(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,598491,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(977388),r=e.i(374829),l=e.i(515288),n=e.i(519455),i=e.i(487486),d=e.i(776639),c=e.i(629288),o=e.i(981140),m=e.i(369340),u=e.i(248425),x="Toggle",h=s.forwardRef((e,s)=>{let{pressed:a,defaultPressed:r,onPressedChange:l,...n}=e,[i,d]=(0,m.useControllableState)({prop:a,onChange:l,defaultProp:r??!1,caller:x});return(0,t.jsx)(u.Primitive.button,{type:"button","aria-pressed":i,"data-state":i?"on":"off","data-disabled":e.disabled?"":void 0,...n,ref:s,onClick:(0,o.composeEventHandlers)(e.onClick,()=>{e.disabled||d(!i)})})});h.displayName=x;var p=e.i(225913),g=e.i(975157);let f=(0,p.cva)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),b=s.forwardRef(({className:e,variant:s,size:a,...r},l)=>(0,t.jsx)(h,{ref:l,className:(0,g.cn)(f({variant:s,size:a,className:e})),...r}));b.displayName=h.displayName;var j=e.i(110204),y=e.i(772436),v=e.i(643531),N=e.i(37727),w=e.i(114683),C=e.i(531278),S=e.i(561659),k=e.i(87316),T=e.i(711190),P=e.i(95187);let I=(0,P.createServerReference)("40063e45a01fcbc9e1bad18991a61b168bb0aea8b1",P.callServer,void 0,P.findSourceMapURL,"getSubscriptionData"),D=(0,P.createServerReference)("78ad81a6e1de1868e437272fe4aa970da1f3fc95c1",P.callServer,void 0,P.findSourceMapURL,"updateSubscriptionPlan"),A=(0,P.createServerReference)("6064f866a50c73160123a784f3c783f4dd84497763",P.callServer,void 0,P.findSourceMapURL,"syncSubscriptionStatus"),E=[.4,0,.2,1],R=e=>{try{let t;if("string"==typeof e)t=new Date(e);else if("number"==typeof e)t=new Date(e);else{if(!(e instanceof Date))return{days:0,hours:0,minutes:0,seconds:0};t=e}if(isNaN(t.getTime()))return{days:0,hours:0,minutes:0,seconds:0};let s=new Date,a=t.getTime()-s.getTime();if(a<=0)return{days:0,hours:0,minutes:0,seconds:0};return{days:Math.floor(a/864e5),hours:Math.floor(a%864e5/36e5),minutes:Math.floor(a%36e5/6e4),seconds:Math.floor(a%6e4/1e3)}}catch{return{days:0,hours:0,minutes:0,seconds:0}}},M=e=>({id:e.priceId,title:e.title,description:e.description,currency:"RM",monthlyPrice:String(e.priceAmount/100),yearlyPrice:String(e.priceAmount/100),buttonText:"Select Plan",features:e.features.map(e=>({name:e,icon:"check",iconColor:"text-green-500"}))}),B=({value:e,label:s})=>(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold tabular-nums sm:text-3xl",children:String(e).padStart(2,"0")}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:s})]}),L=({trialEndDate:e,daysRemaining:a,onUpgrade:r,className:d,title:c="Trial Period",description:o,upgradeButtonText:m="Upgrade Now",features:u=["Unlimited projects","Priority support","Advanced analytics","Custom integrations"]})=>{let[x,h]=(0,s.useState)(!1),[p,f]=(0,s.useState)(()=>e?R(e):{days:a||0,hours:0,minutes:0,seconds:0});(0,s.useEffect)(()=>{if(!e)return;let t=setInterval(()=>{f(R(e))},1e3);return()=>clearInterval(t)},[e]);let b=a??p.days,j=async()=>{if(r){h(!0);try{await r()}finally{h(!1)}}};return(0,t.jsxs)(l.Card,{className:(0,g.cn)("w-full max-w-md",d),children:[(0,t.jsxs)(l.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(l.CardTitle,{className:"text-base font-medium",children:c}),b<=0?(0,t.jsx)(i.Badge,{variant:"destructive",children:"Expired"}):b<=2?(0,t.jsx)(i.Badge,{variant:"destructive",children:"Expiring Soon"}):b<=6?(0,t.jsx)(i.Badge,{variant:"secondary",children:"Active"}):(0,t.jsx)(i.Badge,{variant:"default",children:"Active"})]}),o&&(0,t.jsx)(l.CardDescription,{children:o})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-6",children:[e&&b>0&&(0,t.jsx)("div",{className:"bg-muted/30 rounded-lg border p-4",role:"status","aria-live":"polite","aria-atomic":"true",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 sm:gap-4",children:[(0,t.jsx)(B,{value:p.days,label:"Days"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,t.jsx)(B,{value:p.hours,label:"Hours"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,t.jsx)(B,{value:p.minutes,label:"Min"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,t.jsx)(B,{value:p.seconds,label:"Sec"})]})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold",children:"Included with upgrade"}),(0,t.jsx)("div",{className:"space-y-2",children:u.slice(0,4).map((e,s)=>(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-sm",children:[(0,t.jsx)(v.Check,{className:"text-primary h-4 w-4"}),(0,t.jsx)("span",{children:e})]},s))})]}),r&&(0,t.jsx)(n.Button,{onClick:j,disabled:x,className:"w-full",size:"lg",children:x?"Processing...":m})]})]})},_=({currentPlan:e,plans:l,onPlanChange:o,className:m,title:u,triggerText:x})=>{let[h,p]=(0,s.useState)(!1),[f,y]=(0,s.useState)(void 0),[v,N]=(0,s.useState)(!1),w=(0,s.useCallback)(e=>h?`${e.yearlyPrice}`:`${e.monthlyPrice}`,[h]),C=(0,s.useCallback)(e=>{y(t=>t===e?void 0:e)},[]),S=(0,s.useCallback)(e=>{N(e),e||y(void 0)},[]);return(0,t.jsxs)(d.Dialog,{open:v,onOpenChange:S,children:[(0,t.jsx)(d.DialogTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{children:x||"Update Plan"})}),(0,t.jsxs)(d.DialogContent,{className:(0,g.cn)("text-foreground flex max-h-[95vh] flex-col gap-3 sm:max-h-[90vh] sm:gap-4","w-[calc(100vw-2rem)] max-w-2xl sm:w-full","p-4 sm:p-6",m),children:[(0,t.jsxs)(d.DialogHeader,{className:"flex flex-col gap-3 pb-2 sm:flex-row sm:items-center sm:justify-between sm:gap-4 sm:pb-0",children:[(0,t.jsx)(d.DialogTitle,{className:"text-lg font-semibold sm:text-xl",children:u||"Upgrade Plan"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-sm sm:gap-2",children:[(0,t.jsx)(b,{size:"sm",pressed:!h,onPressedChange:e=>p(!e),className:"h-9 px-3 text-xs sm:h-10 sm:px-4 sm:text-sm",children:"Monthly"}),(0,t.jsx)(b,{size:"sm",pressed:h,onPressedChange:e=>p(e),className:"h-9 px-3 text-xs sm:h-10 sm:px-4 sm:text-sm",children:"Yearly"})]})]}),(0,t.jsx)("div",{className:"min-h-0 flex-1 overflow-y-auto -mx-4 px-4 sm:-mx-6 sm:px-6",children:0===l.length?(0,t.jsx)("div",{className:"flex items-center justify-center py-12 text-center",children:(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No plans available"})}):(0,t.jsx)(c.RadioGroup,{value:f,onValueChange:C,children:(0,t.jsx)("div",{className:"space-y-2.5 pb-2 sm:space-y-3",children:l.map((s,l)=>(0,t.jsxs)(a.motion.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{layout:{duration:.3,ease:E},opacity:{delay:.05*l,duration:.3,ease:E},y:{delay:.05*l,duration:.3,ease:E}},onClick:()=>C(s.id),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),C(s.id))},role:"button",tabIndex:0,"aria-pressed":f===s.id,className:(0,g.cn)("relative cursor-pointer overflow-hidden rounded-lg border transition-all duration-200 sm:rounded-xl","focus-visible:ring-primary focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none",f===s.id?"border-primary from-muted/60 to-muted/30 bg-gradient-to-br shadow-sm":"border-border hover:border-primary/50"),children:[(0,t.jsx)(a.motion.div,{layout:"position",className:"p-3 sm:p-4",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2 sm:gap-3",children:[(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 gap-2 sm:gap-3",children:[(0,t.jsx)(c.RadioGroupItem,{value:s.id,id:s.id,className:"pointer-events-none mt-0.5 flex-shrink-0 sm:mt-1"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2",children:[(0,t.jsx)(j.Label,{htmlFor:s.id,className:"cursor-pointer text-sm leading-tight font-semibold sm:text-base sm:font-medium",children:s.title}),s.badge&&(0,t.jsx)(i.Badge,{variant:"secondary",className:"h-5 px-1.5 py-0 text-[10px] sm:text-xs",children:s.badge})]}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1 text-[11px] leading-relaxed sm:text-xs",children:s.description}),s.features.length>0&&(0,t.jsx)("div",{className:"pt-2 sm:pt-3",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:s.features.map((e,s)=>(0,t.jsxs)("div",{className:"bg-muted/20 border-border/30 flex items-center gap-1.5 rounded-md border px-2 py-1 sm:rounded-lg",children:[(0,t.jsx)("div",{className:"bg-primary h-1 w-1 rounded-full sm:h-1.5 sm:w-1.5"}),(0,t.jsx)("span",{className:"text-muted-foreground text-[10px] whitespace-nowrap sm:text-xs",children:e.name})]},s))})})]})]}),(0,t.jsxs)("div",{className:"min-w-[60px] flex-shrink-0 text-right sm:min-w-[80px]",children:[(0,t.jsx)("div",{className:"text-base font-bold sm:text-xl sm:font-semibold",children:parseFloat(w(s))>=0?`${s.currency}${w(s)}`:w(s)}),(0,t.jsxs)("div",{className:"text-muted-foreground mt-0.5 text-[10px] sm:text-xs",children:["/",h?"year":"month"]})]})]})}),(0,t.jsx)(r.AnimatePresence,{initial:!1,children:f===s.id&&(0,t.jsx)(a.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1,transition:{height:{duration:.3,ease:E},opacity:{duration:.25,delay:.05,ease:E}}},exit:{height:0,opacity:0,transition:{height:{duration:.25,ease:E},opacity:{duration:.15,ease:E}}},className:"overflow-hidden",children:(0,t.jsx)(a.motion.div,{initial:{y:-8},animate:{y:0,transition:{duration:.25,delay:.05,ease:E}},exit:{y:-8},className:"px-3 pb-3 sm:px-4 sm:pb-4",children:(0,t.jsx)(n.Button,{className:"h-10 w-full text-sm font-medium sm:h-11 sm:text-base",disabled:f===e.id,onClick:e=>{e.stopPropagation(),o(s.id),S(!1)},children:f===e.id?"Current Plan":"Upgrade"})})})})]},s.id))})})})]})]})},U=({title:e,description:a,plan:r,triggerButtonText:l,leftPanelImageUrl:c,warningTitle:o,warningText:m,keepButtonText:u,continueButtonText:x,finalTitle:h,finalSubtitle:p,finalWarningText:f,goBackButtonText:b,confirmButtonText:j,onCancel:y,onKeepSubscription:v,onDialogClose:C,className:S})=>{let[k,T]=(0,s.useState)(!1),[P,I]=(0,s.useState)(!1),[D,A]=(0,s.useState)(!1),[E,R]=(0,s.useState)(null),M=async()=>{try{A(!0),R(null),await y(r.id),L()}catch(e){R(e instanceof Error?e.message:"Failed to cancel subscription")}finally{A(!1)}},B=async()=>{try{A(!0),R(null),v&&await v(r.id),L()}catch(e){R(e instanceof Error?e.message:"Failed to keep subscription")}finally{A(!1)}},L=()=>{I(!1),T(!1),R(null),A(!1),C?.()};return(0,s.useEffect)(()=>{let e=e=>{P&&"Escape"===e.key&&(e.preventDefault(),L())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[P]),(0,t.jsxs)(d.Dialog,{open:P,onOpenChange:e=>{e?I(!0):L()},children:[(0,t.jsx)(d.DialogTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"outline",children:l||"Cancel Subscription"})}),(0,t.jsxs)(d.DialogContent,{className:(0,g.cn)("text-foreground flex w-[95%] flex-col overflow-hidden p-0 sm:max-w-[1000px] md:w-[100%] md:flex-row",c?"":"sm:max-w-[500px]",S),children:[(0,t.jsx)(d.DialogTitle,{className:"sr-only",children:e}),(0,t.jsxs)(d.DialogClose,{className:"ring-offset-background focus:ring-ring absolute top-4 right-4 z-10 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",onClick:L,children:[(0,t.jsx)(N.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]}),c&&(0,t.jsxs)("div",{className:"relative hidden min-h-[500px] w-full overflow-hidden md:block md:w-1/2",children:[(0,t.jsx)("img",{src:c,alt:"Cancel Subscription",className:"absolute inset-0 h-full w-full object-cover"}),(0,t.jsx)("div",{className:"via-background/30 to-background/90 absolute inset-0 hidden bg-gradient-to-r from-transparent dark:block"}),(0,t.jsx)("div",{className:"from-background/80 to-background/20 absolute inset-0 hidden bg-gradient-to-t via-transparent dark:block"})]}),(0,t.jsxs)("div",{className:(0,g.cn)("flex flex-col gap-4 px-4 py-6",c?"w-full md:w-1/2":"w-full"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 text-center md:text-left",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold md:text-2xl",children:e}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs md:text-sm",children:a}),E&&(0,t.jsx)("div",{className:"bg-destructive/10 border-destructive/20 rounded-md border p-3",children:(0,t.jsx)("p",{className:"text-destructive text-sm",children:E})})]}),!k&&(0,t.jsxs)("div",{className:"bg-muted/50 flex flex-col gap-4 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsxs)("span",{className:"text-lg font-semibold",children:[r.title," Plan"]}),(0,t.jsx)("span",{className:"text-muted-foreground text-sm",children:"Current subscription"})]}),(0,t.jsx)(i.Badge,{variant:"secondary",children:parseFloat(String(r.monthlyPrice))>=0?`${r.currency}${r.monthlyPrice}/monthly`:`${r.monthlyPrice}/monthly`})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:r.features.slice(0,4).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.Circle,{className:"fill-primary text-primary h-2 w-2"}),(0,t.jsx)("span",{className:"text-muted-foreground text-sm",children:e.name})]},s))})]}),!k&&(o||m)&&(0,t.jsxs)("div",{className:"bg-muted/30 border-border rounded-lg border p-4",children:[o&&(0,t.jsx)("h3",{className:"text-foreground mb-2 font-semibold",children:o}),m&&(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:m})]}),k?(0,t.jsxs)("div",{className:"mt-auto flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 text-center",children:[(0,t.jsx)("h3",{className:"text-foreground mb-2 font-semibold",children:h||"Final Confirmation"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-2 text-sm",children:p||"Are you sure you want to cancel your subscription?"}),(0,t.jsx)("p",{className:"text-destructive text-sm",children:f||"This action cannot be undone and you'll lose access to all premium features."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,t.jsx)(n.Button,{variant:"outline",className:"flex-1",onClick:()=>{T(!1),R(null)},disabled:D,children:b||"Go Back"}),(0,t.jsx)(n.Button,{variant:"destructive",className:"flex-1",onClick:M,disabled:D,children:D?"Cancelling...":j||"Yes, Cancel Subscription"})]})]}):(0,t.jsxs)("div",{className:"mt-auto flex flex-col gap-3 sm:flex-row",children:[(0,t.jsx)(n.Button,{className:"flex-1",onClick:B,disabled:D,children:D?"Processing...":u||"Keep My Subscription"}),(0,t.jsx)(n.Button,{variant:"destructive",className:"flex-1",onClick:()=>{T(!0),R(null)},disabled:D,children:x||"Continue Cancellation"})]})]})]})]})},F=({className:e,currentPlan:s,cancelSubscription:a,updatePlan:r})=>(0,t.jsx)("div",{className:(0,g.cn)("w-full text-left",e),children:(0,t.jsxs)(l.Card,{className:"shadow-lg",children:[(0,t.jsxs)(l.CardHeader,{className:"px-4 pb-4 sm:px-6 sm:pb-6",children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2 text-lg sm:gap-3 sm:text-xl",children:[(0,t.jsx)("div",{className:"bg-primary/10 ring-primary/20 rounded-lg p-1.5 ring-1 sm:p-2",children:(0,t.jsx)(S.CreditCard,{className:"text-primary h-4 w-4 sm:h-5 sm:w-5"})}),"Current Subscription"]}),(0,t.jsx)(l.CardDescription,{className:"text-sm sm:text-base",children:"Manage your billing and subscription settings"})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-6 px-4 sm:space-y-8 sm:px-6",children:[(0,t.jsx)("div",{className:"from-muted/30 via-muted/20 to-muted/30 border-border/50 relative overflow-hidden rounded-xl border bg-gradient-to-r p-3 sm:p-4",children:(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between sm:gap-0",children:(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:"mb-2 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("h3",{className:"text-lg font-semibold sm:text-xl",children:[s.plan.title," Plan"]})}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(i.Badge,{variant:"active"===s.status?"default":"outline",className:"bg-primary/90 hover:bg-primary border-0 text-xs font-medium shadow-sm sm:text-sm",children:"monthly"===s.type?`${s.plan.currency}${s.plan.monthlyPrice}/month`:"yearly"===s.type?`${s.plan.yearlyPrice}/year`:`${s.price}`}),(0,t.jsx)(i.Badge,{variant:"outline",className:"border-border/60 bg-background/50 text-xs shadow-sm backdrop-blur-sm sm:text-sm",children:s.status})]})]}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs sm:text-sm",children:s.plan.description})]})})})}),(0,t.jsx)(y.Separator,{className:"via-border my-4 bg-gradient-to-r from-transparent to-transparent sm:my-6"}),(0,t.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,t.jsxs)("h4",{className:"flex items-center gap-2 text-base font-medium sm:text-lg",children:[(0,t.jsx)("div",{className:"bg-muted ring-border/50 rounded-md p-1 ring-1 sm:p-1.5",children:(0,t.jsx)(k.Calendar,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),"Billing Information"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-6",children:[(0,t.jsxs)("div",{className:"group from-muted to-background/10 border-border/30 hover:border-border/60 rounded-lg border bg-gradient-to-b p-2.5 transition-all duration-200 sm:p-3",children:[(0,t.jsx)("span",{className:"text-muted-foreground mb-1 block text-xs sm:text-sm",children:"Next billing date"}),(0,t.jsx)("div",{className:"group-hover:text-primary text-sm font-medium transition-colors duration-200 sm:text-base",children:s.nextBillingDate})]}),(0,t.jsxs)("div",{className:"group from-muted to-background/10 border-border/30 hover:border-border/60 rounded-lg border bg-gradient-to-b p-2.5 transition-all duration-200 sm:p-3",children:[(0,t.jsx)("span",{className:"text-muted-foreground mb-1 block text-xs sm:text-sm",children:"Payment method"}),(0,t.jsx)("div",{className:"group-hover:text-primary text-sm font-medium transition-colors duration-200 sm:text-base",children:s.paymentMethod})]})]})]}),(0,t.jsx)(y.Separator,{className:"via-border my-4 bg-gradient-to-r from-transparent to-transparent sm:my-6"}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,t.jsx)(_,{className:"shadow-lg transition-all duration-200 hover:shadow-xl",...r}),(0,t.jsx)(U,{className:"shadow-lg transition-all duration-200 hover:shadow-xl",...a})]}),(0,t.jsxs)("div",{className:"pt-4 sm:pt-6",children:[(0,t.jsx)("h4",{className:"mb-3 text-base font-medium sm:mb-4 sm:text-lg",children:"Current Plan Features"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:s.plan.features.map((e,s)=>(0,t.jsxs)("div",{className:"group border-border/80 hover:border-primary/30 hover:bg-primary/5 flex items-center gap-2 rounded-lg border p-2 transition-all duration-200",children:[(0,t.jsx)("div",{className:"bg-primary group-hover:bg-primary h-1 w-1 flex-shrink-0 rounded-full transition-all duration-200 group-hover:scale-125 sm:h-1.5 sm:w-1.5"}),(0,t.jsx)("span",{className:"text-muted-foreground group-hover:text-foreground text-xs transition-colors duration-200 sm:text-sm",children:e.name})]},s))})]})]})]})}),$=({scope:e,scopeId:a})=>{let[r,l]=(0,s.useState)(!0),[n,i]=(0,s.useState)(null),d=(0,s.useCallback)(async()=>{l(!0);try{let e=await I(a);if(e.success&&e.data?.subscriptionId){await A(a,e.data.subscriptionId);let t=await I(a);if(t.success&&t.data)return void i(t.data)}e.success&&e.data&&i(e.data)}finally{l(!1)}},[a]);if((0,s.useEffect)(()=>{d()},[d]),r)return(0,t.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,t.jsx)(C.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})});let c=n?.priceId?(0,T.getPricingCardByPriceId)(n.priceId):void 0,o=c?M(c):{id:"free",title:"Free",description:"No active subscription",currency:"RM",monthlyPrice:"0",yearlyPrice:"0",buttonText:"Subscribe",features:[]},m=n?.state==="TRIALING",u=n?.state==="ACTIVE",x={plan:o,type:"monthly",price:c?.price||"RM 0",nextBillingDate:n?.currentPeriodEndDate?new Date(n.currentPeriodEndDate).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"Not set",paymentMethod:n?.defaultPaymentMethod||"Not set",status:u||m?"active":n?.state==="CANCELLED"?"cancelled":n?.state==="PAST_DUE"?"past_due":"inactive"},h=(0,T.getPricingCards)("month").map(M),p=async t=>{n?.subscriptionId?(await D("",n.subscriptionId,"update",t),d()):window.location.href=`/${e}/${a}/billing/checkout?plan=${t}`},g=async()=>{n?.subscriptionId&&(await D("",n.subscriptionId,"cancel"),d())};return(0,t.jsx)("div",{className:"space-y-6",children:m&&n?.currentPeriodEndDate?(0,t.jsx)(L,{trialEndDate:new Date(n.currentPeriodEndDate),onUpgrade:()=>{window.location.href=`/${e}/${a}/billing/checkout`},features:o.features.map(e=>e.name)}):(0,t.jsx)(F,{currentPlan:x,updatePlan:{currentPlan:o,plans:h,triggerText:"Update Plan",onPlanChange:p},cancelSubscription:{title:"Cancel Subscription",description:"Are you sure you want to cancel your subscription?",plan:o,leftPanelImageUrl:"/assets/preview.png",warningTitle:"You will lose access to premium features",warningText:"If you cancel your subscription, you will lose access to all premium features at the end of your billing period.",onCancel:g,onKeepSubscription:async()=>{}}})})};var V=e.i(247167),O=e.i(868499),H=e.i(995549),z=e.i(302747),K=e.i(784774),q=e.i(922140),Y=e.i(936065);let G=(0,P.createServerReference)("404e165dae5e5016bd89845fb3e4a518136b156251",P.callServer,void 0,P.findSourceMapURL,"getCustomer"),J=(0,P.createServerReference)("60171b8b821cbf43b1a247fd986f1c8cb05bbd4f12",P.callServer,void 0,P.findSourceMapURL,"createSetupIntent"),W=(0,P.createServerReference)("70a4a4052806e5e9874d73b5eda3126bafdedeca8a",P.callServer,void 0,P.findSourceMapURL,"detachPaymentMethod"),Z=(0,P.createServerReference)("708bbbcd33c4c6d4e7b2b9044c712798a38190c7f5",P.callServer,void 0,P.findSourceMapURL,"listPaymentMethods"),X=(0,P.createServerReference)("782545ac67365f7a122e8875c03900c36bb4d6289b",P.callServer,void 0,P.findSourceMapURL,"replacePaymentMethod"),Q=(0,P.createServerReference)("707d10c3249b06a3e5288e9ef492f2000e0adb75fb",P.callServer,void 0,P.findSourceMapURL,"setDefaultPaymentMethod"),ee=(0,P.createServerReference)("60c979ec615f4dd6cedab1c5229bbc9aa68416db12",P.callServer,void 0,P.findSourceMapURL,"listDunningInvoices"),et=(0,P.createServerReference)("60dcf3e67b55ea387f7c9591b44ed0df3d6a403b82",P.callServer,void 0,P.findSourceMapURL,"listInvoices");var es=e.i(667668);e.i(540259);var ea=e.i(911860),er=e.i(878894),el=e.i(440160),en=e.i(778917),ei=e.i(286536),ed=e.i(178583),ec=e.i(107233),eo=e.i(16715),em=e.i(475254);let eu=(0,em.default)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var ex=e.i(618566);let eh=(0,ea.loadStripe)(V.default.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY),ep=({onSuccess:e,onCancel:a})=>{let r=(0,es.useStripe)(),l=(0,es.useElements)(),[i,c]=(0,s.useState)(!1),[o,m]=(0,s.useState)(null),u=async t=>{if(t.preventDefault(),r&&l){c(!0),m(null);try{let{error:t}=await r.confirmSetup({elements:l,confirmParams:{return_url:`${window.location.origin}${window.location.pathname}`},redirect:"if_required"});t?m(t.message||"An error occurred"):e()}catch{m("An unexpected error occurred")}finally{c(!1)}}};return(0,t.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,t.jsx)(es.PaymentElement,{}),o&&(0,t.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:o}),(0,t.jsxs)(d.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,t.jsx)(n.Button,{type:"button",variant:"outline",onClick:a,disabled:i,children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",disabled:!r||i,children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.CreditCard,{className:"mr-2 h-4 w-4"}),"Add Card"]})})]})]})},eg=({onSuccess:e,onCancel:a})=>{let r=(0,es.useStripe)(),l=(0,es.useElements)(),[i,c]=(0,s.useState)(!1),[o,m]=(0,s.useState)(null),u=async t=>{if(t.preventDefault(),r&&l){c(!0),m(null);try{let{error:t,setupIntent:s}=await r.confirmSetup({elements:l,confirmParams:{return_url:`${window.location.origin}${window.location.pathname}`},redirect:"if_required"});t?m(t.message||"An error occurred"):s?.payment_method?e(s.payment_method):m("Failed to get payment method from setup")}catch{m("An unexpected error occurred")}finally{c(!1)}}};return(0,t.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,t.jsx)(es.PaymentElement,{}),o&&(0,t.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:o}),(0,t.jsxs)(d.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,t.jsx)(n.Button,{type:"button",variant:"outline",onClick:a,disabled:i,children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",disabled:!r||i,children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Replacing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eo.RefreshCw,{className:"mr-2 h-4 w-4"}),"Replace Card"]})})]})]})},ef=({agencyId:e,cards:a,onRefresh:r,className:i})=>{(0,ex.useRouter)();let{toast:c}=(0,q.useToast)(),[o,m]=(0,s.useState)(!1),[u,x]=(0,s.useState)(null),[h,p]=(0,s.useState)(!1),[f,b]=(0,s.useState)(null),[,j]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[N,w]=(0,s.useState)(null),[C,k]=(0,s.useState)(null),T=async()=>{j(!0);try{let t=await J(e);t.success?(b(t.data.clientSecret),p(!0)):c({title:"Error",description:t.error,variant:"destructive"})}catch{c({title:"Error",description:"Failed to initialize card setup",variant:"destructive"})}finally{j(!1)}},P=()=>{p(!1),b(null)},I=async t=>{m(!0);try{let s=await Q(e,void 0,t);s.success?(c({title:"Default card updated",description:"Your default payment method has been updated successfully."}),r()):c({title:"Error",description:s.error,variant:"destructive"})}catch{c({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}finally{m(!1)}},D=async e=>{x(e)},A=async()=>{if(u){m(!0);try{let t=await W(e,void 0,u);t.success?(c({title:"Card removed",description:"Your payment method has been removed successfully."}),r()):c({title:"Error",description:t.error,variant:"destructive"})}catch{c({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}finally{m(!1),x(null)}}},E=async t=>{k(t),j(!0);try{let t=await J(e);t.success?(w(t.data.clientSecret),v(!0)):c({title:"Error",description:t.error,variant:"destructive"})}catch{c({title:"Error",description:"Failed to initialize card replacement",variant:"destructive"})}finally{j(!1)}},R=async t=>{if(!C||!t)return void c({title:"Error",description:"Missing card information",variant:"destructive"});m(!0);try{let s=await X(e,void 0,C,t);s.success?(c({title:"Card replaced",description:"Your payment method has been replaced successfully."}),r()):c({title:"Error",description:s.error,variant:"destructive"})}catch{c({title:"Error",description:"An unexpected error occurred while replacing card",variant:"destructive"})}finally{m(!1),v(!1),w(null),k(null)}},M=()=>{v(!1),w(null),k(null)},B=f?{clientSecret:f,appearance:{theme:"night",variables:{colorPrimary:"#6366f1",colorBackground:"#1f2937",colorText:"#f9fafb",borderRadius:"8px"}}}:null;return(0,t.jsxs)("div",{className:(0,g.cn)("space-y-4",i),children:[(0,t.jsxs)(l.Card,{className:"shadow-lg",children:[(0,t.jsxs)(l.CardHeader,{className:"px-4 pb-4 sm:px-6 sm:pb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2 text-lg sm:gap-3 sm:text-xl",children:[(0,t.jsx)("div",{className:"rounded-lg bg-primary/10 p-1.5 ring-1 ring-primary/20 sm:p-2",children:(0,t.jsx)(S.CreditCard,{className:"h-4 w-4 text-primary sm:h-5 sm:w-5"})}),"Payment Methods"]}),(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:T,className:"gap-1.5",children:[(0,t.jsx)(ec.Plus,{className:"h-4 w-4"}),"Add New Card"]})]}),(0,t.jsx)(l.CardDescription,{className:"text-sm sm:text-base",children:"Manage your saved payment methods for billing"})]}),(0,t.jsx)(l.CardContent,{className:"px-4 sm:px-6",children:(0,t.jsx)(H.SavedBankCardsGallery,{cards:a,compact:!1,onSetDefault:I,onRemoveCard:D,onReplaceCard:E})})]}),(0,t.jsx)(d.Dialog,{open:h,onOpenChange:P,children:(0,t.jsxs)(d.DialogContent,{className:"sm:max-w-[480px]",children:[(0,t.jsxs)(d.DialogHeader,{children:[(0,t.jsxs)(d.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(S.CreditCard,{className:"h-5 w-5"}),"Add Payment Method"]}),(0,t.jsx)(d.DialogDescription,{children:"Enter your card details below. Your card will be securely saved for future payments."})]}),f&&B&&(0,t.jsx)(es.Elements,{stripe:eh,options:B,children:(0,t.jsx)(ep,{onSuccess:()=>{p(!1),b(null),c({title:"Card added",description:"Your payment method has been added successfully."}),r()},onCancel:P})})]})}),(0,t.jsx)(d.Dialog,{open:y,onOpenChange:M,children:(0,t.jsxs)(d.DialogContent,{className:"sm:max-w-[480px]",children:[(0,t.jsxs)(d.DialogHeader,{children:[(0,t.jsxs)(d.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(eo.RefreshCw,{className:"h-5 w-5"}),"Replace Payment Method"]}),(0,t.jsx)(d.DialogDescription,{children:"Enter your new card details. The old card will be removed automatically."})]}),N&&(0,t.jsx)(es.Elements,{stripe:eh,options:{clientSecret:N,appearance:{theme:"night",variables:{colorPrimary:"#6366f1",colorBackground:"#1f2937",colorText:"#f9fafb",borderRadius:"8px"}}},children:(0,t.jsx)(eg,{onSuccess:R,onCancel:M})})]})}),(0,t.jsx)(O.AlertDialog,{open:null!==u,onOpenChange:e=>!e&&x(null),children:(0,t.jsxs)(O.AlertDialogContent,{children:[(0,t.jsxs)(O.AlertDialogHeader,{children:[(0,t.jsx)(O.AlertDialogTitle,{children:"Remove payment method?"}),(0,t.jsx)(O.AlertDialogDescription,{children:"This will remove the card from your account. If this is your default payment method, you'll need to set a new default before the next billing cycle."})]}),(0,t.jsxs)(O.AlertDialogFooter,{children:[(0,t.jsx)(O.AlertDialogCancel,{disabled:o,children:"Cancel"}),(0,t.jsx)(O.AlertDialogAction,{onClick:A,disabled:o,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:o?"Removing...":"Remove Card"})]})]})})]})},eb=({invoices:e,className:s})=>{let{toast:a}=(0,q.useToast)(),r=async e=>{if(navigator.share&&e.viewUrl)try{await navigator.share({title:`Invoice ${e.description}`,text:`Invoice for ${e.amount} - ${e.date}`,url:e.viewUrl})}catch{}else e.viewUrl&&(await navigator.clipboard.writeText(e.viewUrl),a({title:"Link copied",description:"Invoice link copied to clipboard"}))};return(0,t.jsxs)(l.Card,{className:(0,g.cn)("shadow-lg",s),children:[(0,t.jsxs)(l.CardHeader,{className:"px-4 pb-3 sm:px-6",children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)("div",{className:"rounded-lg bg-primary/10 p-1.5 ring-1 ring-primary/20",children:(0,t.jsx)(ed.FileText,{className:"h-4 w-4 text-primary"})}),"Invoice History"]}),(0,t.jsx)(l.CardDescription,{className:"text-sm",children:"View and download your past invoices"})]}),(0,t.jsx)(l.CardContent,{className:"px-4 pt-0 sm:px-6",children:(0,t.jsxs)(K.Table,{children:[(0,t.jsx)(K.TableHeader,{children:(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableHead,{children:"Date"}),(0,t.jsx)(K.TableHead,{children:"Description"}),(0,t.jsx)(K.TableHead,{children:"Status"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Amount"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(K.TableBody,{children:0===e.length?(0,t.jsx)(K.TableRow,{children:(0,t.jsx)(K.TableCell,{colSpan:5,className:"py-2 text-center text-muted-foreground",children:"No invoices found"})}):e.map(e=>(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableCell,{className:"py-2 font-medium",children:e.date}),(0,t.jsx)(K.TableCell,{className:"py-2",children:e.description}),(0,t.jsx)(K.TableCell,{className:"py-2",children:(0,t.jsx)(i.Badge,{variant:"outline",className:(0,g.cn)((e=>{switch(e){case"paid":return"bg-green-500/10 text-green-500 border-green-500/20";case"pending":return"bg-orange-500/10 text-orange-500 border-orange-500/20";case"failed":return"bg-destructive/10 text-destructive border-destructive/20"}})(e.status),"backdrop-blur-sm"),children:e.status})}),(0,t.jsx)(K.TableCell,{className:"py-2 text-right font-medium",children:e.amount}),(0,t.jsx)(K.TableCell,{className:"py-2 text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[e.viewUrl&&(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>window.open(e.viewUrl,"_blank"),className:"transition-all duration-200 hover:bg-primary/10",title:"View Invoice",children:(0,t.jsx)(ei.Eye,{className:"h-4 w-4"})}),e.downloadUrl&&(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>window.open(e.downloadUrl,"_blank"),className:"transition-all duration-200 hover:bg-primary/10",title:"Download PDF",children:(0,t.jsx)(el.Download,{className:"h-4 w-4"})}),e.viewUrl&&(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>r(e),className:"transition-all duration-200 hover:bg-primary/10",title:"Share Invoice",children:(0,t.jsx)(eu,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})},ej=({dunningInvoices:e,className:s})=>{let a=e.filter(e=>"open"===e.status).length,r=e.filter(e=>"uncollectible"===e.status).length;return(0,t.jsxs)(l.Card,{className:(0,g.cn)("shadow-lg",s),children:[(0,t.jsxs)(l.CardHeader,{className:"px-4 pb-3 sm:px-6",children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)("div",{className:"rounded-lg bg-orange-500/10 p-1.5 ring-1 ring-orange-500/20",children:(0,t.jsx)(er.AlertTriangle,{className:"h-4 w-4 text-orange-500"})}),"Dunning"]}),(0,t.jsx)(l.CardDescription,{className:"text-sm",children:"Monitor payment failures, overdue invoices, and recovery actions"})]}),(0,t.jsxs)(l.CardContent,{className:"px-4 pt-0 sm:px-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3 mb-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Open invoices"}),(0,t.jsx)("div",{className:"mt-1 text-2xl font-semibold",children:a})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Uncollectible"}),(0,t.jsx)("div",{className:"mt-1 text-2xl font-semibold",children:r})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total flagged"}),(0,t.jsx)("div",{className:"mt-1 text-2xl font-semibold",children:e.length})]})]}),(0,t.jsxs)(K.Table,{children:[(0,t.jsx)(K.TableHeader,{children:(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableHead,{children:"Date"}),(0,t.jsx)(K.TableHead,{children:"Invoice"}),(0,t.jsx)(K.TableHead,{children:"Status"}),(0,t.jsx)(K.TableHead,{children:"Due"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Amount"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(K.TableBody,{children:0===e.length?(0,t.jsx)(K.TableRow,{children:(0,t.jsx)(K.TableCell,{colSpan:6,className:"py-4 text-center text-muted-foreground",children:"No overdue invoices found"})}):e.map(e=>(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableCell,{className:"py-2 text-muted-foreground",children:e.date}),(0,t.jsx)(K.TableCell,{className:"py-2 font-mono text-xs",children:e.number}),(0,t.jsx)(K.TableCell,{className:"py-2",children:(0,t.jsx)(i.Badge,{variant:"open"===e.status?"secondary":"outline",className:"backdrop-blur-sm",children:e.status})}),(0,t.jsx)(K.TableCell,{className:"py-2 text-muted-foreground",children:e.dueDate??"—"}),(0,t.jsxs)(K.TableCell,{className:"py-2 text-right font-medium",children:[e.amount," ",e.currency]}),(0,t.jsx)(K.TableCell,{className:"py-2 text-right",children:e.hostedUrl?(0,t.jsx)(n.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,t.jsxs)("a",{href:e.hostedUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)(en.ExternalLink,{className:"mr-2 h-4 w-4"}),"Open"]})}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"—"})})]},e.id))})]})]})]})},ey=()=>(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(l.Card,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(z.Skeleton,{className:"h-6 w-48"}),(0,t.jsx)(z.Skeleton,{className:"h-4 w-64"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(z.Skeleton,{className:"h-32 w-48"}),(0,t.jsx)(z.Skeleton,{className:"h-32 w-48"})]})]})}),(0,t.jsx)(l.Card,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(z.Skeleton,{className:"h-6 w-48"}),(0,t.jsx)(z.Skeleton,{className:"h-4 w-64"}),(0,t.jsx)(z.Skeleton,{className:"h-48 w-full"})]})})]}),ev=({scope:e,scopeId:a,customerId:r,name:i,showPaymentMethods:d=!0,showInvoices:c=!0,showDunning:o=!1,className:m})=>{let[u,x]=(0,s.useState)(!0),[h,p]=(0,s.useState)([]),[f,b]=(0,s.useState)([]),[j,y]=(0,s.useState)([]),[v,N]=(0,s.useState)(null),[w,C]=(0,s.useState)(r??void 0),[S,k]=(0,s.useState)(i??void 0),T=async()=>{x(!0),N(null);try{let t=w,s=S;if(!t&&"agency"===e){let e=await (0,Y.getAgencyDetails)(a);e?.customerId&&(t=e.customerId,s=e.name||void 0,C(t),k(s))}if(!t)return void x(!1);let r=await G(t),l=r?.invoice_settings?.default_payment_method,n=await Z(void 0,void 0,t);if(n.success){let e=n.data.map(e=>({id:e.id,cardNumber:`•••• •••• •••• ${e.card?.last4||"----"}`,cardholderName:e.billing_details?.name||s||"Cardholder",expiryMonth:String(e.card?.exp_month||"--").padStart(2,"0"),expiryYear:String(e.card?.exp_year||"----"),variant:(e=>{switch(e?.toLowerCase()){case"visa":case"mastercard":default:return"default";case"amex":return"premium";case"discover":return"platinum"}})(e.card?.brand),isDefault:e.id===l,brand:e.card?.brand?.toUpperCase()}));p(e)}let i=await et(t,25);if(i.success){let e=i.data.map(e=>{let t=(e.amount_paid??e.amount_due??0)/100,s=e.currency?.toUpperCase()??"USD";return{id:e.id,date:e.created?new Date(1e3*e.created).toLocaleDateString():"—",description:e.number??e.lines.data[0]?.description??"Invoice",amount:`${t.toFixed(2)} ${s}`,status:(e=>{switch(e){case"paid":return"paid";case"open":case"draft":return"pending";default:return"failed"}})(e.status??null),viewUrl:e.hosted_invoice_url??void 0,downloadUrl:e.invoice_pdf??void 0}});b(e)}if(o){let e=await ee(t,25);if(e.success){let t=e.data.map(e=>({id:e.id,number:e.number??e.id,status:e.status,date:e.created?new Date(1e3*e.created).toLocaleDateString():"—",dueDate:e.due_date?new Date(1e3*e.due_date).toLocaleDateString():null,amount:((e.amount_due??0)/100).toFixed(2),currency:e.currency?.toUpperCase()??"USD",hostedUrl:e.hosted_invoice_url??null}));y(t)}}}catch(e){console.error("Failed to fetch payment data:",e),N("Failed to load payment information")}finally{x(!1)}};return((0,s.useEffect)(()=>{T()},[a]),"agency"!==e)?(0,t.jsxs)(l.Card,{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Payments"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Payment management for subaccounts is not enabled yet."})]}):u?(0,t.jsx)(ey,{}):v?(0,t.jsx)(l.Card,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-destructive",children:"Error"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:v})]}),(0,t.jsxs)(n.Button,{variant:"outline",onClick:T,children:[(0,t.jsx)(eo.RefreshCw,{className:"mr-2 h-4 w-4"}),"Retry"]})]})}):(0,t.jsxs)("div",{className:(0,g.cn)("space-y-4",m),children:[d&&(0,t.jsx)(ef,{agencyId:a,cards:h,onRefresh:T}),c&&(0,t.jsx)(eb,{invoices:f}),o&&(0,t.jsx)(ej,{dunningInvoices:j})]})};var eN=e.i(793479),ew=e.i(967489),eC=e.i(846696),eS=e.i(274323),ek=e.i(39312);let eT=(0,em.default)("ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),eP=(0,em.default)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);e.i(635408),e.i(676027);let eI=({agencyId:e,subAccountId:a,className:r})=>{let o=a?"SUBACCOUNT":"AGENCY",[m,u]=(0,s.useState)(!0),[x,h]=(0,s.useState)([]),[p,f]=(0,s.useState)({}),[b,v]=(0,s.useState)(!1),[N,w]=(0,s.useState)(""),[C,k]=(0,s.useState)("100"),[T,P]=(0,s.useState)("stripe"),[I,D]=(0,s.useState)(!1),A=(0,s.useMemo)(()=>Object.values(p||{}).filter(e=>e?.creditEnabled).map(e=>({key:e.key,label:e.title?`${e.title} (${e.key})`:e.key})).sort((e,t)=>e.key.localeCompare(t.key)),[p]),E=async()=>{u(!0);try{let t=new URL("/api/features/core/billing/entitlements/current",window.location.origin);t.searchParams.set("agencyId",e),a&&t.searchParams.set("subAccountId",a);let s=await fetch(t.toString(),{headers:{[a?"x-autlify-subaccount":"x-autlify-agency"]:a??e},cache:"no-store"}),r=await s.json();if(!s.ok)throw Error(r?.error||"Failed to load entitlements");f(r?.entitlements??{});let l=new URL("/api/features/core/billing/credits/balance",window.location.origin);l.searchParams.set("agencyId",e),a&&l.searchParams.set("subAccountId",a),l.searchParams.set("scope",o);let n=await fetch(l.toString(),{headers:{[a?"x-autlify-subaccount":"x-autlify-agency"]:a??e},cache:"no-store"}),i=await n.json();if(!n.ok||!i?.ok)throw Error(i?.reason||"Failed to load balances");h(i.balances??[])}catch(e){eC.toast.error(e?.message??"Failed to load credits")}finally{u(!1)}};(0,s.useEffect)(()=>{E()},[e,a]),(0,s.useEffect)(()=>{!N&&A.length&&w(A[0].key)},[N,A]);let R=async()=>{try{D(!0);let t=Math.max(1,Math.floor(Number(C)||0));if(!N||t<=0)return void eC.toast.error("Please select a feature and enter credits");if("stripe"===T){let s=await fetch("/api/stripe/credits/checkout",{method:"POST",headers:{"Content-Type":"application/json",[a?"x-autlify-subaccount":"x-autlify-agency"]:a??e},body:JSON.stringify({agencyId:e,subAccountId:a,featureKey:N,credits:t})}),r=await s.json();if(!s.ok||!r?.ok)throw Error(r?.error||"Failed to create checkout");r.url&&(window.location.href=r.url);return}let s=await fetch("/api/features/core/billing/credits/topup",{method:"POST",headers:{"Content-Type":"application/json",[a?"x-autlify-subaccount":"x-autlify-agency"]:a??e},body:JSON.stringify({agencyId:e,subAccountId:a,scope:o,featureKey:N,credits:t,idempotencyKey:`ui-topup:${e}:${a??"null"}:${N}:${Date.now()}`})}),r=await s.json();if(!s.ok||!r?.ok)throw Error(r?.error||"Top-up failed");eC.toast.success("Credits added"),v(!1),await E()}catch(e){eC.toast.error(e?.message??"Top-up failed")}finally{D(!1)}};return(0,t.jsxs)(l.Card,{className:(0,g.cn)("p-6",r),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Credits & Top‑Up"}),(0,t.jsx)(i.Badge,{variant:"secondary",className:"font-mono text-xs",children:o})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Credit balances are used for internal overages and add-ons (per feature). This page is ready for Stripe-paid top-ups."})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(n.Button,{variant:"outline",className:"gap-2",onClick:E,children:[(0,t.jsx)(eo.RefreshCw,{className:"h-4 w-4"}),"Refresh"]}),(0,t.jsxs)(d.Dialog,{open:b,onOpenChange:v,children:[(0,t.jsx)(d.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{className:"gap-2",children:[(0,t.jsx)(eS.PlusCircle,{className:"h-4 w-4"}),"Top‑up credits"]})}),(0,t.jsxs)(d.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsxs)(d.DialogHeader,{children:[(0,t.jsx)(d.DialogTitle,{children:"Top‑up credits"}),(0,t.jsx)(d.DialogDescription,{children:"Purchase credits to use for features and add-ons."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{children:"Top-up Method"}),(0,t.jsxs)(c.RadioGroup,{value:T,onValueChange:e=>P(e),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.RadioGroupItem,{value:"stripe",id:"stripe"}),(0,t.jsxs)(j.Label,{htmlFor:"stripe",className:"flex cursor-pointer items-center gap-2",children:[(0,t.jsx)(S.CreditCard,{className:"h-4 w-4"}),"Pay with Card"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.RadioGroupItem,{value:"manual",id:"manual"}),(0,t.jsxs)(j.Label,{htmlFor:"manual",className:"flex cursor-pointer items-center gap-2",children:[(0,t.jsx)(ek.Zap,{className:"h-4 w-4"}),"Manual (Admin)"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{children:"Feature"}),(0,t.jsxs)(ew.Select,{value:N,onValueChange:w,children:[(0,t.jsx)(ew.SelectTrigger,{children:(0,t.jsx)(ew.SelectValue,{placeholder:"Select feature"})}),(0,t.jsx)(ew.SelectContent,{children:A.map(e=>(0,t.jsx)(ew.SelectItem,{value:e.key,children:e.label},e.key))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{children:"Credits"}),(0,t.jsx)(eN.Input,{value:C,onChange:e=>k(e.target.value),inputMode:"numeric"}),"stripe"===T&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Price: $",(.01*Math.max(1,Number(C)||0)).toFixed(2)," USD ($0.01 per credit, min $1.00)"]}),"manual"===T&&(0,t.jsx)("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Manual top-up is for admin use only. No payment will be charged."})]})]}),(0,t.jsxs)(d.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:()=>v(!1),disabled:I,children:"Cancel"}),(0,t.jsx)(n.Button,{onClick:R,disabled:I,children:I?"Processing...":"stripe"===T?"Pay & Add Credits":"Add Credits"})]})]})]})]})]}),(0,t.jsx)(y.Separator,{className:"my-4"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(K.Table,{children:[(0,t.jsx)(K.TableHeader,{children:(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableHead,{children:"Feature"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Balance"}),(0,t.jsx)(K.TableHead,{children:"Expires"}),(0,t.jsx)(K.TableHead,{children:"Period"})]})}),(0,t.jsxs)(K.TableBody,{children:[m?Array.from({length:6}).map((e,s)=>(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableCell,{children:(0,t.jsx)(z.Skeleton,{className:"h-5 w-[240px]"})}),(0,t.jsx)(K.TableCell,{className:"text-right",children:(0,t.jsx)(z.Skeleton,{className:"ml-auto h-5 w-[120px]"})}),(0,t.jsx)(K.TableCell,{children:(0,t.jsx)(z.Skeleton,{className:"h-5 w-[160px]"})}),(0,t.jsx)(K.TableCell,{children:(0,t.jsx)(z.Skeleton,{className:"h-5 w-[120px]"})})]},s)):x.map(e=>{let s=p?.[e.featureKey];return(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableCell,{className:"font-mono text-xs",children:e.featureKey}),(0,t.jsx)(K.TableCell,{className:"text-right font-medium",children:e.balance}),(0,t.jsx)(K.TableCell,{className:"text-muted-foreground",children:e.expiresAt?new Date(e.expiresAt).toLocaleDateString():"—"}),(0,t.jsx)(K.TableCell,{className:"text-muted-foreground",children:s?.period??"—"})]},e.featureKey)}),!m&&0===x.length&&(0,t.jsx)(K.TableRow,{children:(0,t.jsx)(K.TableCell,{colSpan:4,className:"text-center text-sm text-muted-foreground",children:"No credit balances yet."})})]})]})})]})},eD=({className:e})=>{let[a,r]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),[o,m]=(0,s.useState)(null),u=async()=>{try{c(!0),m(null);let e=await fetch("/api/stripe/validate-coupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:a.trim()})}),t=await e.json();if(!e.ok)throw Error(t?.error||"Invalid coupon");m(t.coupon),eC.toast.success("Coupon valid")}catch(e){eC.toast.error(e?.message??"Failed to validate")}finally{c(!1)}};return(0,t.jsxs)(l.Card,{className:(0,g.cn)("p-6",e),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eT,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Coupons"})]}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Validate a coupon code (Stripe). Apply the code during subscription checkout."}),(0,t.jsx)(y.Separator,{className:"my-4"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,t.jsx)(eN.Input,{value:a,onChange:e=>r(e.target.value),placeholder:"Enter coupon code…"}),(0,t.jsx)(n.Button,{onClick:u,disabled:d||!a.trim(),children:d?"Validating…":"Validate"})]}),o&&(0,t.jsx)("div",{className:"mt-4 rounded-lg border bg-card/50 p-4",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:o.id}),(0,t.jsx)("div",{className:"mt-1 text-sm text-muted-foreground",children:null!=o.percent_off?`${o.percent_off}% off`:null!=o.amount_off?`${o.amount_off} ${o.currency?.toUpperCase()} off`:"—"}),(0,t.jsxs)("div",{className:"mt-2 text-sm text-muted-foreground",children:["Duration: ",o.duration,o.duration_in_months?` (${o.duration_in_months} months)`:""]})]}),(0,t.jsx)(i.Badge,{children:"Valid"})]})})]})},eA=({scope:e,scopeId:s,showCredits:a=!0,showCoupons:r=!0,className:n})=>{let i="agency"===e?s:void 0,d="subAccount"===e?s:void 0;return(0,t.jsxs)("div",{className:(0,g.cn)("space-y-6",n),children:[a&&!!i&&(0,t.jsx)(eI,{agencyId:i,subAccountId:d}),r&&(0,t.jsx)(eD,{}),!a&&!r&&(0,t.jsx)(l.Card,{className:"p-6 text-center",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"No promotional features enabled."})})]})};function eE(e,t){return e===t}let eR=e=>{if(!e.length)return"";let t=Object.keys(e[0]);return[t.join(","),...e.map(e=>t.map(t=>{let s,a,r;return s=String(e[t]??""),a=/[\n\r,\"]/g.test(s),r=s.replace(/\"/g,'""'),a?`"${r}"`:r}).join(","))].join("\n")},eM=(e,t)=>{let s=new Blob([t],{type:"text/csv;charset=utf-8"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=e,r.click(),URL.revokeObjectURL(a)},eB=e=>new Intl.NumberFormat().format(e),eL=({className:e,title:s="Detailed Usage",description:a,resources:r})=>(0,t.jsxs)(l.Card,{className:(0,g.cn)("w-full",e),children:[(0,t.jsxs)(l.CardHeader,{children:[(0,t.jsx)(l.CardTitle,{children:s}),a&&(0,t.jsx)(l.CardDescription,{children:a})]}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("div",{className:"overflow-x-auto rounded-md border",children:(0,t.jsxs)(K.Table,{children:[(0,t.jsx)(K.TableCaption,{className:"sr-only",children:"Detailed usage of resources"}),(0,t.jsx)(K.TableHeader,{children:(0,t.jsxs)(K.TableRow,{className:"from-muted/30 via-muted/20 to-muted/30 border-border/50 relative overflow-hidden border-b bg-gradient-to-b hover:bg-gradient-to-b",children:[(0,t.jsx)(K.TableHead,{className:"w-[180px]",children:"Resource"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Used"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Limit"}),(0,t.jsx)(K.TableHead,{className:"min-w-[160px] text-right",children:"Usage"})]})}),(0,t.jsx)(K.TableBody,{children:0===r.length?(0,t.jsx)(K.TableRow,{children:(0,t.jsx)(K.TableCell,{colSpan:4,className:"text-muted-foreground h-24 text-center",children:"No resources found"})}):r.map((e,s)=>{let a,r=e.percentage??(e.limit>0?e.used/e.limit*100:0),l=e.unit?` ${e.unit}`:"";return(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableCell,{className:"font-medium",children:e.name}),(0,t.jsxs)(K.TableCell,{className:"text-right tabular-nums",children:[eB(e.used),l]}),(0,t.jsxs)(K.TableCell,{className:"text-muted-foreground text-right tabular-nums",children:[eB(e.limit),l]}),(0,t.jsx)(K.TableCell,{className:"text-right",children:(a="bg-emerald-500",r>=90?a="bg-destructive":r>=75&&(a="bg-orange-500"),(0,t.jsxs)("div",{className:"flex min-w-[120px] items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-secondary h-2 flex-1 rounded-full",children:(0,t.jsx)("div",{className:(0,g.cn)("h-2 rounded-full transition-all",a),style:{width:`${Math.max(0,Math.min(r,100))}%`}})}),(0,t.jsxs)("span",{className:"w-10 text-right text-xs font-medium tabular-nums",children:[Math.round(r),"%"]})]}))})]},e.name||s)})})]})})})]}),e_=({className:e})=>(0,t.jsxs)(l.Card,{className:(0,g.cn)("p-6",e),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Cost Allocation"}),(0,t.jsx)(i.Badge,{variant:"secondary",className:"text-xs",children:"Add‑On (Future Accounting)"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Define how usage, credits, and invoices are split across departments / cost centers."})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"outline",disabled:!0,children:"Export rules"}),(0,t.jsx)(n.Button,{disabled:!0,children:"Create rule"})]})]}),(0,t.jsx)(y.Separator,{className:"my-4"}),(0,t.jsx)("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm",children:"This module is scaffolded for the 9th billing item (Split Bill / Recharges / Cost allocation). Once the accounting module is available, wire this page to: (1) dimensions/cost centers, (2) allocation rules, (3) downstream postings."}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"text-left text-muted-foreground",children:[(0,t.jsx)("th",{className:"py-2 pr-4",children:"Name"}),(0,t.jsx)("th",{className:"py-2 pr-4",children:"Basis"}),(0,t.jsx)("th",{className:"py-2 pr-4",children:"Target"}),(0,t.jsx)("th",{className:"py-2 pr-4",children:"Split"}),(0,t.jsx)("th",{className:"py-2",children:"Status"})]})}),(0,t.jsxs)("tbody",{className:"divide-y",children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-3 pr-4",children:"Example: Support recharges"}),(0,t.jsx)("td",{className:"py-3 pr-4 text-muted-foreground",children:"Usage events"}),(0,t.jsx)("td",{className:"py-3 pr-4 text-muted-foreground",children:"Cost Center"}),(0,t.jsx)("td",{className:"py-3 pr-4 text-muted-foreground",children:"60/40"}),(0,t.jsx)("td",{className:"py-3",children:(0,t.jsx)(i.Badge,{variant:"outline",children:"Draft"})})]}),(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"py-6 text-center text-muted-foreground",children:"No allocation rules configured yet."})})]})]})})]}),eU=({scope:a,scopeId:r,showAllocation:d=!0,defaultPeriod:c="MONTHLY",className:o})=>{var m,u,x,h;let p="agency"===a?r:void 0,f="subAccount"===a?r:void 0,b="subAccount"===a?"SUBACCOUNT":"AGENCY",[j,v]=(0,s.useState)(c),[N,w]=(0,s.useState)("0"),[C,S]=(0,s.useState)(""),[k,T]=(0,s.useState)("__ALL__"),[P]=(m=(0,s.useRef)(C),u=(0,s.useState)({})[1],x=function(t,a,r,l){var n=this,i=(0,s.useRef)(null),d=(0,s.useRef)(0),c=(0,s.useRef)(0),o=(0,s.useRef)(null),m=(0,s.useRef)([]),u=(0,s.useRef)(),x=(0,s.useRef)(),h=(0,s.useRef)(t),p=(0,s.useRef)(!0),g=(0,s.useRef)(),f=(0,s.useRef)();h.current=t;var b="u">typeof window,j=!a&&0!==a&&b;if("function"!=typeof t)throw TypeError("Expected a function");a=+a||0;var y=!!(r=r||{}).leading,v=!("trailing"in r)||!!r.trailing,N=!!r.flushOnExit&&v,w="maxWait"in r,C="debounceOnServer"in r&&!!r.debounceOnServer,S=w?Math.max(+r.maxWait||0,a):null,k=(0,s.useMemo)(function(){var t=function(e){var t=m.current,s=u.current;return m.current=u.current=null,d.current=e,c.current=c.current||e,x.current=h.current.apply(s,t)},s=function(e,t){j&&cancelAnimationFrame(o.current),o.current=j?requestAnimationFrame(e):setTimeout(e,t)},r=function(e){if(!p.current)return!1;var t=e-i.current;return!i.current||t>=a||t<0||w&&e-d.current>=S},k=function(e){return o.current=null,v&&m.current?t(e):(m.current=u.current=null,x.current)},T=function e(){var t=Date.now();if(y&&c.current===d.current&&P(),r(t))return k(t);if(p.current){var l=a-(t-i.current);s(e,w?Math.min(l,S-(t-d.current)):l)}},P=function(){l&&l({})},I=function(){if(b||C){var l,c=Date.now(),h=r(c);if(m.current=[].slice.call(arguments),u.current=n,i.current=c,N&&!g.current&&(g.current=function(){var t;"hidden"===(null==(t=e.g.document)?void 0:t.visibilityState)&&f.current.flush()},null==(l=e.g.document)||null==l.addEventListener||l.addEventListener("visibilitychange",g.current)),h){if(!o.current&&p.current)return d.current=i.current,s(T,a),y?t(i.current):x.current;if(w)return s(T,a),t(i.current)}return o.current||s(T,a),x.current}};return I.cancel=function(){var e=o.current;e&&(j?cancelAnimationFrame(o.current):clearTimeout(o.current)),d.current=0,m.current=i.current=u.current=o.current=null,e&&l&&l({})},I.isPending=function(){return!!o.current},I.flush=function(){return o.current?k(Date.now()):x.current},I},[y,w,a,S,v,N,j,b,C,l]);return f.current=k,(0,s.useEffect)(function(){return p.current=!0,function(){var t;N&&f.current.flush(),g.current&&(null==(t=e.g.document)||null==t.removeEventListener||t.removeEventListener("visibilitychange",g.current),g.current=null),p.current=!1}},[N]),k}((0,s.useCallback)(function(e){m.current=e,u({})},[u]),250,void 0,u),eE((h=(0,s.useRef)(C)).current,C)||(x(C),h.current=C),[m.current,x]),[I,D]=(0,s.useState)(!0),[A,E]=(0,s.useState)(!0),[R,M]=(0,s.useState)(null),[B,L]=(0,s.useState)([]),[_,U]=(0,s.useState)(null),F=(0,s.useMemo)(()=>Array.from(new Set((R?.rows??[]).map(e=>e.featureKey))).sort(),[R?.rows]),$=(0,s.useMemo)(()=>{let e=R?.rows??[],t=P.trim().toLowerCase();return e.filter(e=>"__ALL__"===k||e.featureKey===k).filter(e=>!t||e.featureKey.toLowerCase().includes(t))},[R?.rows,P,k]),V=(0,s.useMemo)(()=>{let e=P.trim().toLowerCase();return B.filter(e=>"__ALL__"===k||e.featureKey===k).filter(t=>!e||(t.actionKey??"").toLowerCase().includes(e)||t.featureKey.toLowerCase().includes(e))},[B,P,k]),O=async()=>{if(r){U(null),D(!0),E(!0);try{let e=new URL("/api/features/core/billing/usage/summary",window.location.origin);e.searchParams.set("agencyId",p??r),f&&e.searchParams.set("subAccountId",f),e.searchParams.set("scope",b),e.searchParams.set("period",j),e.searchParams.set("periodsBack",N);let t=await fetch(e.toString(),{headers:{[f?"x-autlify-subaccount":"x-autlify-agency"]:f??p??r},cache:"no-store"}),s=await t.json();if(!t.ok||!s?.ok)throw Error(s?.error||"Failed to load usage summary");M(s),D(!1);let a=new URL("/api/features/core/billing/usage/events",window.location.origin);a.searchParams.set("agencyId",p??r),f&&a.searchParams.set("subAccountId",f),a.searchParams.set("scope",b),a.searchParams.set("period",j),a.searchParams.set("periodsBack",N);let l=await fetch(a.toString(),{headers:{[f?"x-autlify-subaccount":"x-autlify-agency"]:f??p??r},cache:"no-store"}),n=await l.json();if(!l.ok||!n?.ok)throw Error(n?.error||"Failed to load usage events");L(n.events),E(!1)}catch(e){U(e instanceof Error?e.message:"Something went wrong"),D(!1),E(!1)}}};(0,s.useEffect)(()=>{O()},[r,j,N]);let H=(0,s.useMemo)(()=>{if(!R?.window)return"";let e=new Date(R.window.periodStart).toLocaleDateString(),t=new Date(R.window.periodEnd).toLocaleDateString();return`${e} → ${t}`},[R?.window]);return r?(0,t.jsxs)("div",{className:(0,g.cn)("space-y-6",o),children:[(0,t.jsxs)(l.Card,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Usage"}),(0,t.jsx)(i.Badge,{variant:"secondary",className:"font-mono text-xs",children:b})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Track feature consumption, overages, and events for the selected billing window."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(ew.Select,{value:j,onValueChange:e=>v(e),children:[(0,t.jsx)(ew.SelectTrigger,{className:"w-[140px]",children:(0,t.jsx)(ew.SelectValue,{placeholder:"Period"})}),(0,t.jsxs)(ew.SelectContent,{children:[(0,t.jsx)(ew.SelectItem,{value:"MONTHLY",children:"Monthly"}),(0,t.jsx)(ew.SelectItem,{value:"WEEKLY",children:"Weekly"}),(0,t.jsx)(ew.SelectItem,{value:"DAILY",children:"Daily"}),(0,t.jsx)(ew.SelectItem,{value:"YEARLY",children:"Yearly"})]})]}),(0,t.jsxs)(ew.Select,{value:N,onValueChange:e=>w(e),children:[(0,t.jsx)(ew.SelectTrigger,{className:"w-[170px]",children:(0,t.jsx)(ew.SelectValue,{placeholder:"Window"})}),(0,t.jsxs)(ew.SelectContent,{children:[(0,t.jsx)(ew.SelectItem,{value:"0",children:"Current window"}),(0,t.jsx)(ew.SelectItem,{value:"1",children:"Previous window"}),(0,t.jsx)(ew.SelectItem,{value:"2",children:"2 windows back"})]})]})]}),(0,t.jsxs)(n.Button,{variant:"outline",onClick:O,className:"gap-2",children:[(0,t.jsx)(eo.RefreshCw,{className:"h-4 w-4"}),"Refresh"]})]})]}),(0,t.jsx)(y.Separator,{className:"my-4"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Billing window"}),(0,t.jsx)("div",{className:"mt-1 font-medium",children:I?(0,t.jsx)(z.Skeleton,{className:"h-5 w-[180px]"}):H})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Tracked features"}),(0,t.jsx)("div",{className:"mt-1 font-medium",children:I?(0,t.jsx)(z.Skeleton,{className:"h-5 w-[90px]"}):String(F.length)})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Events"}),(0,t.jsx)("div",{className:"mt-1 font-medium",children:A?(0,t.jsx)(z.Skeleton,{className:"h-5 w-[90px]"}):String(B.length)})]})]}),_&&(0,t.jsx)("div",{className:"mt-4 rounded-lg border border-destructive/30 bg-destructive/10 p-3 text-sm text-destructive",children:_}),(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-3",children:[(0,t.jsx)(eN.Input,{value:C,onChange:e=>S(e.target.value),placeholder:"Search feature or action…",className:"md:col-span-2"}),(0,t.jsxs)(ew.Select,{value:k,onValueChange:T,children:[(0,t.jsx)(ew.SelectTrigger,{children:(0,t.jsx)(ew.SelectValue,{placeholder:"Filter by feature"})}),(0,t.jsxs)(ew.SelectContent,{children:[(0,t.jsx)(ew.SelectItem,{value:"__ALL__",children:"All features"}),F.map(e=>(0,t.jsx)(ew.SelectItem,{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(n.Button,{variant:"secondary",className:"gap-2",disabled:I||0===$.length,onClick:()=>{eM(`usage-summary-${j}-${N}.csv`,eR($.map(e=>({featureKey:e.featureKey,currentUsage:e.currentUsage,maxAllowed:e.isUnlimited?"UNLIMITED":e.maxAllowed??"",period:e.period}))))},children:[(0,t.jsx)(el.Download,{className:"h-4 w-4"}),"Export summary"]}),(0,t.jsxs)(n.Button,{variant:"secondary",className:"gap-2",disabled:A||0===V.length,onClick:()=>{eM(`usage-events-${j}-${N}.csv`,eR(V.map(e=>({createdAt:e.createdAt,featureKey:e.featureKey,quantity:e.quantity,actionKey:e.actionKey??"",idempotencyKey:e.idempotencyKey}))))},children:[(0,t.jsx)(el.Download,{className:"h-4 w-4"}),"Export events"]})]})]}),(0,t.jsx)(eL,{title:"Feature usage summary",description:"Detailed breakdown of feature usage",resources:$.map(e=>({name:e.featureKey||"Unnamed feature",used:e.currentUsage?Number(e.currentUsage):0,limit:e.isUnlimited?0:e.maxAllowed?Number(e.maxAllowed):0,unit:"units"}))}),(0,t.jsxs)(l.Card,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Usage events"}),(0,t.jsx)(i.Badge,{variant:"outline",className:(0,g.cn)("font-mono text-xs",A&&"opacity-60"),children:A?"Loading…":`${V.length} rows`})]}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,t.jsxs)(K.Table,{children:[(0,t.jsx)(K.TableHeader,{children:(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableHead,{children:"Date"}),(0,t.jsx)(K.TableHead,{children:"Feature"}),(0,t.jsx)(K.TableHead,{className:"text-right",children:"Qty"}),(0,t.jsx)(K.TableHead,{children:"Action"}),(0,t.jsx)(K.TableHead,{children:"Idempotency"})]})}),(0,t.jsx)(K.TableBody,{children:A?Array.from({length:6}).map((e,s)=>(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableCell,{children:(0,t.jsx)(z.Skeleton,{className:"h-5 w-[140px]"})}),(0,t.jsx)(K.TableCell,{children:(0,t.jsx)(z.Skeleton,{className:"h-5 w-[220px]"})}),(0,t.jsx)(K.TableCell,{className:"text-right",children:(0,t.jsx)(z.Skeleton,{className:"ml-auto h-5 w-[80px]"})}),(0,t.jsx)(K.TableCell,{children:(0,t.jsx)(z.Skeleton,{className:"h-5 w-[160px]"})}),(0,t.jsx)(K.TableCell,{children:(0,t.jsx)(z.Skeleton,{className:"h-5 w-[260px]"})})]},s)):V.map(e=>(0,t.jsxs)(K.TableRow,{children:[(0,t.jsx)(K.TableCell,{className:"text-muted-foreground",children:new Date(e.createdAt).toLocaleString()}),(0,t.jsx)(K.TableCell,{className:"font-mono text-xs",children:e.featureKey}),(0,t.jsx)(K.TableCell,{className:"text-right font-medium",children:e.quantity}),(0,t.jsx)(K.TableCell,{children:e.actionKey??(0,t.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,t.jsx)(K.TableCell,{className:"font-mono text-xs text-muted-foreground",children:e.idempotencyKey})]},e.id))})]})})]}),d&&(0,t.jsx)(e_,{})]}):(0,t.jsx)(l.Card,{className:(0,g.cn)("p-6 text-center",o),children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"No context available."})})};var eF=e.i(207670),e$=e.i(487074);let eV=(0,em.default)("headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);var eO=e.i(647780),eH=e.i(653145),ez=e.i(994814),eK=e.i(422233),eq=e.i(713766),eY=e.i(886883),eG=e.i(373375),eJ=e.i(751975),eW=e.i(488844),eZ=e.i(251454),eX=e.i(758302),eQ=e.i(681307);let e0=eQ.z.object({firstName:eQ.z.string().min(2,"First name must be at least 2 characters"),lastName:eQ.z.string().min(2,"Last name must be at least 2 characters"),userEmail:eQ.z.string().email("Invalid email address"),agencyName:eQ.z.string().min(2,"D.B.A. is required for your agency"),agencyEmail:eQ.z.string().email("Invalid email address"),companyPhone:eQ.z.string().min(1,"Phone number is required"),phoneCode:eQ.z.string().optional(),companyName:eQ.z.string().optional(),tinNumber:eQ.z.string().optional(),line1:eQ.z.string().min(1,"Address line 1 is required"),line2:eQ.z.string().optional(),city:eQ.z.string().min(1,"City is required"),state:eQ.z.string().min(1,"State is required"),postalCode:eQ.z.string().min(1,"Postal code is required"),country:eQ.z.string().min(2,"Country is required"),countryCode:eQ.z.string().optional(),stateCode:eQ.z.string().optional()}),e1=[{id:"billing",label:"Billing",description:"Billing information",required:(e,t)=>"plan"===e&&t.isNewSubscription},{id:"payment",label:"Payment",description:"Payment method",required:()=>!0},{id:"review",label:"Review",description:"Review & Confirm",required:()=>!0}];function e2({steps:e,currentStep:s,completedSteps:a,onStepClick:r}){let l=e.findIndex(e=>e.id===s);return(0,t.jsxs)("div",{className:"relative bg-card backdrop-blur-sm rounded-2xl p-2 sm:p-4 shadow-[0_8px_30px_hsl(var(--shadow-lg))] border border-border",children:[(0,t.jsx)("div",{className:"absolute top-[calc(1.5rem+16px)] left-[8%] right-[8%] flex items-center z-0",children:e.slice(0,-1).map((e,s)=>(0,t.jsx)("div",{className:"h-1 bg-border rounded-full flex-1",children:(0,t.jsx)("div",{className:(0,g.cn)("h-1 rounded-full transition-all duration-500",a.has(e.id)?"bg-gradient-to-r from-blue-500 to-blue-600 w-full":"w-0")})},`line-${s}`))}),(0,t.jsx)("div",{className:"flex justify-between relative z-10",children:e.map((e,n)=>{let i=a.has(e.id),d=s===e.id,c=n<=l||i;return(0,t.jsx)("div",{className:"flex flex-col items-center",children:(0,t.jsxs)("button",{onClick:()=>c&&r(e.id),disabled:!c,className:"flex flex-col items-center group cursor-pointer disabled:cursor-not-allowed transition-all duration-300 hover:scale-105",children:[(0,t.jsx)("div",{className:(0,g.cn)("w-11 h-11 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center mb-1 transition-all duration-500 bg-card",i?"bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-[0_8px_20px_rgba(59,130,246,0.3)]":d?"bg-gradient-to-br from-primary via-blue-500 to-cyan-500 text-white shadow-[0_10px_30px_rgba(59,130,246,0.4)] scale-110":"bg-gradient-to-br from-muted to-muted-foreground/10 text-muted-foreground shadow-sm"),children:i?(0,t.jsx)(v.Check,{className:"h-5 w-5"}):(0,t.jsx)("span",{className:"text-base font-semibold",children:n+1})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:(0,g.cn)("text-sm font-medium transition-colors",d?"text-blue-600":i?"text-blue-500":"text-muted-foreground"),children:e.label}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground hidden sm:block mt-0.5",children:e.description})]})]})},e.id)})})]})}function e4({type:e,item:s}){let{title:a,gradient:r}={plan:{icon:eW.Package,title:"Complete Your Subscription",gradient:"from-blue-500 to-purple-500"},addon:{icon:ek.Zap,title:"Add Enhancement",gradient:"from-green-500 to-emerald-500"},credits:{icon:eP,title:"Purchase Credits",gradient:"from-amber-500 to-orange-500"}}[e];return(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:(0,g.cn)("p-3 rounded-xl bg-gradient-to-br",r),children:["plan"===e&&(0,t.jsx)(eW.Package,{className:"h-6 w-6 text-white"}),"addon"===e&&(0,t.jsx)(ek.Zap,{className:"h-6 w-6 text-white"}),"credits"===e&&(0,t.jsx)(eP,{className:"h-6 w-6 text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-black tracking-tight text-brand-gradient",children:a}),(0,t.jsx)("p",{className:"text-sm text-fg-tertiary mt-1",children:s.title})]})]})}function e5({item:e,selectedAddons:s,coupon:a,isTrialAccepted:r}){let n=e.priceAmount/100+s.reduce((e,t)=>e+t.priceAmount/100,0),i=a?a.percent_off?n*a.percent_off/100:(a.amount_off||0)/100:0,d=n-i;return(0,t.jsxs)(l.Card,{className:"border-0 bg-card/95 backdrop-blur-xl rounded-2xl overflow-hidden relative",children:[(0,t.jsxs)(l.CardHeader,{className:"relative bg-gradient-to-br from-accent-base/8 via-accent-base/5 to-transparent border-b border-line-secondary pb-5",children:[(0,t.jsx)(l.CardTitle,{className:"text-2xl font-black text-brand-gradient tracking-tight",children:"Order Summary"}),(0,t.jsx)(l.CardDescription,{className:"text-fg-tertiary font-medium mt-1.5",children:"Review your purchase"})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-4 pt-6",children:[(0,t.jsx)("div",{className:"bg-card border border-border rounded-xl p-4 shadow-sm",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-bold text-fg-primary",children:e.title}),(0,t.jsx)("p",{className:"text-sm text-fg-secondary",children:"one_time"===e.interval?"One-time purchase":`${e.interval}ly subscription`})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"font-bold text-fg-primary text-lg",children:e.price}),"one_time"!==e.interval&&(0,t.jsxs)("span",{className:"text-xs text-fg-secondary",children:["/ ",e.interval]})]})]})}),r&&e.trial?.enabled&&(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-cyan-500 text-white px-4 py-3 rounded-xl text-sm font-bold",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xl",children:"🎁"}),(0,t.jsxs)("span",{children:[e.trial.days,"-day free trial included"]})]})}),s.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-bold mb-3 text-sm uppercase tracking-wider text-fg-primary",children:"Add-ons"}),(0,t.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-fg-secondary",children:e.title}),(0,t.jsxs)("span",{className:"font-medium",children:[e.price,"/mo"]})]},e.key))})]})]}),e.features&&e.features.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-bold mb-4 text-sm uppercase tracking-wider text-fg-primary",children:"What's included"}),(0,t.jsx)("ul",{className:"space-y-3",children:e.features.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-start gap-3 text-sm",children:[(0,t.jsx)("div",{className:"flex-shrink-0 inline-flex h-5 w-5 items-center justify-center rounded-full bg-gradient-to-br from-primary/15 to-primary/10 border border-primary/30 mt-0.5",children:(0,t.jsx)(v.Check,{className:"h-3.5 w-3.5 text-primary"})}),(0,t.jsx)("span",{className:"text-fg-secondary font-medium",children:e})]},s))})]})]}),(0,t.jsx)(y.Separator,{}),(0,t.jsxs)("div",{className:"space-y-3 bg-muted/50 rounded-lg p-4 border border-border",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-fg-tertiary",children:"Subtotal"}),(0,t.jsxs)("span",{className:"font-medium text-fg-primary",children:["RM ",n.toFixed(2)]})]}),a&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-green-600 font-medium",children:["Discount (",a.percent_off||"","%)"]}),(0,t.jsxs)("span",{className:"text-green-600 font-semibold",children:["- RM ",i.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-md font-bold pt-1",children:[(0,t.jsx)("span",{className:"text-fg-primary",children:"Total"}),(0,t.jsxs)("span",{className:"font-medium text-fg-primary",children:["RM ",d.toFixed(2)]})]}),r&&e.trial?.enabled&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Separator,{}),(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-1",children:[(0,t.jsx)("span",{className:"text-primary",children:"Pay Now"}),(0,t.jsx)("span",{className:"text-primary",children:"RM 0.00"})]}),(0,t.jsxs)("p",{className:"text-xs text-fg-secondary bg-primary/5 rounded-lg p-3 border border-primary/20 font-medium",children:["💡 You'll be charged RM ",d.toFixed(2)," after your ",e.trial.days,"-day trial ends"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground pt-4 border-t border-border",children:[(0,t.jsx)("svg",{className:"h-5 w-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,t.jsx)("span",{children:"Secure payment powered by Stripe"})]})]})]})}(0,ea.loadStripe)(V.default.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);let e3=({mode:a,item:r,additionalItems:i=[],availableAddons:c=[],user:o,context:m,existingCustomer:u,existingPaymentMethods:x=[],onComplete:h,onCancel:p,successUrl:f,cancelUrl:b,showBackButton:v=!0,backUrl:w="/site/pricing",className:S})=>{let k=(0,ex.useRouter)(),{toast:T}=(0,q.useToast)(),P=(0,s.useMemo)(()=>{var e;let t=x.length>0;return e=r.type,e1.filter(s=>("billing"!==s.id||!!m.isNewSubscription)&&("payment"===s.id&&!!t&&!m.isNewSubscription||s.required(e,m)))},[r.type,m,x.length]).map(e=>({id:e.id,label:e.label,description:e.description})),[I,D]=(0,s.useState)(P[0]?.id||"payment"),[A,E]=(0,s.useState)(new Set),[R,M]=(0,s.useState)(!1),[B,L]=(0,s.useState)(m.customerId||u?.id||null),[_,U]=(0,s.useState)([]),[F,$]=(0,s.useState)(!1),[V,O]=(0,s.useState)(null),[H,z]=(0,s.useState)(x.length>0),[K,Y]=(0,s.useState)(x.length>0?x[0].id:null),[G,J]=(0,s.useState)(null),[W,Z]=(0,s.useState)(!1),[X,Q]=(0,s.useState)(""),[ee,et]=(0,s.useState)(null),[es,ea]=(0,s.useState)(!1),[er,el]=(0,s.useState)(""),[en,ei]=(0,s.useState)(""),[ed,ec]=(0,s.useState)(""),[eo,em]=(0,s.useState)(""),eu=(0,eH.useForm)({resolver:(0,ez.zodResolver)(e0),mode:"onChange",defaultValues:{firstName:o.firstName||"",lastName:o.lastName||"",userEmail:o.email||"",agencyName:"",agencyEmail:o.email||"",companyPhone:"",phoneCode:"",line1:"",line2:"",city:"",state:"",postalCode:"",stateCode:"",country:"",countryCode:""}}),eh=eu.formState.isSubmitting,ep=P.findIndex(e=>e.id===I),eg=(0,s.useMemo)(()=>c.filter(e=>_.includes(e.key)),[c,_]),ef=(0,s.useMemo)(()=>{switch(r.type){case"plan":return[{text:"Verifying payment method"},{text:"Creating your subscription"},{text:"Setting up your agency"},{text:"Finalizing your account"}];case"addon":return[{text:"Verifying payment method"},{text:"Adding enhancement to subscription"},{text:"Updating your plan"}];case"credits":return[{text:"Processing payment"},{text:"Adding credits to your account"}];default:return[{text:"Processing..."}]}},[r.type]);(0,s.useEffect)(()=>{if(u){let e=u.metadata||{};if(u.address){let e=eq.Country.getAllCountries().find(e=>e.name===u.address?.country),t=eY.State.getStatesOfCountry(e?.isoCode||"").find(e=>e.name===u.address?.state);eu.setValue("line1",u.address.line1||""),eu.setValue("line2",u.address.line2||""),el(e?.isoCode||""),eu.setValue("country",e?.name||u.address.country||""),eu.setValue("countryCode",e?.isoCode||""),ei(t?.isoCode||""),eu.setValue("state",t?.name||u.address.state||""),eu.setValue("stateCode",t?.isoCode||""),eu.setValue("city",u.address.city||""),ec(u.address.city||""),eu.setValue("postalCode",u.address.postal_code||"")}e.agencyName&&eu.setValue("agencyName",e.agencyName),e.companyName&&eu.setValue("companyName",e.companyName),e.tinNumber&&eu.setValue("tinNumber",e.tinNumber)}},[u,eu]),(0,s.useEffect)(()=>{r.trial?.enabled&&o.trialEligible&&M(!0)},[r.trial,o.trialEligible]);let eb=async e=>"billing"!==e||eu.trigger(["firstName","lastName","userEmail","agencyName","agencyEmail","phoneCode","companyPhone","line1","city","state","postalCode","country"]),ej=async()=>{if(!await eb(I)){let e=Object.keys(eu.formState.errors);T({title:"Validation Error",description:e.length>0?`Please check: ${e.join(", ")}`:"Please fill in all required fields.",variant:"destructive"});return}E(e=>new Set(e).add(I)),"billing"===I&&O(eu.getValues());let e=ep+1;e<P.length&&D(P[e].id)},ey=async()=>{try{$(!0);let e={success:!1,type:r.type};switch(r.type){case"plan":await ev(e);break;case"addon":await ew(e);break;case"credits":await eC(e)}e.success&&(h?.(e),f?k.push(f):e.agencyId&&k.push(`/agency/${e.agencyId}`))}catch(e){console.error("Checkout error:",e),$(!1),T({title:"Error",description:e instanceof Error?e.message:"Failed to process checkout",variant:"destructive"})}},ev=async t=>{let s,a=V||eu.getValues(),l=a.phoneCode&&a.companyPhone?`${a.phoneCode}${a.companyPhone}`:a.companyPhone;if(B)s=B;else{let e=await fetch("/api/stripe/customer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.userEmail,name:a.companyName||`${a.firstName} ${a.lastName}`,phone:l,address:{line1:a.line1,line2:a.line2||"",city:a.city,state:a.state,postal_code:a.postalCode,country:a.country},metadata:{userId:o.id,agencyName:a.agencyName,companyName:a.companyName||""},userId:o.id})});if(!e.ok)throw Error("Failed to create customer");let{customerId:t}=await e.json();L(s=t)}let{upsertAgency:n}=await e.A(306201),i=(0,eK.v4)();await n({id:i,customerId:s,name:a.agencyName,companyEmail:a.userEmail,companyPhone:l,whiteLabel:!1,line1:a.line1,line2:a.line2||"",city:a.city,postalCode:a.postalCode,state:a.state,country:a.country,agencyLogo:"",connectAccountId:"",taxIdentityId:null,goal:5,createdAt:new Date,updatedAt:new Date});let d=await fetch("/api/stripe/create-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:s,agencyId:i,priceId:r.priceId,country:a.country,coupon:ee?.id,paymentMethodId:G||K,trialEnabled:R&&r.trial?.enabled,trialPeriodDays:R?r.trial?.days:void 0})});if(!d.ok)throw Error("Failed to create subscription");let{subscriptionId:m}=await d.json();for(let e of _){let t=c.find(t=>t.key===e);t&&await fetch("/api/stripe/addon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",agencyId:i,addonKey:t.key,priceId:t.priceId})})}t.success=!0,t.subscriptionId=m,t.agencyId=i,T({title:"Success!",description:"Your subscription has been created."})},ew=async e=>{if(!m.agencyId)throw Error("Agency ID required for addon checkout");if(!(await fetch("/api/stripe/addon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",agencyId:m.agencyId,addonKey:r.key,priceId:r.priceId})})).ok)throw Error("Failed to add addon");e.success=!0,e.agencyId=m.agencyId,T({title:"Success!",description:`${r.title} has been added to your subscription.`})},eC=async e=>{if(!m.agencyId)throw Error("Agency ID required for credits checkout");let t=await fetch("/api/stripe/credits/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agencyId:m.agencyId,featureKey:r.key,credits:r.quantity||1,priceId:r.priceId})});if(!t.ok)throw Error("Failed to create checkout session");let{url:s,sessionId:a}=await t.json();e.success=!0,e.sessionId=a,s&&(window.location.href=s)},eS=async()=>{if(X.trim()){ea(!0);try{let e=await fetch("/api/stripe/validate-coupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:X})});if(!e.ok)throw Error("Invalid coupon code");let{coupon:t}=await e.json();et(t),T({title:"Coupon Applied!",description:"Discount applied successfully."})}catch{T({title:"Invalid Coupon",description:"The coupon code is not valid.",variant:"destructive"})}finally{ea(!1)}}},ek=H?!!K:!!G,eT=(0,t.jsxs)("div",{className:(0,g.cn)("min-h-screen relative overflow-hidden bg-bg-primary text-fg-primary","modal"===a&&"min-h-0",S),children:["page"===a&&(0,t.jsxs)("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[(0,t.jsx)("div",{className:"absolute -top-32 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-gradient-to-br from-blue-300/25 to-purple-300/25 blur-3xl"}),(0,t.jsx)("div",{className:"absolute bottom-[-180px] right-[-180px] h-[520px] w-[520px] rounded-full bg-gradient-to-br from-cyan-300/20 to-pink-300/20 blur-3xl"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,hsl(var(--border))_1px,transparent_1px),linear-gradient(to_bottom,hsl(var(--border))_1px,transparent_1px)] bg-[size:72px_72px] opacity-[0.15]"})]}),(0,t.jsxs)("div",{className:(0,g.cn)("mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-12 relative z-10","page"===a?"max-w-6xl":"max-w-4xl py-6"),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-6",children:[(0,t.jsx)(e4,{type:r.type,item:r}),"page"===a&&v&&(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:()=>k.push(w||b||"/site/pricing"),children:[(0,t.jsx)(eG.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Back"]}),"modal"===a&&(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:p,children:(0,t.jsx)(N.X,{className:"h-5 w-5"})})]}),(0,t.jsx)(y.Separator,{className:"my-6"}),(0,t.jsxs)("div",{className:(0,g.cn)("grid gap-6","page"===a?"lg:grid-cols-3":""),children:[(0,t.jsxs)("div",{className:(0,g.cn)("space-y-4","page"===a?"lg:col-span-2":""),children:[P.length>1&&(0,t.jsx)(e2,{steps:P,currentStep:I,completedSteps:A,onStepClick:e=>{(P.findIndex(t=>t.id===e)<=ep||A.has(e))&&D(e)}}),(0,t.jsx)(l.Card,{className:"border-0 card rounded-2xl",children:(0,t.jsx)(l.CardContent,{className:"pt-6 pb-7 px-6 sm:px-7",children:(0,t.jsxs)("form",{children:["billing"===I&&(0,t.jsx)(e6,{form:eu,isLoading:eh,countryCode:er,setCountryCode:el,stateCode:en,setStateCode:ei,city:ed,setCity:ec,phoneNumber:eo,setPhoneNumber:em}),"payment"===I&&(0,t.jsx)(e8,{existingPaymentMethods:x,useExistingPayment:H,setUseExistingPayment:z,selectedPaymentMethodId:K,setSelectedPaymentMethodId:Y,savedPaymentMethodId:G,setSavedPaymentMethodId:J,cardModalOpen:W,setCardModalOpen:Z,savedBillingData:V,toast:T}),"review"===I&&(0,t.jsx)(e7,{item:r,savedBillingData:V,existingPaymentMethods:x,useExistingPayment:H,selectedPaymentMethodId:K,savedPaymentMethodId:G,availableAddons:c,selectedAddonKeys:_,setSelectedAddonKeys:U,isTrialAccepted:R,context:m}),(0,t.jsxs)("div",{className:"flex gap-3 mt-7 pt-5 border-t border-border",children:[ep>0&&(0,t.jsxs)(n.Button,{type:"button",variant:"outline",onClick:()=>{let e=ep-1;e>=0&&D(P[e].id)},children:[(0,t.jsx)(eG.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Back"]}),"review"!==I?(0,t.jsx)(n.Button,{type:"button",className:"btn-brand-gradient h-11",onClick:ej,disabled:eh||"payment"===I&&!ek,children:"Continue →"}):(0,t.jsxs)(n.Button,{type:"button",className:"btn-brand-gradient shadow-lg h-11 flex-1",onClick:ey,disabled:F||!ek,children:["🔒 Confirm & Pay ",R&&r.trial?.enabled?"RM 0.00":r.price]})]})]})})})]}),"page"===a&&(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)("div",{className:"lg:sticky lg:top-6",children:[(0,t.jsx)(e5,{item:r,selectedAddons:eg,coupon:ee,isTrialAccepted:R}),(0,t.jsx)(l.Card,{className:"mt-4 border-0 bg-card/95 rounded-2xl",children:(0,t.jsxs)(l.CardContent,{className:"pt-4 pb-4",children:[(0,t.jsx)(j.Label,{className:"text-sm font-bold mb-3 block text-fg-primary uppercase tracking-wider",children:"Promo Code"}),ee?(0,t.jsxs)("div",{className:"flex items-center justify-between bg-green-50 border border-green-200 rounded-xl px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eJ.Tag,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)("span",{className:"text-sm font-bold text-green-700",children:ee.id})]}),(0,t.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{et(null),Q("")},className:"text-xs",children:"Remove"})]}):(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(eN.Input,{placeholder:"Enter code",value:X,onChange:e=>Q(e.target.value.toUpperCase()),disabled:es}),(0,t.jsx)(n.Button,{type:"button",variant:"outline",size:"sm",onClick:eS,disabled:!X.trim()||es,children:es?(0,t.jsx)(C.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(eJ.Tag,{className:"h-4 w-4"})})]})]})})]})})]})]}),(0,t.jsx)(eZ.MultiStepLoader,{loadingStates:ef,loading:F,duration:2e3,loop:!1})]});return"modal"===a?(0,t.jsxs)(d.Dialog,{open:!0,onOpenChange:e=>!e&&p?.(),children:[(0,t.jsx)(d.DialogHeader,{children:(0,t.jsx)(d.DialogTitle,{className:"text-lg font-bold",children:"Checkout"})}),(0,t.jsx)(d.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:eT})]}):eT};function e6({form:e,isLoading:s,countryCode:a,setCountryCode:r,stateCode:l,setStateCode:n,city:i,setCity:d,phoneNumber:c,setPhoneNumber:o}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,t.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-1 tracking-tight",children:"Account"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your contact information"})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{className:"mb-2 block",children:"Full Name *"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(eN.Input,{...e.register("firstName"),placeholder:"First",className:"h-10"}),(0,t.jsx)(eN.Input,{...e.register("lastName"),placeholder:"Last",className:"h-10"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{htmlFor:"agencyEmail",className:"mb-2 block",children:"Email Address *"}),(0,t.jsx)(eN.Input,{id:"agencyEmail",type:"email",readOnly:!0,...e.register("agencyEmail"),className:"h-10"})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{htmlFor:"agencyName",className:"mb-2 block",children:"Tenant Name *"}),(0,t.jsx)(eN.Input,{id:"agencyName",...e.register("agencyName"),placeholder:"My Tenant",className:"h-10"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{htmlFor:"companyPhone",className:"mb-2 block",children:"Phone Number *"}),(0,t.jsx)(eX.PhoneCodeSelector,{value:c,onValueChange:(t,s)=>{o(t),e.setValue("companyPhone",t),e.setValue("phoneCode",s||"")},countryCode:a,onCountryCodeChange:(t,s)=>{r(t),e.setValue("phoneCode",s?.phonecode||""),e.setValue("country",s?.name||"",{shouldValidate:!0}),e.setValue("countryCode",t)},placeholder:"Enter phone number",disabled:s,styleVariant:"plain"})]})]}),(0,t.jsx)(y.Separator,{className:"my-6"}),(0,t.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,t.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-1 tracking-tight",children:"Billing"}),(0,t.jsx)("p",{className:"text-sm text-fg-tertiary",children:"Billing address and tax information"})]}),(0,t.jsxs)("div",{className:"space-y-5 mt-2",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{htmlFor:"companyName",className:"mb-2 block",children:"Company Name (Optional)"}),(0,t.jsx)(eN.Input,{id:"companyName",...e.register("companyName"),placeholder:"My Company Ltd.",className:"h-10"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{htmlFor:"tinNumber",className:"mb-2 block",children:"Tax ID (Optional)"}),(0,t.jsx)(eN.Input,{id:"tinNumber",...e.register("tinNumber"),placeholder:"123-45-6789",className:"h-10"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{className:"mb-2 block",children:"Address *"}),(0,t.jsxs)("div",{className:"grid md:grid-cols-4 gap-2",children:[(0,t.jsx)(eN.Input,{...e.register("line2"),placeholder:"Apt/Suite (Optional)",className:"h-10"}),(0,t.jsx)(eN.Input,{className:"md:col-span-2 h-10",...e.register("line1"),placeholder:"Street Address"}),(0,t.jsx)(eX.PostalCodeInput,{value:e.watch("postalCode"),onValueChange:t=>e.setValue("postalCode",t),placeholder:"Postal Code",countryCode:a,styleVariant:"plain"})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{className:"mb-2 block",children:"Country *"}),(0,t.jsx)(eX.CountrySelector,{value:a,onValueChange:(t,s)=>{r(t),n(""),e.setValue("country",s?.name||""),e.setValue("countryCode",t),e.setValue("state",""),e.setValue("stateCode",""),e.setValue("city","")},placeholder:"Select country",disabled:s,styleVariant:"plain"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{className:"mb-2 block",children:"State/Province *"}),(0,t.jsx)(eX.StateSelector,{countryCode:a,value:l,onValueChange:(t,s)=>{n(t),e.setValue("state",s.name),e.setValue("stateCode",t)},placeholder:"Select state",disabled:s,styleVariant:"plain"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(j.Label,{className:"mb-2 block",children:"City *"}),(0,t.jsx)(eX.CitySelector,{countryCode:a,stateCode:l,value:i,onValueChange:(t,s)=>{d(s.name),e.setValue("city",s.name)},placeholder:"Select city",disabled:s,styleVariant:"plain"})]})]})]})]})}function e8({existingPaymentMethods:e,useExistingPayment:s,setUseExistingPayment:a,selectedPaymentMethodId:r,setSelectedPaymentMethodId:l,savedPaymentMethodId:i,setSavedPaymentMethodId:d,cardModalOpen:c,setCardModalOpen:o,savedBillingData:m,toast:u}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,t.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-2 tracking-tight",children:"Payment Method"}),(0,t.jsx)("p",{className:"text-fg-tertiary",children:e.length>0?"Choose a payment method or add a new card":"Securely add your payment information"})]}),e.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(H.SavedBankCardsGallery,{compact:!0,cards:e.map(e=>({id:e.id,cardNumber:`**** **** **** ${e.card?.last4}`,cardholderName:e.card?.cardholder_name||"N/A",expiryMonth:String(e.card?.exp_month).padStart(2,"0"),expiryYear:String(e.card?.exp_year),brand:e.card?.brand,variant:e.card?.brand==="visa"?"default":e.card?.brand==="mastercard"?"premium":"default",isDefault:e.card?.isDefault})),selectedCardId:s&&r?r:void 0,onCardSelect:e=>{a(!0),l(e)},onAddCard:()=>o(!0),onSetDefault:()=>u({title:"Coming Soon",description:"This feature will be available soon."}),onReplaceCard:()=>o(!0),onRemoveCard:()=>u({title:"Coming Soon",description:"This feature will be available soon.",variant:"destructive"}),className:"mb-4"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,t.jsx)("span",{className:"w-full border-t border-border"})}),(0,t.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,t.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:s?"Or add new card":"Adding new card"})})]})]}),!s&&!i&&(0,t.jsx)("div",{onClick:()=>o(!0),className:"p-6 border-2 border-dashed border-primary/30 rounded-xl cursor-pointer hover:border-primary hover:bg-primary/5 transition-all",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3 text-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(0,t.jsx)(S.CreditCard,{className:"h-6 w-6 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-fg-primary",children:"Add New Payment Method"}),(0,t.jsx)("p",{className:"text-sm text-fg-tertiary mt-1",children:"Click to securely add your card details"})]})]})}),!s&&i&&(0,t.jsx)("div",{className:"relative rounded-2xl p-[1.5px] bg-gradient-to-br from-green-400/60 via-green-300/40 to-green-400/60 overflow-hidden shadow-lg",children:(0,t.jsx)("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-green-50 via-emerald-50 to-green-50 p-5",children:(0,t.jsxs)("div",{className:"relative z-10 flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center shadow-lg",children:(0,t.jsx)(v.Check,{className:"h-7 w-7 text-white",strokeWidth:3})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-bold text-lg text-green-900",children:"Payment Method Validated"}),(0,t.jsx)("p",{className:"text-sm text-green-700 mt-0.5",children:"Your new card has been validated"})]}),(0,t.jsx)(n.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>d(null),className:"flex-shrink-0",children:"Change Card"})]})})}),c&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:()=>o(!1),children:(0,t.jsxs)("div",{className:"relative bg-card rounded-2xl shadow-2xl max-w-md w-full p-6",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-fg-primary",children:"Add New Card"}),(0,t.jsx)("p",{className:"text-sm text-fg-tertiary mt-1",children:"Your payment information is securely processed by Stripe"})]}),(0,t.jsx)("button",{onClick:()=>o(!1),className:"text-muted-foreground hover:text-foreground",children:(0,t.jsx)(N.X,{className:"h-6 w-6"})})]}),(0,t.jsxs)("div",{className:"bg-muted/50 rounded-xl p-6 text-center",children:[(0,t.jsx)(S.CreditCard,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Stripe Payment Elements would be integrated here for secure card collection"})]}),(0,t.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,t.jsx)(n.Button,{type:"button",variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"Cancel"}),(0,t.jsx)(n.Button,{type:"button",className:"btn-brand-gradient flex-1",onClick:()=>{d("pm_simulated_"+Date.now()),a(!1),o(!1),u({title:"Card Added",description:"Your payment method is ready to use."})},children:"Add Card"})]})]})})]})}function e7({item:e,savedBillingData:s,existingPaymentMethods:a,useExistingPayment:r,selectedPaymentMethodId:l,savedPaymentMethodId:n,availableAddons:i,selectedAddonKeys:d,setSelectedAddonKeys:c,isTrialAccepted:o,context:m}){let u;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,t.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-2 tracking-tight",children:"Review & Confirm"}),(0,t.jsx)("p",{className:"text-fg-tertiary",children:"Please review your information before confirming"})]}),m.isNewSubscription&&s&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(v.Check,{className:"h-5 w-5 text-green-500"}),"Billing Information"]}),(0,t.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Name"}),(0,t.jsxs)("p",{className:"font-medium",children:[s.firstName," ",s.lastName]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Email"}),(0,t.jsx)("p",{className:"font-medium",children:s.agencyEmail})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tenant Name"}),(0,t.jsx)("p",{className:"font-medium",children:s.agencyName})]})]}),(0,t.jsx)(y.Separator,{className:"my-2"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Address"}),(0,t.jsxs)("p",{className:"font-medium",children:[s.line1,s.line2&&`, ${s.line2}`]}),(0,t.jsxs)("p",{className:"font-medium",children:[s.city,", ",s.state," ",s.postalCode]}),(0,t.jsx)("p",{className:"font-medium",children:s.country})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(v.Check,{className:"h-5 w-5 text-green-500"}),"Payment Method"]}),(0,t.jsx)("div",{className:"bg-muted/50 rounded-lg p-4",children:r&&l?(0,t.jsx)("div",{children:(u=a.find(e=>e.id===l))?(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-blue-600 font-semibold",children:u.card?.brand?.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium capitalize",children:[u.card?.brand," •••• ",u.card?.last4]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Expires ",u.card?.exp_month,"/",u.card?.exp_year]})]})]}):null}):n?(0,t.jsx)("p",{className:"font-medium",children:"New card ending in ••••"}):(0,t.jsx)("p",{className:"text-amber-600",children:"No payment method selected"})})]}),"plan"===e.type&&i.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(ec.Plus,{className:"h-5 w-5 text-brand-bg"}),"Enhance Your Plan (Optional)"]}),(0,t.jsx)("div",{className:"space-y-2",children:i.slice(0,4).map(e=>{let s=d.includes(e.key),a=e.requires&&!d.includes(e.requires);return(0,t.jsxs)("div",{className:(0,g.cn)("flex items-center justify-between p-3 rounded-lg border transition-all cursor-pointer",s?"border-brand-bg bg-brand-bg/5":"border-border hover:border-brand-bg/50 bg-muted/30",a&&"opacity-50 cursor-not-allowed"),onClick:()=>{a||c(s?d.filter(t=>t!==e.key):[...d,e.key])},children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:(0,g.cn)("w-5 h-5 rounded border-2 flex items-center justify-center transition-colors",s?"border-brand-bg bg-brand-bg":"border-muted-foreground"),children:s&&(0,t.jsx)(v.Check,{className:"h-3 w-3 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-sm",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description}),a&&(0,t.jsxs)("p",{className:"text-xs text-amber-600",children:["Requires ",e.requires]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-semibold text-sm",children:e.price}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"/month"})]})]},e.key)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(v.Check,{className:"h-5 w-5 text-green-500"}),"plan"===e.type?"Subscription":"addon"===e.type?"Enhancement":"Purchase"]}),(0,t.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-lg",children:e.title}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"one_time"===e.interval?"One-time purchase":`${"month"===e.interval?"Monthly":"Yearly"} subscription`})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-bold text-xl",children:e.price}),"one_time"!==e.interval&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["per ",e.interval]})]})]}),o&&e.trial?.enabled&&(0,t.jsx)("div",{className:"bg-blue-50 rounded-lg p-3",children:(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:["💡 Your ",e.trial.days,"-day free trial starts today. You'll be charged ",e.price," after your trial ends."]})})]})]})]})}let e9=function({scope:e,scopeId:a,user:r,existingCustomer:d,existingPaymentMethods:c}){let{toast:o}=(0,q.useToast)(),[m,u]=(0,s.useState)(!0),[x,h]=(0,s.useState)(null),[p,f]=(0,s.useState)([]),[b]=(0,s.useState)(()=>(0,T.getAddonCards)()),[j,y]=(0,s.useState)({user:r||null,customerId:null,customer:d||null,paymentMethods:c||[]}),N={fi:"Finance Modules",core:"Core Add-ons",co:"Commerce",crm:"CRM",apps:"Apps",iam:"Identity & Access"},w=(0,s.useMemo)(()=>({agencyId:a,customerId:j.customerId||void 0,isNewSubscription:!1}),[a,j.customerId]),S=(0,s.useCallback)(async()=>{try{let e=await fetch(`/api/stripe/addon?agencyId=${a}`);if(e.ok){let t=await e.json();f(t.addons||[])}}catch(e){console.error("Failed to fetch addons:",e)}finally{u(!1)}},[a]),k=(0,s.useCallback)(async()=>{if(!r||!d||!c)try{if(!r){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();if(t?.user){let e=(t.user.name||"").split(" ");y(s=>({...s,user:{id:t.user.id||"",email:t.user.email||"",name:t.user.name||"",firstName:e[0]||"",lastName:e.slice(1).join(" ")||"",trialEligible:!1}}))}}}let e=await fetch(`/api/stripe/customer?agencyId=${a}`);if(e.ok){let t=await e.json();y(e=>({...e,customerId:t.customerId||null,customer:t.customer||null,paymentMethods:t.paymentMethods||[]}))}}catch(e){console.error("Failed to fetch billing data:",e)}},[a,r,d,c]),P=(0,s.useCallback)(e=>{e.success?(o({title:"Success",description:"Add-on added successfully"}),S()):o({title:"Error",description:e.error||"Failed to add addon",variant:"destructive"})},[o,S]),{openCheckout:I,CheckoutModal:D}=function(e){let[a,r]=(0,s.useState)(!1),[l,n]=(0,s.useState)(null),i=(0,s.useCallback)(e=>{n(e),r(!0)},[]),d=(0,s.useCallback)(()=>{r(!1),setTimeout(()=>n(null),300)},[]),c=(0,s.useCallback)(t=>{e.onComplete?.(t),d()},[e,d]),o=a&&l?(0,t.jsx)(e3,{mode:"modal",item:l,user:e.user,context:e.context,existingCustomer:e.existingCustomer,existingPaymentMethods:e.existingPaymentMethods,availableAddons:e.availableAddons,onComplete:c,onCancel:d,successUrl:e.successUrl,cancelUrl:e.cancelUrl}):null;return{isOpen:a,currentItem:l,openCheckout:i,closeCheckout:d,CheckoutModal:o}}({user:(0,s.useMemo)(()=>j.user?j.user:{id:"",email:"",name:"",firstName:"",lastName:"",trialEligible:!1},[j.user]),context:w,existingCustomer:j.customer,existingPaymentMethods:j.paymentMethods,onComplete:P,successUrl:`/${e}/${a}/billing/addons`,cancelUrl:`/${e}/${a}/billing/addons`});(0,s.useEffect)(()=>{S(),k()},[S,k]);let A=e=>p.some(t=>t.key===e&&t.active),E=async e=>{h(e.key);try{let t=await fetch("/api/stripe/addon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remove",agencyId:a,addonKey:e.key,priceId:e.priceId})}),s=await t.json();t.ok?(o({title:"Success",description:s.message||`${e.title} removed successfully`}),await S()):o({title:"Error",description:s.error||"Failed to remove addon",variant:"destructive"})}catch(e){o({title:"Error",description:"Failed to remove addon. Please try again.",variant:"destructive"})}finally{h(null)}},R=b.reduce((e,t)=>{let s=t.category;return e[s]||(e[s]=[]),e[s].push(t),e},{});return m?(0,t.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,t.jsx)(C.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,t.jsxs)(t.Fragment,{children:[D,(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-content-primary",children:"Add-ons"}),(0,t.jsx)("p",{className:"text-sm text-content-secondary mt-1",children:"Extend your subscription with powerful add-on modules"})]}),p.length>0&&(0,t.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-content-primary mb-2",children:"Active Add-ons"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:p.filter(e=>e.active).map(e=>(0,t.jsx)(i.Badge,{variant:"secondary",className:"bg-brand-bg/10 text-brand-bg",children:e.name},e.id))})]}),Object.entries(R).map(([e,s])=>(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"flex items-center justify-center h-8 w-8 rounded-lg bg-brand-bg/10 border border-brand-bg/30",children:function(e){switch(e){case"fi":return(0,t.jsx)(e$.PiggyBank,{className:"h-4 w-4"});case"core":return(0,t.jsx)(ek.Zap,{className:"h-4 w-4"});default:return(0,t.jsx)(ec.Plus,{className:"h-4 w-4"})}}(e)}),(0,t.jsx)("div",{children:(0,t.jsx)("h3",{className:"text-base font-semibold text-content-primary",children:N[e]||"Add-ons"})})]}),(0,t.jsx)("div",{className:"grid gap-4 sm:grid-cols-3 lg:grid-cols-4",children:s.map(e=>{let s=Math.round(e.priceAmount/100),a=A(e.key),r=!!(e.requires&&!A(e.requires)),d=x===e.key;return(0,t.jsxs)(l.Card,{className:(0,eF.default)("group relative overflow-hidden rounded-xl flex flex-col transition-all duration-300",a?"border-2 border-brand-bg bg-brand-bg/5":"border border-line-primary bg-surface-secondary/95",r&&"opacity-50"),children:[(0,t.jsxs)("div",{className:"absolute top-3 right-3 flex gap-1",children:[a&&(0,t.jsx)(i.Badge,{variant:"default",className:"bg-brand-bg text-white text-[10px]",children:"Active"}),e.recommended&&!a&&(0,t.jsx)(i.Badge,{variant:"secondary",className:"bg-brand-bg/10 text-brand-bg border-brand-bg/30 text-[10px]",children:"Recommended"})]}),(0,t.jsx)(l.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:(0,eF.default)("flex items-center justify-center h-10 w-10 rounded-lg transition-colors",a?"bg-brand-bg text-white":"bg-surface-tertiary border border-line-secondary"),children:function(e){switch(e){case"support":return(0,t.jsx)(eV,{className:"h-3 w-3"});case"branding":return(0,t.jsx)(eO.Palette,{className:"h-3 w-3"});case"finance":return(0,t.jsx)(e$.PiggyBank,{className:"h-3 w-3"});default:return(0,t.jsx)(ek.Zap,{className:"h-3 w-3"})}}(e.addonType)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)(l.CardTitle,{className:"text-base font-semibold text-content-primary truncate",children:e.title}),(0,t.jsx)(l.CardDescription,{className:"text-xs text-content-secondary line-clamp-2 mt-1",children:e.description})]})]})}),(0,t.jsxs)(l.CardContent,{className:"flex-1 space-y-4 pb-3",children:[(0,t.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,t.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-b from-neutral-header to-neutral-fg-tertiary bg-clip-text text-transparent",children:(0,g.formatCurrency)(s,e.currency)}),(0,t.jsxs)("span",{className:"text-sm text-content-tertiary",children:["/","one_time"===e.interval?"one-time":"month"]})]}),r&&(0,t.jsxs)("div",{className:"text-xs text-warning-fg bg-warning-bg/10 border border-warning-border/30 rounded-md px-2 py-1.5",children:["Requires ",e.requires," addon"]}),(0,t.jsxs)("ul",{className:"space-y-1.5",children:[e.features.slice(0,3).map(e=>(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"flex-shrink-0 inline-flex h-4 w-4 items-center justify-center rounded-full bg-brand-bg/10 border border-brand-bg/30 mt-0.5",children:(0,t.jsx)(v.Check,{className:"h-2.5 w-2.5 text-brand-bg",strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-xs text-content-primary leading-relaxed",children:e})]},e)),e.features.length>3&&(0,t.jsxs)("li",{className:"text-xs text-content-tertiary pl-6",children:["+",e.features.length-3," more features"]})]})]}),(0,t.jsx)(l.CardFooter,{className:"pt-0 pb-4",children:(0,t.jsx)(n.Button,{variant:a?"outline":"default",size:"sm",className:(0,eF.default)("w-full transition-all",!a&&"bg-brand-gradient hover:bg-brand-gradient-hover"),onClick:()=>(e=>{if(A(e.key))E(e);else I({key:e.key,type:"addon",title:e.title,description:e.description,price:e.price,priceAmount:e.priceAmount,priceId:e.priceId,interval:e.interval,features:e.features})})(e),disabled:r||d,children:d?(0,t.jsx)(C.Loader2,{className:"h-4 w-4 animate-spin"}):a?"Remove Add-on":(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ec.Plus,{className:"h-4 w-4 mr-1.5"}),"Add to Subscription"]})})})]},e.key)})})]},e))]})]})},te=["subscription","payment-methods","usage","credits","promotional","addons"],tt=({scope:e,scopeId:s,section:a})=>{switch(a){case"subscription":default:return(0,t.jsx)($,{scope:e,scopeId:s});case"payment-methods":return(0,t.jsx)(ev,{scope:e,scopeId:s,showInvoices:!0,showDunning:!0});case"usage":return(0,t.jsx)(eU,{scope:e,scopeId:s});case"credits":case"promotional":return(0,t.jsx)(eA,{scope:e,scopeId:s,showCredits:!0,showCoupons:!0});case"addons":return(0,t.jsx)(e9,{scope:e,scopeId:s})}},ts=({scope:e,scopeId:s,section:a,className:r})=>{let l=a&&te.includes(a)?a:"subscription";return(0,t.jsx)("div",{className:r,children:(0,t.jsx)(tt,{scope:e,scopeId:s,section:l})})};e.s(["BillingClient",()=>ts,"default",0,ts],598491)}]);