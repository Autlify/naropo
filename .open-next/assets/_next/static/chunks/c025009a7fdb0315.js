(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,924765,e=>{"use strict";var s=e.i(95187);let i=(0,s.createServerReference)("7ce77e2f8558484be720070be666097800d1d54b31",s.callServer,void 0,s.findSourceMapURL,"changeUserPermissions");e.s(["changeUserPermissions",()=>i])},11765,e=>{"use strict";var s=e.i(95187);let i=(0,s.createServerReference)("00d1e8c27b8f6f54414802ce4b8fc7cfdbce5b4072",s.callServer,void 0,s.findSourceMapURL,"getAuthUserDetails");e.s(["getAuthUserDetails",()=>i])},361919,e=>{"use strict";var s=e.i(95187);let i=(0,s.createServerReference)("400e4316b3f57301b5e594a2e827f77a092945f2fa",s.callServer,void 0,s.findSourceMapURL,"getUserMemberships");e.s(["getUserMemberships",()=>i])},724296,e=>{"use strict";var s=e.i(95187);let i=(0,s.createServerReference)("40464f6453247197f55b96edcbb5a1d00b3b500f33",s.callServer,void 0,s.findSourceMapURL,"updateUser");e.s(["updateUser",()=>i])},721898,e=>{"use strict";var s=e.i(95187);let i=(0,s.createServerReference)("40d54bd414469e40ff3b9278e05b5e53ff02ef900a",s.callServer,void 0,s.findSourceMapURL,"hasPermission");e.s(["hasPermission",()=>i])},72028,e=>{"use strict";var s=e.i(843476),i=e.i(86896),r=e.i(271645),t=e.i(922140),a=e.i(618566),n=e.i(924765),c=e.i(11765),o=e.i(361919),l=e.i(2170),d=e.i(724296),u=e.i(721898),m=e.i(681307),f=e.i(653145),b=e.i(994814),h=e.i(515288),v=e.i(903133),p=e.i(795320),S=e.i(793479),g=e.i(519455),x=e.i(888173),j=e.i(772436),U=e.i(699375);e.s(["default",0,({id:e,type:y,subAccounts:A,userData:F})=>{let[C,M]=(0,r.useState)(null),{data:I,setClose:R}=(0,i.useModal)(),[w,L]=(0,r.useState)(""),[N,P]=(0,r.useState)(!1),[T,D]=(0,r.useState)(null),[E,z]=(0,r.useState)(!1),{toast:O}=(0,t.useToast)(),B=(0,a.useRouter)();(0,r.useEffect)(()=>{I.user&&(async()=>{let e=await (0,c.getAuthUserDetails)();e&&D(e),z(await (0,u.hasPermission)("core.agency.team_member.invite"))})()},[I]);let $=m.z.object({name:m.z.string().min(1),email:m.z.string().email(),avatarUrl:m.z.string().nullable().optional()}),k=(0,f.useForm)({resolver:(0,b.zodResolver)($),mode:"onChange",defaultValues:{name:(F?F.name:I?.user?.name)||"",email:(F?F.email:I?.user?.email)||"",avatarUrl:F?F.avatarUrl??void 0:I?.user?.avatarUrl??void 0}});(0,r.useEffect)(()=>{I.user&&(async()=>{I.user&&M(await (0,o.getUserMemberships)(I.user.id))})()},[I,k]);let q=async(e,s,i)=>{if(!I.user?.id)return;P(!0);let r=C?.SubAccountMemberships?.find(s=>s.subAccountId===e)?.roleId;if(!r){O({variant:"destructive",title:"Failed",description:"Could not find role for permission update"}),P(!1);return}let t=await (0,n.changeUserPermissions)(I.user.id,r,"subaccount",void 0,e),a=T?.AgencyMemberships?.[0];"agency"===y&&a&&await (0,l.saveActivityLogsNotification)({agencyId:a.agencyId,description:`Gave ${F?.name} access to | ${C?.SubAccountMemberships?.find(s=>s.subAccountId===e)?.SubAccount?.name} `,subaccountId:e}),t?O({title:"Success",description:"The request was successfull"}):O({variant:"destructive",title:"Failed",description:"Could not update permissions"}),B.refresh(),P(!1)},K=async s=>{if(!e)return;let i=k.getValues();if(F||I?.user){let e=await (0,d.updateUser)(i),s=T?.AgencyMemberships?.[0];s&&s.Agency.SubAccount.filter(e=>T.SubAccountMemberships?.some(s=>s.subAccountId===e.id&&s.isActive)).forEach(async e=>{await (0,l.saveActivityLogsNotification)({agencyId:void 0,description:`Updated ${F?.name} information`,subaccountId:e.id})}),e?(O({title:"Success",description:"Update User Information"}),R(),B.refresh()):O({variant:"destructive",title:"Oppse!",description:"Could not update user information"})}else console.log("Error could not submit")};return(0,s.jsxs)(h.Card,{className:"w-full",children:[(0,s.jsxs)(h.CardHeader,{children:[(0,s.jsx)(h.CardTitle,{children:"User Details"}),(0,s.jsx)(h.CardDescription,{children:"Add or update your information"})]}),(0,s.jsx)(h.CardContent,{children:(0,s.jsx)(v.Form,{...k,children:(0,s.jsxs)("form",{onSubmit:k.handleSubmit(K),className:"space-y-4",children:[(0,s.jsx)(v.FormField,{disabled:k.formState.isSubmitting,control:k.control,name:"avatarUrl",render:({field:e})=>(0,s.jsxs)(v.FormItem,{children:[(0,s.jsx)(v.FormLabel,{children:"Profile picture"}),(0,s.jsx)(v.FormControl,{children:(0,s.jsx)(p.default,{apiEndpoint:"avatar",value:e.value||void 0,onChange:e.onChange})}),(0,s.jsx)(v.FormMessage,{})]})}),(0,s.jsx)(v.FormField,{disabled:k.formState.isSubmitting,control:k.control,name:"name",render:({field:e})=>(0,s.jsxs)(v.FormItem,{className:"flex-1",children:[(0,s.jsx)(v.FormLabel,{children:"User full name"}),(0,s.jsx)(v.FormControl,{children:(0,s.jsx)(S.Input,{required:!0,placeholder:"Full Name",...e})}),(0,s.jsx)(v.FormMessage,{})]})}),(0,s.jsx)(v.FormField,{disabled:k.formState.isSubmitting,control:k.control,name:"email",render:({field:e})=>(0,s.jsxs)(v.FormItem,{className:"flex-1",children:[(0,s.jsx)(v.FormLabel,{children:"Email"}),(0,s.jsx)(v.FormControl,{children:(0,s.jsx)(S.Input,{readOnly:k.formState.isSubmitting,placeholder:"Email",...e})}),(0,s.jsx)(v.FormMessage,{})]})}),(0,s.jsx)(g.Button,{disabled:k.formState.isSubmitting,type:"submit",children:k.formState.isSubmitting?(0,s.jsx)(x.default,{}):"Save User Details"}),E&&(0,s.jsxs)("div",{children:[(0,s.jsx)(j.Separator,{className:"my-4"}),(0,s.jsx)(v.FormLabel,{children:" User Permissions"}),(0,s.jsx)(v.FormDescription,{className:"mb-4",children:"You can give Sub Account access to team member by turning on access control for each Sub Account. This is only visible to agency owners"}),(0,s.jsx)("div",{className:"flex flex-col gap-4",children:A?.map(e=>{let i=C?.SubAccountMemberships?.find(s=>s.subAccountId===e.id);return(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[(0,s.jsx)("div",{children:(0,s.jsx)("p",{children:e.name})}),(0,s.jsx)(U.Switch,{disabled:N,checked:i?.isActive,onCheckedChange:s=>{q(e.id,s,i?.id)}})]},e.id)})})]})]})})})]})}])}]);