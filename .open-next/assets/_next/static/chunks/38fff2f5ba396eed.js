(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,610688,e=>{"use strict";var s=e.i(843476),t=e.i(522016),i=e.i(618566),a=e.i(975157),n=e.i(519455);let r=[{key:"providers",label:"Providers",href:"providers"},{key:"connections",label:"Connections",href:"connections"},{key:"api-keys",label:"API Keys",href:"api-keys"},{key:"subscriptions",label:"Subscriptions",href:"subscriptions"},{key:"deliveries",label:"Deliveries",href:"deliveries"}];function c({basePath:e}){let c=(0,i.usePathname)();return(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(i=>{let r=`${e}/${i.href}`,d=c===r||c.startsWith(r+"/");return(0,s.jsx)(n.Button,{asChild:!0,variant:d?"default":"outline",size:"sm",className:(0,a.cn)("rounded-xl"),children:(0,s.jsx)(t.default,{href:r,children:i.label})},i.key)})})}e.s(["WebhooksNav",()=>c])},46159,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(522016),a=e.i(519455),n=e.i(515288),r=e.i(487486);function c(e){let c=(0,t.useMemo)(()=>{let s=new URLSearchParams;return e.agencyId&&s.set("agencyId",e.agencyId),e.subAccountId&&s.set("subAccountId",e.subAccountId),s.toString()},[e.agencyId,e.subAccountId]),d=e.agencyId?`/agency/${e.agencyId}`:`/subaccount/${e.subAccountId}`,[l,o]=(0,t.useState)([]),[u,h]=(0,t.useState)([]),x=async()=>{let[e,s]=await Promise.all([fetch("/api/features/core/webhooks/providers").then(e=>e.json()),fetch(`/api/features/core/webhooks/connections?${c}`).then(e=>e.json())]);o(e.providers||[]),h(s.connections||[])};return(0,t.useEffect)(()=>{x()},[c]),(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Providers"}),(0,s.jsx)(n.CardDescription,{children:"Connect providers and manage credentials per context."})]}),(0,s.jsx)(n.CardContent,{className:"grid gap-4 md:grid-cols-2",children:l.map(e=>{var t;let n=(t=e.id,{conn:u.find(e=>e.provider===t&&!e.isInherited),inherited:u.find(e=>e.provider===t&&e.isInherited)}),c=n.conn?.status||(n.inherited?`INHERITED:${n.inherited.status}`:"DISCONNECTED");return(0,s.jsxs)("div",{className:"border rounded-xl p-4 flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"font-semibold truncate",children:e.name}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground truncate",children:e.description||e.id})]}),(0,s.jsx)(r.Badge,{variant:c.startsWith("CONNECTED")?"default":"secondary",children:c})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(i.default,{href:`${d}/apps/webhooks/providers/${e.id}`,children:"Manage"})}),e.webhookSupported?(0,s.jsx)(r.Badge,{variant:"outline",children:"Webhooks"}):null,e.oauthSupported?(0,s.jsx)(r.Badge,{variant:"outline",children:"OAuth"}):(0,s.jsx)(r.Badge,{variant:"outline",children:"Webhook"})]})]},e.id)})})]})}e.s(["WebhooksProvidersPanel",()=>c])},762199,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(522016),a=e.i(519455),n=e.i(515288),r=e.i(487486);function c(e){let c=(0,t.useMemo)(()=>{let s=new URLSearchParams;return e.agencyId&&s.set("agencyId",e.agencyId),e.subAccountId&&s.set("subAccountId",e.subAccountId),s.toString()},[e.agencyId,e.subAccountId]),d=e.agencyId?`/agency/${e.agencyId}`:`/subaccount/${e.subAccountId}`,[l,o]=(0,t.useState)([]),[u,h]=(0,t.useState)(null),x=async()=>{o((await fetch(`/api/features/core/webhooks/connections?${c}`).then(e=>e.json())).connections||[])};(0,t.useEffect)(()=>{x()},[c]);let m=async e=>{if(confirm("Disconnect this connection?")){h(e);try{await fetch(`/api/features/core/webhooks/connections/${e}?${c}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({status:"DISCONNECTED",credentials:null})}),await x()}finally{h(null)}}};return(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Connections"}),(0,s.jsx)(n.CardDescription,{children:"View current connections (owned vs inherited)."})]}),(0,s.jsxs)(n.CardContent,{className:"space-y-3",children:[0===l.length?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No connections yet."}):null,(0,s.jsx)("div",{className:"divide-y rounded-xl border",children:l.map(e=>(0,s.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"font-medium truncate",children:e.provider}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.isInherited?"Inherited":"Owned"," • ",e.updatedAt?new Date(e.updatedAt).toLocaleString():"—"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.Badge,{variant:"CONNECTED"===e.status?"default":"secondary",children:e.status}),(0,s.jsx)(a.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(i.default,{href:`${d}/apps/webhooks/providers/${e.provider}`,children:"Manage"})}),e.isInherited?null:(0,s.jsx)(a.Button,{variant:"outline",size:"sm",disabled:u===e.id,onClick:()=>m(e.id),children:"Disconnect"})]})]},e.id))})]})]})}e.s(["WebhooksConnectionsPanel",()=>c])},38108,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(519455),a=e.i(515288),n=e.i(793479),r=e.i(487486);function c(e){let c=(0,t.useMemo)(()=>{let s=new URLSearchParams;return e.agencyId&&s.set("agencyId",e.agencyId),e.subAccountId&&s.set("subAccountId",e.subAccountId),s.toString()},[e.agencyId,e.subAccountId]),[d,l]=(0,t.useState)([]),[o,u]=(0,t.useState)(""),[h,x]=(0,t.useState)(null),[m,p]=(0,t.useState)(!1),f=async()=>{l((await fetch(`/api/features/core/webhooks/api-keys?${c}`).then(e=>e.json())).apiKeys||[])};(0,t.useEffect)(()=>{f()},[c]);let v=async()=>{p(!0);try{let e=await fetch(`/api/features/core/webhooks/api-keys?${c}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:o||"Default"})}),s=await e.json().catch(()=>({}));e.ok?(x(s.apiKey?.apiKey||null),u(""),await f()):alert(s.error||"Failed to create key")}finally{p(!1)}},j=async e=>{if(confirm("Revoke this key?")){p(!0);try{(await fetch(`/api/features/core/webhooks/api-keys/${e}?${c}`,{method:"DELETE"})).ok&&await f()}finally{p(!1)}}};return(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"API Keys"}),(0,s.jsx)(a.CardDescription,{children:"Server-to-server API keys. The secret is shown once. Store it in your environment variables."})]}),(0,s.jsxs)(a.CardContent,{className:"space-y-4",children:[h?(0,s.jsxs)("div",{className:"rounded-xl border p-3",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"New API Key (copy now)"}),(0,s.jsxs)("div",{className:"mt-2 flex flex-col gap-2",children:[(0,s.jsx)("code",{className:"text-xs break-all",children:h}),(0,s.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>x(null),children:"Dismiss"})]})]}):null,(0,s.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,s.jsx)(n.Input,{placeholder:"Key name",value:o,onChange:e=>u(e.target.value)}),(0,s.jsx)(i.Button,{onClick:v,disabled:m,children:"Create key"})]}),(0,s.jsxs)("div",{className:"divide-y rounded-xl border",children:[0===d.length?(0,s.jsx)("div",{className:"p-3 text-sm text-muted-foreground",children:"No API keys yet."}):null,d.map(e=>(0,s.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"font-medium truncate",children:e.name}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.keyPrefix?`Prefix: ${e.keyPrefix}`:"—"," • ",e.revokedAt?"Revoked":"Active"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.Badge,{variant:e.revokedAt?"secondary":"default",children:e.revokedAt?"REVOKED":"ACTIVE"}),e.revokedAt?null:(0,s.jsx)(i.Button,{variant:"outline",size:"sm",disabled:m,onClick:()=>j(e.id),children:"Revoke"})]})]},e.id))]})]})]})}e.s(["WebhooksApiKeysPanel",()=>c])},218933,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(522016),a=e.i(519455),n=e.i(515288),r=e.i(487486),c=e.i(772436);function d(e){let d=(0,t.useMemo)(()=>{let s=new URLSearchParams;return e.agencyId&&s.set("agencyId",e.agencyId),e.subAccountId&&s.set("subAccountId",e.subAccountId),s.toString()},[e.agencyId,e.subAccountId]),l=e.agencyId?`/agency/${e.agencyId}`:`/subaccount/${e.subAccountId}`,[o,u]=(0,t.useState)([]),[h,x]=(0,t.useState)({}),[m,p]=(0,t.useState)(!1),f=async()=>{p(!0);try{let e=((await fetch(`/api/features/core/webhooks/connections?${d}`).then(e=>e.json())).connections||[]).filter(e=>"CONNECTED"===e.status);u(e);let s={};await Promise.all(e.map(async e=>{let t=await fetch(`/api/features/core/webhooks/subscriptions?${d}&connectionId=${e.id}`).then(e=>e.json());s[e.id]=t.subscriptions||[]})),x(s)}finally{p(!1)}};(0,t.useEffect)(()=>{f()},[d]);let v=async(e,s)=>{p(!0);try{await fetch(`/api/features/core/webhooks/subscriptions/${e}?${d}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({isActive:s})}),await f()}finally{p(!1)}};return(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Webhooks"}),(0,s.jsx)(n.CardDescription,{children:"Manage webhook subscriptions (connect per provider)."})]}),(0,s.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.Button,{variant:"outline",size:"sm",onClick:f,disabled:m,children:"Refresh"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Subscriptions are configured per provider connection."})]}),0===o.length?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No connected providers with webhooks yet."}):null,o.map(e=>{let t=h[e.id]||[];return(0,s.jsxs)("div",{className:"rounded-xl border p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"font-medium",children:e.provider}),(0,s.jsx)(a.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(i.default,{href:`${l}/apps/webhooks/providers/${e.provider}`,children:"Manage provider"})})]}),(0,s.jsx)(c.Separator,{}),0===t.length?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No subscriptions yet."}):(0,s.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"text-sm truncate",children:e.url}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:(e.events||[]).join(", ")||"—"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.Badge,{variant:e.isActive?"default":"secondary",children:e.isActive?"ACTIVE":"PAUSED"}),(0,s.jsx)(a.Button,{variant:"outline",size:"sm",disabled:m,onClick:()=>v(e.id,!e.isActive),children:e.isActive?"Pause":"Resume"})]})]},e.id))})]},e.id)})]})]})}e.s(["WebhooksSubscriptionsPanel",()=>d])},510549,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(522016),a=e.i(519455),n=e.i(515288),r=e.i(487486);function c(e){let c=(0,t.useMemo)(()=>{let s=new URLSearchParams;return e.agencyId&&s.set("agencyId",e.agencyId),e.subAccountId&&s.set("subAccountId",e.subAccountId),s.toString()},[e.agencyId,e.subAccountId]),d=e.agencyId?`/agency/${e.agencyId}`:`/subaccount/${e.subAccountId}`,[l,o]=(0,t.useState)([]),[u,h]=(0,t.useState)(!1),x=async()=>{h(!0);try{let e=await fetch(`/api/features/core/webhooks/deliveries?${c}`).then(e=>e.json());o(e.deliveries||[])}finally{h(!1)}};return(0,t.useEffect)(()=>{x()},[c]),(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Deliveries"}),(0,s.jsx)(n.CardDescription,{children:"Recent webhook delivery attempts from provider events."})]}),(0,s.jsxs)(n.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.Button,{variant:"outline",size:"sm",onClick:x,disabled:u,children:"Refresh"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Showing most recent deliveries."})]}),(0,s.jsxs)("div",{className:"divide-y rounded-xl border",children:[0===l.length?(0,s.jsx)("div",{className:"p-3 text-sm text-muted-foreground",children:"No deliveries yet."}):null,l.map(e=>(0,s.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"text-sm font-medium truncate",children:e.subscription?.connection?.provider||"Provider"}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.createdAt?new Date(e.createdAt).toLocaleString():"—"," • Attempts: ",e.attemptCount??0]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.Badge,{variant:"SUCCESS"===e.status?"default":"FAILED"===e.status?"destructive":"secondary",children:e.status}),(0,s.jsx)(a.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(i.default,{href:`${d}/apps/webhooks/deliveries/${e.id}`,children:"Details"})})]})]},e.id))]})]})]})}e.s(["WebhooksDeliveriesPanel",()=>c])},413044,e=>{"use strict";var s=e.i(843476),t=e.i(522016),i=e.i(618566),a=e.i(975157),n=e.i(519455);let r=[{key:"wizard",label:"Wizard",href:"wizard"},{key:"tickets",label:"Tickets",href:"tickets"}];function c({basePath:e}){let c=(0,i.usePathname)();return(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(i=>{let r=`${e}/${i.href}`,d=c===r||c.startsWith(r+"/");return(0,s.jsx)(n.Button,{asChild:!0,variant:d?"default":"outline",size:"sm",className:(0,a.cn)("rounded-xl"),children:(0,s.jsx)(t.default,{href:r,children:i.label})},i.key)})})}e.s(["SupportNav",()=>c])},803104,e=>{"use strict";e.s(["scopeQuery",0,e=>"AGENCY"===e.type?`agencyId=${encodeURIComponent(e.agencyId)}`:`subAccountId=${encodeURIComponent(e.subaccountId)}`])},380260,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(515288),a=e.i(519455),n=e.i(772436),r=e.i(624687),c=e.i(793479),d=e.i(967489),l=e.i(487486),o=e.i(803104);let u={BILLING:"Billing / Subscription",WEBHOOKS:"Webhooks / Deliveries",ACCESS:"Access / Permissions",BUG:"Bug / UI issue",OTHER:"Other"};async function h(e){try{return await e.json()}catch{return null}}function x({scope:e}){let x="/api/features/core/support",m=(0,t.useMemo)(()=>(0,o.scopeQuery)(e),[e]),[p,f]=(0,t.useState)("BILLING"),[v,j]=(0,t.useState)(""),[y,g]=(0,t.useState)(""),[b,N]=(0,t.useState)(null),[C,w]=(0,t.useState)(!1),[k,I]=(0,t.useState)(!1),[S,A]=(0,t.useState)(null),$="BILLING"===p,E="WEBHOOKS"===p,B=(0,t.useMemo)(()=>"AGENCY"===e.type?{"x-autlify-agency":e.agencyId}:{"x-autlify-subaccount":e.subaccountId},[e]),D=async()=>{A(null),w(!0);try{let e={};if($){let s=await fetch(`${x}/diagnostics/billing?${m}`,{headers:B,cache:"no-store"});e.billing=await h(s)}if(E){let s=await fetch(`${x}/diagnostics/webhooks?${m}`,{headers:B,cache:"no-store"});e.webhooks=await h(s)}e.client={userAgent:"u">typeof navigator?navigator.userAgent:void 0,time:new Date().toISOString()},N(e)}catch(e){A(e?.message||"Failed to run diagnostics")}finally{w(!1)}},T=async()=>{A(null),I(!0);try{let e={category:p,title:v||`${u[p]} issue`,description:y,diagnostics:b},s=await fetch(`${x}/tickets?${m}`,{method:"POST",headers:{...B,"content-type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await h(s);throw Error(e?.error||`Request failed (${s.status})`)}j(""),g(""),A("Ticket created. You can view it in Tickets.")}catch(e){A(e?.message||"Failed to create ticket")}finally{I(!1)}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{children:"Guided Troubleshooting"}),(0,s.jsx)(i.CardDescription,{children:"Capture the essentials quickly. If you run diagnostics, the snapshot will be attached to the ticket."})]}),(0,s.jsxs)(i.CardContent,{className:"space-y-5",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Category"}),(0,s.jsxs)(d.Select,{value:p,onValueChange:e=>f(e),children:[(0,s.jsx)(d.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(d.SelectValue,{placeholder:"Select"})}),(0,s.jsx)(d.SelectContent,{children:Object.entries(u).map(([e,t])=>(0,s.jsx)(d.SelectItem,{value:e,children:t},e))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Title"}),(0,s.jsx)(c.Input,{className:"rounded-xl",placeholder:"Short summary",value:v,onChange:e=>j(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Details"}),(0,s.jsx)(r.Textarea,{className:"min-h-[140px] rounded-xl",placeholder:"What were you doing? What did you expect? What happened instead?",value:y,onChange:e=>g(e.target.value)})]}),(0,s.jsx)(n.Separator,{}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)(a.Button,{type:"button",variant:"outline",className:"rounded-xl",onClick:D,disabled:C,children:C?"Running diagnostics…":"Run diagnostics"}),$||E?(0,s.jsxs)(l.Badge,{variant:"secondary",children:["Includes: ",$?"billing":null,$&&E?", ":null,E?"webhooks":null]}):(0,s.jsx)(l.Badge,{variant:"outline",children:"No automated diagnostics for this category"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(a.Button,{type:"button",className:"rounded-xl",onClick:T,disabled:k||!y.trim(),children:k?"Submitting…":"Create ticket"})]}),S?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:S}):null,b?(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"text-sm font-medium mb-2",children:"Diagnostics snapshot"}),(0,s.jsx)("pre",{className:"text-xs overflow-auto max-h-[260px] whitespace-pre-wrap",children:JSON.stringify(b,null,2)})]}):null]})]}),(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{children:"Quick tips"}),(0,s.jsx)(i.CardDescription,{children:"These reduce back-and-forth for 90% of cases."})]}),(0,s.jsxs)(i.CardContent,{className:"text-sm text-muted-foreground space-y-2",children:[(0,s.jsx)("div",{children:"• Billing issues: confirm plan status and whether the feature is entitled (Add-on vs base)."}),(0,s.jsx)("div",{children:"• Webhooks: check Deliveries for recent failures and retry from Deliveries detail."}),(0,s.jsx)("div",{children:"• Access: verify your role has the required permission keys and that the gate is enabled by entitlement."})]})]})]})}e.s(["SupportWizardPanel",()=>x])},846459,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(515288),a=e.i(519455),n=e.i(487486),r=e.i(772436),c=e.i(803104);async function d(e){try{return await e.json()}catch{return null}}function l({scope:e}){let l=(0,t.useMemo)(()=>(0,c.scopeQuery)(e),[e]),o=(0,t.useMemo)(()=>"AGENCY"===e.type?{"x-autlify-agency":e.agencyId}:{"x-autlify-subaccount":e.subaccountId},[e]),[u,h]=(0,t.useState)([]),[x,m]=(0,t.useState)(!1),[p,f]=(0,t.useState)(null),v=async()=>{f(null),m(!0);try{let e=await fetch(`/api/features/core/support/tickets?${l}`,{headers:o,cache:"no-store"});if(!e.ok){let s=await d(e);throw Error(s?.error||`Request failed (${e.status})`)}let s=await d(e);h(s?.tickets||[])}catch(e){f(e?.message||"Failed to load tickets")}finally{m(!1)}};return(0,t.useEffect)(()=>{v()},[l]),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(i.Card,{children:[(0,s.jsx)(i.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.CardTitle,{children:"Tickets"}),(0,s.jsx)(i.CardDescription,{children:"All tickets for this scope. Newest first."})]}),(0,s.jsx)(a.Button,{variant:"outline",className:"rounded-xl",onClick:v,disabled:x,children:x?"Refreshing…":"Refresh"})]})}),(0,s.jsxs)(i.CardContent,{className:"space-y-4",children:[p?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:p}):null,0!==u.length||x?null:(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No tickets yet."}),u.map(e=>(0,s.jsxs)("div",{className:"rounded-xl border p-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"font-medium",children:e.title}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.Badge,{variant:function(e){switch(e){case"OPEN":return"default";case"IN_PROGRESS":return"secondary";default:return"outline"}}(e.status),children:e.status}),(0,s.jsx)(n.Badge,{variant:"outline",children:e.category})]})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString()}),e.description?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Separator,{}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.description})]}):null]},e.id))]})]})})}e.s(["SupportTicketsPanel",()=>l])},873047,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(522016),a=e.i(519455),n=e.i(515288),r=e.i(793479),c=e.i(487486),d=e.i(772436);function l(e){let l=(0,t.useMemo)(()=>{let s=new URLSearchParams;return e.agencyId&&s.set("agencyId",e.agencyId),e.subAccountId&&s.set("subAccountId",e.subAccountId),s.toString()},[e.agencyId,e.subAccountId]),[o,u]=(0,t.useState)([]),[h,x]=(0,t.useState)(null),[m,p]=(0,t.useState)([]),[f,v]=(0,t.useState)(""),[j,y]=(0,t.useState)(""),[g,b]=(0,t.useState)(""),[N,C]=(0,t.useState)(!1),w=e.agencyId?`/agency/${e.agencyId}`:`/subaccount/${e.subAccountId}`,k=["github","slack"].includes(e.provider),I=async()=>{let s=await fetch(`/api/features/core/webhooks/connections?${l}`).then(e=>e.json());u(s.connections||[]);let t=(s.connections||[]).find(s=>s.provider===e.provider&&!s.isInherited)||(s.connections||[]).find(s=>s.provider===e.provider);x(t||null),t?.id?p((await fetch(`/api/features/core/webhooks/subscriptions?${l}&connectionId=${t.id}`).then(e=>e.json())).subscriptions||[]):p([])};(0,t.useEffect)(()=>{I()},[l,e.provider]);let S=(0,t.useMemo)(()=>{let s=encodeURIComponent(`${w}/apps/webhooks/providers/${e.provider}`);return`/api/features/core/webhooks/providers/${e.provider}/oauth?${l}&back=${s}`},[w,e.provider,l]),A=async()=>{if(!h?.id||h?.isInherited){C(!0);try{let s=await fetch(`/api/features/core/webhooks/connections?${l}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({provider:e.provider})});if(!s.ok){let e=await s.json().catch(()=>({}));alert(e.error||"Failed to create connection")}await I()}finally{C(!1)}}},$=async()=>{if(h?.id&&confirm("Disconnect this provider?")){C(!0);try{await fetch(`/api/features/core/webhooks/connections/${h.id}?${l}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({status:"DISCONNECTED",credentials:null})}),await I()}finally{C(!1)}}},E=async()=>{if(h?.id){C(!0);try{let e=j.split(",").map(e=>e.trim()).filter(Boolean),s=await fetch(`/api/features/core/webhooks/subscriptions?${l}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({connectionId:h.id,url:f,events:e,secret:g||void 0})}),t=await s.json().catch(()=>({}));s.ok||alert(t.error||"Failed to create subscription"),v(""),y(""),b(""),await I()}finally{C(!1)}}},B=async(e,s)=>{C(!0);try{await fetch(`/api/features/core/webhooks/subscriptions/${e}?${l}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({isActive:s})}),await I()}finally{C(!1)}},D=async e=>{if(confirm("Delete this subscription?")){C(!0);try{await fetch(`/api/features/core/webhooks/subscriptions/${e}?${l}`,{method:"DELETE"}),await I()}finally{C(!1)}}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Connection"}),(0,s.jsx)(n.CardDescription,{children:"Manage provider connection and credentials."})]}),(0,s.jsxs)(n.CardContent,{className:"flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Status: ",(0,s.jsx)(c.Badge,{variant:h?.status==="CONNECTED"?"default":"secondary",children:h?.status||"DISCONNECTED"}),h?.isInherited?(0,s.jsx)(c.Badge,{variant:"outline",className:"ml-2",children:"Inherited"}):null]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsx)(i.default,{href:`${w}/apps`,children:"Back"})}),(0,s.jsx)(a.Button,{variant:"outline",size:"sm",onClick:A,disabled:N,children:"Ensure Connection"}),(0,s.jsx)(a.Button,{variant:"outline",size:"sm",asChild:!0,disabled:N||!k,children:(0,s.jsx)("a",{href:S,children:"OAuth Connect"})}),(0,s.jsx)(a.Button,{variant:"destructive",size:"sm",onClick:$,disabled:N||!h?.id||!!h?.isInherited,children:"Disconnect"})]})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Inbound webhook URL: ",(0,s.jsx)("code",{className:"break-all",children:`${window.location.origin}/api/features/core/webhooks/providers/${e.provider}/ingest/${h?.id||"{connectionId}"}`})]})]})]}),(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Webhook Subscriptions"}),(0,s.jsx)(n.CardDescription,{children:"Fan-out provider events to your endpoints. Secret is stored as SHA-256(secret) and used as signing key."})]}),(0,s.jsx)(n.CardContent,{className:"space-y-4",children:h?.id?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid gap-2 md:grid-cols-3",children:[(0,s.jsx)(r.Input,{placeholder:"https://example.com/webhook",value:f,onChange:e=>v(e.target.value),disabled:N}),(0,s.jsx)(r.Input,{placeholder:"events (comma-separated)",value:j,onChange:e=>y(e.target.value),disabled:N}),(0,s.jsx)(r.Input,{placeholder:"secret (optional)",value:g,onChange:e=>b(e.target.value),disabled:N})]}),(0,s.jsx)(a.Button,{onClick:E,disabled:N||!f||!j,children:"Add Subscription"}),(0,s.jsx)(d.Separator,{}),(0,s.jsx)("div",{className:"space-y-2",children:0===m.length?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No subscriptions yet."}):m.map(e=>(0,s.jsx)("div",{className:"border rounded-xl p-3 flex flex-col gap-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"font-medium truncate",children:e.url}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground truncate",children:["Events: ",(e.events||[]).join(", ")]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(c.Badge,{variant:e.isActive?"default":"secondary",children:e.isActive?"ACTIVE":"PAUSED"}),(0,s.jsx)(a.Button,{variant:"outline",size:"sm",onClick:()=>B(e.id,!e.isActive),disabled:N,children:e.isActive?"Pause":"Resume"}),(0,s.jsx)(a.Button,{variant:"destructive",size:"sm",onClick:()=>D(e.id),disabled:N,children:"Delete"})]})]})},e.id))})]}):(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Create a connection first."})})]})]})}e.s(["default",()=>l])}]);