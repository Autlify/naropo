(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,836445,e=>{"use strict";var t=e.i(843476),s=e.i(271645),r=e.i(903133),a=e.i(515288),i=e.i(653145),l=e.i(793479),n=e.i(519455),o=e.i(888173),d=e.i(927639),c=e.i(2170),u=e.i(48444),m=e.i(922140),x=e.i(86896),p=e.i(618566),h=e.i(994814);e.s(["default",0,({defaultData:e,subAccountId:g})=>{let{data:f,isOpen:j,setOpen:v,setClose:b}=(0,x.useModal)(),C=(0,p.useRouter)(),N=(0,i.useForm)({mode:"onChange",resolver:(0,h.zodResolver)(d.CreatePipelineFormSchema),defaultValues:{name:e?.name||""}});(0,s.useEffect)(()=>{e&&N.reset({name:e.name||""})},[e]);let y=N.formState.isLoading,w=async t=>{if(g){try{let s=await (0,u.upsertPipeline)({...t,id:e?.id,subAccountId:g});await (0,c.saveActivityLogsNotification)({agencyId:void 0,description:`Updates a pipeline | ${s?.name}`,subaccountId:g}),(0,m.toast)({title:"Success",description:"Saved pipeline details"}),C.refresh()}catch(e){(0,m.toast)({variant:"destructive",title:"Oppse!",description:"Could not save pipeline details"})}b()}};return(0,t.jsxs)(a.Card,{className:"w-full ",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Pipeline Details"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)(r.Form,{...N,children:(0,t.jsxs)("form",{onSubmit:N.handleSubmit(w),className:"flex flex-col gap-4",children:[(0,t.jsx)(r.FormField,{disabled:y,control:N.control,name:"name",render:({field:e})=>(0,t.jsxs)(r.FormItem,{children:[(0,t.jsx)(r.FormLabel,{children:"Pipeline Name"}),(0,t.jsx)(r.FormControl,{children:(0,t.jsx)(l.Input,{placeholder:"Name",...e})}),(0,t.jsx)(r.FormMessage,{})]})}),(0,t.jsx)(n.Button,{className:"w-20 mt-4",disabled:y,type:"submit",children:N.formState.isSubmitting?(0,t.jsx)(o.default,{}):"Save"})]})})})]})}])},116613,e=>{"use strict";var t=e.i(843476),s=e.i(836445),r=e.i(824609),a=e.i(519455),i=e.i(317056),l=e.i(337822),n=e.i(975157),o=e.i(86896),d=e.i(643531),c=e.i(344523),u=e.i(107233),m=e.i(522016),x=e.i(271645);e.s(["default",0,({pipelineId:e,pipelines:p,subAccountId:h})=>{let{setOpen:g,setClose:f}=(0,o.useModal)(),[j,v]=x.default.useState(!1),[b,C]=x.default.useState(e);return(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"flex items-end gap-2",children:(0,t.jsxs)(l.Popover,{open:j,onOpenChange:v,children:[(0,t.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{variant:"outline",role:"combobox","aria-expanded":j,className:"w-[200px] justify-between",children:[b?p.find(e=>e.id===b)?.name:"Select a pipeline...",(0,t.jsx)(c.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,t.jsx)(l.PopoverContent,{className:"w-[200px] p-0",children:(0,t.jsxs)(i.Command,{children:[(0,t.jsx)(i.CommandEmpty,{children:"No pipelines found."}),(0,t.jsxs)(i.CommandGroup,{children:[p.map(e=>(0,t.jsx)(m.default,{href:`/subaccount/${h}/pipelines/${e.id}`,children:(0,t.jsxs)(i.CommandItem,{value:e.id,onSelect:e=>{C(e),v(!1)},children:[(0,t.jsx)(d.Check,{className:(0,n.cn)("mr-2 h-4 w-4",b===e.id?"opacity-100":"opacity-0")}),e.name]},e.id)},e.id)),(0,t.jsxs)(a.Button,{variant:"secondary",className:"flex gap-2 w-full mt-4",onClick:()=>{g((0,t.jsx)(r.default,{title:"Create A Pipeline",subheading:"Pipelines allows you to group tickets into lanes and track your business processes all in one place.",children:(0,t.jsx)(s.default,{subAccountId:h})}))},children:[(0,t.jsx)(u.Plus,{size:15}),"Create Pipeline"]})]})]})})]})})})}])},431685,e=>{"use strict";var t=e.i(843476),s=e.i(836445),r=e.i(519455),a=e.i(868499),i=e.i(942922),l=e.i(922140),n=e.i(618566);e.s(["default",0,({pipelineId:e,subaccountId:o,pipelines:d})=>{let c=(0,n.useRouter)();return(0,t.jsx)(a.AlertDialog,{children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)(a.AlertDialogTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"destructive",children:"Delete Pipeline"})}),(0,t.jsxs)(a.AlertDialogContent,{children:[(0,t.jsxs)(a.AlertDialogHeader,{children:[(0,t.jsx)(a.AlertDialogTitle,{children:"Are you absolutely sure?"}),(0,t.jsx)(a.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete your account and remove your data from our servers."})]}),(0,t.jsxs)(a.AlertDialogFooter,{className:"items-center",children:[(0,t.jsx)(a.AlertDialogCancel,{children:"Cancel"}),(0,t.jsx)(a.AlertDialogAction,{onClick:async()=>{try{await (0,i.deletePipeline)(e),(0,l.toast)({title:"Deleted",description:"Pipeline is deleted"}),c.replace(`/subaccount/${o}/pipelines`)}catch(e){(0,l.toast)({variant:"destructive",title:"Oppse!",description:"Could Delete Pipeline"})}},children:"Delete"})]})]})]}),(0,t.jsx)(s.default,{subAccountId:o,defaultData:d.find(t=>t.id===e)})]})})}])},307773,e=>{"use strict";var t,s=e.i(843476),r=e.i(271645),a=e.i(903133),i=e.i(515288),l=e.i(653145),n=e.i(793479),o=e.i(519455),d=e.i(888173),c=e.i(927639),u=e.i(669638),m=e.i(2170),x=e.i(956949),p=e.i(922140),h=e.i(86896),g=e.i(618566),f=e.i(994814);let j=({defaultData:e,pipelineId:t})=>{let{setClose:j}=(0,h.useModal)(),v=(0,g.useRouter)(),b=(0,l.useForm)({mode:"onChange",resolver:(0,f.zodResolver)(c.LaneFormSchema),defaultValues:{name:e?.name||""}});(0,r.useEffect)(()=>{e&&b.reset({name:e.name||""})},[e]);let C=b.formState.isLoading,N=async s=>{if(t){try{let r=await (0,x.upsertLane)({...s,id:e?.id,pipelineId:t,order:e?.order}),a=await (0,u.getPipelineDetails)(t);if(!a)return;await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Updated a lane | ${r?.name}`,subaccountId:a.subAccountId}),(0,p.toast)({title:"Success",description:"Saved pipeline details"}),v.refresh()}catch(e){(0,p.toast)({variant:"destructive",title:"Oppse!",description:"Could not save pipeline details"})}j()}};return(0,s.jsxs)(i.Card,{className:"w-full ",children:[(0,s.jsx)(i.CardHeader,{children:(0,s.jsx)(i.CardTitle,{children:"Lane Details"})}),(0,s.jsx)(i.CardContent,{children:(0,s.jsx)(a.Form,{...b,children:(0,s.jsxs)("form",{onSubmit:b.handleSubmit(N),className:"flex flex-col gap-4",children:[(0,s.jsx)(a.FormField,{disabled:C,control:b.control,name:"name",render:({field:e})=>(0,s.jsxs)(a.FormItem,{children:[(0,s.jsx)(a.FormLabel,{children:"Lane Name"}),(0,s.jsx)(a.FormControl,{children:(0,s.jsx)(n.Input,{placeholder:"Lane Name",...e})}),(0,s.jsx)(a.FormMessage,{})]})}),(0,s.jsx)(o.Button,{className:"w-20 mt-4",disabled:C,type:"submit",children:b.formState.isSubmitting?(0,s.jsx)(d.default,{}):"Save"})]})})})]})};var v=e.i(824609),b=e.i(475254);let C=(0,b.default)("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]]);var N=e.i(107233),y=e.i(487064),w=e.i(868499),D=e.i(487486),S=e.i(755146),A=e.i(643420),T=e.i(975157),k=e.i(688511),I=e.i(323585),P=e.i(669186),E=e.i(116019),F=e.i(421937),R=e.i(791903),L=e.i(71357),M=e.i(624687),O=e.i(967489),H=e.i(799676),U=e.i(678745),U=U,z=e.i(805135),z=z;let B=(0,b.default)("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);var V=e.i(337822),$=e.i(317056),G=e.i(207670);let _=({colorName:e,title:t,selectedColor:r})=>(0,s.jsx)("div",{className:(0,G.default)("p-2 rounded-sm flex-shrink-0 text-xs cursor-pointer",{"bg-[#57acea]/10 text-[#57acea]":"BLUE"===e,"bg-[#ffac7e]/10 text-[#ffac7e]":"ORANGE"===e,"bg-rose-500/10 text-rose-500":"ROSE"===e,"bg-emerald-400/10 text-emerald-400":"GREEN"===e,"bg-purple-400/10 text-purple-400":"PURPLE"===e,"border-[1px] border-[#57acea]":"BLUE"===e&&!t,"border-[1px] border-[#ffac7e]":"ORANGE"===e&&!t,"border-[1px] border-rose-500":"ROSE"===e&&!t,"border-[1px] border-emerald-400":"GREEN"===e&&!t,"border-[1px] border-purple-400":"PURPLE"===e&&!t}),onClick:()=>{r&&r(e)},children:t},e);var K=e.i(373765),K=K,W=e.i(37727),q=e.i(422233),J=e.i(998082),X=e.i(371253),Q=e.i(961320);let Y=["BLUE","ORANGE","ROSE","PURPLE","GREEN"],Z=({getSelectedTags:e,subAccountId:t,defaultTags:a})=>{let[i,l]=(0,r.useState)(a||[]),[n,o]=(0,r.useState)([]),d=(0,g.useRouter)(),[c,u]=(0,r.useState)(""),[x,h]=(0,r.useState)("");(0,r.useEffect)(()=>{e(i)},[i]),(0,r.useEffect)(()=>{t&&(async()=>{let e=await (0,X.getTagsForSubaccount)(t);e&&o(e.Tags)})()},[t]);let f=async()=>{if(!c)return void(0,p.toast)({variant:"destructive",title:"Tags need to have a name"});if(!x)return void(0,p.toast)({variant:"destructive",title:"Please Select a color"});let e={color:x,createdAt:new Date,id:(0,q.v4)(),name:c,subAccountId:t,updatedAt:new Date};o([...n,e]),u(""),h("");try{let s=await (0,Q.upsertTag)(t,e);(0,p.toast)({title:"Created the tag"}),await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Updated a tag | ${s?.name}`,subaccountId:t})}catch(e){(0,p.toast)({variant:"destructive",title:"Could not create tag"})}},j=async e=>{o(n.filter(t=>t.id!==e));try{let s=await (0,J.deleteTag)(e);(0,p.toast)({title:"Deleted tag",description:"The tag is deleted from your subaccount."}),await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Deleted a tag | ${s?.name}`,subaccountId:t}),d.refresh()}catch(e){(0,p.toast)({variant:"destructive",title:"Could not delete tag"})}};return(0,s.jsx)(w.AlertDialog,{children:(0,s.jsxs)($.Command,{className:"bg-transparent",children:[!!i.length&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2 p-2 bg-background border-2 border rounded-md",children:i.map(e=>(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(_,{title:e.name,colorName:e.color}),(0,s.jsx)(W.X,{size:14,className:"text-muted-foreground cursor-pointer",onClick:()=>{var t;return t=e.id,void l(i.filter(e=>e.id!==t))}})]},e.id))}),(0,s.jsx)("div",{className:"flex items-center gap-2 my-2",children:Y.map(e=>(0,s.jsx)(_,{selectedColor:h,title:"",colorName:e},e))}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)($.CommandInput,{placeholder:"Search for tag...",value:c,onValueChange:u}),(0,s.jsx)(P.PlusCircleIcon,{onClick:f,size:20,className:"absolute top-1/2 transform -translate-y-1/2 right-2 icon-interactive"})]}),(0,s.jsxs)($.CommandList,{children:[(0,s.jsx)($.CommandSeparator,{}),(0,s.jsx)($.CommandGroup,{heading:"Tags",children:n.map(e=>(0,s.jsxs)($.CommandItem,{className:"command-item flex items-center justify-between !font-light",children:[(0,s.jsx)("div",{onClick:()=>{i.every(t=>t.id!==e.id)&&l([...i,e])},children:(0,s.jsx)(_,{title:e.name,colorName:e.color})}),(0,s.jsx)(w.AlertDialogTrigger,{children:(0,s.jsx)(K.default,{size:16,className:"icon-destructive"})}),(0,s.jsxs)(w.AlertDialogContent,{children:[(0,s.jsxs)(w.AlertDialogHeader,{children:[(0,s.jsx)(w.AlertDialogTitle,{className:"text-left",children:"Are you absolutely sure?"}),(0,s.jsx)(w.AlertDialogDescription,{className:"text-left",children:"This action cannot be undone. This will permanently delete your the tag and remove it from our servers."})]}),(0,s.jsxs)(w.AlertDialogFooter,{className:"items-center",children:[(0,s.jsx)(w.AlertDialogCancel,{children:"Cancel"}),(0,s.jsx)(w.AlertDialogAction,{className:"bg-destructive",onClick:()=>j(e.id),children:"Delete Tag"})]})]})]},e.id))}),(0,s.jsx)($.CommandEmpty,{children:"No results found."})]})]})})},ee=({getNewTicket:e,laneId:t,subaccountId:u})=>{let{data:x,setClose:j}=(0,h.useModal)(),v=(0,g.useRouter)(),[b,C]=(0,r.useState)([]),[N,y]=(0,r.useState)(""),[w,D]=(0,r.useState)(""),[S,A]=(0,r.useState)([]),k=(0,r.useRef)(null),[I,P]=(0,r.useState)([]),[E,G]=(0,r.useState)(x.ticket?.Assigned?.id||""),_=(0,l.useForm)({mode:"onChange",resolver:(0,f.zodResolver)(c.TicketFormSchema),defaultValues:{name:x.ticket?.name||"",description:x.ticket?.description||"",value:String(x.ticket?.value||0)}}),K=_.formState.isLoading;(0,r.useEffect)(()=>{u&&(async()=>{let e=await (0,F.getSubAccountTeamMembers)(u);e&&P(e)})()},[u]),(0,r.useEffect)(()=>{x.ticket&&(_.reset({name:x.ticket.name||"",description:x.ticket?.description||"",value:String(x.ticket?.value||0)}),x.ticket.customerId&&y(x.ticket.customerId),(async()=>{A(await (0,R.searchContacts)(x.ticket?.Customer?.name))})())},[x]);let W=async s=>{if(t){try{let r=await (0,L.upsertTicket)({...s,laneId:t,id:x.ticket?.id,assignedUserId:E,...N?{customerId:N}:{}},b);await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Updated a ticket | ${r?.name}`,subaccountId:u}),(0,p.toast)({title:"Success",description:"Saved  details"}),r&&e(r),v.refresh()}catch(e){(0,p.toast)({variant:"destructive",title:"Oppse!",description:"Could not save pipeline details"})}j()}};return(0,s.jsxs)(i.Card,{className:"w-full",children:[(0,s.jsx)(i.CardHeader,{children:(0,s.jsx)(i.CardTitle,{children:"Ticket Details"})}),(0,s.jsx)(i.CardContent,{children:(0,s.jsx)(a.Form,{..._,children:(0,s.jsxs)("form",{onSubmit:_.handleSubmit(W),className:"flex flex-col gap-4",children:[(0,s.jsx)(a.FormField,{disabled:K,control:_.control,name:"name",render:({field:e})=>(0,s.jsxs)(a.FormItem,{children:[(0,s.jsx)(a.FormLabel,{children:"Ticket Name"}),(0,s.jsx)(a.FormControl,{children:(0,s.jsx)(n.Input,{placeholder:"Name",...e})}),(0,s.jsx)(a.FormMessage,{})]})}),(0,s.jsx)(a.FormField,{disabled:K,control:_.control,name:"description",render:({field:e})=>(0,s.jsxs)(a.FormItem,{children:[(0,s.jsx)(a.FormLabel,{children:"Description"}),(0,s.jsx)(a.FormControl,{children:(0,s.jsx)(M.Textarea,{placeholder:"Description",...e})}),(0,s.jsx)(a.FormMessage,{})]})}),(0,s.jsx)(a.FormField,{disabled:K,control:_.control,name:"value",render:({field:e})=>(0,s.jsxs)(a.FormItem,{children:[(0,s.jsx)(a.FormLabel,{children:"Ticket Value"}),(0,s.jsx)(a.FormControl,{children:(0,s.jsx)(n.Input,{placeholder:"Value",...e})}),(0,s.jsx)(a.FormMessage,{})]})}),(0,s.jsx)("h3",{children:"Add tags"}),(0,s.jsx)(Z,{subAccountId:u,getSelectedTags:C,defaultTags:x.ticket?.Tags||[]}),(0,s.jsx)(a.FormLabel,{children:"Assigned To Team Member"}),(0,s.jsxs)(O.Select,{onValueChange:G,defaultValue:E,children:[(0,s.jsx)(O.SelectTrigger,{children:(0,s.jsx)(O.SelectValue,{placeholder:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(H.Avatar,{className:"w-8 h-8",children:[(0,s.jsx)(H.AvatarImage,{alt:"contact"}),(0,s.jsx)(H.AvatarFallback,{className:"bg-primary text-sm text-white",children:(0,s.jsx)(B,{size:14})})]}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Not Assigned"})]})})}),(0,s.jsx)(O.SelectContent,{children:I.map(e=>(0,s.jsx)(O.SelectItem,{value:e.id,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(H.Avatar,{className:"w-8 h-8",children:[(0,s.jsx)(H.AvatarImage,{alt:"contact",src:e.avatarUrl||""}),(0,s.jsx)(H.AvatarFallback,{className:"bg-primary text-sm text-white",children:(0,s.jsx)(B,{size:14})})]}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:e.name})]})},e.id))})]}),(0,s.jsx)(a.FormLabel,{children:"Customer"}),(0,s.jsxs)(V.Popover,{children:[(0,s.jsx)(V.PopoverTrigger,{asChild:!0,className:"w-full",children:(0,s.jsxs)(o.Button,{variant:"outline",role:"combobox",className:"justify-between",children:[N?S.find(e=>e.id===N)?.name:"Select Customer...",(0,s.jsx)(z.default,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(V.PopoverContent,{className:"w-[400px] p-0",children:(0,s.jsxs)($.Command,{children:[(0,s.jsx)($.CommandInput,{placeholder:"Search...",className:"h-9",value:w,onChangeCapture:async e=>{D(e.target.value),k.current&&clearTimeout(k.current),k.current=setTimeout(async()=>{A(await (0,R.searchContacts)(e.target.value)),D("")},1e3)}}),(0,s.jsx)($.CommandEmpty,{children:"No Customer found."}),(0,s.jsx)($.CommandGroup,{children:S.map(e=>(0,s.jsxs)($.CommandItem,{value:e.id,onSelect:e=>{y(e===N?"":e)},children:[e.name,(0,s.jsx)(U.default,{className:(0,T.cn)("ml-auto h-4 w-4",N===e.id?"opacity-100":"opacity-0")})]},e.id))})]})})]}),(0,s.jsx)(o.Button,{className:"w-20 mt-4",disabled:K,type:"submit",children:_.formState.isSubmitting?(0,s.jsx)(d.default,{}):"Save"})]})})})]})};var et=e.i(930771),es=e.i(981140),er=e.i(30030),ea=e.i(369340),ei=e.i(820783),el=e.i(853660),en=(e.i(774606),e.i(296626)),eo=e.i(248425),ed=e.i(726330),ec="HoverCard",[eu,em]=(0,er.createContextScope)(ec,[el.createPopperScope]),ex=(0,el.createPopperScope)(),[ep,eh]=eu(ec),eg=e=>{let{__scopeHoverCard:t,children:a,open:i,defaultOpen:l,onOpenChange:n,openDelay:o=700,closeDelay:d=300}=e,c=ex(t),u=r.useRef(0),m=r.useRef(0),x=r.useRef(!1),p=r.useRef(!1),[h,g]=(0,ea.useControllableState)({prop:i,defaultProp:l??!1,onChange:n,caller:ec}),f=r.useCallback(()=>{clearTimeout(m.current),u.current=window.setTimeout(()=>g(!0),o)},[o,g]),j=r.useCallback(()=>{clearTimeout(u.current),x.current||p.current||(m.current=window.setTimeout(()=>g(!1),d))},[d,g]),v=r.useCallback(()=>g(!1),[g]);return r.useEffect(()=>()=>{clearTimeout(u.current),clearTimeout(m.current)},[]),(0,s.jsx)(ep,{scope:t,open:h,onOpenChange:g,onOpen:f,onClose:j,onDismiss:v,hasSelectionRef:x,isPointerDownOnContentRef:p,children:(0,s.jsx)(el.Root,{...c,children:a})})};eg.displayName=ec;var ef="HoverCardTrigger",ej=r.forwardRef((e,t)=>{let{__scopeHoverCard:r,...a}=e,i=eh(ef,r),l=ex(r);return(0,s.jsx)(el.Anchor,{asChild:!0,...l,children:(0,s.jsx)(eo.Primitive.a,{"data-state":i.open?"open":"closed",...a,ref:t,onPointerEnter:(0,es.composeEventHandlers)(e.onPointerEnter,ew(i.onOpen)),onPointerLeave:(0,es.composeEventHandlers)(e.onPointerLeave,ew(i.onClose)),onFocus:(0,es.composeEventHandlers)(e.onFocus,i.onOpen),onBlur:(0,es.composeEventHandlers)(e.onBlur,i.onClose),onTouchStart:(0,es.composeEventHandlers)(e.onTouchStart,e=>e.preventDefault())})})});ej.displayName=ef;var[ev,eb]=eu("HoverCardPortal",{forceMount:void 0}),eC="HoverCardContent",eN=r.forwardRef((e,t)=>{let r=eb(eC,e.__scopeHoverCard),{forceMount:a=r.forceMount,...i}=e,l=eh(eC,e.__scopeHoverCard);return(0,s.jsx)(en.Presence,{present:a||l.open,children:(0,s.jsx)(ey,{"data-state":l.open?"open":"closed",...i,onPointerEnter:(0,es.composeEventHandlers)(e.onPointerEnter,ew(l.onOpen)),onPointerLeave:(0,es.composeEventHandlers)(e.onPointerLeave,ew(l.onClose)),ref:t})})});eN.displayName=eC;var ey=r.forwardRef((e,a)=>{let{__scopeHoverCard:i,onEscapeKeyDown:l,onPointerDownOutside:n,onFocusOutside:o,onInteractOutside:d,...c}=e,u=eh(eC,i),m=ex(i),x=r.useRef(null),p=(0,ei.useComposedRefs)(a,x),[h,g]=r.useState(!1);return r.useEffect(()=>{if(h){let e=document.body;return t=e.style.userSelect||e.style.webkitUserSelect,e.style.userSelect="none",e.style.webkitUserSelect="none",()=>{e.style.userSelect=t,e.style.webkitUserSelect=t}}},[h]),r.useEffect(()=>{if(x.current){let e=()=>{g(!1),u.isPointerDownOnContentRef.current=!1,setTimeout(()=>{document.getSelection()?.toString()!==""&&(u.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",e),()=>{document.removeEventListener("pointerup",e),u.hasSelectionRef.current=!1,u.isPointerDownOnContentRef.current=!1}}},[u.isPointerDownOnContentRef,u.hasSelectionRef]),r.useEffect(()=>{x.current&&(function(e){let t=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;s.nextNode();)t.push(s.currentNode);return t})(x.current).forEach(e=>e.setAttribute("tabindex","-1"))}),(0,s.jsx)(ed.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:d,onEscapeKeyDown:l,onPointerDownOutside:n,onFocusOutside:(0,es.composeEventHandlers)(o,e=>{e.preventDefault()}),onDismiss:u.onDismiss,children:(0,s.jsx)(el.Content,{...m,...c,onPointerDown:(0,es.composeEventHandlers)(c.onPointerDown,e=>{e.currentTarget.contains(e.target)&&g(!0),u.hasSelectionRef.current=!1,u.isPointerDownOnContentRef.current=!0}),ref:p,style:{...c.style,userSelect:h?"text":void 0,WebkitUserSelect:h?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})});function ew(e){return t=>"touch"===t.pointerType?void 0:e()}r.forwardRef((e,t)=>{let{__scopeHoverCard:r,...a}=e,i=ex(r);return(0,s.jsx)(el.Arrow,{...i,...a,ref:t})}).displayName="HoverCardArrow";let eD=r.forwardRef(({className:e,align:t="center",sideOffset:r=4,...a},i)=>(0,s.jsx)(eN,{ref:i,align:t,sideOffset:r,className:(0,T.cn)("z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));eD.displayName=eN.displayName;var eS=e.i(615587),eA=e.i(878235),eA=eA,eT=e.i(373488),eT=eT;let ek=({allTickets:e,index:t,setAllTickets:r,subaccountId:a,ticket:l})=>{let n=(0,g.useRouter)(),{setOpen:o,data:d}=(0,h.useModal)(),c=t=>{r(s=>e.map(e=>e.id===t.id?t:e))},u=async()=>{o((0,s.jsx)(v.default,{title:"Update Ticket Details",subheading:"",children:(0,s.jsx)(ee,{getNewTicket:c,laneId:l.laneId,subaccountId:a})}),async()=>({ticket:l}))},x=async()=>{try{r(e=>e.filter(e=>e.id!==l.id));let e=await (0,eS.deleteTicket)(l.id);(0,p.toast)({title:"Deleted",description:"Deleted ticket from lane."}),await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Deleted a ticket | ${e?.name}`,subaccountId:a}),n.refresh()}catch(e){(0,p.toast)({variant:"destructive",title:"Oppse!",description:"Could not delete the ticket."}),console.log(e)}};return(0,s.jsx)(y.Draggable,{draggableId:l.id.toString(),index:t,children:(e,t)=>{if(t.isDragging){let t=e.draggableProps.style?.left-300,s=e.draggableProps.style?.top-20;e.draggableProps.style={...e.draggableProps.style,top:s,left:t}}return(0,s.jsx)("div",{...e.draggableProps,...e.dragHandleProps,ref:e.innerRef,children:(0,s.jsx)(w.AlertDialog,{children:(0,s.jsxs)(S.DropdownMenu,{children:[(0,s.jsxs)(i.Card,{className:"my-4 bg-card shadow-none transition-all",children:[(0,s.jsxs)(i.CardHeader,{className:"p-[12px]",children:[(0,s.jsxs)(i.CardTitle,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-lg w-full",children:l.name}),(0,s.jsx)(S.DropdownMenuTrigger,{children:(0,s.jsx)(eT.default,{className:"text-muted-foreground"})})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:new Date().toLocaleDateString()}),(0,s.jsx)("div",{className:"flex items-center flex-wrap gap-2",children:l.Tags.map(e=>(0,s.jsx)(_,{title:e.name,colorName:e.color},e.id))}),(0,s.jsx)(i.CardDescription,{className:"w-full ",children:l.description}),(0,s.jsxs)(eg,{children:[(0,s.jsx)(ej,{asChild:!0,children:(0,s.jsxs)("div",{className:"p-2 text-muted-foreground flex gap-2 hover:bg-muted transition-all rounded-lg cursor-pointer items-center",children:[(0,s.jsx)(et.default,{}),(0,s.jsx)("span",{className:"text-xs font-bold",children:"CONTACT"})]})}),(0,s.jsx)(eD,{side:"right",className:"w-fit",children:(0,s.jsxs)("div",{className:"flex justify-between space-x-4",children:[(0,s.jsxs)(H.Avatar,{children:[(0,s.jsx)(H.AvatarImage,{}),(0,s.jsx)(H.AvatarFallback,{className:"bg-primary",children:l.Customer?.name.slice(0,2).toUpperCase()})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold",children:l.Customer?.name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:l.Customer?.email}),(0,s.jsxs)("div",{className:"flex items-center pt-2",children:[(0,s.jsx)(eA.default,{className:"mr-2 h-4 w-4 opacity-70"}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Joined"," ",l.Customer?.createdAt.toLocaleDateString()]})]})]})]})})]})]}),(0,s.jsxs)(i.CardFooter,{className:"m-0 p-2 border-t-[1px] border-muted-foreground/20 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex item-center gap-2",children:[(0,s.jsxs)(H.Avatar,{className:"w-8 h-8",children:[(0,s.jsx)(H.AvatarImage,{alt:"contact",src:l.Assigned?.avatarUrl||""}),(0,s.jsxs)(H.AvatarFallback,{className:"bg-primary text-sm text-white",children:[l.Assigned?.name,!l.assignedUserId&&(0,s.jsx)(B,{size:14})]})]}),(0,s.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:l.assignedUserId?"Assigned to":"Not Assigned"}),l.assignedUserId&&(0,s.jsx)("span",{className:"text-xs w-28  overflow-ellipsis overflow-hidden whitespace-nowrap text-muted-foreground",children:l.Assigned?.name})]})]}),(0,s.jsx)("span",{className:"text-sm font-bold",children:!!l.value&&new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(+l.value)})]}),(0,s.jsxs)(S.DropdownMenuContent,{children:[(0,s.jsx)(S.DropdownMenuLabel,{children:"Options"}),(0,s.jsx)(S.DropdownMenuSeparator,{}),(0,s.jsx)(w.AlertDialogTrigger,{children:(0,s.jsxs)(S.DropdownMenuItem,{className:"flex items-center gap-2",children:[(0,s.jsx)(E.Trash,{size:15}),"Delete Ticket"]})}),(0,s.jsxs)(S.DropdownMenuItem,{className:"flex items-center gap-2",onClick:u,children:[(0,s.jsx)(k.Edit,{size:15}),"Edit Ticket"]})]})]}),(0,s.jsxs)(w.AlertDialogContent,{children:[(0,s.jsxs)(w.AlertDialogHeader,{children:[(0,s.jsx)(w.AlertDialogTitle,{children:"Are you absolutely sure?"}),(0,s.jsx)(w.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete the ticket and remove it from our servers."})]}),(0,s.jsxs)(w.AlertDialogFooter,{className:"flex items-center",children:[(0,s.jsx)(w.AlertDialogCancel,{children:"Cancel"}),(0,s.jsx)(w.AlertDialogAction,{className:"bg-destructive",onClick:x,children:"Delete"})]})]})]})})})}})},eI=({setAllTickets:e,tickets:t,pipelineId:a,laneDetails:i,subaccountId:l,allTickets:n,index:o})=>{let{setOpen:d}=(0,h.useModal)(),c=(0,g.useRouter)(),u=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}),x=(0,r.useMemo)(()=>(console.log(t),t.reduce((e,t)=>e+(Number(t?.value)||0),0)),[t]),p=`#${Math.random().toString(16).slice(2,8)}`,f=t=>{e([...n,t])},b=()=>{d((0,s.jsx)(v.default,{title:"Create A Ticket",subheading:"Tickets are a great way to keep track of tasks",children:(0,s.jsx)(ee,{getNewTicket:f,laneId:i.id,subaccountId:l})}))},C=()=>{d((0,s.jsx)(v.default,{title:"Edit Lane Details",subheading:"",children:(0,s.jsx)(j,{pipelineId:a,defaultData:i})}))},N=async()=>{try{let e=await (0,A.deleteLane)(i.id);await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Deleted a lane | ${e?.name}`,subaccountId:l}),c.refresh()}catch(e){console.log(e)}};return(0,s.jsx)(y.Draggable,{draggableId:i.id.toString(),index:o,children:(r,a)=>{if(a.isDragging){let e=r.draggableProps.style?.left-300,t=r.draggableProps.style?.top-0;r.draggableProps.style={...r.draggableProps.style,top:t,left:e}}return(0,s.jsx)("div",{...r.draggableProps,ref:r.innerRef,className:"h-full",children:(0,s.jsx)(w.AlertDialog,{children:(0,s.jsxs)(S.DropdownMenu,{children:[(0,s.jsxs)("div",{className:"bg-bg-secondary/30 h-[700px] w-[300px] px-4 relative rounded-lg overflow-visible flex-shrink-0 ",children:[(0,s.jsx)("div",{...r.dragHandleProps,className:"h-14 backdrop-blur-lg bg-bg-secondary/60 absolute top-0 left-0 right-0 z-10 ",children:(0,s.jsxs)("div",{className:"h-full flex items-center p-4 justify-between cursor-grab border-b-[1px] ",children:[(0,s.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,s.jsx)("div",{className:(0,T.cn)("w-4 h-4 rounded-full"),style:{background:p}}),(0,s.jsx)("span",{className:"font-bold text-sm",children:i.name})]}),(0,s.jsxs)("div",{className:"flex items-center flex-row",children:[(0,s.jsx)(D.Badge,{className:"bg-white text-black",children:u.format(x)}),(0,s.jsx)(S.DropdownMenuTrigger,{children:(0,s.jsx)(I.MoreVertical,{className:"text-muted-foreground cursor-pointer"})})]})]})}),(0,s.jsx)(y.Droppable,{droppableId:i.id.toString(),type:"ticket",children:r=>(0,s.jsx)("div",{className:" max-h-[700px] overflow-scroll pt-12 ",children:(0,s.jsxs)("div",{...r.droppableProps,ref:r.innerRef,className:"mt-2",children:[t.map((t,r)=>(0,s.jsx)(ek,{allTickets:n,setAllTickets:e,subaccountId:l,ticket:t,index:r},t.id.toString())),r.placeholder]})})},i.id),(0,s.jsxs)(S.DropdownMenuContent,{children:[(0,s.jsx)(S.DropdownMenuLabel,{children:"Options"}),(0,s.jsx)(S.DropdownMenuSeparator,{}),(0,s.jsx)(w.AlertDialogTrigger,{children:(0,s.jsxs)(S.DropdownMenuItem,{className:"flex items-center gap-2",children:[(0,s.jsx)(E.Trash,{size:15}),"Delete"]})}),(0,s.jsxs)(S.DropdownMenuItem,{className:"flex items-center gap-2",onClick:C,children:[(0,s.jsx)(k.Edit,{size:15}),"Edit"]}),(0,s.jsxs)(S.DropdownMenuItem,{className:"flex items-center gap-2",onClick:b,children:[(0,s.jsx)(P.PlusCircleIcon,{size:15}),"Create Ticket"]})]})]}),(0,s.jsxs)(w.AlertDialogContent,{children:[(0,s.jsxs)(w.AlertDialogHeader,{children:[(0,s.jsx)(w.AlertDialogTitle,{children:"Are you absolutely sure?"}),(0,s.jsx)(w.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete your account and remove your data from our servers."})]}),(0,s.jsxs)(w.AlertDialogFooter,{className:"flex items-center",children:[(0,s.jsx)(w.AlertDialogCancel,{children:"Cancel"}),(0,s.jsx)(w.AlertDialogAction,{className:"bg-destructive",onClick:N,children:"Continue"})]})]})]})})})}},i.id)};e.s(["default",0,({lanes:e,pipelineDetails:t,pipelineId:a,subaccountId:i,updateLanesOrder:l,updateTicketsOrder:n})=>{let{setOpen:d}=(0,h.useModal)(),c=(0,g.useRouter)(),[u,m]=(0,r.useState)([]);(0,r.useEffect)(()=>{m(e)},[e]);let x=[];e.forEach(e=>{e.Tickets.forEach(e=>{x.push(e)})});let[p,f]=(0,r.useState)(x);return(0,s.jsx)(y.DragDropContext,{onDragEnd:e=>{console.log(e);let{destination:t,source:s,type:r}=e;if(t&&(t.droppableId!==s.droppableId||t.index!==s.index))switch(r){case"lane":{let e=[...u].toSpliced(s.index,1).toSpliced(t.index,0,u[s.index]).map((e,t)=>({...e,order:t}));m(e),l(e)}case"ticket":{let e=[...u],r=e.find(e=>e.id===s.droppableId),a=e.find(e=>e.id===t.droppableId);if(!r||!a)return;if(s.droppableId===t.droppableId){let a=[...r.Tickets].toSpliced(s.index,1).toSpliced(t.index,0,r.Tickets[s.index]).map((e,t)=>({...e,order:t}));r.Tickets=a,m(e),n(a),c.refresh()}else{let[i]=r.Tickets.splice(s.index,1);r.Tickets.forEach((e,t)=>{e.order=t}),a.Tickets.splice(t.index,0,{...i,laneId:t.droppableId}),a.Tickets.forEach((e,t)=>{e.order=t}),m(e),n([...a.Tickets,...r.Tickets]),c.refresh()}}}},children:(0,s.jsxs)("div",{className:"bg-card/60 rounded-xl p-4 use-automation-zoom-in",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl",children:t?.name}),(0,s.jsxs)(o.Button,{className:"flex items-center gap-4",onClick:()=>{d((0,s.jsx)(v.default,{title:" Create A Lane",subheading:"Lanes allow you to group tickets",children:(0,s.jsx)(j,{pipelineId:a})}))},children:[(0,s.jsx)(N.Plus,{size:15}),"Create Lane"]})]}),(0,s.jsx)(y.Droppable,{droppableId:"lanes",type:"lane",direction:"horizontal",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,children:e=>(0,s.jsx)("div",{className:"flex item-center gap-x-2 overflow-scroll",...e.droppableProps,ref:e.innerRef,children:(0,s.jsxs)("div",{className:"flex mt-4",children:[u.map((e,t)=>(0,s.jsx)(eI,{allTickets:p,setAllTickets:f,subaccountId:i,pipelineId:a,tickets:e.Tickets,laneDetails:e,index:t},e.id)),e.placeholder]})})},"lanes"),0==u.length&&(0,s.jsx)("div",{className:"flex items-center justify-center w-full flex-col",children:(0,s.jsx)("div",{className:"opacity-100",children:(0,s.jsx)(C,{width:"100%",height:"100%",className:"text-muted-foreground"})})})]})})}],307773)}]);