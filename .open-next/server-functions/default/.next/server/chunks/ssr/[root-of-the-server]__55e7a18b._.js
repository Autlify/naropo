module.exports=[504446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},679594,(a,b,c)=>{b.exports=a.x("dns",()=>require("dns"))},446786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},755004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},406461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},750227,(a,b,c)=>{b.exports=a.x("node:path",()=>require("node:path"))},857764,(a,b,c)=>{b.exports=a.x("node:url",()=>require("node:url"))},784941,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6/runtime/client",()=>require("@prisma/client-2c3a283f134fdcb6/runtime/client"))},921517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},524836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},233405,(a,b,c)=>{b.exports=a.x("child_process",()=>require("child_process"))},363818,a=>{a.v({name:"nodemailer",version:"7.0.13",description:"Easy as cake e-mail sending from your Node.js applications",main:"lib/nodemailer.js",scripts:{test:"node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js","test:coverage":"c8 node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js",format:'prettier --write "**/*.{js,json,md}"',"format:check":'prettier --check "**/*.{js,json,md}"',lint:"eslint .","lint:fix":"eslint . --fix",update:"rm -rf node_modules/ package-lock.json && ncu -u && npm install"},repository:{type:"git",url:"https://github.com/nodemailer/nodemailer.git"},keywords:["Nodemailer"],author:"Andris Reinman",license:"MIT-0",bugs:{url:"https://github.com/nodemailer/nodemailer/issues"},homepage:"https://nodemailer.com/",devDependencies:{"@aws-sdk/client-sesv2":"3.975.0",bunyan:"1.8.15",c8:"10.1.3",eslint:"9.39.2","eslint-config-prettier":"10.1.8",globals:"17.1.0",libbase64:"1.3.0",libmime:"5.3.7",libqp:"2.1.1","nodemailer-ntlm-auth":"1.0.4",prettier:"3.8.1",proxy:"1.0.2","proxy-test-server":"1.0.0","smtp-server":"3.18.0"},engines:{node:">=6.0.0"}})},755381,a=>{a.v(JSON.parse('{"1und1":{"description":"1&1 Mail (German hosting provider)","host":"smtp.1und1.de","port":465,"secure":true,"authMethod":"LOGIN"},"126":{"description":"126 Mail (NetEase)","host":"smtp.126.com","port":465,"secure":true},"163":{"description":"163 Mail (NetEase)","host":"smtp.163.com","port":465,"secure":true},"Aliyun":{"description":"Alibaba Cloud Mail","domains":["aliyun.com"],"host":"smtp.aliyun.com","port":465,"secure":true},"AliyunQiye":{"description":"Alibaba Cloud Enterprise Mail","host":"smtp.qiye.aliyun.com","port":465,"secure":true},"AOL":{"description":"AOL Mail","domains":["aol.com"],"host":"smtp.aol.com","port":587},"Aruba":{"description":"Aruba PEC (Italian email provider)","domains":["aruba.it","pec.aruba.it"],"aliases":["Aruba PEC"],"host":"smtps.aruba.it","port":465,"secure":true,"authMethod":"LOGIN"},"Bluewin":{"description":"Bluewin (Swiss email provider)","host":"smtpauths.bluewin.ch","domains":["bluewin.ch"],"port":465},"BOL":{"description":"BOL Mail (Brazilian provider)","domains":["bol.com.br"],"host":"smtp.bol.com.br","port":587,"requireTLS":true},"DebugMail":{"description":"DebugMail (email testing service)","host":"debugmail.io","port":25},"Disroot":{"description":"Disroot (privacy-focused provider)","domains":["disroot.org"],"host":"disroot.org","port":587,"secure":false,"authMethod":"LOGIN"},"DynectEmail":{"description":"Dyn Email Delivery","aliases":["Dynect"],"host":"smtp.dynect.net","port":25},"ElasticEmail":{"description":"Elastic Email","aliases":["Elastic Email"],"host":"smtp.elasticemail.com","port":465,"secure":true},"Ethereal":{"description":"Ethereal Email (email testing service)","aliases":["ethereal.email"],"host":"smtp.ethereal.email","port":587},"FastMail":{"description":"FastMail","domains":["fastmail.fm"],"host":"smtp.fastmail.com","port":465,"secure":true},"Feishu Mail":{"description":"Feishu Mail (Lark)","aliases":["Feishu","FeishuMail"],"domains":["www.feishu.cn"],"host":"smtp.feishu.cn","port":465,"secure":true},"Forward Email":{"description":"Forward Email (email forwarding service)","aliases":["FE","ForwardEmail"],"domains":["forwardemail.net"],"host":"smtp.forwardemail.net","port":465,"secure":true},"GandiMail":{"description":"Gandi Mail","aliases":["Gandi","Gandi Mail"],"host":"mail.gandi.net","port":587},"Gmail":{"description":"Gmail","aliases":["Google Mail"],"domains":["gmail.com","googlemail.com"],"host":"smtp.gmail.com","port":465,"secure":true},"GMX":{"description":"GMX Mail","domains":["gmx.com","gmx.net","gmx.de"],"host":"mail.gmx.com","port":587},"Godaddy":{"description":"GoDaddy Email (US)","host":"smtpout.secureserver.net","port":25},"GodaddyAsia":{"description":"GoDaddy Email (Asia)","host":"smtp.asia.secureserver.net","port":25},"GodaddyEurope":{"description":"GoDaddy Email (Europe)","host":"smtp.europe.secureserver.net","port":25},"hot.ee":{"description":"Hot.ee (Estonian email provider)","host":"mail.hot.ee"},"Hotmail":{"description":"Outlook.com / Hotmail","aliases":["Outlook","Outlook.com","Hotmail.com"],"domains":["hotmail.com","outlook.com"],"host":"smtp-mail.outlook.com","port":587},"iCloud":{"description":"iCloud Mail","aliases":["Me","Mac"],"domains":["me.com","mac.com"],"host":"smtp.mail.me.com","port":587},"Infomaniak":{"description":"Infomaniak Mail (Swiss hosting provider)","host":"mail.infomaniak.com","domains":["ik.me","ikmail.com","etik.com"],"port":587},"KolabNow":{"description":"KolabNow (secure email service)","domains":["kolabnow.com"],"aliases":["Kolab"],"host":"smtp.kolabnow.com","port":465,"secure":true,"authMethod":"LOGIN"},"Loopia":{"description":"Loopia (Swedish hosting provider)","host":"mailcluster.loopia.se","port":465},"Loops":{"description":"Loops","host":"smtp.loops.so","port":587},"mail.ee":{"description":"Mail.ee (Estonian email provider)","host":"smtp.mail.ee"},"Mail.ru":{"description":"Mail.ru","host":"smtp.mail.ru","port":465,"secure":true},"Mailcatch.app":{"description":"Mailcatch (email testing service)","host":"sandbox-smtp.mailcatch.app","port":2525},"Maildev":{"description":"MailDev (local email testing)","port":1025,"ignoreTLS":true},"MailerSend":{"description":"MailerSend","host":"smtp.mailersend.net","port":587},"Mailgun":{"description":"Mailgun","host":"smtp.mailgun.org","port":465,"secure":true},"Mailjet":{"description":"Mailjet","host":"in.mailjet.com","port":587},"Mailosaur":{"description":"Mailosaur (email testing service)","host":"mailosaur.io","port":25},"Mailtrap":{"description":"Mailtrap","host":"live.smtp.mailtrap.io","port":587},"Mandrill":{"description":"Mandrill (by Mailchimp)","host":"smtp.mandrillapp.com","port":587},"Naver":{"description":"Naver Mail (Korean email provider)","host":"smtp.naver.com","port":587},"OhMySMTP":{"description":"OhMySMTP (email delivery service)","host":"smtp.ohmysmtp.com","port":587,"secure":false},"One":{"description":"One.com Email","host":"send.one.com","port":465,"secure":true},"OpenMailBox":{"description":"OpenMailBox","aliases":["OMB","openmailbox.org"],"host":"smtp.openmailbox.org","port":465,"secure":true},"Outlook365":{"description":"Microsoft 365 / Office 365","host":"smtp.office365.com","port":587,"secure":false},"Postmark":{"description":"Postmark","aliases":["PostmarkApp"],"host":"smtp.postmarkapp.com","port":2525},"Proton":{"description":"Proton Mail","aliases":["ProtonMail","Proton.me","Protonmail.com","Protonmail.ch"],"domains":["proton.me","protonmail.com","pm.me","protonmail.ch"],"host":"smtp.protonmail.ch","port":587,"requireTLS":true},"qiye.aliyun":{"description":"Alibaba Mail Enterprise Edition","host":"smtp.mxhichina.com","port":"465","secure":true},"QQ":{"description":"QQ Mail","domains":["qq.com"],"host":"smtp.qq.com","port":465,"secure":true},"QQex":{"description":"QQ Enterprise Mail","aliases":["QQ Enterprise"],"domains":["exmail.qq.com"],"host":"smtp.exmail.qq.com","port":465,"secure":true},"Resend":{"description":"Resend","host":"smtp.resend.com","port":465,"secure":true},"Runbox":{"description":"Runbox (Norwegian email provider)","domains":["runbox.com"],"host":"smtp.runbox.com","port":465,"secure":true},"SendCloud":{"description":"SendCloud (Chinese email delivery)","host":"smtp.sendcloud.net","port":2525},"SendGrid":{"description":"SendGrid","host":"smtp.sendgrid.net","port":587},"SendinBlue":{"description":"Brevo (formerly Sendinblue)","aliases":["Brevo"],"host":"smtp-relay.brevo.com","port":587},"SendPulse":{"description":"SendPulse","host":"smtp-pulse.com","port":465,"secure":true},"SES":{"description":"AWS SES US East (N. Virginia)","host":"email-smtp.us-east-1.amazonaws.com","port":465,"secure":true},"SES-AP-NORTHEAST-1":{"description":"AWS SES Asia Pacific (Tokyo)","host":"email-smtp.ap-northeast-1.amazonaws.com","port":465,"secure":true},"SES-AP-NORTHEAST-2":{"description":"AWS SES Asia Pacific (Seoul)","host":"email-smtp.ap-northeast-2.amazonaws.com","port":465,"secure":true},"SES-AP-NORTHEAST-3":{"description":"AWS SES Asia Pacific (Osaka)","host":"email-smtp.ap-northeast-3.amazonaws.com","port":465,"secure":true},"SES-AP-SOUTH-1":{"description":"AWS SES Asia Pacific (Mumbai)","host":"email-smtp.ap-south-1.amazonaws.com","port":465,"secure":true},"SES-AP-SOUTHEAST-1":{"description":"AWS SES Asia Pacific (Singapore)","host":"email-smtp.ap-southeast-1.amazonaws.com","port":465,"secure":true},"SES-AP-SOUTHEAST-2":{"description":"AWS SES Asia Pacific (Sydney)","host":"email-smtp.ap-southeast-2.amazonaws.com","port":465,"secure":true},"SES-CA-CENTRAL-1":{"description":"AWS SES Canada (Central)","host":"email-smtp.ca-central-1.amazonaws.com","port":465,"secure":true},"SES-EU-CENTRAL-1":{"description":"AWS SES Europe (Frankfurt)","host":"email-smtp.eu-central-1.amazonaws.com","port":465,"secure":true},"SES-EU-NORTH-1":{"description":"AWS SES Europe (Stockholm)","host":"email-smtp.eu-north-1.amazonaws.com","port":465,"secure":true},"SES-EU-WEST-1":{"description":"AWS SES Europe (Ireland)","host":"email-smtp.eu-west-1.amazonaws.com","port":465,"secure":true},"SES-EU-WEST-2":{"description":"AWS SES Europe (London)","host":"email-smtp.eu-west-2.amazonaws.com","port":465,"secure":true},"SES-EU-WEST-3":{"description":"AWS SES Europe (Paris)","host":"email-smtp.eu-west-3.amazonaws.com","port":465,"secure":true},"SES-SA-EAST-1":{"description":"AWS SES South America (São Paulo)","host":"email-smtp.sa-east-1.amazonaws.com","port":465,"secure":true},"SES-US-EAST-1":{"description":"AWS SES US East (N. Virginia)","host":"email-smtp.us-east-1.amazonaws.com","port":465,"secure":true},"SES-US-EAST-2":{"description":"AWS SES US East (Ohio)","host":"email-smtp.us-east-2.amazonaws.com","port":465,"secure":true},"SES-US-GOV-EAST-1":{"description":"AWS SES GovCloud (US-East)","host":"email-smtp.us-gov-east-1.amazonaws.com","port":465,"secure":true},"SES-US-GOV-WEST-1":{"description":"AWS SES GovCloud (US-West)","host":"email-smtp.us-gov-west-1.amazonaws.com","port":465,"secure":true},"SES-US-WEST-1":{"description":"AWS SES US West (N. California)","host":"email-smtp.us-west-1.amazonaws.com","port":465,"secure":true},"SES-US-WEST-2":{"description":"AWS SES US West (Oregon)","host":"email-smtp.us-west-2.amazonaws.com","port":465,"secure":true},"Seznam":{"description":"Seznam Email (Czech email provider)","aliases":["Seznam Email"],"domains":["seznam.cz","email.cz","post.cz","spoluzaci.cz"],"host":"smtp.seznam.cz","port":465,"secure":true},"SMTP2GO":{"description":"SMTP2GO","host":"mail.smtp2go.com","port":2525},"Sparkpost":{"description":"SparkPost","aliases":["SparkPost","SparkPost Mail"],"domains":["sparkpost.com"],"host":"smtp.sparkpostmail.com","port":587,"secure":false},"Tipimail":{"description":"Tipimail (email delivery service)","host":"smtp.tipimail.com","port":587},"Tutanota":{"description":"Tutanota (Tuta Mail)","domains":["tutanota.com","tuta.com","tutanota.de","tuta.io"],"host":"smtp.tutanota.com","port":465,"secure":true},"Yahoo":{"description":"Yahoo Mail","domains":["yahoo.com"],"host":"smtp.mail.yahoo.com","port":465,"secure":true},"Yandex":{"description":"Yandex Mail","domains":["yandex.ru"],"host":"smtp.yandex.ru","port":465,"secure":true},"Zimbra":{"description":"Zimbra Mail Server","aliases":["Zimbra Collaboration"],"host":"smtp.zimbra.com","port":587,"requireTLS":true},"Zoho":{"description":"Zoho Mail","host":"smtp.zoho.com","port":465,"secure":true,"authMethod":"LOGIN"}}'))},713095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},733199,a=>{"use strict";a.i(155781);var b=a.i(577607),c=a.i(761469);let d=a=>{if(!a)return"MISSING";let b=new Date,c=(a.status||"").toUpperCase(),d=a.currentPeriodEndDate instanceof Date&&a.currentPeriodEndDate.getTime()>b.getTime();return("ACTIVE"===c||"TRIALING"===c)&&d||"TRIALING"===c&&a.trialEndedAt instanceof Date&&a.trialEndedAt.getTime()>b.getTime()?"ACTIVE":"INACTIVE"},e=a=>{if(!a)return null;let[b,c]=a.split(":");return c?"agency"===b?{kind:"agency",agencyId:c}:"subaccount"===b?{kind:"subaccount",subAccountId:c}:null:null},f=async a=>{let f=await (0,b.auth)(),g=f?.user?.id;if(!g)return null;let h=a?.agencyPermissionKey??"core.agency.account.read",i=a?.subAccountPermissionKey??"core.subaccount.account.read";a?.billingPermissionKey;let j=e(a?.cookieValue??null),k=await c.db.agencyMembership.findMany({where:{userId:g,isActive:!0,Role:{Permissions:{some:{granted:!0,Permission:{key:h}}}}},select:{agencyId:!0,isPrimary:!0,joinedAt:!0,Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}},Agency:{select:{Subscription:{select:{status:!0,currentPeriodEndDate:!0,trialEndedAt:!0,active:!0,cancelAtPeriodEnd:!0}}}}},orderBy:{joinedAt:"asc"}}),l=await c.db.subAccountMembership.findMany({where:{userId:g,isActive:!0,Role:{Permissions:{some:{granted:!0,Permission:{key:i}}}}},select:{subAccountId:!0,joinedAt:!0,Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}},SubAccount:{select:{agencyId:!0}}},orderBy:{joinedAt:"asc"}}),m=a=>{let b=k.find(b=>b.agencyId===a);if(!b)return null;let c=b.Role.Permissions.map(a=>a.Permission.key),e=d(b.Agency.Subscription);return{kind:"agency",agencyId:a,href:`/agency/${a}`,permissionKeys:c,subscriptionState:e,hasInactiveSubscription:"ACTIVE"!==e}},n=a=>{let b=l.find(b=>b.subAccountId===a);if(!b)return null;let c=b.Role.Permissions.map(a=>a.Permission.key);return{kind:"subaccount",subAccountId:a,agencyId:b.SubAccount.agencyId,href:`/subaccount/${a}`,permissionKeys:c}};if(j?.kind==="agency"){let a=m(j.agencyId);if(a)return a}if(j?.kind==="subaccount"){let a=n(j.subAccountId);if(a)return a}if(1===k.length)return m(k[0].agencyId);if(0===k.length&&1===l.length)return n(l[0].subAccountId);let o=k.find(a=>a.isPrimary);return o?m(o.agencyId):k.length>0?m(k[0].agencyId):l.length>0?n(l[0].subAccountId):null},g=async a=>{let b=await c.db.agencyMembership.findFirst({where:{userId:a.userId,agencyId:a.agencyId,isActive:!0},select:{userId:!0,agencyId:!0,Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}},Agency:{select:{Subscription:{select:{status:!0,currentPeriodEndDate:!0,trialEndedAt:!0,active:!0,cancelAtPeriodEnd:!0}}}}}});if(!b)return null;let e=b.Role.Permissions.map(a=>a.Permission.key),f=d(b.Agency.Subscription);return{userId:b.userId,agencyId:b.agencyId,permissionKeys:e,subscriptionState:f}},h=async a=>{let e=await (0,b.auth)(),f=e?.user?.id;if(!f)return null;let g=await c.db.agencyMembership.findFirst({where:{userId:f,agencyId:a.agencyId,isActive:!0},select:{userId:!0,agencyId:!0,Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}},Agency:{select:{Subscription:{select:{status:!0,currentPeriodEndDate:!0,trialEndedAt:!0,active:!0,cancelAtPeriodEnd:!0}}}}}});if(!g)return null;let h=g.Role.Permissions.map(a=>a.Permission.key),i=d(g.Agency.Subscription);return{userId:g.userId,agencyId:g.agencyId,permissionKeys:h,subscriptionState:i}},i=async a=>d(await c.db.subscription.findUnique({where:{agencyId:a},select:{status:!0,currentPeriodEndDate:!0,trialEndedAt:!0,active:!0,cancelAtPeriodEnd:!0}})),j=async a=>{let b=await c.db.subAccountMembership.findFirst({where:{userId:a.userId,subAccountId:a.subAccountId,isActive:!0},select:{userId:!0,subAccountId:!0,SubAccount:{select:{agencyId:!0}},Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}}}});if(!b)return null;let d=b.Role.Permissions.map(a=>a.Permission.key);return{userId:b.userId,agencyId:b.SubAccount.agencyId,subAccountId:b.subAccountId,permissionKeys:d}},k=async a=>{let c=await (0,b.auth)(),d=c?.user?.id;return d?j({userId:d,subAccountId:a.subAccountId}):null};a.s(["CONTEXT_COOKIE",0,"autlify.context-token","getAgencySubscriptionState",0,i,"parseSavedContext",0,e,"resolveAgencyContextForUser",0,g,"resolveCurrentAgencyContext",0,h,"resolveCurrentSubAccountContext",0,k,"resolveLandingTarget",0,f,"resolveSubAccountContextForUser",0,j])},432382,a=>{"use strict";var b=a.i(137936),c=a.i(142338),d=a.i(761469),e=a.i(118558),f=a.i(713095);let g=async(a,b,f,g)=>{try{let h,i=await d.db.subscription.findUnique({where:{subscritiptionId:b,agencyId:a}});if(!i)return{success:!1,error:"Subscription not found"};let j=await c.stripe.subscriptions.retrieve(b);if(!j||"canceled"===j.status)return{success:!1,error:"Subscription not found or already canceled"};if("cancel"===f)h=await c.stripe.subscriptions.update(b,{cancel_at_period_end:!0});else{if(!g)return{success:!1,error:"Price ID is required for this action"};let d=j.items.data[0]?.id;if(!d)throw Error("Could not find a subscription item to update.");h="upgrade"===f?await c.stripe.subscriptions.update(b,{cancel_at_period_end:!1,proration_behavior:"create_prorations",items:[{id:d,price:g}],expand:["latest_invoice.payment_intent"],metadata:{agencyId:a}}):await c.stripe.subscriptions.update(b,{cancel_at_period_end:!1,proration_behavior:"none",items:[{id:d,price:g}],expand:["latest_invoice.payment_intent"],metadata:{agencyId:a}})}let k=h.items.data[0]?.current_period_end;return await d.db.subscription.update({where:{agencyId:a},data:{priceId:g,status:String(h.status).toUpperCase(),cancelAtPeriodEnd:!!h.cancel_at_period_end,currentPeriodEndDate:k?new Date(1e3*k):i.currentPeriodEndDate}}),(0,e.revalidatePath)(`/agency/${a}/billing/subscription`),{success:!0,data:void 0}}catch(a){return console.error("Error updating subscription plan:",a),{success:!1,error:a instanceof Error?a.message:"Failed to update subscription plan"}}},h=async(a,b)=>{try{let e=await c.stripe.subscriptions.retrieve(b);if(!e)return{success:!1,error:"Subscription not found in Stripe"};let f=e.current_period_end,g=e.status.toUpperCase(),h=Math.floor(Date.now()/1e3);return"trialing"===e.status&&e.trial_end&&e.trial_end<h&&(g="ACTIVE"),await d.db.subscription.updateMany({where:{agencyId:a,subscritiptionId:b},data:{status:g,cancelAtPeriodEnd:!!e.cancel_at_period_end,currentPeriodEndDate:f?new Date(1e3*f):void 0,priceId:e.items.data[0]?.price?.id??void 0}}),{success:!0,data:void 0}}catch(a){return console.error("Error syncing subscription status:",a),{success:!1,error:a instanceof Error?a.message:"Failed to sync subscription status"}}},i=async(a,b=25)=>{try{if(!a)return{success:!1,error:"Customer ID is required"};let d=await c.stripe.invoices.list({customer:a,limit:b});return{success:!0,data:d.data}}catch(a){return console.error("Error listing invoices:",a),{success:!1,error:a instanceof Error?a.message:"Failed to list invoices"}}},j=async(a,b=25)=>{try{if(!a)return{success:!1,error:"Customer ID is required"};let[d,e]=await Promise.all([c.stripe.invoices.list({customer:a,status:"open",limit:b}),c.stripe.invoices.list({customer:a,status:"uncollectible",limit:b})]),f=[...d.data,...e.data].sort((a,b)=>(b.created??0)-(a.created??0));return{success:!0,data:f}}catch(a){return console.error("Error listing dunning invoices:",a),{success:!1,error:a instanceof Error?a.message:"Failed to list dunning invoices"}}},k=async a=>{try{if(!a)return{success:!1,error:"Agency ID is required"};let b=await d.db.subscription.findFirst({where:{agencyId:a},include:{Agency:{select:{customerId:!0}}}});if(!b)return{success:!0,data:{customerId:null,subscriptionId:null,priceId:null,status:null,cancelAtPeriodEnd:!1,currentPeriodEndDate:null,trialEndedAt:null,defaultPaymentMethod:null,state:"INACTIVE"}};let e=b.Agency?.customerId??null,f=null;if(e)try{let a=await c.stripe.customers.retrieve(e),b=a?.invoice_settings?.default_payment_method;if(b){let a=await c.stripe.paymentMethods.retrieve(b),d=a?.card?.brand?.toUpperCase()??"CARD",e=a?.card?.last4??"";f=e?`${d} •••• ${e}`:d}}catch{}let g=b.status?.toUpperCase()??"INACTIVE",h="INACTIVE";return"ACTIVE"===g?h="ACTIVE":"TRIALING"===g?h="TRIALING":"PAST_DUE"===g||"UNPAID"===g?h="PAST_DUE":("CANCELED"===g||"CANCELLED"===g)&&(h="CANCELLED"),{success:!0,data:{customerId:e,subscriptionId:b.subscritiptionId,priceId:b.priceId,status:b.status,cancelAtPeriodEnd:b.cancelAtPeriodEnd??!1,currentPeriodEndDate:b.currentPeriodEndDate?.toISOString()??null,trialEndedAt:b.trialEndedAt?.toISOString()??null,defaultPaymentMethod:f,state:h}}}catch(a){return console.error("Error getting subscription data:",a),{success:!1,error:a instanceof Error?a.message:"Failed to get subscription data"}}};(0,f.ensureServerEntryExports)([g,h,i,j,k]),(0,b.registerServerReference)(g,"78ad81a6e1de1868e437272fe4aa970da1f3fc95c1",null),(0,b.registerServerReference)(h,"6064f866a50c73160123a784f3c783f4dd84497763",null),(0,b.registerServerReference)(i,"60dcf3e67b55ea387f7c9591b44ed0df3d6a403b82",null),(0,b.registerServerReference)(j,"60c979ec615f4dd6cedab1c5229bbc9aa68416db12",null),(0,b.registerServerReference)(k,"40063e45a01fcbc9e1bad18991a61b168bb0aea8b1",null),a.s(["getSubscriptionData",0,k,"listDunningInvoices",0,j,"listInvoices",0,i,"syncSubscriptionStatus",0,h,"updateSubscriptionPlan",0,g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__55e7a18b._.js.map