module.exports=[745694,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(873871),e=a.i(132544),f=a.i(591119),g=a.i(699570),h=a.i(786304),i=a.i(814574),j=a.i(48468),k=a.i(507554),l=a.i(225152),m=a.i(30553),n="Toggle",o=c.forwardRef((a,c)=>{let{pressed:d,defaultPressed:e,onPressedChange:f,...g}=a,[h,i]=(0,l.useControllableState)({prop:d,onChange:f,defaultProp:e??!1,caller:n});return(0,b.jsx)(m.Primitive.button,{type:"button","aria-pressed":h,"data-state":h?"on":"off","data-disabled":a.disabled?"":void 0,...g,ref:c,onClick:(0,k.composeEventHandlers)(a.onClick,()=>{a.disabled||i(!h)})})});o.displayName=n;var p=a.i(400187),q=a.i(368114);let r=(0,p.cva)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),s=c.forwardRef(({className:a,variant:c,size:d,...e},f)=>(0,b.jsx)(o,{ref:f,className:(0,q.cn)(r({variant:c,size:d,className:a})),...e}));s.displayName=o.displayName;var t=a.i(870430),u=a.i(505084),v=a.i(533441),w=a.i(633508),x=a.i(65151),y=a.i(596221),z=a.i(911156),A=a.i(941675),B=a.i(412747),C=a.i(405050);let D=(0,C.createServerReference)("40063e45a01fcbc9e1bad18991a61b168bb0aea8b1",C.callServer,void 0,C.findSourceMapURL,"getSubscriptionData"),E=(0,C.createServerReference)("78ad81a6e1de1868e437272fe4aa970da1f3fc95c1",C.callServer,void 0,C.findSourceMapURL,"updateSubscriptionPlan"),F=(0,C.createServerReference)("6064f866a50c73160123a784f3c783f4dd84497763",C.callServer,void 0,C.findSourceMapURL,"syncSubscriptionStatus"),G=[.4,0,.2,1],H=a=>{try{let b;if("string"==typeof a)b=new Date(a);else if("number"==typeof a)b=new Date(a);else{if(!(a instanceof Date))return{days:0,hours:0,minutes:0,seconds:0};b=a}if(isNaN(b.getTime()))return{days:0,hours:0,minutes:0,seconds:0};let c=new Date,d=b.getTime()-c.getTime();if(d<=0)return{days:0,hours:0,minutes:0,seconds:0};return{days:Math.floor(d/864e5),hours:Math.floor(d%864e5/36e5),minutes:Math.floor(d%36e5/6e4),seconds:Math.floor(d%6e4/1e3)}}catch{return{days:0,hours:0,minutes:0,seconds:0}}},I=a=>({id:a.priceId,title:a.title,description:a.description,currency:"RM",monthlyPrice:String(a.priceAmount/100),yearlyPrice:String(a.priceAmount/100),buttonText:"Select Plan",features:a.features.map(a=>({name:a,icon:"check",iconColor:"text-green-500"}))}),J=({value:a,label:c})=>(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold tabular-nums sm:text-3xl",children:String(a).padStart(2,"0")}),(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:c})]}),K=({trialEndDate:a,daysRemaining:d,onUpgrade:e,className:i,title:j="Trial Period",description:k,upgradeButtonText:l="Upgrade Now",features:m=["Unlimited projects","Priority support","Advanced analytics","Custom integrations"]})=>{let[n,o]=(0,c.useState)(!1),[p,r]=(0,c.useState)(()=>a?H(a):{days:d||0,hours:0,minutes:0,seconds:0});(0,c.useEffect)(()=>{if(!a)return;let b=setInterval(()=>{r(H(a))},1e3);return()=>clearInterval(b)},[a]);let s=d??p.days,t=async()=>{if(e){o(!0);try{await e()}finally{o(!1)}}};return(0,b.jsxs)(f.Card,{className:(0,q.cn)("w-full max-w-md",i),children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(f.CardTitle,{className:"text-base font-medium",children:j}),s<=0?(0,b.jsx)(h.Badge,{variant:"destructive",children:"Expired"}):s<=2?(0,b.jsx)(h.Badge,{variant:"destructive",children:"Expiring Soon"}):s<=6?(0,b.jsx)(h.Badge,{variant:"secondary",children:"Active"}):(0,b.jsx)(h.Badge,{variant:"default",children:"Active"})]}),k&&(0,b.jsx)(f.CardDescription,{children:k})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-6",children:[a&&s>0&&(0,b.jsx)("div",{className:"bg-muted/30 rounded-lg border p-4",role:"status","aria-live":"polite","aria-atomic":"true",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 sm:gap-4",children:[(0,b.jsx)(J,{value:p.days,label:"Days"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,b.jsx)(J,{value:p.hours,label:"Hours"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,b.jsx)(J,{value:p.minutes,label:"Min"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,b.jsx)(J,{value:p.seconds,label:"Sec"})]})}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Included with upgrade"}),(0,b.jsx)("div",{className:"space-y-2",children:m.slice(0,4).map((a,c)=>(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-sm",children:[(0,b.jsx)(v.Check,{className:"text-primary h-4 w-4"}),(0,b.jsx)("span",{children:a})]},c))})]}),e&&(0,b.jsx)(g.Button,{onClick:t,disabled:n,className:"w-full",size:"lg",children:n?"Processing...":l})]})]})},L=({currentPlan:a,plans:f,onPlanChange:k,className:l,title:m,triggerText:n})=>{let[o,p]=(0,c.useState)(!1),[r,u]=(0,c.useState)(void 0),[v,w]=(0,c.useState)(!1),x=(0,c.useCallback)(a=>o?`${a.yearlyPrice}`:`${a.monthlyPrice}`,[o]),y=(0,c.useCallback)(a=>{u(b=>b===a?void 0:a)},[]),z=(0,c.useCallback)(a=>{w(a),a||u(void 0)},[]);return(0,b.jsxs)(i.Dialog,{open:v,onOpenChange:z,children:[(0,b.jsx)(i.DialogTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{children:n||"Update Plan"})}),(0,b.jsxs)(i.DialogContent,{className:(0,q.cn)("text-foreground flex max-h-[95vh] flex-col gap-3 sm:max-h-[90vh] sm:gap-4","w-[calc(100vw-2rem)] max-w-2xl sm:w-full","p-4 sm:p-6",l),children:[(0,b.jsxs)(i.DialogHeader,{className:"flex flex-col gap-3 pb-2 sm:flex-row sm:items-center sm:justify-between sm:gap-4 sm:pb-0",children:[(0,b.jsx)(i.DialogTitle,{className:"text-lg font-semibold sm:text-xl",children:m||"Upgrade Plan"}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-sm sm:gap-2",children:[(0,b.jsx)(s,{size:"sm",pressed:!o,onPressedChange:a=>p(!a),className:"h-9 px-3 text-xs sm:h-10 sm:px-4 sm:text-sm",children:"Monthly"}),(0,b.jsx)(s,{size:"sm",pressed:o,onPressedChange:a=>p(a),className:"h-9 px-3 text-xs sm:h-10 sm:px-4 sm:text-sm",children:"Yearly"})]})]}),(0,b.jsx)("div",{className:"min-h-0 flex-1 overflow-y-auto -mx-4 px-4 sm:-mx-6 sm:px-6",children:0===f.length?(0,b.jsx)("div",{className:"flex items-center justify-center py-12 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No plans available"})}):(0,b.jsx)(j.RadioGroup,{value:r,onValueChange:y,children:(0,b.jsx)("div",{className:"space-y-2.5 pb-2 sm:space-y-3",children:f.map((c,f)=>(0,b.jsxs)(d.motion.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{layout:{duration:.3,ease:G},opacity:{delay:.05*f,duration:.3,ease:G},y:{delay:.05*f,duration:.3,ease:G}},onClick:()=>y(c.id),onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&(a.preventDefault(),y(c.id))},role:"button",tabIndex:0,"aria-pressed":r===c.id,className:(0,q.cn)("relative cursor-pointer overflow-hidden rounded-lg border transition-all duration-200 sm:rounded-xl","focus-visible:ring-primary focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none",r===c.id?"border-primary from-muted/60 to-muted/30 bg-gradient-to-br shadow-sm":"border-border hover:border-primary/50"),children:[(0,b.jsx)(d.motion.div,{layout:"position",className:"p-3 sm:p-4",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2 sm:gap-3",children:[(0,b.jsxs)("div",{className:"flex min-w-0 flex-1 gap-2 sm:gap-3",children:[(0,b.jsx)(j.RadioGroupItem,{value:c.id,id:c.id,className:"pointer-events-none mt-0.5 flex-shrink-0 sm:mt-1"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2",children:[(0,b.jsx)(t.Label,{htmlFor:c.id,className:"cursor-pointer text-sm leading-tight font-semibold sm:text-base sm:font-medium",children:c.title}),c.badge&&(0,b.jsx)(h.Badge,{variant:"secondary",className:"h-5 px-1.5 py-0 text-[10px] sm:text-xs",children:c.badge})]}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-[11px] leading-relaxed sm:text-xs",children:c.description}),c.features.length>0&&(0,b.jsx)("div",{className:"pt-2 sm:pt-3",children:(0,b.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:c.features.map((a,c)=>(0,b.jsxs)("div",{className:"bg-muted/20 border-border/30 flex items-center gap-1.5 rounded-md border px-2 py-1 sm:rounded-lg",children:[(0,b.jsx)("div",{className:"bg-primary h-1 w-1 rounded-full sm:h-1.5 sm:w-1.5"}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px] whitespace-nowrap sm:text-xs",children:a.name})]},c))})})]})]}),(0,b.jsxs)("div",{className:"min-w-[60px] flex-shrink-0 text-right sm:min-w-[80px]",children:[(0,b.jsx)("div",{className:"text-base font-bold sm:text-xl sm:font-semibold",children:parseFloat(x(c))>=0?`${c.currency}${x(c)}`:x(c)}),(0,b.jsxs)("div",{className:"text-muted-foreground mt-0.5 text-[10px] sm:text-xs",children:["/",o?"year":"month"]})]})]})}),(0,b.jsx)(e.AnimatePresence,{initial:!1,children:r===c.id&&(0,b.jsx)(d.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1,transition:{height:{duration:.3,ease:G},opacity:{duration:.25,delay:.05,ease:G}}},exit:{height:0,opacity:0,transition:{height:{duration:.25,ease:G},opacity:{duration:.15,ease:G}}},className:"overflow-hidden",children:(0,b.jsx)(d.motion.div,{initial:{y:-8},animate:{y:0,transition:{duration:.25,delay:.05,ease:G}},exit:{y:-8},className:"px-3 pb-3 sm:px-4 sm:pb-4",children:(0,b.jsx)(g.Button,{className:"h-10 w-full text-sm font-medium sm:h-11 sm:text-base",disabled:r===a.id,onClick:a=>{a.stopPropagation(),k(c.id),z(!1)},children:r===a.id?"Current Plan":"Upgrade"})})})})]},c.id))})})})]})]})},M=({title:a,description:d,plan:e,triggerButtonText:f,leftPanelImageUrl:j,warningTitle:k,warningText:l,keepButtonText:m,continueButtonText:n,finalTitle:o,finalSubtitle:p,finalWarningText:r,goBackButtonText:s,confirmButtonText:t,onCancel:u,onKeepSubscription:v,onDialogClose:y,className:z})=>{let[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),I=async()=>{try{F(!0),H(null),await u(e.id),K()}catch(a){H(a instanceof Error?a.message:"Failed to cancel subscription")}finally{F(!1)}},J=async()=>{try{F(!0),H(null),v&&await v(e.id),K()}catch(a){H(a instanceof Error?a.message:"Failed to keep subscription")}finally{F(!1)}},K=()=>{D(!1),B(!1),H(null),F(!1),y?.()};return(0,c.useEffect)(()=>{let a=a=>{C&&"Escape"===a.key&&(a.preventDefault(),K())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[C]),(0,b.jsxs)(i.Dialog,{open:C,onOpenChange:a=>{a?D(!0):K()},children:[(0,b.jsx)(i.DialogTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"outline",children:f||"Cancel Subscription"})}),(0,b.jsxs)(i.DialogContent,{className:(0,q.cn)("text-foreground flex w-[95%] flex-col overflow-hidden p-0 sm:max-w-[1000px] md:w-[100%] md:flex-row",j?"":"sm:max-w-[500px]",z),children:[(0,b.jsx)(i.DialogTitle,{className:"sr-only",children:a}),(0,b.jsxs)(i.DialogClose,{className:"ring-offset-background focus:ring-ring absolute top-4 right-4 z-10 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",onClick:K,children:[(0,b.jsx)(w.X,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Close"})]}),j&&(0,b.jsxs)("div",{className:"relative hidden min-h-[500px] w-full overflow-hidden md:block md:w-1/2",children:[(0,b.jsx)("img",{src:j,alt:"Cancel Subscription",className:"absolute inset-0 h-full w-full object-cover"}),(0,b.jsx)("div",{className:"via-background/30 to-background/90 absolute inset-0 hidden bg-gradient-to-r from-transparent dark:block"}),(0,b.jsx)("div",{className:"from-background/80 to-background/20 absolute inset-0 hidden bg-gradient-to-t via-transparent dark:block"})]}),(0,b.jsxs)("div",{className:(0,q.cn)("flex flex-col gap-4 px-4 py-6",j?"w-full md:w-1/2":"w-full"),children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 text-center md:text-left",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold md:text-2xl",children:a}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs md:text-sm",children:d}),G&&(0,b.jsx)("div",{className:"bg-destructive/10 border-destructive/20 rounded-md border p-3",children:(0,b.jsx)("p",{className:"text-destructive text-sm",children:G})})]}),!A&&(0,b.jsxs)("div",{className:"bg-muted/50 flex flex-col gap-4 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsxs)("span",{className:"text-lg font-semibold",children:[e.title," Plan"]}),(0,b.jsx)("span",{className:"text-muted-foreground text-sm",children:"Current subscription"})]}),(0,b.jsx)(h.Badge,{variant:"secondary",children:parseFloat(String(e.monthlyPrice))>=0?`${e.currency}${e.monthlyPrice}/monthly`:`${e.monthlyPrice}/monthly`})]}),(0,b.jsx)("div",{className:"flex flex-col gap-2",children:e.features.slice(0,4).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(x.Circle,{className:"fill-primary text-primary h-2 w-2"}),(0,b.jsx)("span",{className:"text-muted-foreground text-sm",children:a.name})]},c))})]}),!A&&(k||l)&&(0,b.jsxs)("div",{className:"bg-muted/30 border-border rounded-lg border p-4",children:[k&&(0,b.jsx)("h3",{className:"text-foreground mb-2 font-semibold",children:k}),l&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:l})]}),A?(0,b.jsxs)("div",{className:"mt-auto flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 text-center",children:[(0,b.jsx)("h3",{className:"text-foreground mb-2 font-semibold",children:o||"Final Confirmation"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-2 text-sm",children:p||"Are you sure you want to cancel your subscription?"}),(0,b.jsx)("p",{className:"text-destructive text-sm",children:r||"This action cannot be undone and you'll lose access to all premium features."})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,b.jsx)(g.Button,{variant:"outline",className:"flex-1",onClick:()=>{B(!1),H(null)},disabled:E,children:s||"Go Back"}),(0,b.jsx)(g.Button,{variant:"destructive",className:"flex-1",onClick:I,disabled:E,children:E?"Cancelling...":t||"Yes, Cancel Subscription"})]})]}):(0,b.jsxs)("div",{className:"mt-auto flex flex-col gap-3 sm:flex-row",children:[(0,b.jsx)(g.Button,{className:"flex-1",onClick:J,disabled:E,children:E?"Processing...":m||"Keep My Subscription"}),(0,b.jsx)(g.Button,{variant:"destructive",className:"flex-1",onClick:()=>{B(!0),H(null)},disabled:E,children:n||"Continue Cancellation"})]})]})]})]})},N=({className:a,currentPlan:c,cancelSubscription:d,updatePlan:e})=>(0,b.jsx)("div",{className:(0,q.cn)("w-full text-left",a),children:(0,b.jsxs)(f.Card,{className:"shadow-lg",children:[(0,b.jsxs)(f.CardHeader,{className:"px-4 pb-4 sm:px-6 sm:pb-6",children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2 text-lg sm:gap-3 sm:text-xl",children:[(0,b.jsx)("div",{className:"bg-primary/10 ring-primary/20 rounded-lg p-1.5 ring-1 sm:p-2",children:(0,b.jsx)(z.CreditCard,{className:"text-primary h-4 w-4 sm:h-5 sm:w-5"})}),"Current Subscription"]}),(0,b.jsx)(f.CardDescription,{className:"text-sm sm:text-base",children:"Manage your billing and subscription settings"})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-6 px-4 sm:space-y-8 sm:px-6",children:[(0,b.jsx)("div",{className:"from-muted/30 via-muted/20 to-muted/30 border-border/50 relative overflow-hidden rounded-xl border bg-gradient-to-r p-3 sm:p-4",children:(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between sm:gap-0",children:(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"mb-2 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)("h3",{className:"text-lg font-semibold sm:text-xl",children:[c.plan.title," Plan"]})}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(h.Badge,{variant:"active"===c.status?"default":"outline",className:"bg-primary/90 hover:bg-primary border-0 text-xs font-medium shadow-sm sm:text-sm",children:"monthly"===c.type?`${c.plan.currency}${c.plan.monthlyPrice}/month`:"yearly"===c.type?`${c.plan.yearlyPrice}/year`:`${c.price}`}),(0,b.jsx)(h.Badge,{variant:"outline",className:"border-border/60 bg-background/50 text-xs shadow-sm backdrop-blur-sm sm:text-sm",children:c.status})]})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs sm:text-sm",children:c.plan.description})]})})})}),(0,b.jsx)(u.Separator,{className:"via-border my-4 bg-gradient-to-r from-transparent to-transparent sm:my-6"}),(0,b.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,b.jsxs)("h4",{className:"flex items-center gap-2 text-base font-medium sm:text-lg",children:[(0,b.jsx)("div",{className:"bg-muted ring-border/50 rounded-md p-1 ring-1 sm:p-1.5",children:(0,b.jsx)(A.Calendar,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),"Billing Information"]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-6",children:[(0,b.jsxs)("div",{className:"group from-muted to-background/10 border-border/30 hover:border-border/60 rounded-lg border bg-gradient-to-b p-2.5 transition-all duration-200 sm:p-3",children:[(0,b.jsx)("span",{className:"text-muted-foreground mb-1 block text-xs sm:text-sm",children:"Next billing date"}),(0,b.jsx)("div",{className:"group-hover:text-primary text-sm font-medium transition-colors duration-200 sm:text-base",children:c.nextBillingDate})]}),(0,b.jsxs)("div",{className:"group from-muted to-background/10 border-border/30 hover:border-border/60 rounded-lg border bg-gradient-to-b p-2.5 transition-all duration-200 sm:p-3",children:[(0,b.jsx)("span",{className:"text-muted-foreground mb-1 block text-xs sm:text-sm",children:"Payment method"}),(0,b.jsx)("div",{className:"group-hover:text-primary text-sm font-medium transition-colors duration-200 sm:text-base",children:c.paymentMethod})]})]})]}),(0,b.jsx)(u.Separator,{className:"via-border my-4 bg-gradient-to-r from-transparent to-transparent sm:my-6"}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,b.jsx)(L,{className:"shadow-lg transition-all duration-200 hover:shadow-xl",...e}),(0,b.jsx)(M,{className:"shadow-lg transition-all duration-200 hover:shadow-xl",...d})]}),(0,b.jsxs)("div",{className:"pt-4 sm:pt-6",children:[(0,b.jsx)("h4",{className:"mb-3 text-base font-medium sm:mb-4 sm:text-lg",children:"Current Plan Features"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:c.plan.features.map((a,c)=>(0,b.jsxs)("div",{className:"group border-border/80 hover:border-primary/30 hover:bg-primary/5 flex items-center gap-2 rounded-lg border p-2 transition-all duration-200",children:[(0,b.jsx)("div",{className:"bg-primary group-hover:bg-primary h-1 w-1 flex-shrink-0 rounded-full transition-all duration-200 group-hover:scale-125 sm:h-1.5 sm:w-1.5"}),(0,b.jsx)("span",{className:"text-muted-foreground group-hover:text-foreground text-xs transition-colors duration-200 sm:text-sm",children:a.name})]},c))})]})]})]})}),O=({scope:a,scopeId:d})=>{let[e,f]=(0,c.useState)(!0),[g,h]=(0,c.useState)(null),i=(0,c.useCallback)(async()=>{f(!0);try{let a=await D(d);if(a.success&&a.data?.subscriptionId){await F(d,a.data.subscriptionId);let b=await D(d);if(b.success&&b.data)return void h(b.data)}a.success&&a.data&&h(a.data)}finally{f(!1)}},[d]);if((0,c.useEffect)(()=>{i()},[i]),e)return(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsx)(y.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})});let j=g?.priceId?(0,B.getPricingCardByPriceId)(g.priceId):void 0,k=j?I(j):{id:"free",title:"Free",description:"No active subscription",currency:"RM",monthlyPrice:"0",yearlyPrice:"0",buttonText:"Subscribe",features:[]},l=g?.state==="TRIALING",m=g?.state==="ACTIVE",n={plan:k,type:"monthly",price:j?.price||"RM 0",nextBillingDate:g?.currentPeriodEndDate?new Date(g.currentPeriodEndDate).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"Not set",paymentMethod:g?.defaultPaymentMethod||"Not set",status:m||l?"active":g?.state==="CANCELLED"?"cancelled":g?.state==="PAST_DUE"?"past_due":"inactive"},o=(0,B.getPricingCards)("month").map(I),p=async b=>{g?.subscriptionId?(await E("",g.subscriptionId,"update",b),i()):window.location.href=`/${a}/${d}/billing/checkout?plan=${b}`},q=async()=>{g?.subscriptionId&&(await E("",g.subscriptionId,"cancel"),i())};return(0,b.jsx)("div",{className:"space-y-6",children:l&&g?.currentPeriodEndDate?(0,b.jsx)(K,{trialEndDate:new Date(g.currentPeriodEndDate),onUpgrade:()=>{window.location.href=`/${a}/${d}/billing/checkout`},features:k.features.map(a=>a.name)}):(0,b.jsx)(N,{currentPlan:n,updatePlan:{currentPlan:k,plans:o,triggerText:"Update Plan",onPlanChange:p},cancelSubscription:{title:"Cancel Subscription",description:"Are you sure you want to cancel your subscription?",plan:k,leftPanelImageUrl:"/assets/preview.png",warningTitle:"You will lose access to premium features",warningText:"If you cancel your subscription, you will lose access to all premium features at the end of your billing period.",onCancel:q,onKeepSubscription:async()=>{}}})})};var P=a.i(486192),Q=a.i(458321),R=a.i(333140),S=a.i(206015),T=a.i(878125),U=a.i(290275);let V=(0,C.createServerReference)("404e165dae5e5016bd89845fb3e4a518136b156251",C.callServer,void 0,C.findSourceMapURL,"getCustomer"),W=(0,C.createServerReference)("60171b8b821cbf43b1a247fd986f1c8cb05bbd4f12",C.callServer,void 0,C.findSourceMapURL,"createSetupIntent"),X=(0,C.createServerReference)("70a4a4052806e5e9874d73b5eda3126bafdedeca8a",C.callServer,void 0,C.findSourceMapURL,"detachPaymentMethod"),Y=(0,C.createServerReference)("708bbbcd33c4c6d4e7b2b9044c712798a38190c7f5",C.callServer,void 0,C.findSourceMapURL,"listPaymentMethods"),Z=(0,C.createServerReference)("782545ac67365f7a122e8875c03900c36bb4d6289b",C.callServer,void 0,C.findSourceMapURL,"replacePaymentMethod"),$=(0,C.createServerReference)("707d10c3249b06a3e5288e9ef492f2000e0adb75fb",C.callServer,void 0,C.findSourceMapURL,"setDefaultPaymentMethod"),_=(0,C.createServerReference)("60c979ec615f4dd6cedab1c5229bbc9aa68416db12",C.callServer,void 0,C.findSourceMapURL,"listDunningInvoices"),aa=(0,C.createServerReference)("60dcf3e67b55ea387f7c9591b44ed0df3d6a403b82",C.callServer,void 0,C.findSourceMapURL,"listInvoices");var ab=a.i(792501);a.i(112732);var ac=a.i(810788),ad=a.i(73570),ae=a.i(284505),af=a.i(452495),ag=a.i(177156),ah=a.i(104720),ai=a.i(915618),aj=a.i(669520),ak=a.i(170106);let al=(0,ak.default)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var am=a.i(50944);let an=(0,ac.loadStripe)(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY),ao=({onSuccess:a,onCancel:d})=>{let e=(0,ab.useStripe)(),f=(0,ab.useElements)(),[h,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),m=async b=>{if(b.preventDefault(),e&&f){j(!0),l(null);try{let{error:b}=await e.confirmSetup({elements:f,confirmParams:{return_url:`${window.location.origin}${window.location.pathname}`},redirect:"if_required"});b?l(b.message||"An error occurred"):a()}catch{l("An unexpected error occurred")}finally{j(!1)}}};return(0,b.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,b.jsx)(ab.PaymentElement,{}),k&&(0,b.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:k}),(0,b.jsxs)(i.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:d,disabled:h,children:"Cancel"}),(0,b.jsx)(g.Button,{type:"submit",disabled:!e||h,children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z.CreditCard,{className:"mr-2 h-4 w-4"}),"Add Card"]})})]})]})},ap=({onSuccess:a,onCancel:d})=>{let e=(0,ab.useStripe)(),f=(0,ab.useElements)(),[h,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),m=async b=>{if(b.preventDefault(),e&&f){j(!0),l(null);try{let{error:b,setupIntent:c}=await e.confirmSetup({elements:f,confirmParams:{return_url:`${window.location.origin}${window.location.pathname}`},redirect:"if_required"});b?l(b.message||"An error occurred"):c?.payment_method?a(c.payment_method):l("Failed to get payment method from setup")}catch{l("An unexpected error occurred")}finally{j(!1)}}};return(0,b.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,b.jsx)(ab.PaymentElement,{}),k&&(0,b.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:k}),(0,b.jsxs)(i.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:d,disabled:h,children:"Cancel"}),(0,b.jsx)(g.Button,{type:"submit",disabled:!e||h,children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Replacing..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aj.RefreshCw,{className:"mr-2 h-4 w-4"}),"Replace Card"]})})]})]})},aq=({agencyId:a,cards:d,onRefresh:e,className:h})=>{(0,am.useRouter)();let{toast:j}=(0,T.useToast)(),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,A]=(0,c.useState)(null),B=async()=>{t(!0);try{let b=await W(a);b.success?(s(b.data.clientSecret),p(!0)):j({title:"Error",description:b.error,variant:"destructive"})}catch{j({title:"Error",description:"Failed to initialize card setup",variant:"destructive"})}finally{t(!1)}},C=()=>{p(!1),s(null)},D=async b=>{l(!0);try{let c=await $(a,void 0,b);c.success?(j({title:"Default card updated",description:"Your default payment method has been updated successfully."}),e()):j({title:"Error",description:c.error,variant:"destructive"})}catch{j({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}finally{l(!1)}},E=async a=>{n(a)},F=async()=>{if(m){l(!0);try{let b=await X(a,void 0,m);b.success?(j({title:"Card removed",description:"Your payment method has been removed successfully."}),e()):j({title:"Error",description:b.error,variant:"destructive"})}catch{j({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}finally{l(!1),n(null)}}},G=async b=>{A(b),t(!0);try{let b=await W(a);b.success?(x(b.data.clientSecret),v(!0)):j({title:"Error",description:b.error,variant:"destructive"})}catch{j({title:"Error",description:"Failed to initialize card replacement",variant:"destructive"})}finally{t(!1)}},H=async b=>{if(!y||!b)return void j({title:"Error",description:"Missing card information",variant:"destructive"});l(!0);try{let c=await Z(a,void 0,y,b);c.success?(j({title:"Card replaced",description:"Your payment method has been replaced successfully."}),e()):j({title:"Error",description:c.error,variant:"destructive"})}catch{j({title:"Error",description:"An unexpected error occurred while replacing card",variant:"destructive"})}finally{l(!1),v(!1),x(null),A(null)}},I=()=>{v(!1),x(null),A(null)},J=r?{clientSecret:r,appearance:{theme:"night",variables:{colorPrimary:"#6366f1",colorBackground:"#1f2937",colorText:"#f9fafb",borderRadius:"8px"}}}:null;return(0,b.jsxs)("div",{className:(0,q.cn)("space-y-4",h),children:[(0,b.jsxs)(f.Card,{className:"shadow-lg",children:[(0,b.jsxs)(f.CardHeader,{className:"px-4 pb-4 sm:px-6 sm:pb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2 text-lg sm:gap-3 sm:text-xl",children:[(0,b.jsx)("div",{className:"rounded-lg bg-primary/10 p-1.5 ring-1 ring-primary/20 sm:p-2",children:(0,b.jsx)(z.CreditCard,{className:"h-4 w-4 text-primary sm:h-5 sm:w-5"})}),"Payment Methods"]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:B,className:"gap-1.5",children:[(0,b.jsx)(ai.Plus,{className:"h-4 w-4"}),"Add New Card"]})]}),(0,b.jsx)(f.CardDescription,{className:"text-sm sm:text-base",children:"Manage your saved payment methods for billing"})]}),(0,b.jsx)(f.CardContent,{className:"px-4 sm:px-6",children:(0,b.jsx)(Q.SavedBankCardsGallery,{cards:d,compact:!1,onSetDefault:D,onRemoveCard:E,onReplaceCard:G})})]}),(0,b.jsx)(i.Dialog,{open:o,onOpenChange:C,children:(0,b.jsxs)(i.DialogContent,{className:"sm:max-w-[480px]",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsxs)(i.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(z.CreditCard,{className:"h-5 w-5"}),"Add Payment Method"]}),(0,b.jsx)(i.DialogDescription,{children:"Enter your card details below. Your card will be securely saved for future payments."})]}),r&&J&&(0,b.jsx)(ab.Elements,{stripe:an,options:J,children:(0,b.jsx)(ao,{onSuccess:()=>{p(!1),s(null),j({title:"Card added",description:"Your payment method has been added successfully."}),e()},onCancel:C})})]})}),(0,b.jsx)(i.Dialog,{open:u,onOpenChange:I,children:(0,b.jsxs)(i.DialogContent,{className:"sm:max-w-[480px]",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsxs)(i.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(aj.RefreshCw,{className:"h-5 w-5"}),"Replace Payment Method"]}),(0,b.jsx)(i.DialogDescription,{children:"Enter your new card details. The old card will be removed automatically."})]}),w&&(0,b.jsx)(ab.Elements,{stripe:an,options:{clientSecret:w,appearance:{theme:"night",variables:{colorPrimary:"#6366f1",colorBackground:"#1f2937",colorText:"#f9fafb",borderRadius:"8px"}}},children:(0,b.jsx)(ap,{onSuccess:H,onCancel:I})})]})}),(0,b.jsx)(P.AlertDialog,{open:null!==m,onOpenChange:a=>!a&&n(null),children:(0,b.jsxs)(P.AlertDialogContent,{children:[(0,b.jsxs)(P.AlertDialogHeader,{children:[(0,b.jsx)(P.AlertDialogTitle,{children:"Remove payment method?"}),(0,b.jsx)(P.AlertDialogDescription,{children:"This will remove the card from your account. If this is your default payment method, you'll need to set a new default before the next billing cycle."})]}),(0,b.jsxs)(P.AlertDialogFooter,{children:[(0,b.jsx)(P.AlertDialogCancel,{disabled:k,children:"Cancel"}),(0,b.jsx)(P.AlertDialogAction,{onClick:F,disabled:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:k?"Removing...":"Remove Card"})]})]})})]})},ar=({invoices:a,className:c})=>{let{toast:d}=(0,T.useToast)(),e=async a=>{if(navigator.share&&a.viewUrl)try{await navigator.share({title:`Invoice ${a.description}`,text:`Invoice for ${a.amount} - ${a.date}`,url:a.viewUrl})}catch{}else a.viewUrl&&(await navigator.clipboard.writeText(a.viewUrl),d({title:"Link copied",description:"Invoice link copied to clipboard"}))};return(0,b.jsxs)(f.Card,{className:(0,q.cn)("shadow-lg",c),children:[(0,b.jsxs)(f.CardHeader,{className:"px-4 pb-3 sm:px-6",children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,b.jsx)("div",{className:"rounded-lg bg-primary/10 p-1.5 ring-1 ring-primary/20",children:(0,b.jsx)(ah.FileText,{className:"h-4 w-4 text-primary"})}),"Invoice History"]}),(0,b.jsx)(f.CardDescription,{className:"text-sm",children:"View and download your past invoices"})]}),(0,b.jsx)(f.CardContent,{className:"px-4 pt-0 sm:px-6",children:(0,b.jsxs)(S.Table,{children:[(0,b.jsx)(S.TableHeader,{children:(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableHead,{children:"Date"}),(0,b.jsx)(S.TableHead,{children:"Description"}),(0,b.jsx)(S.TableHead,{children:"Status"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Amount"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(S.TableBody,{children:0===a.length?(0,b.jsx)(S.TableRow,{children:(0,b.jsx)(S.TableCell,{colSpan:5,className:"py-2 text-center text-muted-foreground",children:"No invoices found"})}):a.map(a=>(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableCell,{className:"py-2 font-medium",children:a.date}),(0,b.jsx)(S.TableCell,{className:"py-2",children:a.description}),(0,b.jsx)(S.TableCell,{className:"py-2",children:(0,b.jsx)(h.Badge,{variant:"outline",className:(0,q.cn)((a=>{switch(a){case"paid":return"bg-green-500/10 text-green-500 border-green-500/20";case"pending":return"bg-orange-500/10 text-orange-500 border-orange-500/20";case"failed":return"bg-destructive/10 text-destructive border-destructive/20"}})(a.status),"backdrop-blur-sm"),children:a.status})}),(0,b.jsx)(S.TableCell,{className:"py-2 text-right font-medium",children:a.amount}),(0,b.jsx)(S.TableCell,{className:"py-2 text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[a.viewUrl&&(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>window.open(a.viewUrl,"_blank"),className:"transition-all duration-200 hover:bg-primary/10",title:"View Invoice",children:(0,b.jsx)(ag.Eye,{className:"h-4 w-4"})}),a.downloadUrl&&(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>window.open(a.downloadUrl,"_blank"),className:"transition-all duration-200 hover:bg-primary/10",title:"Download PDF",children:(0,b.jsx)(ae.Download,{className:"h-4 w-4"})}),a.viewUrl&&(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>e(a),className:"transition-all duration-200 hover:bg-primary/10",title:"Share Invoice",children:(0,b.jsx)(al,{className:"h-4 w-4"})})]})})]},a.id))})]})})]})},as=({dunningInvoices:a,className:c})=>{let d=a.filter(a=>"open"===a.status).length,e=a.filter(a=>"uncollectible"===a.status).length;return(0,b.jsxs)(f.Card,{className:(0,q.cn)("shadow-lg",c),children:[(0,b.jsxs)(f.CardHeader,{className:"px-4 pb-3 sm:px-6",children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,b.jsx)("div",{className:"rounded-lg bg-orange-500/10 p-1.5 ring-1 ring-orange-500/20",children:(0,b.jsx)(ad.AlertTriangle,{className:"h-4 w-4 text-orange-500"})}),"Dunning"]}),(0,b.jsx)(f.CardDescription,{className:"text-sm",children:"Monitor payment failures, overdue invoices, and recovery actions"})]}),(0,b.jsxs)(f.CardContent,{className:"px-4 pt-0 sm:px-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3 mb-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Open invoices"}),(0,b.jsx)("div",{className:"mt-1 text-2xl font-semibold",children:d})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Uncollectible"}),(0,b.jsx)("div",{className:"mt-1 text-2xl font-semibold",children:e})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total flagged"}),(0,b.jsx)("div",{className:"mt-1 text-2xl font-semibold",children:a.length})]})]}),(0,b.jsxs)(S.Table,{children:[(0,b.jsx)(S.TableHeader,{children:(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableHead,{children:"Date"}),(0,b.jsx)(S.TableHead,{children:"Invoice"}),(0,b.jsx)(S.TableHead,{children:"Status"}),(0,b.jsx)(S.TableHead,{children:"Due"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Amount"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(S.TableBody,{children:0===a.length?(0,b.jsx)(S.TableRow,{children:(0,b.jsx)(S.TableCell,{colSpan:6,className:"py-4 text-center text-muted-foreground",children:"No overdue invoices found"})}):a.map(a=>(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableCell,{className:"py-2 text-muted-foreground",children:a.date}),(0,b.jsx)(S.TableCell,{className:"py-2 font-mono text-xs",children:a.number}),(0,b.jsx)(S.TableCell,{className:"py-2",children:(0,b.jsx)(h.Badge,{variant:"open"===a.status?"secondary":"outline",className:"backdrop-blur-sm",children:a.status})}),(0,b.jsx)(S.TableCell,{className:"py-2 text-muted-foreground",children:a.dueDate??"—"}),(0,b.jsxs)(S.TableCell,{className:"py-2 text-right font-medium",children:[a.amount," ",a.currency]}),(0,b.jsx)(S.TableCell,{className:"py-2 text-right",children:a.hostedUrl?(0,b.jsx)(g.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsxs)("a",{href:a.hostedUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,b.jsx)(af.ExternalLink,{className:"mr-2 h-4 w-4"}),"Open"]})}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"—"})})]},a.id))})]})]})]})},at=()=>(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(f.Card,{className:"p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(R.Skeleton,{className:"h-6 w-48"}),(0,b.jsx)(R.Skeleton,{className:"h-4 w-64"}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(R.Skeleton,{className:"h-32 w-48"}),(0,b.jsx)(R.Skeleton,{className:"h-32 w-48"})]})]})}),(0,b.jsx)(f.Card,{className:"p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(R.Skeleton,{className:"h-6 w-48"}),(0,b.jsx)(R.Skeleton,{className:"h-4 w-64"}),(0,b.jsx)(R.Skeleton,{className:"h-48 w-full"})]})})]}),au=({scope:a,scopeId:d,customerId:e,name:h,showPaymentMethods:i=!0,showInvoices:j=!0,showDunning:k=!1,className:l})=>{let[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)([]),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(e??void 0),[z,A]=(0,c.useState)(h??void 0),B=async()=>{n(!0),w(null);try{let b=x,c=z;if(!b&&"agency"===a){let a=await (0,U.getAgencyDetails)(d);a?.customerId&&(b=a.customerId,c=a.name||void 0,y(b),A(c))}if(!b)return void n(!1);let e=await V(b),f=e?.invoice_settings?.default_payment_method,g=await Y(void 0,void 0,b);if(g.success){let a=g.data.map(a=>({id:a.id,cardNumber:`•••• •••• •••• ${a.card?.last4||"----"}`,cardholderName:a.billing_details?.name||c||"Cardholder",expiryMonth:String(a.card?.exp_month||"--").padStart(2,"0"),expiryYear:String(a.card?.exp_year||"----"),variant:(a=>{switch(a?.toLowerCase()){case"visa":case"mastercard":default:return"default";case"amex":return"premium";case"discover":return"platinum"}})(a.card?.brand),isDefault:a.id===f,brand:a.card?.brand?.toUpperCase()}));p(a)}let h=await aa(b,25);if(h.success){let a=h.data.map(a=>{let b=(a.amount_paid??a.amount_due??0)/100,c=a.currency?.toUpperCase()??"USD";return{id:a.id,date:a.created?new Date(1e3*a.created).toLocaleDateString():"—",description:a.number??a.lines.data[0]?.description??"Invoice",amount:`${b.toFixed(2)} ${c}`,status:(a=>{switch(a){case"paid":return"paid";case"open":case"draft":return"pending";default:return"failed"}})(a.status??null),viewUrl:a.hosted_invoice_url??void 0,downloadUrl:a.invoice_pdf??void 0}});s(a)}if(k){let a=await _(b,25);if(a.success){let b=a.data.map(a=>({id:a.id,number:a.number??a.id,status:a.status,date:a.created?new Date(1e3*a.created).toLocaleDateString():"—",dueDate:a.due_date?new Date(1e3*a.due_date).toLocaleDateString():null,amount:((a.amount_due??0)/100).toFixed(2),currency:a.currency?.toUpperCase()??"USD",hostedUrl:a.hosted_invoice_url??null}));u(b)}}}catch(a){console.error("Failed to fetch payment data:",a),w("Failed to load payment information")}finally{n(!1)}};return((0,c.useEffect)(()=>{B()},[d]),"agency"!==a)?(0,b.jsxs)(f.Card,{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Payments"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Payment management for subaccounts is not enabled yet."})]}):m?(0,b.jsx)(at,{}):v?(0,b.jsx)(f.Card,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-destructive",children:"Error"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:v})]}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:B,children:[(0,b.jsx)(aj.RefreshCw,{className:"mr-2 h-4 w-4"}),"Retry"]})]})}):(0,b.jsxs)("div",{className:(0,q.cn)("space-y-4",l),children:[i&&(0,b.jsx)(aq,{agencyId:d,cards:o,onRefresh:B}),j&&(0,b.jsx)(ar,{invoices:r}),k&&(0,b.jsx)(as,{dunningInvoices:t})]})};var av=a.i(866718),aw=a.i(580701),ax=a.i(823292),ay=a.i(159564),az=a.i(501027);let aA=(0,ak.default)("ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),aB=(0,ak.default)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);a.i(653277),a.i(470385);let aC=({agencyId:a,subAccountId:d,className:e})=>{let k=d?"SUBACCOUNT":"AGENCY",[l,m]=(0,c.useState)(!0),[n,o]=(0,c.useState)([]),[p,r]=(0,c.useState)({}),[s,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),[y,A]=(0,c.useState)("100"),[B,C]=(0,c.useState)("stripe"),[D,E]=(0,c.useState)(!1),F=(0,c.useMemo)(()=>Object.values(p||{}).filter(a=>a?.creditEnabled).map(a=>({key:a.key,label:a.title?`${a.title} (${a.key})`:a.key})).sort((a,b)=>a.key.localeCompare(b.key)),[p]),G=async()=>{m(!0);try{let b=new URL("/api/features/core/billing/entitlements/current",window.location.origin);b.searchParams.set("agencyId",a),d&&b.searchParams.set("subAccountId",d);let c=await fetch(b.toString(),{headers:{[d?"x-autlify-subaccount":"x-autlify-agency"]:d??a},cache:"no-store"}),e=await c.json();if(!c.ok)throw Error(e?.error||"Failed to load entitlements");r(e?.entitlements??{});let f=new URL("/api/features/core/billing/credits/balance",window.location.origin);f.searchParams.set("agencyId",a),d&&f.searchParams.set("subAccountId",d),f.searchParams.set("scope",k);let g=await fetch(f.toString(),{headers:{[d?"x-autlify-subaccount":"x-autlify-agency"]:d??a},cache:"no-store"}),h=await g.json();if(!g.ok||!h?.ok)throw Error(h?.reason||"Failed to load balances");o(h.balances??[])}catch(a){ax.toast.error(a?.message??"Failed to load credits")}finally{m(!1)}};(0,c.useEffect)(()=>{G()},[a,d]),(0,c.useEffect)(()=>{!w&&F.length&&x(F[0].key)},[w,F]);let H=async()=>{try{E(!0);let b=Math.max(1,Math.floor(Number(y)||0));if(!w||b<=0)return void ax.toast.error("Please select a feature and enter credits");if("stripe"===B){let c=await fetch("/api/stripe/credits/checkout",{method:"POST",headers:{"Content-Type":"application/json",[d?"x-autlify-subaccount":"x-autlify-agency"]:d??a},body:JSON.stringify({agencyId:a,subAccountId:d,featureKey:w,credits:b})}),e=await c.json();if(!c.ok||!e?.ok)throw Error(e?.error||"Failed to create checkout");e.url&&(window.location.href=e.url);return}let c=await fetch("/api/features/core/billing/credits/topup",{method:"POST",headers:{"Content-Type":"application/json",[d?"x-autlify-subaccount":"x-autlify-agency"]:d??a},body:JSON.stringify({agencyId:a,subAccountId:d,scope:k,featureKey:w,credits:b,idempotencyKey:`ui-topup:${a}:${d??"null"}:${w}:${Date.now()}`})}),e=await c.json();if(!c.ok||!e?.ok)throw Error(e?.error||"Top-up failed");ax.toast.success("Credits added"),v(!1),await G()}catch(a){ax.toast.error(a?.message??"Top-up failed")}finally{E(!1)}};return(0,b.jsxs)(f.Card,{className:(0,q.cn)("p-6",e),children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Credits & Top‑Up"}),(0,b.jsx)(h.Badge,{variant:"secondary",className:"font-mono text-xs",children:k})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Credit balances are used for internal overages and add-ons (per feature). This page is ready for Stripe-paid top-ups."})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",className:"gap-2",onClick:G,children:[(0,b.jsx)(aj.RefreshCw,{className:"h-4 w-4"}),"Refresh"]}),(0,b.jsxs)(i.Dialog,{open:s,onOpenChange:v,children:[(0,b.jsx)(i.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{className:"gap-2",children:[(0,b.jsx)(ay.PlusCircle,{className:"h-4 w-4"}),"Top‑up credits"]})}),(0,b.jsxs)(i.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsx)(i.DialogTitle,{children:"Top‑up credits"}),(0,b.jsx)(i.DialogDescription,{children:"Purchase credits to use for features and add-ons."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{children:"Top-up Method"}),(0,b.jsxs)(j.RadioGroup,{value:B,onValueChange:a=>C(a),className:"flex gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(j.RadioGroupItem,{value:"stripe",id:"stripe"}),(0,b.jsxs)(t.Label,{htmlFor:"stripe",className:"flex cursor-pointer items-center gap-2",children:[(0,b.jsx)(z.CreditCard,{className:"h-4 w-4"}),"Pay with Card"]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(j.RadioGroupItem,{value:"manual",id:"manual"}),(0,b.jsxs)(t.Label,{htmlFor:"manual",className:"flex cursor-pointer items-center gap-2",children:[(0,b.jsx)(az.Zap,{className:"h-4 w-4"}),"Manual (Admin)"]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{children:"Feature"}),(0,b.jsxs)(aw.Select,{value:w,onValueChange:x,children:[(0,b.jsx)(aw.SelectTrigger,{children:(0,b.jsx)(aw.SelectValue,{placeholder:"Select feature"})}),(0,b.jsx)(aw.SelectContent,{children:F.map(a=>(0,b.jsx)(aw.SelectItem,{value:a.key,children:a.label},a.key))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{children:"Credits"}),(0,b.jsx)(av.Input,{value:y,onChange:a=>A(a.target.value),inputMode:"numeric"}),"stripe"===B&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Price: $",(.01*Math.max(1,Number(y)||0)).toFixed(2)," USD ($0.01 per credit, min $1.00)"]}),"manual"===B&&(0,b.jsx)("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Manual top-up is for admin use only. No payment will be charged."})]})]}),(0,b.jsxs)(i.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>v(!1),disabled:D,children:"Cancel"}),(0,b.jsx)(g.Button,{onClick:H,disabled:D,children:D?"Processing...":"stripe"===B?"Pay & Add Credits":"Add Credits"})]})]})]})]})]}),(0,b.jsx)(u.Separator,{className:"my-4"}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(S.Table,{children:[(0,b.jsx)(S.TableHeader,{children:(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableHead,{children:"Feature"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Balance"}),(0,b.jsx)(S.TableHead,{children:"Expires"}),(0,b.jsx)(S.TableHead,{children:"Period"})]})}),(0,b.jsxs)(S.TableBody,{children:[l?Array.from({length:6}).map((a,c)=>(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableCell,{children:(0,b.jsx)(R.Skeleton,{className:"h-5 w-[240px]"})}),(0,b.jsx)(S.TableCell,{className:"text-right",children:(0,b.jsx)(R.Skeleton,{className:"ml-auto h-5 w-[120px]"})}),(0,b.jsx)(S.TableCell,{children:(0,b.jsx)(R.Skeleton,{className:"h-5 w-[160px]"})}),(0,b.jsx)(S.TableCell,{children:(0,b.jsx)(R.Skeleton,{className:"h-5 w-[120px]"})})]},c)):n.map(a=>{let c=p?.[a.featureKey];return(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableCell,{className:"font-mono text-xs",children:a.featureKey}),(0,b.jsx)(S.TableCell,{className:"text-right font-medium",children:a.balance}),(0,b.jsx)(S.TableCell,{className:"text-muted-foreground",children:a.expiresAt?new Date(a.expiresAt).toLocaleDateString():"—"}),(0,b.jsx)(S.TableCell,{className:"text-muted-foreground",children:c?.period??"—"})]},a.featureKey)}),!l&&0===n.length&&(0,b.jsx)(S.TableRow,{children:(0,b.jsx)(S.TableCell,{colSpan:4,className:"text-center text-sm text-muted-foreground",children:"No credit balances yet."})})]})]})})]})},aD=({className:a})=>{let[d,e]=(0,c.useState)(""),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),m=async()=>{try{j(!0),l(null);let a=await fetch("/api/stripe/validate-coupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d.trim()})}),b=await a.json();if(!a.ok)throw Error(b?.error||"Invalid coupon");l(b.coupon),ax.toast.success("Coupon valid")}catch(a){ax.toast.error(a?.message??"Failed to validate")}finally{j(!1)}};return(0,b.jsxs)(f.Card,{className:(0,q.cn)("p-6",a),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aA,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Coupons"})]}),(0,b.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Validate a coupon code (Stripe). Apply the code during subscription checkout."}),(0,b.jsx)(u.Separator,{className:"my-4"}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,b.jsx)(av.Input,{value:d,onChange:a=>e(a.target.value),placeholder:"Enter coupon code…"}),(0,b.jsx)(g.Button,{onClick:m,disabled:i||!d.trim(),children:i?"Validating…":"Validate"})]}),k&&(0,b.jsx)("div",{className:"mt-4 rounded-lg border bg-card/50 p-4",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:k.id}),(0,b.jsx)("div",{className:"mt-1 text-sm text-muted-foreground",children:null!=k.percent_off?`${k.percent_off}% off`:null!=k.amount_off?`${k.amount_off} ${k.currency?.toUpperCase()} off`:"—"}),(0,b.jsxs)("div",{className:"mt-2 text-sm text-muted-foreground",children:["Duration: ",k.duration,k.duration_in_months?` (${k.duration_in_months} months)`:""]})]}),(0,b.jsx)(h.Badge,{children:"Valid"})]})})]})},aE=({scope:a,scopeId:c,showCredits:d=!0,showCoupons:e=!0,className:g})=>{let h="agency"===a?c:void 0,i="subAccount"===a?c:void 0;return(0,b.jsxs)("div",{className:(0,q.cn)("space-y-6",g),children:[d&&!!h&&(0,b.jsx)(aC,{agencyId:h,subAccountId:i}),e&&(0,b.jsx)(aD,{}),!d&&!e&&(0,b.jsx)(f.Card,{className:"p-6 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No promotional features enabled."})})]})};function aF(a,b){return a===b}let aG=a=>{if(!a.length)return"";let b=Object.keys(a[0]);return[b.join(","),...a.map(a=>b.map(b=>{let c,d,e;return c=String(a[b]??""),d=/[\n\r,\"]/g.test(c),e=c.replace(/\"/g,'""'),d?`"${e}"`:e}).join(","))].join("\n")},aH=(a,b)=>{let c=new Blob([b],{type:"text/csv;charset=utf-8"}),d=URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=a,e.click(),URL.revokeObjectURL(d)},aI=a=>new Intl.NumberFormat().format(a),aJ=({className:a,title:c="Detailed Usage",description:d,resources:e})=>(0,b.jsxs)(f.Card,{className:(0,q.cn)("w-full",a),children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:c}),d&&(0,b.jsx)(f.CardDescription,{children:d})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto rounded-md border",children:(0,b.jsxs)(S.Table,{children:[(0,b.jsx)(S.TableCaption,{className:"sr-only",children:"Detailed usage of resources"}),(0,b.jsx)(S.TableHeader,{children:(0,b.jsxs)(S.TableRow,{className:"from-muted/30 via-muted/20 to-muted/30 border-border/50 relative overflow-hidden border-b bg-gradient-to-b hover:bg-gradient-to-b",children:[(0,b.jsx)(S.TableHead,{className:"w-[180px]",children:"Resource"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Used"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Limit"}),(0,b.jsx)(S.TableHead,{className:"min-w-[160px] text-right",children:"Usage"})]})}),(0,b.jsx)(S.TableBody,{children:0===e.length?(0,b.jsx)(S.TableRow,{children:(0,b.jsx)(S.TableCell,{colSpan:4,className:"text-muted-foreground h-24 text-center",children:"No resources found"})}):e.map((a,c)=>{let d,e=a.percentage??(a.limit>0?a.used/a.limit*100:0),f=a.unit?` ${a.unit}`:"";return(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableCell,{className:"font-medium",children:a.name}),(0,b.jsxs)(S.TableCell,{className:"text-right tabular-nums",children:[aI(a.used),f]}),(0,b.jsxs)(S.TableCell,{className:"text-muted-foreground text-right tabular-nums",children:[aI(a.limit),f]}),(0,b.jsx)(S.TableCell,{className:"text-right",children:(d="bg-emerald-500",e>=90?d="bg-destructive":e>=75&&(d="bg-orange-500"),(0,b.jsxs)("div",{className:"flex min-w-[120px] items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-secondary h-2 flex-1 rounded-full",children:(0,b.jsx)("div",{className:(0,q.cn)("h-2 rounded-full transition-all",d),style:{width:`${Math.max(0,Math.min(e,100))}%`}})}),(0,b.jsxs)("span",{className:"w-10 text-right text-xs font-medium tabular-nums",children:[Math.round(e),"%"]})]}))})]},a.name||c)})})]})})})]}),aK=({className:a})=>(0,b.jsxs)(f.Card,{className:(0,q.cn)("p-6",a),children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Cost Allocation"}),(0,b.jsx)(h.Badge,{variant:"secondary",className:"text-xs",children:"Add‑On (Future Accounting)"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Define how usage, credits, and invoices are split across departments / cost centers."})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",disabled:!0,children:"Export rules"}),(0,b.jsx)(g.Button,{disabled:!0,children:"Create rule"})]})]}),(0,b.jsx)(u.Separator,{className:"my-4"}),(0,b.jsx)("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm",children:"This module is scaffolded for the 9th billing item (Split Bill / Recharges / Cost allocation). Once the accounting module is available, wire this page to: (1) dimensions/cost centers, (2) allocation rules, (3) downstream postings."}),(0,b.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"text-left text-muted-foreground",children:[(0,b.jsx)("th",{className:"py-2 pr-4",children:"Name"}),(0,b.jsx)("th",{className:"py-2 pr-4",children:"Basis"}),(0,b.jsx)("th",{className:"py-2 pr-4",children:"Target"}),(0,b.jsx)("th",{className:"py-2 pr-4",children:"Split"}),(0,b.jsx)("th",{className:"py-2",children:"Status"})]})}),(0,b.jsxs)("tbody",{className:"divide-y",children:[(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"py-3 pr-4",children:"Example: Support recharges"}),(0,b.jsx)("td",{className:"py-3 pr-4 text-muted-foreground",children:"Usage events"}),(0,b.jsx)("td",{className:"py-3 pr-4 text-muted-foreground",children:"Cost Center"}),(0,b.jsx)("td",{className:"py-3 pr-4 text-muted-foreground",children:"60/40"}),(0,b.jsx)("td",{className:"py-3",children:(0,b.jsx)(h.Badge,{variant:"outline",children:"Draft"})})]}),(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:5,className:"py-6 text-center text-muted-foreground",children:"No allocation rules configured yet."})})]})]})})]}),aL=({scope:d,scopeId:e,showAllocation:i=!0,defaultPeriod:j="MONTHLY",className:k})=>{var l,m,n,o;let p="agency"===d?e:void 0,r="subAccount"===d?e:void 0,s="subAccount"===d?"SUBACCOUNT":"AGENCY",[t,v]=(0,c.useState)(j),[w,x]=(0,c.useState)("0"),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)("__ALL__"),[C]=(l=(0,c.useRef)(y),m=(0,c.useState)({})[1],n=function(b,d,e,f){var g=this,h=(0,c.useRef)(null),i=(0,c.useRef)(0),j=(0,c.useRef)(0),k=(0,c.useRef)(null),l=(0,c.useRef)([]),m=(0,c.useRef)(),n=(0,c.useRef)(),o=(0,c.useRef)(b),p=(0,c.useRef)(!0),q=(0,c.useRef)(),r=(0,c.useRef)();o.current=b;var s=!d&&0!==d&&!1;if("function"!=typeof b)throw TypeError("Expected a function");d=+d||0;var t=!!(e=e||{}).leading,u=!("trailing"in e)||!!e.trailing,v=!!e.flushOnExit&&u,w="maxWait"in e,x="debounceOnServer"in e&&!!e.debounceOnServer,y=w?Math.max(+e.maxWait||0,d):null,z=(0,c.useMemo)(function(){var b=function(a){var b=l.current,c=m.current;return l.current=m.current=null,i.current=a,j.current=j.current||a,n.current=o.current.apply(c,b)},c=function(a,b){s&&cancelAnimationFrame(k.current),k.current=setTimeout(a,b)},e=function(a){if(!p.current)return!1;var b=a-h.current;return!h.current||b>=d||b<0||w&&a-i.current>=y},z=function(a){return k.current=null,u&&l.current?b(a):(l.current=m.current=null,n.current)},A=function a(){var b=Date.now();if(t&&j.current===i.current&&B(),e(b))return z(b);if(p.current){var f=d-(b-h.current);c(a,w?Math.min(f,y-(b-i.current)):f)}},B=function(){f&&f({})},C=function(){if(x){var f,j=Date.now(),o=e(j);if(l.current=[].slice.call(arguments),m.current=g,h.current=j,v&&!q.current&&(q.current=function(){var b;"hidden"===(null==(b=a.g.document)?void 0:b.visibilityState)&&r.current.flush()},null==(f=a.g.document)||null==f.addEventListener||f.addEventListener("visibilitychange",q.current)),o){if(!k.current&&p.current)return i.current=h.current,c(A,d),t?b(h.current):n.current;if(w)return c(A,d),b(h.current)}return k.current||c(A,d),n.current}};return C.cancel=function(){var a=k.current;a&&clearTimeout(k.current),i.current=0,l.current=h.current=m.current=k.current=null,a&&f&&f({})},C.isPending=function(){return!!k.current},C.flush=function(){return k.current?z(Date.now()):n.current},C},[t,w,d,y,u,v,s,!1,x,f]);return r.current=z,(0,c.useEffect)(function(){return p.current=!0,function(){var b;v&&r.current.flush(),q.current&&(null==(b=a.g.document)||null==b.removeEventListener||b.removeEventListener("visibilitychange",q.current),q.current=null),p.current=!1}},[v]),z}((0,c.useCallback)(function(a){l.current=a,m({})},[m]),250,void 0,m),aF((o=(0,c.useRef)(y)).current,y)||(n(y),o.current=y),[l.current,n]),[D,E]=(0,c.useState)(!0),[F,G]=(0,c.useState)(!0),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)(null),N=(0,c.useMemo)(()=>Array.from(new Set((H?.rows??[]).map(a=>a.featureKey))).sort(),[H?.rows]),O=(0,c.useMemo)(()=>{let a=H?.rows??[],b=C.trim().toLowerCase();return a.filter(a=>"__ALL__"===A||a.featureKey===A).filter(a=>!b||a.featureKey.toLowerCase().includes(b))},[H?.rows,C,A]),P=(0,c.useMemo)(()=>{let a=C.trim().toLowerCase();return J.filter(a=>"__ALL__"===A||a.featureKey===A).filter(b=>!a||(b.actionKey??"").toLowerCase().includes(a)||b.featureKey.toLowerCase().includes(a))},[J,C,A]),Q=async()=>{if(e){M(null),E(!0),G(!0);try{let a=new URL("/api/features/core/billing/usage/summary",window.location.origin);a.searchParams.set("agencyId",p??e),r&&a.searchParams.set("subAccountId",r),a.searchParams.set("scope",s),a.searchParams.set("period",t),a.searchParams.set("periodsBack",w);let b=await fetch(a.toString(),{headers:{[r?"x-autlify-subaccount":"x-autlify-agency"]:r??p??e},cache:"no-store"}),c=await b.json();if(!b.ok||!c?.ok)throw Error(c?.error||"Failed to load usage summary");I(c),E(!1);let d=new URL("/api/features/core/billing/usage/events",window.location.origin);d.searchParams.set("agencyId",p??e),r&&d.searchParams.set("subAccountId",r),d.searchParams.set("scope",s),d.searchParams.set("period",t),d.searchParams.set("periodsBack",w);let f=await fetch(d.toString(),{headers:{[r?"x-autlify-subaccount":"x-autlify-agency"]:r??p??e},cache:"no-store"}),g=await f.json();if(!f.ok||!g?.ok)throw Error(g?.error||"Failed to load usage events");K(g.events),G(!1)}catch(a){M(a instanceof Error?a.message:"Something went wrong"),E(!1),G(!1)}}};(0,c.useEffect)(()=>{Q()},[e,t,w]);let T=(0,c.useMemo)(()=>{if(!H?.window)return"";let a=new Date(H.window.periodStart).toLocaleDateString(),b=new Date(H.window.periodEnd).toLocaleDateString();return`${a} → ${b}`},[H?.window]);return e?(0,b.jsxs)("div",{className:(0,q.cn)("space-y-6",k),children:[(0,b.jsxs)(f.Card,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Usage"}),(0,b.jsx)(h.Badge,{variant:"secondary",className:"font-mono text-xs",children:s})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Track feature consumption, overages, and events for the selected billing window."})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(aw.Select,{value:t,onValueChange:a=>v(a),children:[(0,b.jsx)(aw.SelectTrigger,{className:"w-[140px]",children:(0,b.jsx)(aw.SelectValue,{placeholder:"Period"})}),(0,b.jsxs)(aw.SelectContent,{children:[(0,b.jsx)(aw.SelectItem,{value:"MONTHLY",children:"Monthly"}),(0,b.jsx)(aw.SelectItem,{value:"WEEKLY",children:"Weekly"}),(0,b.jsx)(aw.SelectItem,{value:"DAILY",children:"Daily"}),(0,b.jsx)(aw.SelectItem,{value:"YEARLY",children:"Yearly"})]})]}),(0,b.jsxs)(aw.Select,{value:w,onValueChange:a=>x(a),children:[(0,b.jsx)(aw.SelectTrigger,{className:"w-[170px]",children:(0,b.jsx)(aw.SelectValue,{placeholder:"Window"})}),(0,b.jsxs)(aw.SelectContent,{children:[(0,b.jsx)(aw.SelectItem,{value:"0",children:"Current window"}),(0,b.jsx)(aw.SelectItem,{value:"1",children:"Previous window"}),(0,b.jsx)(aw.SelectItem,{value:"2",children:"2 windows back"})]})]})]}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:Q,className:"gap-2",children:[(0,b.jsx)(aj.RefreshCw,{className:"h-4 w-4"}),"Refresh"]})]})]}),(0,b.jsx)(u.Separator,{className:"my-4"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Billing window"}),(0,b.jsx)("div",{className:"mt-1 font-medium",children:D?(0,b.jsx)(R.Skeleton,{className:"h-5 w-[180px]"}):T})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Tracked features"}),(0,b.jsx)("div",{className:"mt-1 font-medium",children:D?(0,b.jsx)(R.Skeleton,{className:"h-5 w-[90px]"}):String(N.length)})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card/50 p-3",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Events"}),(0,b.jsx)("div",{className:"mt-1 font-medium",children:F?(0,b.jsx)(R.Skeleton,{className:"h-5 w-[90px]"}):String(J.length)})]})]}),L&&(0,b.jsx)("div",{className:"mt-4 rounded-lg border border-destructive/30 bg-destructive/10 p-3 text-sm text-destructive",children:L}),(0,b.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-3",children:[(0,b.jsx)(av.Input,{value:y,onChange:a=>z(a.target.value),placeholder:"Search feature or action…",className:"md:col-span-2"}),(0,b.jsxs)(aw.Select,{value:A,onValueChange:B,children:[(0,b.jsx)(aw.SelectTrigger,{children:(0,b.jsx)(aw.SelectValue,{placeholder:"Filter by feature"})}),(0,b.jsxs)(aw.SelectContent,{children:[(0,b.jsx)(aw.SelectItem,{value:"__ALL__",children:"All features"}),N.map(a=>(0,b.jsx)(aw.SelectItem,{value:a,children:a},a))]})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[(0,b.jsxs)(g.Button,{variant:"secondary",className:"gap-2",disabled:D||0===O.length,onClick:()=>{aH(`usage-summary-${t}-${w}.csv`,aG(O.map(a=>({featureKey:a.featureKey,currentUsage:a.currentUsage,maxAllowed:a.isUnlimited?"UNLIMITED":a.maxAllowed??"",period:a.period}))))},children:[(0,b.jsx)(ae.Download,{className:"h-4 w-4"}),"Export summary"]}),(0,b.jsxs)(g.Button,{variant:"secondary",className:"gap-2",disabled:F||0===P.length,onClick:()=>{aH(`usage-events-${t}-${w}.csv`,aG(P.map(a=>({createdAt:a.createdAt,featureKey:a.featureKey,quantity:a.quantity,actionKey:a.actionKey??"",idempotencyKey:a.idempotencyKey}))))},children:[(0,b.jsx)(ae.Download,{className:"h-4 w-4"}),"Export events"]})]})]}),(0,b.jsx)(aJ,{title:"Feature usage summary",description:"Detailed breakdown of feature usage",resources:O.map(a=>({name:a.featureKey||"Unnamed feature",used:a.currentUsage?Number(a.currentUsage):0,limit:a.isUnlimited?0:a.maxAllowed?Number(a.maxAllowed):0,unit:"units"}))}),(0,b.jsxs)(f.Card,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Usage events"}),(0,b.jsx)(h.Badge,{variant:"outline",className:(0,q.cn)("font-mono text-xs",F&&"opacity-60"),children:F?"Loading…":`${P.length} rows`})]}),(0,b.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,b.jsxs)(S.Table,{children:[(0,b.jsx)(S.TableHeader,{children:(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableHead,{children:"Date"}),(0,b.jsx)(S.TableHead,{children:"Feature"}),(0,b.jsx)(S.TableHead,{className:"text-right",children:"Qty"}),(0,b.jsx)(S.TableHead,{children:"Action"}),(0,b.jsx)(S.TableHead,{children:"Idempotency"})]})}),(0,b.jsx)(S.TableBody,{children:F?Array.from({length:6}).map((a,c)=>(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableCell,{children:(0,b.jsx)(R.Skeleton,{className:"h-5 w-[140px]"})}),(0,b.jsx)(S.TableCell,{children:(0,b.jsx)(R.Skeleton,{className:"h-5 w-[220px]"})}),(0,b.jsx)(S.TableCell,{className:"text-right",children:(0,b.jsx)(R.Skeleton,{className:"ml-auto h-5 w-[80px]"})}),(0,b.jsx)(S.TableCell,{children:(0,b.jsx)(R.Skeleton,{className:"h-5 w-[160px]"})}),(0,b.jsx)(S.TableCell,{children:(0,b.jsx)(R.Skeleton,{className:"h-5 w-[260px]"})})]},c)):P.map(a=>(0,b.jsxs)(S.TableRow,{children:[(0,b.jsx)(S.TableCell,{className:"text-muted-foreground",children:new Date(a.createdAt).toLocaleString()}),(0,b.jsx)(S.TableCell,{className:"font-mono text-xs",children:a.featureKey}),(0,b.jsx)(S.TableCell,{className:"text-right font-medium",children:a.quantity}),(0,b.jsx)(S.TableCell,{children:a.actionKey??(0,b.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,b.jsx)(S.TableCell,{className:"font-mono text-xs text-muted-foreground",children:a.idempotencyKey})]},a.id))})]})})]}),i&&(0,b.jsx)(aK,{})]}):(0,b.jsx)(f.Card,{className:(0,q.cn)("p-6 text-center",k),children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No context available."})})};var aM=a.i(298621),aN=a.i(441660);let aO=(0,ak.default)("headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);var aP=a.i(154347),aQ=a.i(695245),aR=a.i(159501),aS=a.i(970806),aT=a.i(885861),aU=a.i(531448),aV=a.i(613749),aW=a.i(533350),aX=a.i(883497),aY=a.i(45050),aZ=a.i(385542),a$=a.i(156757);let a_=a$.z.object({firstName:a$.z.string().min(2,"First name must be at least 2 characters"),lastName:a$.z.string().min(2,"Last name must be at least 2 characters"),userEmail:a$.z.string().email("Invalid email address"),agencyName:a$.z.string().min(2,"D.B.A. is required for your agency"),agencyEmail:a$.z.string().email("Invalid email address"),companyPhone:a$.z.string().min(1,"Phone number is required"),phoneCode:a$.z.string().optional(),companyName:a$.z.string().optional(),tinNumber:a$.z.string().optional(),line1:a$.z.string().min(1,"Address line 1 is required"),line2:a$.z.string().optional(),city:a$.z.string().min(1,"City is required"),state:a$.z.string().min(1,"State is required"),postalCode:a$.z.string().min(1,"Postal code is required"),country:a$.z.string().min(2,"Country is required"),countryCode:a$.z.string().optional(),stateCode:a$.z.string().optional()}),a0=[{id:"billing",label:"Billing",description:"Billing information",required:(a,b)=>"plan"===a&&b.isNewSubscription},{id:"payment",label:"Payment",description:"Payment method",required:()=>!0},{id:"review",label:"Review",description:"Review & Confirm",required:()=>!0}];function a1({steps:a,currentStep:c,completedSteps:d,onStepClick:e}){let f=a.findIndex(a=>a.id===c);return(0,b.jsxs)("div",{className:"relative bg-card backdrop-blur-sm rounded-2xl p-2 sm:p-4 shadow-[0_8px_30px_hsl(var(--shadow-lg))] border border-border",children:[(0,b.jsx)("div",{className:"absolute top-[calc(1.5rem+16px)] left-[8%] right-[8%] flex items-center z-0",children:a.slice(0,-1).map((a,c)=>(0,b.jsx)("div",{className:"h-1 bg-border rounded-full flex-1",children:(0,b.jsx)("div",{className:(0,q.cn)("h-1 rounded-full transition-all duration-500",d.has(a.id)?"bg-gradient-to-r from-blue-500 to-blue-600 w-full":"w-0")})},`line-${c}`))}),(0,b.jsx)("div",{className:"flex justify-between relative z-10",children:a.map((a,g)=>{let h=d.has(a.id),i=c===a.id,j=g<=f||h;return(0,b.jsx)("div",{className:"flex flex-col items-center",children:(0,b.jsxs)("button",{onClick:()=>j&&e(a.id),disabled:!j,className:"flex flex-col items-center group cursor-pointer disabled:cursor-not-allowed transition-all duration-300 hover:scale-105",children:[(0,b.jsx)("div",{className:(0,q.cn)("w-11 h-11 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center mb-1 transition-all duration-500 bg-card",h?"bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-[0_8px_20px_rgba(59,130,246,0.3)]":i?"bg-gradient-to-br from-primary via-blue-500 to-cyan-500 text-white shadow-[0_10px_30px_rgba(59,130,246,0.4)] scale-110":"bg-gradient-to-br from-muted to-muted-foreground/10 text-muted-foreground shadow-sm"),children:h?(0,b.jsx)(v.Check,{className:"h-5 w-5"}):(0,b.jsx)("span",{className:"text-base font-semibold",children:g+1})}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:(0,q.cn)("text-sm font-medium transition-colors",i?"text-blue-600":h?"text-blue-500":"text-muted-foreground"),children:a.label}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground hidden sm:block mt-0.5",children:a.description})]})]})},a.id)})})]})}function a2({type:a,item:c}){let{title:d,gradient:e}={plan:{icon:aX.Package,title:"Complete Your Subscription",gradient:"from-blue-500 to-purple-500"},addon:{icon:az.Zap,title:"Add Enhancement",gradient:"from-green-500 to-emerald-500"},credits:{icon:aB,title:"Purchase Credits",gradient:"from-amber-500 to-orange-500"}}[a];return(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:(0,q.cn)("p-3 rounded-xl bg-gradient-to-br",e),children:["plan"===a&&(0,b.jsx)(aX.Package,{className:"h-6 w-6 text-white"}),"addon"===a&&(0,b.jsx)(az.Zap,{className:"h-6 w-6 text-white"}),"credits"===a&&(0,b.jsx)(aB,{className:"h-6 w-6 text-white"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl font-black tracking-tight text-brand-gradient",children:d}),(0,b.jsx)("p",{className:"text-sm text-fg-tertiary mt-1",children:c.title})]})]})}function a3({item:a,selectedAddons:c,coupon:d,isTrialAccepted:e}){let g=a.priceAmount/100+c.reduce((a,b)=>a+b.priceAmount/100,0),h=d?d.percent_off?g*d.percent_off/100:(d.amount_off||0)/100:0,i=g-h;return(0,b.jsxs)(f.Card,{className:"border-0 bg-card/95 backdrop-blur-xl rounded-2xl overflow-hidden relative",children:[(0,b.jsxs)(f.CardHeader,{className:"relative bg-gradient-to-br from-accent-base/8 via-accent-base/5 to-transparent border-b border-line-secondary pb-5",children:[(0,b.jsx)(f.CardTitle,{className:"text-2xl font-black text-brand-gradient tracking-tight",children:"Order Summary"}),(0,b.jsx)(f.CardDescription,{className:"text-fg-tertiary font-medium mt-1.5",children:"Review your purchase"})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-4 pt-6",children:[(0,b.jsx)("div",{className:"bg-card border border-border rounded-xl p-4 shadow-sm",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-fg-primary",children:a.title}),(0,b.jsx)("p",{className:"text-sm text-fg-secondary",children:"one_time"===a.interval?"One-time purchase":`${a.interval}ly subscription`})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"font-bold text-fg-primary text-lg",children:a.price}),"one_time"!==a.interval&&(0,b.jsxs)("span",{className:"text-xs text-fg-secondary",children:["/ ",a.interval]})]})]})}),e&&a.trial?.enabled&&(0,b.jsx)("div",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-cyan-500 text-white px-4 py-3 rounded-xl text-sm font-bold",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xl",children:"🎁"}),(0,b.jsxs)("span",{children:[a.trial.days,"-day free trial included"]})]})}),c.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-bold mb-3 text-sm uppercase tracking-wider text-fg-primary",children:"Add-ons"}),(0,b.jsx)("div",{className:"space-y-2",children:c.map(a=>(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-fg-secondary",children:a.title}),(0,b.jsxs)("span",{className:"font-medium",children:[a.price,"/mo"]})]},a.key))})]})]}),a.features&&a.features.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-bold mb-4 text-sm uppercase tracking-wider text-fg-primary",children:"What's included"}),(0,b.jsx)("ul",{className:"space-y-3",children:a.features.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-start gap-3 text-sm",children:[(0,b.jsx)("div",{className:"flex-shrink-0 inline-flex h-5 w-5 items-center justify-center rounded-full bg-gradient-to-br from-primary/15 to-primary/10 border border-primary/30 mt-0.5",children:(0,b.jsx)(v.Check,{className:"h-3.5 w-3.5 text-primary"})}),(0,b.jsx)("span",{className:"text-fg-secondary font-medium",children:a})]},c))})]})]}),(0,b.jsx)(u.Separator,{}),(0,b.jsxs)("div",{className:"space-y-3 bg-muted/50 rounded-lg p-4 border border-border",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-fg-tertiary",children:"Subtotal"}),(0,b.jsxs)("span",{className:"font-medium text-fg-primary",children:["RM ",g.toFixed(2)]})]}),d&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-green-600 font-medium",children:["Discount (",d.percent_off||"","%)"]}),(0,b.jsxs)("span",{className:"text-green-600 font-semibold",children:["- RM ",h.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-md font-bold pt-1",children:[(0,b.jsx)("span",{className:"text-fg-primary",children:"Total"}),(0,b.jsxs)("span",{className:"font-medium text-fg-primary",children:["RM ",i.toFixed(2)]})]}),e&&a.trial?.enabled&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Separator,{}),(0,b.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-1",children:[(0,b.jsx)("span",{className:"text-primary",children:"Pay Now"}),(0,b.jsx)("span",{className:"text-primary",children:"RM 0.00"})]}),(0,b.jsxs)("p",{className:"text-xs text-fg-secondary bg-primary/5 rounded-lg p-3 border border-primary/20 font-medium",children:["💡 You'll be charged RM ",i.toFixed(2)," after your ",a.trial.days,"-day trial ends"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground pt-4 border-t border-border",children:[(0,b.jsx)("svg",{className:"h-5 w-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,b.jsx)("span",{children:"Secure payment powered by Stripe"})]})]})]})}(0,ac.loadStripe)(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);let a4=({mode:d,item:e,additionalItems:h=[],availableAddons:j=[],user:k,context:l,existingCustomer:m,existingPaymentMethods:n=[],onComplete:o,onCancel:p,successUrl:r,cancelUrl:s,showBackButton:v=!0,backUrl:x="/site/pricing",className:z})=>{let A=(0,am.useRouter)(),{toast:B}=(0,T.useToast)(),C=(0,c.useMemo)(()=>{var a;let b=n.length>0;return a=e.type,a0.filter(c=>("billing"!==c.id||!!l.isNewSubscription)&&("payment"===c.id&&!!b&&!l.isNewSubscription||c.required(a,l)))},[e.type,l,n.length]).map(a=>({id:a.id,label:a.label,description:a.description})),[D,E]=(0,c.useState)(C[0]?.id||"payment"),[F,G]=(0,c.useState)(new Set),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(l.customerId||m?.id||null),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(null),[R,S]=(0,c.useState)(n.length>0),[U,V]=(0,c.useState)(n.length>0?n[0].id:null),[W,X]=(0,c.useState)(null),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(""),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(""),[ag,ah]=(0,c.useState)(""),[ai,aj]=(0,c.useState)(""),[ak,al]=(0,c.useState)(""),an=(0,aQ.useForm)({resolver:(0,aR.zodResolver)(a_),mode:"onChange",defaultValues:{firstName:k.firstName||"",lastName:k.lastName||"",userEmail:k.email||"",agencyName:"",agencyEmail:k.email||"",companyPhone:"",phoneCode:"",line1:"",line2:"",city:"",state:"",postalCode:"",stateCode:"",country:"",countryCode:""}}),ao=an.formState.isSubmitting,ap=C.findIndex(a=>a.id===D),aq=(0,c.useMemo)(()=>j.filter(a=>L.includes(a.key)),[j,L]),ar=(0,c.useMemo)(()=>{switch(e.type){case"plan":return[{text:"Verifying payment method"},{text:"Creating your subscription"},{text:"Setting up your agency"},{text:"Finalizing your account"}];case"addon":return[{text:"Verifying payment method"},{text:"Adding enhancement to subscription"},{text:"Updating your plan"}];case"credits":return[{text:"Processing payment"},{text:"Adding credits to your account"}];default:return[{text:"Processing..."}]}},[e.type]);(0,c.useEffect)(()=>{if(m){let a=m.metadata||{};if(m.address){let a=aT.Country.getAllCountries().find(a=>a.name===m.address?.country),b=aU.State.getStatesOfCountry(a?.isoCode||"").find(a=>a.name===m.address?.state);an.setValue("line1",m.address.line1||""),an.setValue("line2",m.address.line2||""),af(a?.isoCode||""),an.setValue("country",a?.name||m.address.country||""),an.setValue("countryCode",a?.isoCode||""),ah(b?.isoCode||""),an.setValue("state",b?.name||m.address.state||""),an.setValue("stateCode",b?.isoCode||""),an.setValue("city",m.address.city||""),aj(m.address.city||""),an.setValue("postalCode",m.address.postal_code||"")}a.agencyName&&an.setValue("agencyName",a.agencyName),a.companyName&&an.setValue("companyName",a.companyName),a.tinNumber&&an.setValue("tinNumber",a.tinNumber)}},[m,an]),(0,c.useEffect)(()=>{e.trial?.enabled&&k.trialEligible&&I(!0)},[e.trial,k.trialEligible]);let as=async a=>"billing"!==a||an.trigger(["firstName","lastName","userEmail","agencyName","agencyEmail","phoneCode","companyPhone","line1","city","state","postalCode","country"]),at=async()=>{if(!await as(D)){let a=Object.keys(an.formState.errors);B({title:"Validation Error",description:a.length>0?`Please check: ${a.join(", ")}`:"Please fill in all required fields.",variant:"destructive"});return}G(a=>new Set(a).add(D)),"billing"===D&&Q(an.getValues());let a=ap+1;a<C.length&&E(C[a].id)},au=async()=>{try{O(!0);let a={success:!1,type:e.type};switch(e.type){case"plan":await aw(a);break;case"addon":await ax(a);break;case"credits":await ay(a)}a.success&&(o?.(a),r?A.push(r):a.agencyId&&A.push(`/agency/${a.agencyId}`))}catch(a){console.error("Checkout error:",a),O(!1),B({title:"Error",description:a instanceof Error?a.message:"Failed to process checkout",variant:"destructive"})}},aw=async b=>{let c,d=P||an.getValues(),f=d.phoneCode&&d.companyPhone?`${d.phoneCode}${d.companyPhone}`:d.companyPhone;if(J)c=J;else{let a=await fetch("/api/stripe/customer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.userEmail,name:d.companyName||`${d.firstName} ${d.lastName}`,phone:f,address:{line1:d.line1,line2:d.line2||"",city:d.city,state:d.state,postal_code:d.postalCode,country:d.country},metadata:{userId:k.id,agencyName:d.agencyName,companyName:d.companyName||""},userId:k.id})});if(!a.ok)throw Error("Failed to create customer");let{customerId:b}=await a.json();K(c=b)}let{upsertAgency:g}=await a.A(442982),h=(0,aS.v4)();await g({id:h,customerId:c,name:d.agencyName,companyEmail:d.userEmail,companyPhone:f,whiteLabel:!1,line1:d.line1,line2:d.line2||"",city:d.city,postalCode:d.postalCode,state:d.state,country:d.country,agencyLogo:"",connectAccountId:"",taxIdentityId:null,goal:5,createdAt:new Date,updatedAt:new Date});let i=await fetch("/api/stripe/create-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:c,agencyId:h,priceId:e.priceId,country:d.country,coupon:aa?.id,paymentMethodId:W||U,trialEnabled:H&&e.trial?.enabled,trialPeriodDays:H?e.trial?.days:void 0})});if(!i.ok)throw Error("Failed to create subscription");let{subscriptionId:l}=await i.json();for(let a of L){let b=j.find(b=>b.key===a);b&&await fetch("/api/stripe/addon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",agencyId:h,addonKey:b.key,priceId:b.priceId})})}b.success=!0,b.subscriptionId=l,b.agencyId=h,B({title:"Success!",description:"Your subscription has been created."})},ax=async a=>{if(!l.agencyId)throw Error("Agency ID required for addon checkout");if(!(await fetch("/api/stripe/addon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",agencyId:l.agencyId,addonKey:e.key,priceId:e.priceId})})).ok)throw Error("Failed to add addon");a.success=!0,a.agencyId=l.agencyId,B({title:"Success!",description:`${e.title} has been added to your subscription.`})},ay=async a=>{if(!l.agencyId)throw Error("Agency ID required for credits checkout");let b=await fetch("/api/stripe/credits/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agencyId:l.agencyId,featureKey:e.key,credits:e.quantity||1,priceId:e.priceId})});if(!b.ok)throw Error("Failed to create checkout session");let{url:c,sessionId:d}=await b.json();a.success=!0,a.sessionId=d,c&&(window.location.href=c)},az=async()=>{if($.trim()){ad(!0);try{let a=await fetch("/api/stripe/validate-coupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:$})});if(!a.ok)throw Error("Invalid coupon code");let{coupon:b}=await a.json();ab(b),B({title:"Coupon Applied!",description:"Discount applied successfully."})}catch{B({title:"Invalid Coupon",description:"The coupon code is not valid.",variant:"destructive"})}finally{ad(!1)}}},aA=R?!!U:!!W,aB=(0,b.jsxs)("div",{className:(0,q.cn)("min-h-screen relative overflow-hidden bg-bg-primary text-fg-primary","modal"===d&&"min-h-0",z),children:["page"===d&&(0,b.jsxs)("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[(0,b.jsx)("div",{className:"absolute -top-32 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-gradient-to-br from-blue-300/25 to-purple-300/25 blur-3xl"}),(0,b.jsx)("div",{className:"absolute bottom-[-180px] right-[-180px] h-[520px] w-[520px] rounded-full bg-gradient-to-br from-cyan-300/20 to-pink-300/20 blur-3xl"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,hsl(var(--border))_1px,transparent_1px),linear-gradient(to_bottom,hsl(var(--border))_1px,transparent_1px)] bg-[size:72px_72px] opacity-[0.15]"})]}),(0,b.jsxs)("div",{className:(0,q.cn)("mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-12 relative z-10","page"===d?"max-w-6xl":"max-w-4xl py-6"),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-6",children:[(0,b.jsx)(a2,{type:e.type,item:e}),"page"===d&&v&&(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",onClick:()=>A.push(x||s||"/site/pricing"),children:[(0,b.jsx)(aV.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Back"]}),"modal"===d&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:p,children:(0,b.jsx)(w.X,{className:"h-5 w-5"})})]}),(0,b.jsx)(u.Separator,{className:"my-6"}),(0,b.jsxs)("div",{className:(0,q.cn)("grid gap-6","page"===d?"lg:grid-cols-3":""),children:[(0,b.jsxs)("div",{className:(0,q.cn)("space-y-4","page"===d?"lg:col-span-2":""),children:[C.length>1&&(0,b.jsx)(a1,{steps:C,currentStep:D,completedSteps:F,onStepClick:a=>{(C.findIndex(b=>b.id===a)<=ap||F.has(a))&&E(a)}}),(0,b.jsx)(f.Card,{className:"border-0 card rounded-2xl",children:(0,b.jsx)(f.CardContent,{className:"pt-6 pb-7 px-6 sm:px-7",children:(0,b.jsxs)("form",{children:["billing"===D&&(0,b.jsx)(a5,{form:an,isLoading:ao,countryCode:ae,setCountryCode:af,stateCode:ag,setStateCode:ah,city:ai,setCity:aj,phoneNumber:ak,setPhoneNumber:al}),"payment"===D&&(0,b.jsx)(a6,{existingPaymentMethods:n,useExistingPayment:R,setUseExistingPayment:S,selectedPaymentMethodId:U,setSelectedPaymentMethodId:V,savedPaymentMethodId:W,setSavedPaymentMethodId:X,cardModalOpen:Y,setCardModalOpen:Z,savedBillingData:P,toast:B}),"review"===D&&(0,b.jsx)(a7,{item:e,savedBillingData:P,existingPaymentMethods:n,useExistingPayment:R,selectedPaymentMethodId:U,savedPaymentMethodId:W,availableAddons:j,selectedAddonKeys:L,setSelectedAddonKeys:M,isTrialAccepted:H,context:l}),(0,b.jsxs)("div",{className:"flex gap-3 mt-7 pt-5 border-t border-border",children:[ap>0&&(0,b.jsxs)(g.Button,{type:"button",variant:"outline",onClick:()=>{let a=ap-1;a>=0&&E(C[a].id)},children:[(0,b.jsx)(aV.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Back"]}),"review"!==D?(0,b.jsx)(g.Button,{type:"button",className:"btn-brand-gradient h-11",onClick:at,disabled:ao||"payment"===D&&!aA,children:"Continue →"}):(0,b.jsxs)(g.Button,{type:"button",className:"btn-brand-gradient shadow-lg h-11 flex-1",onClick:au,disabled:N||!aA,children:["🔒 Confirm & Pay ",H&&e.trial?.enabled?"RM 0.00":e.price]})]})]})})})]}),"page"===d&&(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)("div",{className:"lg:sticky lg:top-6",children:[(0,b.jsx)(a3,{item:e,selectedAddons:aq,coupon:aa,isTrialAccepted:H}),(0,b.jsx)(f.Card,{className:"mt-4 border-0 bg-card/95 rounded-2xl",children:(0,b.jsxs)(f.CardContent,{className:"pt-4 pb-4",children:[(0,b.jsx)(t.Label,{className:"text-sm font-bold mb-3 block text-fg-primary uppercase tracking-wider",children:"Promo Code"}),aa?(0,b.jsxs)("div",{className:"flex items-center justify-between bg-green-50 border border-green-200 rounded-xl px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aW.Tag,{className:"h-4 w-4 text-green-600"}),(0,b.jsx)("span",{className:"text-sm font-bold text-green-700",children:aa.id})]}),(0,b.jsx)(g.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{ab(null),_("")},className:"text-xs",children:"Remove"})]}):(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(av.Input,{placeholder:"Enter code",value:$,onChange:a=>_(a.target.value.toUpperCase()),disabled:ac}),(0,b.jsx)(g.Button,{type:"button",variant:"outline",size:"sm",onClick:az,disabled:!$.trim()||ac,children:ac?(0,b.jsx)(y.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(aW.Tag,{className:"h-4 w-4"})})]})]})})]})})]})]}),(0,b.jsx)(aY.MultiStepLoader,{loadingStates:ar,loading:N,duration:2e3,loop:!1})]});return"modal"===d?(0,b.jsxs)(i.Dialog,{open:!0,onOpenChange:a=>!a&&p?.(),children:[(0,b.jsx)(i.DialogHeader,{children:(0,b.jsx)(i.DialogTitle,{className:"text-lg font-bold",children:"Checkout"})}),(0,b.jsx)(i.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:aB})]}):aB};function a5({form:a,isLoading:c,countryCode:d,setCountryCode:e,stateCode:f,setStateCode:g,city:h,setCity:i,phoneNumber:j,setPhoneNumber:k}){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,b.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-1 tracking-tight",children:"Account"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your contact information"})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{className:"mb-2 block",children:"Full Name *"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(av.Input,{...a.register("firstName"),placeholder:"First",className:"h-10"}),(0,b.jsx)(av.Input,{...a.register("lastName"),placeholder:"Last",className:"h-10"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"agencyEmail",className:"mb-2 block",children:"Email Address *"}),(0,b.jsx)(av.Input,{id:"agencyEmail",type:"email",readOnly:!0,...a.register("agencyEmail"),className:"h-10"})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"agencyName",className:"mb-2 block",children:"Tenant Name *"}),(0,b.jsx)(av.Input,{id:"agencyName",...a.register("agencyName"),placeholder:"My Tenant",className:"h-10"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"companyPhone",className:"mb-2 block",children:"Phone Number *"}),(0,b.jsx)(aZ.PhoneCodeSelector,{value:j,onValueChange:(b,c)=>{k(b),a.setValue("companyPhone",b),a.setValue("phoneCode",c||"")},countryCode:d,onCountryCodeChange:(b,c)=>{e(b),a.setValue("phoneCode",c?.phonecode||""),a.setValue("country",c?.name||"",{shouldValidate:!0}),a.setValue("countryCode",b)},placeholder:"Enter phone number",disabled:c,styleVariant:"plain"})]})]}),(0,b.jsx)(u.Separator,{className:"my-6"}),(0,b.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,b.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-1 tracking-tight",children:"Billing"}),(0,b.jsx)("p",{className:"text-sm text-fg-tertiary",children:"Billing address and tax information"})]}),(0,b.jsxs)("div",{className:"space-y-5 mt-2",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"companyName",className:"mb-2 block",children:"Company Name (Optional)"}),(0,b.jsx)(av.Input,{id:"companyName",...a.register("companyName"),placeholder:"My Company Ltd.",className:"h-10"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"tinNumber",className:"mb-2 block",children:"Tax ID (Optional)"}),(0,b.jsx)(av.Input,{id:"tinNumber",...a.register("tinNumber"),placeholder:"123-45-6789",className:"h-10"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{className:"mb-2 block",children:"Address *"}),(0,b.jsxs)("div",{className:"grid md:grid-cols-4 gap-2",children:[(0,b.jsx)(av.Input,{...a.register("line2"),placeholder:"Apt/Suite (Optional)",className:"h-10"}),(0,b.jsx)(av.Input,{className:"md:col-span-2 h-10",...a.register("line1"),placeholder:"Street Address"}),(0,b.jsx)(aZ.PostalCodeInput,{value:a.watch("postalCode"),onValueChange:b=>a.setValue("postalCode",b),placeholder:"Postal Code",countryCode:d,styleVariant:"plain"})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-3 gap-5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{className:"mb-2 block",children:"Country *"}),(0,b.jsx)(aZ.CountrySelector,{value:d,onValueChange:(b,c)=>{e(b),g(""),a.setValue("country",c?.name||""),a.setValue("countryCode",b),a.setValue("state",""),a.setValue("stateCode",""),a.setValue("city","")},placeholder:"Select country",disabled:c,styleVariant:"plain"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{className:"mb-2 block",children:"State/Province *"}),(0,b.jsx)(aZ.StateSelector,{countryCode:d,value:f,onValueChange:(b,c)=>{g(b),a.setValue("state",c.name),a.setValue("stateCode",b)},placeholder:"Select state",disabled:c,styleVariant:"plain"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{className:"mb-2 block",children:"City *"}),(0,b.jsx)(aZ.CitySelector,{countryCode:d,stateCode:f,value:h,onValueChange:(b,c)=>{i(c.name),a.setValue("city",c.name)},placeholder:"Select city",disabled:c,styleVariant:"plain"})]})]})]})]})}function a6({existingPaymentMethods:a,useExistingPayment:c,setUseExistingPayment:d,selectedPaymentMethodId:e,setSelectedPaymentMethodId:f,savedPaymentMethodId:h,setSavedPaymentMethodId:i,cardModalOpen:j,setCardModalOpen:k,savedBillingData:l,toast:m}){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,b.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-2 tracking-tight",children:"Payment Method"}),(0,b.jsx)("p",{className:"text-fg-tertiary",children:a.length>0?"Choose a payment method or add a new card":"Securely add your payment information"})]}),a.length>0&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(Q.SavedBankCardsGallery,{compact:!0,cards:a.map(a=>({id:a.id,cardNumber:`**** **** **** ${a.card?.last4}`,cardholderName:a.card?.cardholder_name||"N/A",expiryMonth:String(a.card?.exp_month).padStart(2,"0"),expiryYear:String(a.card?.exp_year),brand:a.card?.brand,variant:a.card?.brand==="visa"?"default":a.card?.brand==="mastercard"?"premium":"default",isDefault:a.card?.isDefault})),selectedCardId:c&&e?e:void 0,onCardSelect:a=>{d(!0),f(a)},onAddCard:()=>k(!0),onSetDefault:()=>m({title:"Coming Soon",description:"This feature will be available soon."}),onReplaceCard:()=>k(!0),onRemoveCard:()=>m({title:"Coming Soon",description:"This feature will be available soon.",variant:"destructive"}),className:"mb-4"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,b.jsx)("span",{className:"w-full border-t border-border"})}),(0,b.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,b.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:c?"Or add new card":"Adding new card"})})]})]}),!c&&!h&&(0,b.jsx)("div",{onClick:()=>k(!0),className:"p-6 border-2 border-dashed border-primary/30 rounded-xl cursor-pointer hover:border-primary hover:bg-primary/5 transition-all",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-3 text-center",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(z.CreditCard,{className:"h-6 w-6 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-fg-primary",children:"Add New Payment Method"}),(0,b.jsx)("p",{className:"text-sm text-fg-tertiary mt-1",children:"Click to securely add your card details"})]})]})}),!c&&h&&(0,b.jsx)("div",{className:"relative rounded-2xl p-[1.5px] bg-gradient-to-br from-green-400/60 via-green-300/40 to-green-400/60 overflow-hidden shadow-lg",children:(0,b.jsx)("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-green-50 via-emerald-50 to-green-50 p-5",children:(0,b.jsxs)("div",{className:"relative z-10 flex items-center gap-4",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center shadow-lg",children:(0,b.jsx)(v.Check,{className:"h-7 w-7 text-white",strokeWidth:3})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-bold text-lg text-green-900",children:"Payment Method Validated"}),(0,b.jsx)("p",{className:"text-sm text-green-700 mt-0.5",children:"Your new card has been validated"})]}),(0,b.jsx)(g.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>i(null),className:"flex-shrink-0",children:"Change Card"})]})})}),j&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:()=>k(!1),children:(0,b.jsxs)("div",{className:"relative bg-card rounded-2xl shadow-2xl max-w-md w-full p-6",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-fg-primary",children:"Add New Card"}),(0,b.jsx)("p",{className:"text-sm text-fg-tertiary mt-1",children:"Your payment information is securely processed by Stripe"})]}),(0,b.jsx)("button",{onClick:()=>k(!1),className:"text-muted-foreground hover:text-foreground",children:(0,b.jsx)(w.X,{className:"h-6 w-6"})})]}),(0,b.jsxs)("div",{className:"bg-muted/50 rounded-xl p-6 text-center",children:[(0,b.jsx)(z.CreditCard,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Stripe Payment Elements would be integrated here for secure card collection"})]}),(0,b.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:()=>k(!1),className:"flex-1",children:"Cancel"}),(0,b.jsx)(g.Button,{type:"button",className:"btn-brand-gradient flex-1",onClick:()=>{i("pm_simulated_"+Date.now()),d(!1),k(!1),m({title:"Card Added",description:"Your payment method is ready to use."})},children:"Add Card"})]})]})})]})}function a7({item:a,savedBillingData:c,existingPaymentMethods:d,useExistingPayment:e,selectedPaymentMethodId:f,savedPaymentMethodId:g,availableAddons:h,selectedAddonKeys:i,setSelectedAddonKeys:j,isTrialAccepted:k,context:l}){let m;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"border-l-4 border-primary pl-5",children:[(0,b.jsx)("h2",{className:"text-2xl font-black text-brand-gradient mb-2 tracking-tight",children:"Review & Confirm"}),(0,b.jsx)("p",{className:"text-fg-tertiary",children:"Please review your information before confirming"})]}),l.isNewSubscription&&c&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(v.Check,{className:"h-5 w-5 text-green-500"}),"Billing Information"]}),(0,b.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Name"}),(0,b.jsxs)("p",{className:"font-medium",children:[c.firstName," ",c.lastName]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Email"}),(0,b.jsx)("p",{className:"font-medium",children:c.agencyEmail})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tenant Name"}),(0,b.jsx)("p",{className:"font-medium",children:c.agencyName})]})]}),(0,b.jsx)(u.Separator,{className:"my-2"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Address"}),(0,b.jsxs)("p",{className:"font-medium",children:[c.line1,c.line2&&`, ${c.line2}`]}),(0,b.jsxs)("p",{className:"font-medium",children:[c.city,", ",c.state," ",c.postalCode]}),(0,b.jsx)("p",{className:"font-medium",children:c.country})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(v.Check,{className:"h-5 w-5 text-green-500"}),"Payment Method"]}),(0,b.jsx)("div",{className:"bg-muted/50 rounded-lg p-4",children:e&&f?(0,b.jsx)("div",{children:(m=d.find(a=>a.id===f))?(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-blue-600 font-semibold",children:m.card?.brand?.charAt(0).toUpperCase()})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-medium capitalize",children:[m.card?.brand," •••• ",m.card?.last4]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Expires ",m.card?.exp_month,"/",m.card?.exp_year]})]})]}):null}):g?(0,b.jsx)("p",{className:"font-medium",children:"New card ending in ••••"}):(0,b.jsx)("p",{className:"text-amber-600",children:"No payment method selected"})})]}),"plan"===a.type&&h.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(ai.Plus,{className:"h-5 w-5 text-brand-bg"}),"Enhance Your Plan (Optional)"]}),(0,b.jsx)("div",{className:"space-y-2",children:h.slice(0,4).map(a=>{let c=i.includes(a.key),d=a.requires&&!i.includes(a.requires);return(0,b.jsxs)("div",{className:(0,q.cn)("flex items-center justify-between p-3 rounded-lg border transition-all cursor-pointer",c?"border-brand-bg bg-brand-bg/5":"border-border hover:border-brand-bg/50 bg-muted/30",d&&"opacity-50 cursor-not-allowed"),onClick:()=>{d||j(c?i.filter(b=>b!==a.key):[...i,a.key])},children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:(0,q.cn)("w-5 h-5 rounded border-2 flex items-center justify-center transition-colors",c?"border-brand-bg bg-brand-bg":"border-muted-foreground"),children:c&&(0,b.jsx)(v.Check,{className:"h-3 w-3 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.description}),d&&(0,b.jsxs)("p",{className:"text-xs text-amber-600",children:["Requires ",a.requires]})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-semibold text-sm",children:a.price}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"/month"})]})]},a.key)})})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(v.Check,{className:"h-5 w-5 text-green-500"}),"plan"===a.type?"Subscription":"addon"===a.type?"Enhancement":"Purchase"]}),(0,b.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-lg",children:a.title}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"one_time"===a.interval?"One-time purchase":`${"month"===a.interval?"Monthly":"Yearly"} subscription`})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-bold text-xl",children:a.price}),"one_time"!==a.interval&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["per ",a.interval]})]})]}),k&&a.trial?.enabled&&(0,b.jsx)("div",{className:"bg-blue-50 rounded-lg p-3",children:(0,b.jsxs)("p",{className:"text-sm text-blue-700",children:["💡 Your ",a.trial.days,"-day free trial starts today. You'll be charged ",a.price," after your trial ends."]})})]})]})]})}let a8=function({scope:a,scopeId:d,user:e,existingCustomer:i,existingPaymentMethods:j}){let{toast:k}=(0,T.useToast)(),[l,m]=(0,c.useState)(!0),[n,o]=(0,c.useState)(null),[p,r]=(0,c.useState)([]),[s]=(0,c.useState)(()=>(0,B.getAddonCards)()),[t,u]=(0,c.useState)({user:e||null,customerId:null,customer:i||null,paymentMethods:j||[]}),w={fi:"Finance Modules",core:"Core Add-ons",co:"Commerce",crm:"CRM",apps:"Apps",iam:"Identity & Access"},x=(0,c.useMemo)(()=>({agencyId:d,customerId:t.customerId||void 0,isNewSubscription:!1}),[d,t.customerId]),z=(0,c.useCallback)(async()=>{try{let a=await fetch(`/api/stripe/addon?agencyId=${d}`);if(a.ok){let b=await a.json();r(b.addons||[])}}catch(a){console.error("Failed to fetch addons:",a)}finally{m(!1)}},[d]),A=(0,c.useCallback)(async()=>{if(!e||!i||!j)try{if(!e){let a=await fetch("/api/auth/session");if(a.ok){let b=await a.json();if(b?.user){let a=(b.user.name||"").split(" ");u(c=>({...c,user:{id:b.user.id||"",email:b.user.email||"",name:b.user.name||"",firstName:a[0]||"",lastName:a.slice(1).join(" ")||"",trialEligible:!1}}))}}}let a=await fetch(`/api/stripe/customer?agencyId=${d}`);if(a.ok){let b=await a.json();u(a=>({...a,customerId:b.customerId||null,customer:b.customer||null,paymentMethods:b.paymentMethods||[]}))}}catch(a){console.error("Failed to fetch billing data:",a)}},[d,e,i,j]),C=(0,c.useCallback)(a=>{a.success?(k({title:"Success",description:"Add-on added successfully"}),z()):k({title:"Error",description:a.error||"Failed to add addon",variant:"destructive"})},[k,z]),{openCheckout:D,CheckoutModal:E}=function(a){let[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(null),h=(0,c.useCallback)(a=>{g(a),e(!0)},[]),i=(0,c.useCallback)(()=>{e(!1),setTimeout(()=>g(null),300)},[]),j=(0,c.useCallback)(b=>{a.onComplete?.(b),i()},[a,i]),k=d&&f?(0,b.jsx)(a4,{mode:"modal",item:f,user:a.user,context:a.context,existingCustomer:a.existingCustomer,existingPaymentMethods:a.existingPaymentMethods,availableAddons:a.availableAddons,onComplete:j,onCancel:i,successUrl:a.successUrl,cancelUrl:a.cancelUrl}):null;return{isOpen:d,currentItem:f,openCheckout:h,closeCheckout:i,CheckoutModal:k}}({user:(0,c.useMemo)(()=>t.user?t.user:{id:"",email:"",name:"",firstName:"",lastName:"",trialEligible:!1},[t.user]),context:x,existingCustomer:t.customer,existingPaymentMethods:t.paymentMethods,onComplete:C,successUrl:`/${a}/${d}/billing/addons`,cancelUrl:`/${a}/${d}/billing/addons`});(0,c.useEffect)(()=>{z(),A()},[z,A]);let F=a=>p.some(b=>b.key===a&&b.active),G=async a=>{o(a.key);try{let b=await fetch("/api/stripe/addon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remove",agencyId:d,addonKey:a.key,priceId:a.priceId})}),c=await b.json();b.ok?(k({title:"Success",description:c.message||`${a.title} removed successfully`}),await z()):k({title:"Error",description:c.error||"Failed to remove addon",variant:"destructive"})}catch(a){k({title:"Error",description:"Failed to remove addon. Please try again.",variant:"destructive"})}finally{o(null)}},H=s.reduce((a,b)=>{let c=b.category;return a[c]||(a[c]=[]),a[c].push(b),a},{});return l?(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsx)(y.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,b.jsxs)(b.Fragment,{children:[E,(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-content-primary",children:"Add-ons"}),(0,b.jsx)("p",{className:"text-sm text-content-secondary mt-1",children:"Extend your subscription with powerful add-on modules"})]}),p.length>0&&(0,b.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-content-primary mb-2",children:"Active Add-ons"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:p.filter(a=>a.active).map(a=>(0,b.jsx)(h.Badge,{variant:"secondary",className:"bg-brand-bg/10 text-brand-bg",children:a.name},a.id))})]}),Object.entries(H).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex items-center justify-center h-8 w-8 rounded-lg bg-brand-bg/10 border border-brand-bg/30",children:function(a){switch(a){case"fi":return(0,b.jsx)(aN.PiggyBank,{className:"h-4 w-4"});case"core":return(0,b.jsx)(az.Zap,{className:"h-4 w-4"});default:return(0,b.jsx)(ai.Plus,{className:"h-4 w-4"})}}(a)}),(0,b.jsx)("div",{children:(0,b.jsx)("h3",{className:"text-base font-semibold text-content-primary",children:w[a]||"Add-ons"})})]}),(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-3 lg:grid-cols-4",children:c.map(a=>{let c=Math.round(a.priceAmount/100),d=F(a.key),e=!!(a.requires&&!F(a.requires)),i=n===a.key;return(0,b.jsxs)(f.Card,{className:(0,aM.default)("group relative overflow-hidden rounded-xl flex flex-col transition-all duration-300",d?"border-2 border-brand-bg bg-brand-bg/5":"border border-line-primary bg-surface-secondary/95",e&&"opacity-50"),children:[(0,b.jsxs)("div",{className:"absolute top-3 right-3 flex gap-1",children:[d&&(0,b.jsx)(h.Badge,{variant:"default",className:"bg-brand-bg text-white text-[10px]",children:"Active"}),a.recommended&&!d&&(0,b.jsx)(h.Badge,{variant:"secondary",className:"bg-brand-bg/10 text-brand-bg border-brand-bg/30 text-[10px]",children:"Recommended"})]}),(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:(0,aM.default)("flex items-center justify-center h-10 w-10 rounded-lg transition-colors",d?"bg-brand-bg text-white":"bg-surface-tertiary border border-line-secondary"),children:function(a){switch(a){case"support":return(0,b.jsx)(aO,{className:"h-3 w-3"});case"branding":return(0,b.jsx)(aP.Palette,{className:"h-3 w-3"});case"finance":return(0,b.jsx)(aN.PiggyBank,{className:"h-3 w-3"});default:return(0,b.jsx)(az.Zap,{className:"h-3 w-3"})}}(a.addonType)}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)(f.CardTitle,{className:"text-base font-semibold text-content-primary truncate",children:a.title}),(0,b.jsx)(f.CardDescription,{className:"text-xs text-content-secondary line-clamp-2 mt-1",children:a.description})]})]})}),(0,b.jsxs)(f.CardContent,{className:"flex-1 space-y-4 pb-3",children:[(0,b.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,b.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-b from-neutral-header to-neutral-fg-tertiary bg-clip-text text-transparent",children:(0,q.formatCurrency)(c,a.currency)}),(0,b.jsxs)("span",{className:"text-sm text-content-tertiary",children:["/","one_time"===a.interval?"one-time":"month"]})]}),e&&(0,b.jsxs)("div",{className:"text-xs text-warning-fg bg-warning-bg/10 border border-warning-border/30 rounded-md px-2 py-1.5",children:["Requires ",a.requires," addon"]}),(0,b.jsxs)("ul",{className:"space-y-1.5",children:[a.features.slice(0,3).map(a=>(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"flex-shrink-0 inline-flex h-4 w-4 items-center justify-center rounded-full bg-brand-bg/10 border border-brand-bg/30 mt-0.5",children:(0,b.jsx)(v.Check,{className:"h-2.5 w-2.5 text-brand-bg",strokeWidth:2.5})}),(0,b.jsx)("span",{className:"text-xs text-content-primary leading-relaxed",children:a})]},a)),a.features.length>3&&(0,b.jsxs)("li",{className:"text-xs text-content-tertiary pl-6",children:["+",a.features.length-3," more features"]})]})]}),(0,b.jsx)(f.CardFooter,{className:"pt-0 pb-4",children:(0,b.jsx)(g.Button,{variant:d?"outline":"default",size:"sm",className:(0,aM.default)("w-full transition-all",!d&&"bg-brand-gradient hover:bg-brand-gradient-hover"),onClick:()=>(a=>{if(F(a.key))G(a);else D({key:a.key,type:"addon",title:a.title,description:a.description,price:a.price,priceAmount:a.priceAmount,priceId:a.priceId,interval:a.interval,features:a.features})})(a),disabled:e||i,children:i?(0,b.jsx)(y.Loader2,{className:"h-4 w-4 animate-spin"}):d?"Remove Add-on":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ai.Plus,{className:"h-4 w-4 mr-1.5"}),"Add to Subscription"]})})})]},a.key)})})]},a))]})]})},a9=["subscription","payment-methods","usage","credits","promotional","addons"],ba=({scope:a,scopeId:c,section:d})=>{switch(d){case"subscription":default:return(0,b.jsx)(O,{scope:a,scopeId:c});case"payment-methods":return(0,b.jsx)(au,{scope:a,scopeId:c,showInvoices:!0,showDunning:!0});case"usage":return(0,b.jsx)(aL,{scope:a,scopeId:c});case"credits":case"promotional":return(0,b.jsx)(aE,{scope:a,scopeId:c,showCredits:!0,showCoupons:!0});case"addons":return(0,b.jsx)(a8,{scope:a,scopeId:c})}},bb=({scope:a,scopeId:c,section:d,className:e})=>{let f=d&&a9.includes(d)?d:"subscription";return(0,b.jsx)("div",{className:e,children:(0,b.jsx)(ba,{scope:a,scopeId:c,section:f})})};a.s(["BillingClient",()=>bb,"default",0,bb],745694)}];

//# sourceMappingURL=src_components_features_core_billing_client_tsx_af00155b._.js.map