module.exports=[730780,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(441921),e=a.i(591119),f=a.i(695245),g=a.i(866718),h=a.i(699570),i=a.i(187624),j=a.i(539726),k=a.i(125581),l=a.i(496749),m=a.i(878125),n=a.i(864527),o=a.i(50944),p=a.i(159501);a.s(["default",0,({defaultData:a,subAccountId:q})=>{let{data:r,isOpen:s,setOpen:t,setClose:u}=(0,n.useModal)(),v=(0,o.useRouter)(),w=(0,f.useForm)({mode:"onChange",resolver:(0,p.zodResolver)(j.CreatePipelineFormSchema),defaultValues:{name:a?.name||""}});(0,c.useEffect)(()=>{a&&w.reset({name:a.name||""})},[a]);let x=w.formState.isLoading,y=async b=>{if(q){try{let c=await (0,l.upsertPipeline)({...b,id:a?.id,subAccountId:q});await (0,k.saveActivityLogsNotification)({agencyId:void 0,description:`Updates a pipeline | ${c?.name}`,subaccountId:q}),(0,m.toast)({title:"Success",description:"Saved pipeline details"}),v.refresh()}catch(a){(0,m.toast)({variant:"destructive",title:"Oppse!",description:"Could not save pipeline details"})}u()}};return(0,b.jsxs)(e.Card,{className:"w-full ",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{children:"Pipeline Details"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(d.Form,{...w,children:(0,b.jsxs)("form",{onSubmit:w.handleSubmit(y),className:"flex flex-col gap-4",children:[(0,b.jsx)(d.FormField,{disabled:x,control:w.control,name:"name",render:({field:a})=>(0,b.jsxs)(d.FormItem,{children:[(0,b.jsx)(d.FormLabel,{children:"Pipeline Name"}),(0,b.jsx)(d.FormControl,{children:(0,b.jsx)(g.Input,{placeholder:"Name",...a})}),(0,b.jsx)(d.FormMessage,{})]})}),(0,b.jsx)(h.Button,{className:"w-20 mt-4",disabled:x,type:"submit",children:w.formState.isSubmitting?(0,b.jsx)(i.default,{}):"Save"})]})})})]})}])},107703,a=>{"use strict";var b=a.i(187924),c=a.i(730780),d=a.i(874235),e=a.i(699570),f=a.i(419622),g=a.i(599209),h=a.i(368114),i=a.i(864527),j=a.i(533441),k=a.i(737539),l=a.i(915618),m=a.i(238246),n=a.i(572131);a.s(["default",0,({pipelineId:a,pipelines:o,subAccountId:p})=>{let{setOpen:q,setClose:r}=(0,i.useModal)(),[s,t]=n.default.useState(!1),[u,v]=n.default.useState(a);return(0,b.jsx)("div",{children:(0,b.jsx)("div",{className:"flex items-end gap-2",children:(0,b.jsxs)(g.Popover,{open:s,onOpenChange:t,children:[(0,b.jsx)(g.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(e.Button,{variant:"outline",role:"combobox","aria-expanded":s,className:"w-[200px] justify-between",children:[u?o.find(a=>a.id===u)?.name:"Select a pipeline...",(0,b.jsx)(k.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,b.jsx)(g.PopoverContent,{className:"w-[200px] p-0",children:(0,b.jsxs)(f.Command,{children:[(0,b.jsx)(f.CommandEmpty,{children:"No pipelines found."}),(0,b.jsxs)(f.CommandGroup,{children:[o.map(a=>(0,b.jsx)(m.default,{href:`/subaccount/${p}/pipelines/${a.id}`,children:(0,b.jsxs)(f.CommandItem,{value:a.id,onSelect:a=>{v(a),t(!1)},children:[(0,b.jsx)(j.Check,{className:(0,h.cn)("mr-2 h-4 w-4",u===a.id?"opacity-100":"opacity-0")}),a.name]},a.id)},a.id)),(0,b.jsxs)(e.Button,{variant:"secondary",className:"flex gap-2 w-full mt-4",onClick:()=>{q((0,b.jsx)(d.default,{title:"Create A Pipeline",subheading:"Pipelines allows you to group tickets into lanes and track your business processes all in one place.",children:(0,b.jsx)(c.default,{subAccountId:p})}))},children:[(0,b.jsx)(l.Plus,{size:15}),"Create Pipeline"]})]})]})})]})})})}])},877580,a=>{"use strict";var b=a.i(187924),c=a.i(730780),d=a.i(699570),e=a.i(486192),f=a.i(897882),g=a.i(878125),h=a.i(50944);a.s(["default",0,({pipelineId:a,subaccountId:i,pipelines:j})=>{let k=(0,h.useRouter)();return(0,b.jsx)(e.AlertDialog,{children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)(e.AlertDialogTrigger,{asChild:!0,children:(0,b.jsx)(d.Button,{variant:"destructive",children:"Delete Pipeline"})}),(0,b.jsxs)(e.AlertDialogContent,{children:[(0,b.jsxs)(e.AlertDialogHeader,{children:[(0,b.jsx)(e.AlertDialogTitle,{children:"Are you absolutely sure?"}),(0,b.jsx)(e.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete your account and remove your data from our servers."})]}),(0,b.jsxs)(e.AlertDialogFooter,{className:"items-center",children:[(0,b.jsx)(e.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(e.AlertDialogAction,{onClick:async()=>{try{await (0,f.deletePipeline)(a),(0,g.toast)({title:"Deleted",description:"Pipeline is deleted"}),k.replace(`/subaccount/${i}/pipelines`)}catch(a){(0,g.toast)({variant:"destructive",title:"Oppse!",description:"Could Delete Pipeline"})}},children:"Delete"})]})]})]}),(0,b.jsx)(c.default,{subAccountId:i,defaultData:j.find(b=>b.id===a)})]})})}])},968684,a=>{"use strict";var b,c=a.i(187924),d=a.i(572131),e=a.i(441921),f=a.i(591119),g=a.i(695245),h=a.i(866718),i=a.i(699570),j=a.i(187624),k=a.i(539726),l=a.i(5112),m=a.i(125581),n=a.i(183587),o=a.i(878125),p=a.i(864527),q=a.i(50944),r=a.i(159501);let s=({defaultData:a,pipelineId:b})=>{let{setClose:s}=(0,p.useModal)(),t=(0,q.useRouter)(),u=(0,g.useForm)({mode:"onChange",resolver:(0,r.zodResolver)(k.LaneFormSchema),defaultValues:{name:a?.name||""}});(0,d.useEffect)(()=>{a&&u.reset({name:a.name||""})},[a]);let v=u.formState.isLoading,w=async c=>{if(b){try{let d=await (0,n.upsertLane)({...c,id:a?.id,pipelineId:b,order:a?.order}),e=await (0,l.getPipelineDetails)(b);if(!e)return;await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Updated a lane | ${d?.name}`,subaccountId:e.subAccountId}),(0,o.toast)({title:"Success",description:"Saved pipeline details"}),t.refresh()}catch(a){(0,o.toast)({variant:"destructive",title:"Oppse!",description:"Could not save pipeline details"})}s()}};return(0,c.jsxs)(f.Card,{className:"w-full ",children:[(0,c.jsx)(f.CardHeader,{children:(0,c.jsx)(f.CardTitle,{children:"Lane Details"})}),(0,c.jsx)(f.CardContent,{children:(0,c.jsx)(e.Form,{...u,children:(0,c.jsxs)("form",{onSubmit:u.handleSubmit(w),className:"flex flex-col gap-4",children:[(0,c.jsx)(e.FormField,{disabled:v,control:u.control,name:"name",render:({field:a})=>(0,c.jsxs)(e.FormItem,{children:[(0,c.jsx)(e.FormLabel,{children:"Lane Name"}),(0,c.jsx)(e.FormControl,{children:(0,c.jsx)(h.Input,{placeholder:"Lane Name",...a})}),(0,c.jsx)(e.FormMessage,{})]})}),(0,c.jsx)(i.Button,{className:"w-20 mt-4",disabled:v,type:"submit",children:u.formState.isSubmitting?(0,c.jsx)(j.default,{}):"Save"})]})})})]})};var t=a.i(874235),u=a.i(170106);let v=(0,u.default)("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]]);var w=a.i(915618),x=a.i(891270),y=a.i(486192),z=a.i(786304),A=a.i(335732),B=a.i(5111),C=a.i(368114),D=a.i(824569),E=a.i(879360),F=a.i(509211),G=a.i(217201),H=a.i(66481),I=a.i(168473),J=a.i(188614),K=a.i(429246),L=a.i(580701),M=a.i(872233),N=a.i(234157),N=N,O=a.i(864462),O=O;let P=(0,u.default)("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);var Q=a.i(599209),R=a.i(419622),S=a.i(298621);let T=({colorName:a,title:b,selectedColor:d})=>(0,c.jsx)("div",{className:(0,S.default)("p-2 rounded-sm flex-shrink-0 text-xs cursor-pointer",{"bg-[#57acea]/10 text-[#57acea]":"BLUE"===a,"bg-[#ffac7e]/10 text-[#ffac7e]":"ORANGE"===a,"bg-rose-500/10 text-rose-500":"ROSE"===a,"bg-emerald-400/10 text-emerald-400":"GREEN"===a,"bg-purple-400/10 text-purple-400":"PURPLE"===a,"border-[1px] border-[#57acea]":"BLUE"===a&&!b,"border-[1px] border-[#ffac7e]":"ORANGE"===a&&!b,"border-[1px] border-rose-500":"ROSE"===a&&!b,"border-[1px] border-emerald-400":"GREEN"===a&&!b,"border-[1px] border-purple-400":"PURPLE"===a&&!b}),onClick:()=>{d&&d(a)},children:b},a);var U=a.i(892692),U=U,V=a.i(633508),W=a.i(970806),X=a.i(838891),Y=a.i(19010),Z=a.i(688);let $=["BLUE","ORANGE","ROSE","PURPLE","GREEN"],_=({getSelectedTags:a,subAccountId:b,defaultTags:e})=>{let[f,g]=(0,d.useState)(e||[]),[h,i]=(0,d.useState)([]),j=(0,q.useRouter)(),[k,l]=(0,d.useState)(""),[n,p]=(0,d.useState)("");(0,d.useEffect)(()=>{a(f)},[f]),(0,d.useEffect)(()=>{b&&(async()=>{let a=await (0,Y.getTagsForSubaccount)(b);a&&i(a.Tags)})()},[b]);let r=async()=>{if(!k)return void(0,o.toast)({variant:"destructive",title:"Tags need to have a name"});if(!n)return void(0,o.toast)({variant:"destructive",title:"Please Select a color"});let a={color:n,createdAt:new Date,id:(0,W.v4)(),name:k,subAccountId:b,updatedAt:new Date};i([...h,a]),l(""),p("");try{let c=await (0,Z.upsertTag)(b,a);(0,o.toast)({title:"Created the tag"}),await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Updated a tag | ${c?.name}`,subaccountId:b})}catch(a){(0,o.toast)({variant:"destructive",title:"Could not create tag"})}},s=async a=>{i(h.filter(b=>b.id!==a));try{let c=await (0,X.deleteTag)(a);(0,o.toast)({title:"Deleted tag",description:"The tag is deleted from your subaccount."}),await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Deleted a tag | ${c?.name}`,subaccountId:b}),j.refresh()}catch(a){(0,o.toast)({variant:"destructive",title:"Could not delete tag"})}};return(0,c.jsx)(y.AlertDialog,{children:(0,c.jsxs)(R.Command,{className:"bg-transparent",children:[!!f.length&&(0,c.jsx)("div",{className:"flex flex-wrap gap-2 p-2 bg-background border-2 border rounded-md",children:f.map(a=>(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)(T,{title:a.name,colorName:a.color}),(0,c.jsx)(V.X,{size:14,className:"text-muted-foreground cursor-pointer",onClick:()=>{var b;return b=a.id,void g(f.filter(a=>a.id!==b))}})]},a.id))}),(0,c.jsx)("div",{className:"flex items-center gap-2 my-2",children:$.map(a=>(0,c.jsx)(T,{selectedColor:p,title:"",colorName:a},a))}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)(R.CommandInput,{placeholder:"Search for tag...",value:k,onValueChange:l}),(0,c.jsx)(F.PlusCircleIcon,{onClick:r,size:20,className:"absolute top-1/2 transform -translate-y-1/2 right-2 icon-interactive"})]}),(0,c.jsxs)(R.CommandList,{children:[(0,c.jsx)(R.CommandSeparator,{}),(0,c.jsx)(R.CommandGroup,{heading:"Tags",children:h.map(a=>(0,c.jsxs)(R.CommandItem,{className:"command-item flex items-center justify-between !font-light",children:[(0,c.jsx)("div",{onClick:()=>{f.every(b=>b.id!==a.id)&&g([...f,a])},children:(0,c.jsx)(T,{title:a.name,colorName:a.color})}),(0,c.jsx)(y.AlertDialogTrigger,{children:(0,c.jsx)(U.default,{size:16,className:"icon-destructive"})}),(0,c.jsxs)(y.AlertDialogContent,{children:[(0,c.jsxs)(y.AlertDialogHeader,{children:[(0,c.jsx)(y.AlertDialogTitle,{className:"text-left",children:"Are you absolutely sure?"}),(0,c.jsx)(y.AlertDialogDescription,{className:"text-left",children:"This action cannot be undone. This will permanently delete your the tag and remove it from our servers."})]}),(0,c.jsxs)(y.AlertDialogFooter,{className:"items-center",children:[(0,c.jsx)(y.AlertDialogCancel,{children:"Cancel"}),(0,c.jsx)(y.AlertDialogAction,{className:"bg-destructive",onClick:()=>s(a.id),children:"Delete Tag"})]})]})]},a.id))}),(0,c.jsx)(R.CommandEmpty,{children:"No results found."})]})]})})},aa=({getNewTicket:a,laneId:b,subaccountId:l})=>{let{data:n,setClose:s}=(0,p.useModal)(),t=(0,q.useRouter)(),[u,v]=(0,d.useState)([]),[w,x]=(0,d.useState)(""),[y,z]=(0,d.useState)(""),[A,B]=(0,d.useState)([]),D=(0,d.useRef)(null),[E,F]=(0,d.useState)([]),[G,S]=(0,d.useState)(n.ticket?.Assigned?.id||""),T=(0,g.useForm)({mode:"onChange",resolver:(0,r.zodResolver)(k.TicketFormSchema),defaultValues:{name:n.ticket?.name||"",description:n.ticket?.description||"",value:String(n.ticket?.value||0)}}),U=T.formState.isLoading;(0,d.useEffect)(()=>{l&&(async()=>{let a=await (0,H.getSubAccountTeamMembers)(l);a&&F(a)})()},[l]),(0,d.useEffect)(()=>{n.ticket&&(T.reset({name:n.ticket.name||"",description:n.ticket?.description||"",value:String(n.ticket?.value||0)}),n.ticket.customerId&&x(n.ticket.customerId),(async()=>{B(await (0,I.searchContacts)(n.ticket?.Customer?.name))})())},[n]);let V=async c=>{if(b){try{let d=await (0,J.upsertTicket)({...c,laneId:b,id:n.ticket?.id,assignedUserId:G,...w?{customerId:w}:{}},u);await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Updated a ticket | ${d?.name}`,subaccountId:l}),(0,o.toast)({title:"Success",description:"Saved  details"}),d&&a(d),t.refresh()}catch(a){(0,o.toast)({variant:"destructive",title:"Oppse!",description:"Could not save pipeline details"})}s()}};return(0,c.jsxs)(f.Card,{className:"w-full",children:[(0,c.jsx)(f.CardHeader,{children:(0,c.jsx)(f.CardTitle,{children:"Ticket Details"})}),(0,c.jsx)(f.CardContent,{children:(0,c.jsx)(e.Form,{...T,children:(0,c.jsxs)("form",{onSubmit:T.handleSubmit(V),className:"flex flex-col gap-4",children:[(0,c.jsx)(e.FormField,{disabled:U,control:T.control,name:"name",render:({field:a})=>(0,c.jsxs)(e.FormItem,{children:[(0,c.jsx)(e.FormLabel,{children:"Ticket Name"}),(0,c.jsx)(e.FormControl,{children:(0,c.jsx)(h.Input,{placeholder:"Name",...a})}),(0,c.jsx)(e.FormMessage,{})]})}),(0,c.jsx)(e.FormField,{disabled:U,control:T.control,name:"description",render:({field:a})=>(0,c.jsxs)(e.FormItem,{children:[(0,c.jsx)(e.FormLabel,{children:"Description"}),(0,c.jsx)(e.FormControl,{children:(0,c.jsx)(K.Textarea,{placeholder:"Description",...a})}),(0,c.jsx)(e.FormMessage,{})]})}),(0,c.jsx)(e.FormField,{disabled:U,control:T.control,name:"value",render:({field:a})=>(0,c.jsxs)(e.FormItem,{children:[(0,c.jsx)(e.FormLabel,{children:"Ticket Value"}),(0,c.jsx)(e.FormControl,{children:(0,c.jsx)(h.Input,{placeholder:"Value",...a})}),(0,c.jsx)(e.FormMessage,{})]})}),(0,c.jsx)("h3",{children:"Add tags"}),(0,c.jsx)(_,{subAccountId:l,getSelectedTags:v,defaultTags:n.ticket?.Tags||[]}),(0,c.jsx)(e.FormLabel,{children:"Assigned To Team Member"}),(0,c.jsxs)(L.Select,{onValueChange:S,defaultValue:G,children:[(0,c.jsx)(L.SelectTrigger,{children:(0,c.jsx)(L.SelectValue,{placeholder:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsxs)(M.Avatar,{className:"w-8 h-8",children:[(0,c.jsx)(M.AvatarImage,{alt:"contact"}),(0,c.jsx)(M.AvatarFallback,{className:"bg-primary text-sm text-white",children:(0,c.jsx)(P,{size:14})})]}),(0,c.jsx)("span",{className:"text-sm text-muted-foreground",children:"Not Assigned"})]})})}),(0,c.jsx)(L.SelectContent,{children:E.map(a=>(0,c.jsx)(L.SelectItem,{value:a.id,children:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsxs)(M.Avatar,{className:"w-8 h-8",children:[(0,c.jsx)(M.AvatarImage,{alt:"contact",src:a.avatarUrl||""}),(0,c.jsx)(M.AvatarFallback,{className:"bg-primary text-sm text-white",children:(0,c.jsx)(P,{size:14})})]}),(0,c.jsx)("span",{className:"text-sm text-muted-foreground",children:a.name})]})},a.id))})]}),(0,c.jsx)(e.FormLabel,{children:"Customer"}),(0,c.jsxs)(Q.Popover,{children:[(0,c.jsx)(Q.PopoverTrigger,{asChild:!0,className:"w-full",children:(0,c.jsxs)(i.Button,{variant:"outline",role:"combobox",className:"justify-between",children:[w?A.find(a=>a.id===w)?.name:"Select Customer...",(0,c.jsx)(O.default,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,c.jsx)(Q.PopoverContent,{className:"w-[400px] p-0",children:(0,c.jsxs)(R.Command,{children:[(0,c.jsx)(R.CommandInput,{placeholder:"Search...",className:"h-9",value:y,onChangeCapture:async a=>{z(a.target.value),D.current&&clearTimeout(D.current),D.current=setTimeout(async()=>{B(await (0,I.searchContacts)(a.target.value)),z("")},1e3)}}),(0,c.jsx)(R.CommandEmpty,{children:"No Customer found."}),(0,c.jsx)(R.CommandGroup,{children:A.map(a=>(0,c.jsxs)(R.CommandItem,{value:a.id,onSelect:a=>{x(a===w?"":a)},children:[a.name,(0,c.jsx)(N.default,{className:(0,C.cn)("ml-auto h-4 w-4",w===a.id?"opacity-100":"opacity-0")})]},a.id))})]})})]}),(0,c.jsx)(i.Button,{className:"w-20 mt-4",disabled:U,type:"submit",children:T.formState.isSubmitting?(0,c.jsx)(j.default,{}):"Save"})]})})})]})};var ab=a.i(840851),ac=a.i(507554),ad=a.i(750104),ae=a.i(225152),af=a.i(470121),ag=a.i(704691),ah=(a.i(692616),a.i(777192)),ai=a.i(30553),aj=a.i(596743),ak="HoverCard",[al,am]=(0,ad.createContextScope)(ak,[ag.createPopperScope]),an=(0,ag.createPopperScope)(),[ao,ap]=al(ak),aq=a=>{let{__scopeHoverCard:b,children:e,open:f,defaultOpen:g,onOpenChange:h,openDelay:i=700,closeDelay:j=300}=a,k=an(b),l=d.useRef(0),m=d.useRef(0),n=d.useRef(!1),o=d.useRef(!1),[p,q]=(0,ae.useControllableState)({prop:f,defaultProp:g??!1,onChange:h,caller:ak}),r=d.useCallback(()=>{clearTimeout(m.current),l.current=window.setTimeout(()=>q(!0),i)},[i,q]),s=d.useCallback(()=>{clearTimeout(l.current),n.current||o.current||(m.current=window.setTimeout(()=>q(!1),j))},[j,q]),t=d.useCallback(()=>q(!1),[q]);return d.useEffect(()=>()=>{clearTimeout(l.current),clearTimeout(m.current)},[]),(0,c.jsx)(ao,{scope:b,open:p,onOpenChange:q,onOpen:r,onClose:s,onDismiss:t,hasSelectionRef:n,isPointerDownOnContentRef:o,children:(0,c.jsx)(ag.Root,{...k,children:e})})};aq.displayName=ak;var ar="HoverCardTrigger",as=d.forwardRef((a,b)=>{let{__scopeHoverCard:d,...e}=a,f=ap(ar,d),g=an(d);return(0,c.jsx)(ag.Anchor,{asChild:!0,...g,children:(0,c.jsx)(ai.Primitive.a,{"data-state":f.open?"open":"closed",...e,ref:b,onPointerEnter:(0,ac.composeEventHandlers)(a.onPointerEnter,ay(f.onOpen)),onPointerLeave:(0,ac.composeEventHandlers)(a.onPointerLeave,ay(f.onClose)),onFocus:(0,ac.composeEventHandlers)(a.onFocus,f.onOpen),onBlur:(0,ac.composeEventHandlers)(a.onBlur,f.onClose),onTouchStart:(0,ac.composeEventHandlers)(a.onTouchStart,a=>a.preventDefault())})})});as.displayName=ar;var[at,au]=al("HoverCardPortal",{forceMount:void 0}),av="HoverCardContent",aw=d.forwardRef((a,b)=>{let d=au(av,a.__scopeHoverCard),{forceMount:e=d.forceMount,...f}=a,g=ap(av,a.__scopeHoverCard);return(0,c.jsx)(ah.Presence,{present:e||g.open,children:(0,c.jsx)(ax,{"data-state":g.open?"open":"closed",...f,onPointerEnter:(0,ac.composeEventHandlers)(a.onPointerEnter,ay(g.onOpen)),onPointerLeave:(0,ac.composeEventHandlers)(a.onPointerLeave,ay(g.onClose)),ref:b})})});aw.displayName=av;var ax=d.forwardRef((a,e)=>{let{__scopeHoverCard:f,onEscapeKeyDown:g,onPointerDownOutside:h,onFocusOutside:i,onInteractOutside:j,...k}=a,l=ap(av,f),m=an(f),n=d.useRef(null),o=(0,af.useComposedRefs)(e,n),[p,q]=d.useState(!1);return d.useEffect(()=>{if(p){let a=document.body;return b=a.style.userSelect||a.style.webkitUserSelect,a.style.userSelect="none",a.style.webkitUserSelect="none",()=>{a.style.userSelect=b,a.style.webkitUserSelect=b}}},[p]),d.useEffect(()=>{if(n.current){let a=()=>{q(!1),l.isPointerDownOnContentRef.current=!1,setTimeout(()=>{document.getSelection()?.toString()!==""&&(l.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",a),()=>{document.removeEventListener("pointerup",a),l.hasSelectionRef.current=!1,l.isPointerDownOnContentRef.current=!1}}},[l.isPointerDownOnContentRef,l.hasSelectionRef]),d.useEffect(()=>{n.current&&(function(a){let b=[],c=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;c.nextNode();)b.push(c.currentNode);return b})(n.current).forEach(a=>a.setAttribute("tabindex","-1"))}),(0,c.jsx)(aj.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:j,onEscapeKeyDown:g,onPointerDownOutside:h,onFocusOutside:(0,ac.composeEventHandlers)(i,a=>{a.preventDefault()}),onDismiss:l.onDismiss,children:(0,c.jsx)(ag.Content,{...m,...k,onPointerDown:(0,ac.composeEventHandlers)(k.onPointerDown,a=>{a.currentTarget.contains(a.target)&&q(!0),l.hasSelectionRef.current=!1,l.isPointerDownOnContentRef.current=!0}),ref:o,style:{...k.style,userSelect:p?"text":void 0,WebkitUserSelect:p?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})});function ay(a){return b=>"touch"===b.pointerType?void 0:a()}d.forwardRef((a,b)=>{let{__scopeHoverCard:d,...e}=a,f=an(d);return(0,c.jsx)(ag.Arrow,{...f,...e,ref:b})}).displayName="HoverCardArrow";let az=d.forwardRef(({className:a,align:b="center",sideOffset:d=4,...e},f)=>(0,c.jsx)(aw,{ref:f,align:b,sideOffset:d,className:(0,C.cn)("z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...e}));az.displayName=aw.displayName;var aA=a.i(590815),aB=a.i(107081),aB=aB,aC=a.i(281828),aC=aC;let aD=({allTickets:a,index:b,setAllTickets:d,subaccountId:e,ticket:g})=>{let h=(0,q.useRouter)(),{setOpen:i,data:j}=(0,p.useModal)(),k=b=>{d(c=>a.map(a=>a.id===b.id?b:a))},l=async()=>{i((0,c.jsx)(t.default,{title:"Update Ticket Details",subheading:"",children:(0,c.jsx)(aa,{getNewTicket:k,laneId:g.laneId,subaccountId:e})}),async()=>({ticket:g}))},n=async()=>{try{d(a=>a.filter(a=>a.id!==g.id));let a=await (0,aA.deleteTicket)(g.id);(0,o.toast)({title:"Deleted",description:"Deleted ticket from lane."}),await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Deleted a ticket | ${a?.name}`,subaccountId:e}),h.refresh()}catch(a){(0,o.toast)({variant:"destructive",title:"Oppse!",description:"Could not delete the ticket."}),console.log(a)}};return(0,c.jsx)(x.Draggable,{draggableId:g.id.toString(),index:b,children:(a,b)=>{if(b.isDragging){let b=a.draggableProps.style?.left-300,c=a.draggableProps.style?.top-20;a.draggableProps.style={...a.draggableProps.style,top:c,left:b}}return(0,c.jsx)("div",{...a.draggableProps,...a.dragHandleProps,ref:a.innerRef,children:(0,c.jsx)(y.AlertDialog,{children:(0,c.jsxs)(A.DropdownMenu,{children:[(0,c.jsxs)(f.Card,{className:"my-4 bg-card shadow-none transition-all",children:[(0,c.jsxs)(f.CardHeader,{className:"p-[12px]",children:[(0,c.jsxs)(f.CardTitle,{className:"flex items-center justify-between",children:[(0,c.jsx)("span",{className:"text-lg w-full",children:g.name}),(0,c.jsx)(A.DropdownMenuTrigger,{children:(0,c.jsx)(aC.default,{className:"text-muted-foreground"})})]}),(0,c.jsx)("span",{className:"text-muted-foreground text-xs",children:new Date().toLocaleDateString()}),(0,c.jsx)("div",{className:"flex items-center flex-wrap gap-2",children:g.Tags.map(a=>(0,c.jsx)(T,{title:a.name,colorName:a.color},a.id))}),(0,c.jsx)(f.CardDescription,{className:"w-full ",children:g.description}),(0,c.jsxs)(aq,{children:[(0,c.jsx)(as,{asChild:!0,children:(0,c.jsxs)("div",{className:"p-2 text-muted-foreground flex gap-2 hover:bg-muted transition-all rounded-lg cursor-pointer items-center",children:[(0,c.jsx)(ab.default,{}),(0,c.jsx)("span",{className:"text-xs font-bold",children:"CONTACT"})]})}),(0,c.jsx)(az,{side:"right",className:"w-fit",children:(0,c.jsxs)("div",{className:"flex justify-between space-x-4",children:[(0,c.jsxs)(M.Avatar,{children:[(0,c.jsx)(M.AvatarImage,{}),(0,c.jsx)(M.AvatarFallback,{className:"bg-primary",children:g.Customer?.name.slice(0,2).toUpperCase()})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("h4",{className:"text-sm font-semibold",children:g.Customer?.name}),(0,c.jsx)("p",{className:"text-sm text-muted-foreground",children:g.Customer?.email}),(0,c.jsxs)("div",{className:"flex items-center pt-2",children:[(0,c.jsx)(aB.default,{className:"mr-2 h-4 w-4 opacity-70"}),(0,c.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Joined"," ",g.Customer?.createdAt.toLocaleDateString()]})]})]})]})})]})]}),(0,c.jsxs)(f.CardFooter,{className:"m-0 p-2 border-t-[1px] border-muted-foreground/20 flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex item-center gap-2",children:[(0,c.jsxs)(M.Avatar,{className:"w-8 h-8",children:[(0,c.jsx)(M.AvatarImage,{alt:"contact",src:g.Assigned?.avatarUrl||""}),(0,c.jsxs)(M.AvatarFallback,{className:"bg-primary text-sm text-white",children:[g.Assigned?.name,!g.assignedUserId&&(0,c.jsx)(P,{size:14})]})]}),(0,c.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,c.jsx)("span",{className:"text-sm text-muted-foreground",children:g.assignedUserId?"Assigned to":"Not Assigned"}),g.assignedUserId&&(0,c.jsx)("span",{className:"text-xs w-28  overflow-ellipsis overflow-hidden whitespace-nowrap text-muted-foreground",children:g.Assigned?.name})]})]}),(0,c.jsx)("span",{className:"text-sm font-bold",children:!!g.value&&new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(+g.value)})]}),(0,c.jsxs)(A.DropdownMenuContent,{children:[(0,c.jsx)(A.DropdownMenuLabel,{children:"Options"}),(0,c.jsx)(A.DropdownMenuSeparator,{}),(0,c.jsx)(y.AlertDialogTrigger,{children:(0,c.jsxs)(A.DropdownMenuItem,{className:"flex items-center gap-2",children:[(0,c.jsx)(G.Trash,{size:15}),"Delete Ticket"]})}),(0,c.jsxs)(A.DropdownMenuItem,{className:"flex items-center gap-2",onClick:l,children:[(0,c.jsx)(D.Edit,{size:15}),"Edit Ticket"]})]})]}),(0,c.jsxs)(y.AlertDialogContent,{children:[(0,c.jsxs)(y.AlertDialogHeader,{children:[(0,c.jsx)(y.AlertDialogTitle,{children:"Are you absolutely sure?"}),(0,c.jsx)(y.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete the ticket and remove it from our servers."})]}),(0,c.jsxs)(y.AlertDialogFooter,{className:"flex items-center",children:[(0,c.jsx)(y.AlertDialogCancel,{children:"Cancel"}),(0,c.jsx)(y.AlertDialogAction,{className:"bg-destructive",onClick:n,children:"Delete"})]})]})]})})})}})},aE=({setAllTickets:a,tickets:b,pipelineId:e,laneDetails:f,subaccountId:g,allTickets:h,index:i})=>{let{setOpen:j}=(0,p.useModal)(),k=(0,q.useRouter)(),l=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}),n=(0,d.useMemo)(()=>(console.log(b),b.reduce((a,b)=>a+(Number(b?.value)||0),0)),[b]),o=`#${Math.random().toString(16).slice(2,8)}`,r=b=>{a([...h,b])},u=()=>{j((0,c.jsx)(t.default,{title:"Create A Ticket",subheading:"Tickets are a great way to keep track of tasks",children:(0,c.jsx)(aa,{getNewTicket:r,laneId:f.id,subaccountId:g})}))},v=()=>{j((0,c.jsx)(t.default,{title:"Edit Lane Details",subheading:"",children:(0,c.jsx)(s,{pipelineId:e,defaultData:f})}))},w=async()=>{try{let a=await (0,B.deleteLane)(f.id);await (0,m.saveActivityLogsNotification)({agencyId:void 0,description:`Deleted a lane | ${a?.name}`,subaccountId:g}),k.refresh()}catch(a){console.log(a)}};return(0,c.jsx)(x.Draggable,{draggableId:f.id.toString(),index:i,children:(d,e)=>{if(e.isDragging){let a=d.draggableProps.style?.left-300,b=d.draggableProps.style?.top-0;d.draggableProps.style={...d.draggableProps.style,top:b,left:a}}return(0,c.jsx)("div",{...d.draggableProps,ref:d.innerRef,className:"h-full",children:(0,c.jsx)(y.AlertDialog,{children:(0,c.jsxs)(A.DropdownMenu,{children:[(0,c.jsxs)("div",{className:"bg-bg-secondary/30 h-[700px] w-[300px] px-4 relative rounded-lg overflow-visible flex-shrink-0 ",children:[(0,c.jsx)("div",{...d.dragHandleProps,className:"h-14 backdrop-blur-lg bg-bg-secondary/60 absolute top-0 left-0 right-0 z-10 ",children:(0,c.jsxs)("div",{className:"h-full flex items-center p-4 justify-between cursor-grab border-b-[1px] ",children:[(0,c.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,c.jsx)("div",{className:(0,C.cn)("w-4 h-4 rounded-full"),style:{background:o}}),(0,c.jsx)("span",{className:"font-bold text-sm",children:f.name})]}),(0,c.jsxs)("div",{className:"flex items-center flex-row",children:[(0,c.jsx)(z.Badge,{className:"bg-white text-black",children:l.format(n)}),(0,c.jsx)(A.DropdownMenuTrigger,{children:(0,c.jsx)(E.MoreVertical,{className:"text-muted-foreground cursor-pointer"})})]})]})}),(0,c.jsx)(x.Droppable,{droppableId:f.id.toString(),type:"ticket",children:d=>(0,c.jsx)("div",{className:" max-h-[700px] overflow-scroll pt-12 ",children:(0,c.jsxs)("div",{...d.droppableProps,ref:d.innerRef,className:"mt-2",children:[b.map((b,d)=>(0,c.jsx)(aD,{allTickets:h,setAllTickets:a,subaccountId:g,ticket:b,index:d},b.id.toString())),d.placeholder]})})},f.id),(0,c.jsxs)(A.DropdownMenuContent,{children:[(0,c.jsx)(A.DropdownMenuLabel,{children:"Options"}),(0,c.jsx)(A.DropdownMenuSeparator,{}),(0,c.jsx)(y.AlertDialogTrigger,{children:(0,c.jsxs)(A.DropdownMenuItem,{className:"flex items-center gap-2",children:[(0,c.jsx)(G.Trash,{size:15}),"Delete"]})}),(0,c.jsxs)(A.DropdownMenuItem,{className:"flex items-center gap-2",onClick:v,children:[(0,c.jsx)(D.Edit,{size:15}),"Edit"]}),(0,c.jsxs)(A.DropdownMenuItem,{className:"flex items-center gap-2",onClick:u,children:[(0,c.jsx)(F.PlusCircleIcon,{size:15}),"Create Ticket"]})]})]}),(0,c.jsxs)(y.AlertDialogContent,{children:[(0,c.jsxs)(y.AlertDialogHeader,{children:[(0,c.jsx)(y.AlertDialogTitle,{children:"Are you absolutely sure?"}),(0,c.jsx)(y.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete your account and remove your data from our servers."})]}),(0,c.jsxs)(y.AlertDialogFooter,{className:"flex items-center",children:[(0,c.jsx)(y.AlertDialogCancel,{children:"Cancel"}),(0,c.jsx)(y.AlertDialogAction,{className:"bg-destructive",onClick:w,children:"Continue"})]})]})]})})})}},f.id)};a.s(["default",0,({lanes:a,pipelineDetails:b,pipelineId:e,subaccountId:f,updateLanesOrder:g,updateTicketsOrder:h})=>{let{setOpen:j}=(0,p.useModal)(),k=(0,q.useRouter)(),[l,m]=(0,d.useState)([]);(0,d.useEffect)(()=>{m(a)},[a]);let n=[];a.forEach(a=>{a.Tickets.forEach(a=>{n.push(a)})});let[o,r]=(0,d.useState)(n);return(0,c.jsx)(x.DragDropContext,{onDragEnd:a=>{console.log(a);let{destination:b,source:c,type:d}=a;if(b&&(b.droppableId!==c.droppableId||b.index!==c.index))switch(d){case"lane":{let a=[...l].toSpliced(c.index,1).toSpliced(b.index,0,l[c.index]).map((a,b)=>({...a,order:b}));m(a),g(a)}case"ticket":{let a=[...l],d=a.find(a=>a.id===c.droppableId),e=a.find(a=>a.id===b.droppableId);if(!d||!e)return;if(c.droppableId===b.droppableId){let e=[...d.Tickets].toSpliced(c.index,1).toSpliced(b.index,0,d.Tickets[c.index]).map((a,b)=>({...a,order:b}));d.Tickets=e,m(a),h(e),k.refresh()}else{let[f]=d.Tickets.splice(c.index,1);d.Tickets.forEach((a,b)=>{a.order=b}),e.Tickets.splice(b.index,0,{...f,laneId:b.droppableId}),e.Tickets.forEach((a,b)=>{a.order=b}),m(a),h([...e.Tickets,...d.Tickets]),k.refresh()}}}},children:(0,c.jsxs)("div",{className:"bg-card/60 rounded-xl p-4 use-automation-zoom-in",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h1",{className:"text-2xl",children:b?.name}),(0,c.jsxs)(i.Button,{className:"flex items-center gap-4",onClick:()=>{j((0,c.jsx)(t.default,{title:" Create A Lane",subheading:"Lanes allow you to group tickets",children:(0,c.jsx)(s,{pipelineId:e})}))},children:[(0,c.jsx)(w.Plus,{size:15}),"Create Lane"]})]}),(0,c.jsx)(x.Droppable,{droppableId:"lanes",type:"lane",direction:"horizontal",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,children:a=>(0,c.jsx)("div",{className:"flex item-center gap-x-2 overflow-scroll",...a.droppableProps,ref:a.innerRef,children:(0,c.jsxs)("div",{className:"flex mt-4",children:[l.map((a,b)=>(0,c.jsx)(aE,{allTickets:o,setAllTickets:r,subaccountId:f,pipelineId:e,tickets:a.Tickets,laneDetails:a,index:b},a.id)),a.placeholder]})})},"lanes"),0==l.length&&(0,c.jsx)("div",{className:"flex items-center justify-center w-full flex-col",children:(0,c.jsx)("div",{className:"opacity-100",children:(0,c.jsx)(v,{width:"100%",height:"100%",className:"text-muted-foreground"})})})]})})}],968684)}];

//# sourceMappingURL=src_0db4d14c._.js.map