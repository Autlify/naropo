module.exports=[465368,a=>{"use strict";var b=a.i(187924),c=a.i(206015),d=a.i(478788),e=a.i(452308),f=a.i(864527),g=a.i(587532),h=a.i(866718),i=a.i(699570),j=a.i(874235);function k({columns:a,data:k,filterValue:l,actionButtonText:m,modalChildren:n}){let{setOpen:o}=(0,f.useModal)(),p=(0,d.useReactTable)({data:k,columns:a,getCoreRowModel:(0,e.getCoreRowModel)(),getFilteredRowModel:(0,e.getFilteredRowModel)()});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center py-4 gap-2",children:[(0,b.jsx)(g.Search,{}),(0,b.jsx)(h.Input,{placeholder:"Search Name...",value:p.getColumn(l)?.getFilterValue()??"",onChange:a=>{p.getColumn(l)?.setFilterValue(a.target.value)},className:"h-12"})]}),(0,b.jsx)(i.Button,{className:"flex gap-2",onClick:()=>{n&&o((0,b.jsx)(j.default,{title:"Add a team member",subheading:"Send an invitation",children:n}))},children:m})]}),(0,b.jsx)("div",{className:"border bg-background rounded-lg",children:(0,b.jsxs)(c.Table,{children:[(0,b.jsx)(c.TableHeader,{children:p.getHeaderGroups().map(a=>(0,b.jsx)(c.TableRow,{children:a.headers.map(a=>(0,b.jsx)(c.TableHead,{children:a.isPlaceholder?null:(0,d.flexRender)(a.column.columnDef.header,a.getContext())},a.id))},a.id))}),(0,b.jsx)(c.TableBody,{children:p.getRowModel().rows.length?p.getRowModel().rows.map(a=>(0,b.jsx)(c.TableRow,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(a=>(0,b.jsx)(c.TableCell,{children:(0,d.flexRender)(a.column.columnDef.cell,a.getContext())},a.id))},a.id)):(0,b.jsx)(c.TableRow,{children:(0,b.jsx)(c.TableCell,{colSpan:a.length,className:"h-24 text-center",children:"No Results."})})})]})})]})}a.s(["default",()=>k])},28379,a=>{"use strict";let b=(0,a.i(170106).default)("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);a.s(["UserCog",()=>b],28379)},353160,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(695245),f=a.i(159501),g=a.i(954714),h=a.i(699570),i=a.i(441921),j=a.i(580701),k=a.i(591119),l=a.i(786304),m=a.i(505084),n=a.i(269876),o=a.i(603314),p=a.i(816201),q=a.i(943108),r=a.i(596221),s=a.i(878125),t=a.i(741063);let u=g.object({roleId:g.string().min(1,"Please select a role")});function v({userId:a,agencyId:g,currentRole:v,availableRoles:w,onSuccess:x}){let y=(0,d.useRouter)(),{toast:z}=(0,s.useToast)(),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)([]),E=(0,e.useForm)({resolver:(0,f.zodResolver)(u),defaultValues:{roleId:v?.id||""}});(0,c.useEffect)(()=>{let a=E.watch("roleId");if(a){let b=w.find(b=>b.id===a);b&&D(b.Permissions.map(a=>a.Permission))}},[E.watch("roleId"),w]);let F=async b=>{try{B(!0),await (0,t.updateAgencyMemberRole)(a,g,b.roleId),z({title:"Role Updated",description:"The user role has been successfully updated."}),y.refresh(),x&&x()}catch(a){console.error("Error updating role:",a),z({variant:"destructive",title:"Error",description:a.message||"Failed to update user role. Please try again."})}finally{B(!1)}};return(0,b.jsx)(i.Form,{...E,children:(0,b.jsxs)("form",{onSubmit:E.handleSubmit(F),className:"space-y-6",children:[v&&(0,b.jsxs)(k.Card,{children:[(0,b.jsx)(k.CardHeader,{className:"pb-3",children:(0,b.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Current Role"})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsx)(l.Badge,{className:(a=>{switch(a){case"AGENCY_OWNER":return"bg-emerald-500 text-white";case"AGENCY_ADMIN":return"bg-orange-400 text-white";case"AGENCY_USER":return"bg-blue-500 text-white";default:return"bg-gray-500 text-white"}})(v.name),children:v.name})})]}),(0,b.jsx)(i.FormField,{control:E.control,name:"roleId",render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Assign New Role"}),(0,b.jsxs)(j.Select,{onValueChange:a.onChange,defaultValue:a.value,disabled:A,children:[(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"Select a role"})})}),(0,b.jsx)(j.SelectContent,{children:w.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Shield,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:a.name}),a.isSystem&&(0,b.jsx)(l.Badge,{variant:"outline",className:"ml-2 text-xs",children:"System"})]})},a.id))})]}),(0,b.jsx)(i.FormDescription,{children:"Choose the role that defines this user's permissions within the agency."}),(0,b.jsx)(i.FormMessage,{})]})}),E.watch("roleId")&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Separator,{}),(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Lock,{className:"w-5 h-5 text-muted-foreground"}),(0,b.jsx)(k.CardTitle,{className:"text-lg",children:"Role Permissions"})]}),(0,b.jsx)(k.CardDescription,{children:"This role grants the following permissions"})]}),(0,b.jsx)(k.CardContent,{children:(0,b.jsx)(n.ScrollArea,{className:"h-[200px] w-full pr-4",children:C.length>0?(0,b.jsx)("div",{className:"space-y-2",children:C.map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-muted/50",children:[(0,b.jsx)(p.CheckCircle,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.key}),a.description&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[(0,b.jsx)(q.Lock,{className:"w-12 h-12 text-muted-foreground mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No permissions configured for this role"})]})})})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)(h.Button,{type:"submit",disabled:A||!E.watch("roleId"),className:"flex-1",children:[A&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),A?"Updating...":"Update Role"]})})]})})}a.s(["default",()=>v])},473072,a=>a.a(async(b,c)=>{try{var d=a.i(187924),e=a.i(298621),f=a.i(571987),g=a.i(786304),h=a.i(335732),i=a.i(486192),j=a.i(699570),k=a.i(705151),l=a.i(824569),m=a.i(417755),n=a.i(217201),o=a.i(28379),p=a.i(864527),q=a.i(798364),r=a.i(353160),s=a.i(656837),t=a.i(568781),u=a.i(241803),v=a.i(558615),w=a.i(878125),x=a.i(572131),y=a.i(50944),z=a.i(874235),A=b([q]);[q]=A.then?(await A)():A;let B=[{accessorKey:"id",header:"",cell:()=>null},{accessorKey:"name",header:"Name",cell:({row:a})=>{let b=a.getValue("avatarUrl");return(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("div",{className:"h-11 w-11 relative flex-none",children:(0,d.jsx)(f.default,{src:b||"/assets/autlify-logo.svg",fill:!0,className:"rounded-full object-cover",alt:"avatar image"})}),(0,d.jsx)("span",{children:a.getValue("name")})]})}},{accessorKey:"avatarUrl",header:"",cell:()=>null},{accessorKey:"email",header:"Email"},{accessorKey:"SubAccount",header:"Owned Accounts",cell:({row:a})=>{let b=a.original?.AgencyMemberships?.[0],c=b?.Role?.name==="AGENCY_OWNER",e=a.original?.SubAccountMemberships?.filter(a=>a.isActive)||[];return c?(0,d.jsx)("div",{className:"flex flex-col items-start",children:(0,d.jsx)("div",{className:"flex flex-col gap-2",children:(0,d.jsxs)(g.Badge,{className:"bg-slate-600 whitespace-nowrap",children:["Agency - ",b?.Agency?.name||"Unknown"]})})}):(0,d.jsx)("div",{className:"flex flex-col items-start",children:(0,d.jsx)("div",{className:"flex flex-col gap-2",children:e?.length?e.map(a=>(0,d.jsxs)(g.Badge,{className:"bg-slate-600 w-fit whitespace-nowrap",children:["Sub Account - ",a.SubAccount?.name||"Unknown"]},a.id)):(0,d.jsx)("div",{className:"text-muted-foreground",children:"No Access Yet"})})})}},{accessorKey:"role",header:"Role",cell:({row:a})=>{let b=a.original?.AgencyMemberships?.[0],c=a.original?.SubAccountMemberships?.[0],f=b?.Role?.name||c?.Role?.name||"NO_ROLE";return(0,d.jsx)(g.Badge,{className:(0,e.default)({"bg-emerald-500":"AGENCY_OWNER"===f,"bg-orange-400":"AGENCY_ADMIN"===f,"bg-primary":"SUBACCOUNT_USER"===f,"bg-muted":"SUBACCOUNT_GUEST"===f}),children:f})}},{id:"actions",cell:({row:a})=>{let b=a.original;return(0,d.jsx)(C,{rowData:b})}}],C=({rowData:a})=>{let{data:b,setOpen:c}=(0,p.useModal)(),{toast:e}=(0,w.useToast)(),[f,g]=(0,x.useState)(!1),[A,B]=(0,x.useState)(!1),C=(0,y.useRouter)();if((0,x.useEffect)(()=>{(async()=>{let a=await (0,u.hasPermission)("core.agency.team_member.remove");B(a)})()},[]),!a)return;let D=a.AgencyMemberships?.[0];if(!D)return;let E=D?.Role?.name==="AGENCY_OWNER";return(0,d.jsxs)(i.AlertDialog,{children:[(0,d.jsxs)(h.DropdownMenu,{children:[(0,d.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,d.jsxs)(j.Button,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,d.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,d.jsx)(m.MoreHorizontal,{className:"h-4 w-4"})]})}),(0,d.jsxs)(h.DropdownMenuContent,{align:"end",children:[(0,d.jsx)(h.DropdownMenuLabel,{children:"Actions"}),(0,d.jsxs)(h.DropdownMenuItem,{className:"flex gap-2",onClick:()=>navigator.clipboard.writeText(a?.email),children:[(0,d.jsx)(k.Copy,{size:15})," Copy Email"]}),(0,d.jsx)(h.DropdownMenuSeparator,{}),(0,d.jsxs)(h.DropdownMenuItem,{className:"flex gap-2",onClick:()=>{c((0,d.jsx)(z.default,{subheading:"You can change permissions only when the user has an owned subaccount",title:"Edit User Details",children:(0,d.jsx)(q.default,{type:"agency",id:D?.Agency?.id||null,subAccounts:D?.Agency?.SubAccount})}),async()=>({user:await (0,t.getUser)(a?.id)}))},children:[(0,d.jsx)(l.Edit,{size:15}),"Edit Details"]}),A&&!E&&(0,d.jsxs)(h.DropdownMenuItem,{className:"flex gap-2",onClick:async()=>{let b=await (0,v.getRolesByScope)("AGENCY",D?.Agency?.id);c((0,d.jsx)(z.default,{subheading:"Assign a new role to change the user's permissions within this agency",title:"Change User Role",children:(0,d.jsx)(r.default,{userId:a.id,agencyId:D?.Agency?.id||"",currentRole:D?.Role,availableRoles:b,onSuccess:()=>{C.refresh(),c(null)}})}))},children:[(0,d.jsx)(o.UserCog,{size:15}),"Change Role"]}),A&&!E&&(0,d.jsx)(i.AlertDialogTrigger,{asChild:!0,children:(0,d.jsxs)(h.DropdownMenuItem,{className:"flex gap-2",onClick:()=>{},children:[(0,d.jsx)(n.Trash,{size:15})," Remove User"]})})]})]}),(0,d.jsxs)(i.AlertDialogContent,{children:[(0,d.jsxs)(i.AlertDialogHeader,{children:[(0,d.jsx)(i.AlertDialogTitle,{className:"text-left",children:"Are you absolutely sure?"}),(0,d.jsx)(i.AlertDialogDescription,{className:"text-left",children:"This action cannot be undone. This will permanently delete the user and related data."})]}),(0,d.jsxs)(i.AlertDialogFooter,{className:"flex items-center",children:[(0,d.jsx)(i.AlertDialogCancel,{className:"mb-2",children:"Cancel"}),(0,d.jsx)(i.AlertDialogAction,{disabled:f,className:"bg-destructive hover:bg-destructive",onClick:async()=>{g(!0),await (0,s.deleteUser)(a.id),e({title:"Deleted User",description:"The user has been deleted from this agency they no longer have access to the agency"}),g(!1),C.refresh()},children:"Delete"})]})]})]})};a.s(["columns",0,B]),c()}catch(a){c(a)}},!1),225973,a=>{"use strict";var b=a.i(187924),c=a.i(156757),d=a.i(591119),e=a.i(441921),f=a.i(695245),g=a.i(159501),h=a.i(866718),i=a.i(580701),j=a.i(699570),k=a.i(187624),l=a.i(125581),m=a.i(580895),n=a.i(878125);a.s(["default",0,({agencyId:a})=>{let{toast:o}=(0,n.useToast)(),p=c.z.object({email:c.z.string().email(),role:c.z.enum(["AGENCY_ADMIN","SUBACCOUNT_USER","SUBACCOUNT_GUEST"])}),q=(0,f.useForm)({resolver:(0,g.zodResolver)(p),mode:"onChange",defaultValues:{email:"",role:"SUBACCOUNT_USER"}}),r=async b=>{try{let c=await (0,m.sendInvitation)(a,b.role,b.email,a);await (0,l.saveActivityLogsNotification)({agencyId:a,description:`Invited ${c.email}`,subaccountId:void 0}),o({title:"Success",description:"Created and sent invitation"})}catch(a){console.log(a),o({variant:"destructive",title:"Oppse!",description:"Could not send invitation"})}};return(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Invitation"}),(0,b.jsx)(d.CardDescription,{children:"An invitation will be sent to the user. Users who already have an invitation sent out to their email, will not receive another invitation."})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)(e.Form,{...q,children:(0,b.jsxs)("form",{onSubmit:q.handleSubmit(r),className:"flex flex-col gap-6",children:[(0,b.jsx)(e.FormField,{disabled:q.formState.isSubmitting,control:q.control,name:"email",render:({field:a})=>(0,b.jsxs)(e.FormItem,{className:"flex-1",children:[(0,b.jsx)(e.FormLabel,{children:"Email"}),(0,b.jsx)(e.FormControl,{children:(0,b.jsx)(h.Input,{placeholder:"Email",...a})}),(0,b.jsx)(e.FormMessage,{})]})}),(0,b.jsx)(e.FormField,{disabled:q.formState.isSubmitting,control:q.control,name:"role",render:({field:a})=>(0,b.jsxs)(e.FormItem,{className:"flex-1",children:[(0,b.jsx)(e.FormLabel,{children:"User role"}),(0,b.jsxs)(i.Select,{onValueChange:b=>a.onChange(b),defaultValue:a.value,children:[(0,b.jsx)(e.FormControl,{children:(0,b.jsx)(i.SelectTrigger,{children:(0,b.jsx)(i.SelectValue,{placeholder:"Select user role..."})})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"AGENCY_ADMIN",children:"Agency Admin"}),(0,b.jsx)(i.SelectItem,{value:"SUBACCOUNT_USER",children:"Sub Account User"}),(0,b.jsx)(i.SelectItem,{value:"SUBACCOUNT_GUEST",children:"Sub Account Guest"})]})]}),(0,b.jsx)(e.FormMessage,{})]})}),(0,b.jsx)(j.Button,{disabled:q.formState.isSubmitting,type:"submit",children:q.formState.isSubmitting?(0,b.jsx)(k.default,{}):"Send Invitation"})]})})})]})}])}];

//# sourceMappingURL=_79edd6ee._.js.map