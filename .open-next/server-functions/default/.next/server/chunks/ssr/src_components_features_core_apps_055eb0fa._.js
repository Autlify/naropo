module.exports=[906850,a=>{"use strict";var b=a.i(187924),c=a.i(238246),d=a.i(50944),e=a.i(368114),f=a.i(699570);let g=[{key:"providers",label:"Providers",href:"providers"},{key:"connections",label:"Connections",href:"connections"},{key:"api-keys",label:"API Keys",href:"api-keys"},{key:"subscriptions",label:"Subscriptions",href:"subscriptions"},{key:"deliveries",label:"Deliveries",href:"deliveries"}];function h({basePath:a}){let h=(0,d.usePathname)();return(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map(d=>{let g=`${a}/${d.href}`,i=h===g||h.startsWith(g+"/");return(0,b.jsx)(f.Button,{asChild:!0,variant:i?"default":"outline",size:"sm",className:(0,e.cn)("rounded-xl"),children:(0,b.jsx)(c.default,{href:g,children:d.label})},d.key)})})}a.s(["WebhooksNav",()=>h])},777834,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(699570),f=a.i(591119),g=a.i(786304);function h(a){let h=(0,c.useMemo)(()=>{let b=new URLSearchParams;return a.agencyId&&b.set("agencyId",a.agencyId),a.subAccountId&&b.set("subAccountId",a.subAccountId),b.toString()},[a.agencyId,a.subAccountId]),i=a.agencyId?`/agency/${a.agencyId}`:`/subaccount/${a.subAccountId}`,[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),n=async()=>{let[a,b]=await Promise.all([fetch("/api/features/core/webhooks/providers").then(a=>a.json()),fetch(`/api/features/core/webhooks/connections?${h}`).then(a=>a.json())]);k(a.providers||[]),m(b.connections||[])};return(0,c.useEffect)(()=>{n()},[h]),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Providers"}),(0,b.jsx)(f.CardDescription,{children:"Connect providers and manage credentials per context."})]}),(0,b.jsx)(f.CardContent,{className:"grid gap-4 md:grid-cols-2",children:j.map(a=>{var c;let f=(c=a.id,{conn:l.find(a=>a.provider===c&&!a.isInherited),inherited:l.find(a=>a.provider===c&&a.isInherited)}),h=f.conn?.status||(f.inherited?`INHERITED:${f.inherited.status}`:"DISCONNECTED");return(0,b.jsxs)("div",{className:"border rounded-xl p-4 flex flex-col gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"font-semibold truncate",children:a.name}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground truncate",children:a.description||a.id})]}),(0,b.jsx)(g.Badge,{variant:h.startsWith("CONNECTED")?"default":"secondary",children:h})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(d.default,{href:`${i}/apps/webhooks/providers/${a.id}`,children:"Manage"})}),a.webhookSupported?(0,b.jsx)(g.Badge,{variant:"outline",children:"Webhooks"}):null,a.oauthSupported?(0,b.jsx)(g.Badge,{variant:"outline",children:"OAuth"}):(0,b.jsx)(g.Badge,{variant:"outline",children:"Webhook"})]})]},a.id)})})]})}a.s(["WebhooksProvidersPanel",()=>h])},94802,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(699570),f=a.i(591119),g=a.i(786304);function h(a){let h=(0,c.useMemo)(()=>{let b=new URLSearchParams;return a.agencyId&&b.set("agencyId",a.agencyId),a.subAccountId&&b.set("subAccountId",a.subAccountId),b.toString()},[a.agencyId,a.subAccountId]),i=a.agencyId?`/agency/${a.agencyId}`:`/subaccount/${a.subAccountId}`,[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(null),n=async()=>{k((await fetch(`/api/features/core/webhooks/connections?${h}`).then(a=>a.json())).connections||[])};(0,c.useEffect)(()=>{n()},[h]);let o=async a=>{if(confirm("Disconnect this connection?")){m(a);try{await fetch(`/api/features/core/webhooks/connections/${a}?${h}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({status:"DISCONNECTED",credentials:null})}),await n()}finally{m(null)}}};return(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Connections"}),(0,b.jsx)(f.CardDescription,{children:"View current connections (owned vs inherited)."})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-3",children:[0===j.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No connections yet."}):null,(0,b.jsx)("div",{className:"divide-y rounded-xl border",children:j.map(a=>(0,b.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"font-medium truncate",children:a.provider}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.isInherited?"Inherited":"Owned"," • ",a.updatedAt?new Date(a.updatedAt).toLocaleString():"—"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Badge,{variant:"CONNECTED"===a.status?"default":"secondary",children:a.status}),(0,b.jsx)(e.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(d.default,{href:`${i}/apps/webhooks/providers/${a.provider}`,children:"Manage"})}),a.isInherited?null:(0,b.jsx)(e.Button,{variant:"outline",size:"sm",disabled:l===a.id,onClick:()=>o(a.id),children:"Disconnect"})]})]},a.id))})]})]})}a.s(["WebhooksConnectionsPanel",()=>h])},757025,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(699570),e=a.i(591119),f=a.i(866718),g=a.i(786304);function h(a){let h=(0,c.useMemo)(()=>{let b=new URLSearchParams;return a.agencyId&&b.set("agencyId",a.agencyId),a.subAccountId&&b.set("subAccountId",a.subAccountId),b.toString()},[a.agencyId,a.subAccountId]),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!1),q=async()=>{j((await fetch(`/api/features/core/webhooks/api-keys?${h}`).then(a=>a.json())).apiKeys||[])};(0,c.useEffect)(()=>{q()},[h]);let r=async()=>{p(!0);try{let a=await fetch(`/api/features/core/webhooks/api-keys?${h}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:k||"Default"})}),b=await a.json().catch(()=>({}));a.ok?(n(b.apiKey?.apiKey||null),l(""),await q()):alert(b.error||"Failed to create key")}finally{p(!1)}},s=async a=>{if(confirm("Revoke this key?")){p(!0);try{(await fetch(`/api/features/core/webhooks/api-keys/${a}?${h}`,{method:"DELETE"})).ok&&await q()}finally{p(!1)}}};return(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"API Keys"}),(0,b.jsx)(e.CardDescription,{children:"Server-to-server API keys. The secret is shown once. Store it in your environment variables."})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[m?(0,b.jsxs)("div",{className:"rounded-xl border p-3",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"New API Key (copy now)"}),(0,b.jsxs)("div",{className:"mt-2 flex flex-col gap-2",children:[(0,b.jsx)("code",{className:"text-xs break-all",children:m}),(0,b.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>n(null),children:"Dismiss"})]})]}):null,(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,b.jsx)(f.Input,{placeholder:"Key name",value:k,onChange:a=>l(a.target.value)}),(0,b.jsx)(d.Button,{onClick:r,disabled:o,children:"Create key"})]}),(0,b.jsxs)("div",{className:"divide-y rounded-xl border",children:[0===i.length?(0,b.jsx)("div",{className:"p-3 text-sm text-muted-foreground",children:"No API keys yet."}):null,i.map(a=>(0,b.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"font-medium truncate",children:a.name}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.keyPrefix?`Prefix: ${a.keyPrefix}`:"—"," • ",a.revokedAt?"Revoked":"Active"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Badge,{variant:a.revokedAt?"secondary":"default",children:a.revokedAt?"REVOKED":"ACTIVE"}),a.revokedAt?null:(0,b.jsx)(d.Button,{variant:"outline",size:"sm",disabled:o,onClick:()=>s(a.id),children:"Revoke"})]})]},a.id))]})]})]})}a.s(["WebhooksApiKeysPanel",()=>h])},881351,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(699570),f=a.i(591119),g=a.i(786304),h=a.i(505084);function i(a){let i=(0,c.useMemo)(()=>{let b=new URLSearchParams;return a.agencyId&&b.set("agencyId",a.agencyId),a.subAccountId&&b.set("subAccountId",a.subAccountId),b.toString()},[a.agencyId,a.subAccountId]),j=a.agencyId?`/agency/${a.agencyId}`:`/subaccount/${a.subAccountId}`,[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)({}),[o,p]=(0,c.useState)(!1),q=async()=>{p(!0);try{let a=((await fetch(`/api/features/core/webhooks/connections?${i}`).then(a=>a.json())).connections||[]).filter(a=>"CONNECTED"===a.status);l(a);let b={};await Promise.all(a.map(async a=>{let c=await fetch(`/api/features/core/webhooks/subscriptions?${i}&connectionId=${a.id}`).then(a=>a.json());b[a.id]=c.subscriptions||[]})),n(b)}finally{p(!1)}};(0,c.useEffect)(()=>{q()},[i]);let r=async(a,b)=>{p(!0);try{await fetch(`/api/features/core/webhooks/subscriptions/${a}?${i}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({isActive:b})}),await q()}finally{p(!1)}};return(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Webhooks"}),(0,b.jsx)(f.CardDescription,{children:"Manage webhook subscriptions (connect per provider)."})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:q,disabled:o,children:"Refresh"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Subscriptions are configured per provider connection."})]}),0===k.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No connected providers with webhooks yet."}):null,k.map(a=>{let c=m[a.id]||[];return(0,b.jsxs)("div",{className:"rounded-xl border p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"font-medium",children:a.provider}),(0,b.jsx)(e.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(d.default,{href:`${j}/apps/webhooks/providers/${a.provider}`,children:"Manage provider"})})]}),(0,b.jsx)(h.Separator,{}),0===c.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No subscriptions yet."}):(0,b.jsx)("div",{className:"space-y-2",children:c.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm truncate",children:a.url}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:(a.events||[]).join(", ")||"—"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Badge,{variant:a.isActive?"default":"secondary",children:a.isActive?"ACTIVE":"PAUSED"}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",disabled:o,onClick:()=>r(a.id,!a.isActive),children:a.isActive?"Pause":"Resume"})]})]},a.id))})]},a.id)})]})]})}a.s(["WebhooksSubscriptionsPanel",()=>i])},237647,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(699570),f=a.i(591119),g=a.i(786304);function h(a){let h=(0,c.useMemo)(()=>{let b=new URLSearchParams;return a.agencyId&&b.set("agencyId",a.agencyId),a.subAccountId&&b.set("subAccountId",a.subAccountId),b.toString()},[a.agencyId,a.subAccountId]),i=a.agencyId?`/agency/${a.agencyId}`:`/subaccount/${a.subAccountId}`,[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(!1),n=async()=>{m(!0);try{let a=await fetch(`/api/features/core/webhooks/deliveries?${h}`).then(a=>a.json());k(a.deliveries||[])}finally{m(!1)}};return(0,c.useEffect)(()=>{n()},[h]),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Deliveries"}),(0,b.jsx)(f.CardDescription,{children:"Recent webhook delivery attempts from provider events."})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:n,disabled:l,children:"Refresh"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Showing most recent deliveries."})]}),(0,b.jsxs)("div",{className:"divide-y rounded-xl border",children:[0===j.length?(0,b.jsx)("div",{className:"p-3 text-sm text-muted-foreground",children:"No deliveries yet."}):null,j.map(a=>(0,b.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-medium truncate",children:a.subscription?.connection?.provider||"Provider"}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.createdAt?new Date(a.createdAt).toLocaleString():"—"," • Attempts: ",a.attemptCount??0]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Badge,{variant:"SUCCESS"===a.status?"default":"FAILED"===a.status?"destructive":"secondary",children:a.status}),(0,b.jsx)(e.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(d.default,{href:`${i}/apps/webhooks/deliveries/${a.id}`,children:"Details"})})]})]},a.id))]})]})]})}a.s(["WebhooksDeliveriesPanel",()=>h])},316348,a=>{"use strict";var b=a.i(187924),c=a.i(238246),d=a.i(50944),e=a.i(368114),f=a.i(699570);let g=[{key:"wizard",label:"Wizard",href:"wizard"},{key:"tickets",label:"Tickets",href:"tickets"}];function h({basePath:a}){let h=(0,d.usePathname)();return(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map(d=>{let g=`${a}/${d.href}`,i=h===g||h.startsWith(g+"/");return(0,b.jsx)(f.Button,{asChild:!0,variant:i?"default":"outline",size:"sm",className:(0,e.cn)("rounded-xl"),children:(0,b.jsx)(c.default,{href:g,children:d.label})},d.key)})})}a.s(["SupportNav",()=>h])},805248,a=>{"use strict";a.s(["scopeQuery",0,a=>"AGENCY"===a.type?`agencyId=${encodeURIComponent(a.agencyId)}`:`subAccountId=${encodeURIComponent(a.subaccountId)}`])},923324,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(591119),e=a.i(699570),f=a.i(505084),g=a.i(429246),h=a.i(866718),i=a.i(580701),j=a.i(786304),k=a.i(805248);let l={BILLING:"Billing / Subscription",WEBHOOKS:"Webhooks / Deliveries",ACCESS:"Access / Permissions",BUG:"Bug / UI issue",OTHER:"Other"};async function m(a){try{return await a.json()}catch{return null}}function n({scope:a}){let n="/api/features/core/support",o=(0,c.useMemo)(()=>(0,k.scopeQuery)(a),[a]),[p,q]=(0,c.useState)("BILLING"),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(null),D="BILLING"===p,E="WEBHOOKS"===p,F=(0,c.useMemo)(()=>"AGENCY"===a.type?{"x-autlify-agency":a.agencyId}:{"x-autlify-subaccount":a.subaccountId},[a]),G=async()=>{C(null),y(!0);try{let a={};if(D){let b=await fetch(`${n}/diagnostics/billing?${o}`,{headers:F,cache:"no-store"});a.billing=await m(b)}if(E){let b=await fetch(`${n}/diagnostics/webhooks?${o}`,{headers:F,cache:"no-store"});a.webhooks=await m(b)}a.client={userAgent:"u">typeof navigator?navigator.userAgent:void 0,time:new Date().toISOString()},w(a)}catch(a){C(a?.message||"Failed to run diagnostics")}finally{y(!1)}},H=async()=>{C(null),A(!0);try{let a={category:p,title:r||`${l[p]} issue`,description:t,diagnostics:v},b=await fetch(`${n}/tickets?${o}`,{method:"POST",headers:{...F,"content-type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await m(b);throw Error(a?.error||`Request failed (${b.status})`)}s(""),u(""),C("Ticket created. You can view it in Tickets.")}catch(a){C(a?.message||"Failed to create ticket")}finally{A(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Guided Troubleshooting"}),(0,b.jsx)(d.CardDescription,{children:"Capture the essentials quickly. If you run diagnostics, the snapshot will be attached to the ticket."})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-5",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Category"}),(0,b.jsxs)(i.Select,{value:p,onValueChange:a=>q(a),children:[(0,b.jsx)(i.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(i.SelectValue,{placeholder:"Select"})}),(0,b.jsx)(i.SelectContent,{children:Object.entries(l).map(([a,c])=>(0,b.jsx)(i.SelectItem,{value:a,children:c},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Title"}),(0,b.jsx)(h.Input,{className:"rounded-xl",placeholder:"Short summary",value:r,onChange:a=>s(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Details"}),(0,b.jsx)(g.Textarea,{className:"min-h-[140px] rounded-xl",placeholder:"What were you doing? What did you expect? What happened instead?",value:t,onChange:a=>u(a.target.value)})]}),(0,b.jsx)(f.Separator,{}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",className:"rounded-xl",onClick:G,disabled:x,children:x?"Running diagnostics…":"Run diagnostics"}),D||E?(0,b.jsxs)(j.Badge,{variant:"secondary",children:["Includes: ",D?"billing":null,D&&E?", ":null,E?"webhooks":null]}):(0,b.jsx)(j.Badge,{variant:"outline",children:"No automated diagnostics for this category"}),(0,b.jsx)("div",{className:"flex-1"}),(0,b.jsx)(e.Button,{type:"button",className:"rounded-xl",onClick:H,disabled:z||!t.trim(),children:z?"Submitting…":"Create ticket"})]}),B?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:B}):null,v?(0,b.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,b.jsx)("div",{className:"text-sm font-medium mb-2",children:"Diagnostics snapshot"}),(0,b.jsx)("pre",{className:"text-xs overflow-auto max-h-[260px] whitespace-pre-wrap",children:JSON.stringify(v,null,2)})]}):null]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Quick tips"}),(0,b.jsx)(d.CardDescription,{children:"These reduce back-and-forth for 90% of cases."})]}),(0,b.jsxs)(d.CardContent,{className:"text-sm text-muted-foreground space-y-2",children:[(0,b.jsx)("div",{children:"• Billing issues: confirm plan status and whether the feature is entitled (Add-on vs base)."}),(0,b.jsx)("div",{children:"• Webhooks: check Deliveries for recent failures and retry from Deliveries detail."}),(0,b.jsx)("div",{children:"• Access: verify your role has the required permission keys and that the gate is enabled by entitlement."})]})]})]})}a.s(["SupportWizardPanel",()=>n])},441382,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(591119),e=a.i(699570),f=a.i(786304),g=a.i(505084),h=a.i(805248);async function i(a){try{return await a.json()}catch{return null}}function j({scope:a}){let j=(0,c.useMemo)(()=>(0,h.scopeQuery)(a),[a]),k=(0,c.useMemo)(()=>"AGENCY"===a.type?{"x-autlify-agency":a.agencyId}:{"x-autlify-subaccount":a.subaccountId},[a]),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),r=async()=>{q(null),o(!0);try{let a=await fetch(`/api/features/core/support/tickets?${j}`,{headers:k,cache:"no-store"});if(!a.ok){let b=await i(a);throw Error(b?.error||`Request failed (${a.status})`)}let b=await i(a);m(b?.tickets||[])}catch(a){q(a?.message||"Failed to load tickets")}finally{o(!1)}};return(0,c.useEffect)(()=>{r()},[j]),(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(d.CardTitle,{children:"Tickets"}),(0,b.jsx)(d.CardDescription,{children:"All tickets for this scope. Newest first."})]}),(0,b.jsx)(e.Button,{variant:"outline",className:"rounded-xl",onClick:r,disabled:n,children:n?"Refreshing…":"Refresh"})]})}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[p?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:p}):null,0!==l.length||n?null:(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No tickets yet."}),l.map(a=>(0,b.jsxs)("div",{className:"rounded-xl border p-4 space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"font-medium",children:a.title}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Badge,{variant:function(a){switch(a){case"OPEN":return"default";case"IN_PROGRESS":return"secondary";default:return"outline"}}(a.status),children:a.status}),(0,b.jsx)(f.Badge,{variant:"outline",children:a.category})]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleString()}),a.description?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Separator,{}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:a.description})]}):null]},a.id))]})]})})}a.s(["SupportTicketsPanel",()=>j])},705049,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(699570),f=a.i(591119),g=a.i(866718),h=a.i(786304),i=a.i(505084);function j(a){let j=(0,c.useMemo)(()=>{let b=new URLSearchParams;return a.agencyId&&b.set("agencyId",a.agencyId),a.subAccountId&&b.set("subAccountId",a.subAccountId),b.toString()},[a.agencyId,a.subAccountId]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(!1),y=a.agencyId?`/agency/${a.agencyId}`:`/subaccount/${a.subAccountId}`,z=["github","slack"].includes(a.provider),A=async()=>{let b=await fetch(`/api/features/core/webhooks/connections?${j}`).then(a=>a.json());l(b.connections||[]);let c=(b.connections||[]).find(b=>b.provider===a.provider&&!b.isInherited)||(b.connections||[]).find(b=>b.provider===a.provider);n(c||null),c?.id?p((await fetch(`/api/features/core/webhooks/subscriptions?${j}&connectionId=${c.id}`).then(a=>a.json())).subscriptions||[]):p([])};(0,c.useEffect)(()=>{A()},[j,a.provider]);let B=(0,c.useMemo)(()=>{let b=encodeURIComponent(`${y}/apps/webhooks/providers/${a.provider}`);return`/api/features/core/webhooks/providers/${a.provider}/oauth?${j}&back=${b}`},[y,a.provider,j]),C=async()=>{if(!m?.id||m?.isInherited){x(!0);try{let b=await fetch(`/api/features/core/webhooks/connections?${j}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({provider:a.provider})});if(!b.ok){let a=await b.json().catch(()=>({}));alert(a.error||"Failed to create connection")}await A()}finally{x(!1)}}},D=async()=>{if(m?.id&&confirm("Disconnect this provider?")){x(!0);try{await fetch(`/api/features/core/webhooks/connections/${m.id}?${j}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({status:"DISCONNECTED",credentials:null})}),await A()}finally{x(!1)}}},E=async()=>{if(m?.id){x(!0);try{let a=s.split(",").map(a=>a.trim()).filter(Boolean),b=await fetch(`/api/features/core/webhooks/subscriptions?${j}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({connectionId:m.id,url:q,events:a,secret:u||void 0})}),c=await b.json().catch(()=>({}));b.ok||alert(c.error||"Failed to create subscription"),r(""),t(""),v(""),await A()}finally{x(!1)}}},F=async(a,b)=>{x(!0);try{await fetch(`/api/features/core/webhooks/subscriptions/${a}?${j}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({isActive:b})}),await A()}finally{x(!1)}},G=async a=>{if(confirm("Delete this subscription?")){x(!0);try{await fetch(`/api/features/core/webhooks/subscriptions/${a}?${j}`,{method:"DELETE"}),await A()}finally{x(!1)}}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Connection"}),(0,b.jsx)(f.CardDescription,{children:"Manage provider connection and credentials."})]}),(0,b.jsxs)(f.CardContent,{className:"flex flex-col gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Status: ",(0,b.jsx)(h.Badge,{variant:m?.status==="CONNECTED"?"default":"secondary",children:m?.status||"DISCONNECTED"}),m?.isInherited?(0,b.jsx)(h.Badge,{variant:"outline",className:"ml-2",children:"Inherited"}):null]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,b.jsx)(d.default,{href:`${y}/apps`,children:"Back"})}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:C,disabled:w,children:"Ensure Connection"}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",asChild:!0,disabled:w||!z,children:(0,b.jsx)("a",{href:B,children:"OAuth Connect"})}),(0,b.jsx)(e.Button,{variant:"destructive",size:"sm",onClick:D,disabled:w||!m?.id||!!m?.isInherited,children:"Disconnect"})]})]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Inbound webhook URL: ",(0,b.jsx)("code",{className:"break-all",children:`/api/features/core/webhooks/providers/${a.provider}/ingest/${m?.id||"{connectionId}"}`})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Webhook Subscriptions"}),(0,b.jsx)(f.CardDescription,{children:"Fan-out provider events to your endpoints. Secret is stored as SHA-256(secret) and used as signing key."})]}),(0,b.jsx)(f.CardContent,{className:"space-y-4",children:m?.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid gap-2 md:grid-cols-3",children:[(0,b.jsx)(g.Input,{placeholder:"https://example.com/webhook",value:q,onChange:a=>r(a.target.value),disabled:w}),(0,b.jsx)(g.Input,{placeholder:"events (comma-separated)",value:s,onChange:a=>t(a.target.value),disabled:w}),(0,b.jsx)(g.Input,{placeholder:"secret (optional)",value:u,onChange:a=>v(a.target.value),disabled:w})]}),(0,b.jsx)(e.Button,{onClick:E,disabled:w||!q||!s,children:"Add Subscription"}),(0,b.jsx)(i.Separator,{}),(0,b.jsx)("div",{className:"space-y-2",children:0===o.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No subscriptions yet."}):o.map(a=>(0,b.jsx)("div",{className:"border rounded-xl p-3 flex flex-col gap-2",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"font-medium truncate",children:a.url}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground truncate",children:["Events: ",(a.events||[]).join(", ")]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Badge,{variant:a.isActive?"default":"secondary",children:a.isActive?"ACTIVE":"PAUSED"}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>F(a.id,!a.isActive),disabled:w,children:a.isActive?"Pause":"Resume"}),(0,b.jsx)(e.Button,{variant:"destructive",size:"sm",onClick:()=>G(a.id),disabled:w,children:"Delete"})]})]})},a.id))})]}):(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Create a connection first."})})]})]})}a.s(["default",()=>j])}];

//# sourceMappingURL=src_components_features_core_apps_055eb0fa._.js.map