module.exports=[73903,e=>{"use strict";e.i(423502);var r=e.i(698902),t=e.i(843793);let a=e=>{if(!e)return"MISSING";let r=new Date,t=(e.status||"").toUpperCase(),a=e.currentPeriodEndDate instanceof Date&&e.currentPeriodEndDate.getTime()>r.getTime();return("ACTIVE"===t||"TRIALING"===t)&&a||"TRIALING"===t&&e.trialEndedAt instanceof Date&&e.trialEndedAt.getTime()>r.getTime()?"ACTIVE":"INACTIVE"},i=async e=>{let r=await t.db.agencyMembership.findFirst({where:{userId:e.userId,agencyId:e.agencyId,isActive:!0},select:{userId:!0,agencyId:!0,Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}},Agency:{select:{Subscription:{select:{status:!0,currentPeriodEndDate:!0,trialEndedAt:!0,active:!0,cancelAtPeriodEnd:!0}}}}}});if(!r)return null;let i=r.Role.Permissions.map(e=>e.Permission.key),n=a(r.Agency.Subscription);return{userId:r.userId,agencyId:r.agencyId,permissionKeys:i,subscriptionState:n}},n=async e=>{let i=await (0,r.auth)(),n=i?.user?.id;if(!n)return null;let s=await t.db.agencyMembership.findFirst({where:{userId:n,agencyId:e.agencyId,isActive:!0},select:{userId:!0,agencyId:!0,Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}},Agency:{select:{Subscription:{select:{status:!0,currentPeriodEndDate:!0,trialEndedAt:!0,active:!0,cancelAtPeriodEnd:!0}}}}}});if(!s)return null;let c=s.Role.Permissions.map(e=>e.Permission.key),o=a(s.Agency.Subscription);return{userId:s.userId,agencyId:s.agencyId,permissionKeys:c,subscriptionState:o}},s=async e=>a(await t.db.subscription.findUnique({where:{agencyId:e},select:{status:!0,currentPeriodEndDate:!0,trialEndedAt:!0,active:!0,cancelAtPeriodEnd:!0}})),c=async e=>{let r=await t.db.subAccountMembership.findFirst({where:{userId:e.userId,subAccountId:e.subAccountId,isActive:!0},select:{userId:!0,subAccountId:!0,SubAccount:{select:{agencyId:!0}},Role:{select:{Permissions:{where:{granted:!0},select:{Permission:{select:{key:!0}}}}}}}});if(!r)return null;let a=r.Role.Permissions.map(e=>e.Permission.key);return{userId:r.userId,agencyId:r.SubAccount.agencyId,subAccountId:r.subAccountId,permissionKeys:a}},o=async e=>{let t=await (0,r.auth)(),a=t?.user?.id;return a?c({userId:a,subAccountId:e.subAccountId}):null};e.s(["CONTEXT_COOKIE",0,"autlify.context-token","getAgencySubscriptionState",0,s,"parseSavedContext",0,e=>{if(!e)return null;let[r,t]=e.split(":");return t?"agency"===r?{kind:"agency",agencyId:t}:"subaccount"===r?{kind:"subaccount",subAccountId:t}:null:null},"resolveAgencyContextForUser",0,i,"resolveCurrentAgencyContext",0,n,"resolveCurrentSubAccountContext",0,o,"resolveSubAccountContextForUser",0,c])},883406,e=>{"use strict";e.s(["KEYS",0,{core:{organization:{profile:{view:"core.organization.profile.view",manage:"core.organization.profile.manage"},security:{view:"core.organization.security.view",manage:"core.organization.security.manage"},integrations:{view:"core.organization.integrations.view",manage:"core.organization.integrations.manage"},automation:{view:"core.organization.automation.view",manage:"core.organization.automation.manage"}},agency:{account:{read:"core.agency.account.read",update:"core.agency.account.update",delete:"core.agency.account.delete"},subaccounts:{read:"core.agency.subaccounts.read",create:"core.agency.subaccounts.create",update:"core.agency.subaccounts.update",delete:"core.agency.subaccounts.delete"},team_member:{invite:"core.agency.team_member.invite",remove:"core.agency.team_member.remove",manage:"core.agency.team_member.manage"},settings:{view:"core.agency.settings.view",manage:"core.agency.settings.manage"},storage:{view:"core.agency.storage.view",manage:"core.agency.storage.manage"}},billing:{account:{view:"core.billing.account.view",manage:"core.billing.account.manage"},payment_methods:{read:"core.billing.payment_methods.read",create:"core.billing.payment_methods.create",delete:"core.billing.payment_methods.delete"},subscription:{view:"core.billing.subscription.view",manage:"core.billing.subscription.manage"},features:{manage:"core.billing.features.manage"},usage:{view:"core.billing.usage.view",consume:"core.billing.usage.consume"},entitlements:{view:"core.billing.entitlements.view"},credits:{view:"core.billing.credits.view"},rebilling:{manage:"core.billing.rebilling.manage"},priority_support:{view:"core.billing.priority_support.view"}},subaccount:{account:{read:"core.subaccount.account.read",update:"core.subaccount.account.update",delete:"core.subaccount.account.delete"},team_member:{invite:"core.subaccount.team_member.invite",remove:"core.subaccount.team_member.remove"}},experimental:{flag:{toggle:"core.experimental.flag.toggle"}},apps:{app:{view:"core.apps.app.view",install:"core.apps.app.install",manage:"core.apps.app.manage",uninstall:"core.apps.app.uninstall"},webhooks:{manage:"core.apps.webhooks.manage",view:"core.apps.webhooks.view"},api_keys:{read:"core.apps.api_keys.read",create:"core.apps.api_keys.create",delete:"core.apps.api_keys.delete"}},support:{tickets:{view:"core.support.tickets.view",create:"core.support.tickets.create",update:"core.support.tickets.update",close:"core.support.tickets.close"},diagnostics:{run:"core.support.diagnostics.run"}}},iam:{authZ:{roles:{read:"iam.authZ.roles.read",create:"iam.authZ.roles.create",update:"iam.authZ.roles.update",delete:"iam.authZ.roles.delete"},permissions:{view:"iam.authZ.permissions.view"},members:{assign:"iam.authZ.members.assign",revoke:"iam.authZ.members.revoke"}}},fi:{configuration:{fiscal_years:{view:"fi.configuration.fiscal_years.view",manage:"fi.configuration.fiscal_years.manage"},currencies:{view:"fi.configuration.currencies.view",manage:"fi.configuration.currencies.manage"},tax_settings:{view:"fi.configuration.tax_settings.view",manage:"fi.configuration.tax_settings.manage"},tolerances:{view:"fi.configuration.tolerances.view",manage:"fi.configuration.tolerances.manage"},number_ranges:{view:"fi.configuration.number_ranges.view",manage:"fi.configuration.number_ranges.manage"},posting_rules:{view:"fi.configuration.posting_rules.view",manage:"fi.configuration.posting_rules.manage",simulate:"fi.configuration.posting_rules.simulate"}},master_data:{accounts:{view:"fi.master_data.accounts.view",manage:"fi.master_data.accounts.manage"},customers:{view:"fi.master_data.customers.view",manage:"fi.master_data.customers.manage"},vendors:{view:"fi.master_data.vendors.view",manage:"fi.master_data.vendors.manage"},banks:{view:"fi.master_data.banks.view",manage:"fi.master_data.banks.manage"}},general_ledger:{accounts:{view:"fi.general_ledger.accounts.view",manage:"fi.general_ledger.accounts.manage"},subledgers:{view:"fi.general_ledger.subledgers.view",allocate:"fi.general_ledger.subledgers.allocate",manage:"fi.general_ledger.subledgers.manage"},balances:{view:"fi.general_ledger.balances.view",recalculate:"fi.general_ledger.balances.recalculate",rollforward:"fi.general_ledger.balances.rollforward"},settings:{view:"fi.general_ledger.settings.view",manage:"fi.general_ledger.settings.manage",setup:"fi.general_ledger.settings.setup"},journal_entries:{read:"fi.general_ledger.journal_entries.read",create:"fi.general_ledger.journal_entries.create",update:"fi.general_ledger.journal_entries.update",submit:"fi.general_ledger.journal_entries.submit",delete:"fi.general_ledger.journal_entries.delete",reverse:"fi.general_ledger.journal_entries.reverse",reject:"fi.general_ledger.journal_entries.reject",approve:"fi.general_ledger.journal_entries.approve"},reports:{view:"fi.general_ledger.reports.view",generate:"fi.general_ledger.reports.generate",approve:"fi.general_ledger.reports.approve",export:"fi.general_ledger.reports.export"},consolidation:{view:"fi.general_ledger.consolidation.view",manage:"fi.general_ledger.consolidation.manage"},year_end:{view:"fi.general_ledger.year_end.view",manage:"fi.general_ledger.year_end.manage",close:"fi.general_ledger.year_end.close"},reconciliation:{view:"fi.general_ledger.reconciliation.view",manage:"fi.general_ledger.reconciliation.manage",clear:"fi.general_ledger.reconciliation.clear",reset:"fi.general_ledger.reconciliation.reset"}},accounts_receivable:{subledgers:{view:"fi.accounts_receivable.subledgers.view",allocate:"fi.accounts_receivable.subledgers.allocate",manage:"fi.accounts_receivable.subledgers.manage"}},accounts_payable:{subledgers:{view:"fi.accounts_payable.subledgers.view",allocate:"fi.accounts_payable.subledgers.allocate",manage:"fi.accounts_payable.subledgers.manage"}},bank_ledger:{bank_accounts:{view:"fi.bank_ledger.bank_accounts.view",manage:"fi.bank_ledger.bank_accounts.manage"},subledgers:{view:"fi.bank_ledger.subledgers.view",allocate:"fi.bank_ledger.subledgers.allocate",manage:"fi.bank_ledger.subledgers.manage"}},controlling:{cost_centers:{view:"fi.controlling.cost_centers.view",manage:"fi.controlling.cost_centers.manage"}},advanced_reporting:{financial_statements:{view:"fi.advanced_reporting.financial_statements.view",generate:"fi.advanced_reporting.financial_statements.generate"},custom_reports:{view:"fi.advanced_reporting.custom_reports.view",create:"fi.advanced_reporting.custom_reports.create",update:"fi.advanced_reporting.custom_reports.update",delete:"fi.advanced_reporting.custom_reports.delete"}}},crm:{customers:{contact:{read:"crm.customers.contact.read",create:"crm.customers.contact.create",update:"crm.customers.contact.update",delete:"crm.customers.contact.delete"},billing:{read:"crm.customers.billing.read",create:"crm.customers.billing.create",update:"crm.customers.billing.update",delete:"crm.customers.billing.delete"}},media:{file:{read:"crm.media.file.read",create:"crm.media.file.create",delete:"crm.media.file.delete"}},funnels:{content:{read:"crm.funnels.content.read",create:"crm.funnels.content.create",update:"crm.funnels.content.update",delete:"crm.funnels.content.delete",publish:"crm.funnels.content.publish"}},pipelines:{lane:{read:"crm.pipelines.lane.read",create:"crm.pipelines.lane.create",update:"crm.pipelines.lane.update",delete:"crm.pipelines.lane.delete"},ticket:{read:"crm.pipelines.ticket.read",create:"crm.pipelines.ticket.create",update:"crm.pipelines.ticket.update",delete:"crm.pipelines.ticket.delete"},tag:{read:"crm.pipelines.tag.read",create:"crm.pipelines.tag.create",update:"crm.pipelines.tag.update",delete:"crm.pipelines.tag.delete"}}},co:{cost_centers:{master_data:{read:"co.cost_centers.master_data.read",create:"co.cost_centers.master_data.create",update:"co.cost_centers.master_data.update",delete:"co.cost_centers.master_data.delete"},hierarchy:{view:"co.cost_centers.hierarchy.view",manage:"co.cost_centers.hierarchy.manage"},allocations:{view:"co.cost_centers.allocations.view",execute:"co.cost_centers.allocations.execute"},reports:{view:"co.cost_centers.reports.view",generate:"co.cost_centers.reports.generate"}},profit_centers:{master_data:{read:"co.profit_centers.master_data.read",create:"co.profit_centers.master_data.create",update:"co.profit_centers.master_data.update",delete:"co.profit_centers.master_data.delete"},hierarchy:{view:"co.profit_centers.hierarchy.view",manage:"co.profit_centers.hierarchy.manage"},reports:{view:"co.profit_centers.reports.view",generate:"co.profit_centers.reports.generate"}},internal_orders:{master_data:{read:"co.internal_orders.master_data.read",create:"co.internal_orders.master_data.create",update:"co.internal_orders.master_data.update",close:"co.internal_orders.master_data.close"},settlement:{view:"co.internal_orders.settlement.view",execute:"co.internal_orders.settlement.execute"}},profitability:{segments:{view:"co.profitability.segments.view",manage:"co.profitability.segments.manage"},reports:{view:"co.profitability.reports.view",generate:"co.profitability.reports.generate"}},budgets:{planning:{view:"co.budgets.planning.view",create:"co.budgets.planning.create",update:"co.budgets.planning.update",approve:"co.budgets.planning.approve"},monitoring:{view:"co.budgets.monitoring.view",alerts:"co.budgets.monitoring.alerts"}}}}])},50377,e=>{"use strict";let r=process.env.LOG_LEVEL||"info",t=new class{level;prefix;levels={debug:0,info:1,warn:2,error:3};constructor(e){this.level=e.level,this.prefix=e.prefix||""}shouldLog(e){return this.levels[e]>=this.levels[this.level]}formatMessage(e){return this.prefix?`[${this.prefix}] ${e}`:e}formatData(e){if(e)return e instanceof Error?{...e,message:e.message,name:e.name,stack:e.stack}:e}debug(e,r){this.shouldLog("debug")&&console.debug(this.formatMessage(e),this.formatData(r))}info(e,r,t,a){this.shouldLog("info")&&console.info(this.formatMessage(e),this.formatData(r))}warn(e,r){this.shouldLog("warn")&&console.warn(this.formatMessage(e),this.formatData(r))}error(e,r){this.shouldLog("error")&&console.error(this.formatMessage(e),this.formatData(r))}}({level:r,prefix:"Autlify"});e.s(["logger",0,t])},907117,e=>{"use strict";e.i(423502);var r=e.i(698902),t=e.i(843793),a=e.i(307144),i=e.i(883406);let n=[{prefix:"core.agency.",requireAny:["core.agency.account"]},{prefix:"core.billing.",requireAll:["core.agency.account"]},{prefix:"iam.authZ.",requireAnyAll:[["core.agency.account"],["core.subaccount.account"]]},{prefix:"core.subaccount.",requireAny:["core.agency.subaccounts","core.subaccount.account"]},{prefix:"core.apps.",requireAny:["core.apps.api_keys","core.apps.app","core.apps.webhooks"]},{prefix:"core.billing.priority_support.",requireAny:["core.billing.priority_support"]},{prefix:"core.billing.rebilling.",requireAny:["crm.customers.billing"]},{prefix:"crm.customers.contact.",requireAny:["crm.customers.contact"]},{prefix:"crm.customers.billing.",requireAny:["crm.customers.billing"]},{prefix:"crm.funnels.content.",requireAny:["crm.funnels.content"]},{prefix:"crm.pipelines.lane.",requireAny:["crm.pipelines.lane"]},{prefix:"crm.pipelines.ticket.",requireAny:["crm.pipelines.lane"]},{prefix:"crm.pipelines.tag.",requireAny:["crm.pipelines.lane"]},{prefix:"crm.media.file.",requireAny:["crm.media.file"]},{prefix:"fi.configuration.",requireAny:["fi.general_ledger.settings","fi.accounts_receivable.subledgers","fi.accounts_payable.subledgers","fi.bank_ledger.bank_accounts","fi.controlling.cost_centers","fi.advanced_reporting.financial_statements"]},{prefix:"fi.general_ledger.",requireAny:["fi.general_ledger.settings"]},{prefix:"fi.accounts_receivable.",requireAny:["fi.accounts_receivable.subledgers"]},{prefix:"fi.accounts_payable.",requireAny:["fi.accounts_payable.subledgers"]},{prefix:"fi.bank_ledger.",requireAny:["fi.bank_ledger.bank_accounts"]},{prefix:"fi.controlling.",requireAny:["fi.controlling.cost_centers"]},{prefix:"fi.advanced_reporting.",requireAny:["fi.advanced_reporting.financial_statements"]},{prefix:"co.cost_centers.",requireAny:["co.cost_centers.master_data"]},{prefix:"co.profit_centers.",requireAny:["co.profit_centers.master_data"]},{prefix:"co.internal_orders.",requireAny:["co.internal_orders.master_data"]},{prefix:"co.profitability.",requireAny:["co.profitability.segments"]},{prefix:"co.budgets.",requireAny:["co.budgets.planning"]}];function s(e){if(!e)return!1;if("BOOLEAN"===e.valueType)return e.isEnabled;if(!e.isEnabled)return!1;if(e.isUnlimited||(e.maxInt??e.includedInt??0)>0)return!0;let r=parseFloat(e.maxDec??e.includedDec??"0");return Number.isFinite(r)&&r>0}let c=async()=>{let e=await (0,r.auth)(),a=e?.user?.id;return a?t.db.user.findUnique({where:{id:a},include:{AgencyMemberships:{where:{isActive:!0},include:{Agency:!0,Role:{include:{Permissions:{where:{granted:!0},include:{Permission:!0}}}}}},SubAccountMemberships:{where:{isActive:!0},include:{SubAccount:!0,Role:{include:{Permissions:{where:{granted:!0},include:{Permission:!0}}}}}}}}):null},o=async()=>{let e=await c();if(!e)return[];let r=e.AgencyMemberships.flatMap(e=>e.Role.Permissions.map(e=>e.Permission)),t=e.SubAccountMemberships.flatMap(e=>e.Role.Permissions.map(e=>e.Permission)),a={};for(let e of[...r,...t])a[e.key]=e;return Object.keys(a).map(e=>a[e])},l=async()=>(await o()).map(e=>e.key),u=async e=>{let r=e.trim();return(await l()).includes(r)},g=async e=>{let r=await c();if(!r)return[];let t=r.AgencyMemberships.find(r=>r.agencyId===e);return t?t.Role.Permissions.map(e=>e.Permission.key):[]},d=async e=>{let r=await c();if(!r)return[];let t=r.SubAccountMemberships.find(r=>r.subAccountId===e);return t?t.Role.Permissions.map(e=>e.Permission.key):[]},m=async(e,r)=>{let t=r.trim();return(await g(e)).includes(t)},p=async(e,r)=>{let t=r.trim();return(await d(e)).includes(t)},f=async(e,r)=>{let c,o=await (0,a.resolveEffectiveEntitlements)({scope:"SUBACCOUNT"===r?"SUBACCOUNT":"AGENCY",agencyId:e,subAccountId:null}),l="AGENCY"===r?["core.agency.","core.billing.","core.apps.","core.experimental.","crm.","fi."]:["core.subaccount.","crm.","fi."],u=(c=[],!function e(r,t){if(r&&"object"==typeof r)for(let a of Object.values(r))"string"==typeof a?t.push(a):a&&"object"==typeof a&&e(a,t)}(i.KEYS,c),Array.from(new Set(c)).sort((e,r)=>e.localeCompare(r)).map(e=>{var r;let t,a,i;return{key:e,name:(a=(t=(r=e).split("."))[t.length-1]??r,i=t[t.length-2]??"",`${i} ${a}`.trim().replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())),description:null,category:e.split(".").slice(0,2).join("."),isSystem:!0}})).filter(e=>l.some(r=>e.key.startsWith(r))).filter(e=>(function(e,r){let t=function(e){let r=null;for(let t of n)e.startsWith(t.prefix)&&(!r||t.prefix.length>r.prefix.length)&&(r=t);return r}(e);if(!t)return!(e.startsWith("fi.")||e.startsWith("co."));if(t.requireAll?.length){for(let e of t.requireAll)if(!s(r[e]))return!1}return(!t.requireAnyAll?.length||!!t.requireAnyAll.some(e=>e.every(e=>s(r[e]))))&&(!t.requireAny?.length||t.requireAny.some(e=>s(r[e])))})(e.key,o));await t.db.permission.createMany({data:u.map(e=>({key:e.key,name:e.name,description:e.description,category:e.category,isSystem:e.isSystem})),skipDuplicates:!0});let g=await t.db.permission.findMany({where:{key:{in:u.map(e=>e.key)}},orderBy:[{category:"asc"},{key:"asc"}]}),d={};for(let e of g)d[e.category]||(d[e.category]=[]),d[e.category].push(e);return d},b=async(e,r)=>Object.values(await f(e,r)).flat().map(e=>e.key),_=async(e,r,t)=>{let a=new Set(await b(e,r)),i=t.filter(e=>!a.has(e));return{valid:0===i.length,invalidKeys:i}},y=async()=>{let e=await c();if(!e)return[];let r=[],t=new Map;for(let r of e.SubAccountMemberships){let e=r.SubAccount,a=e.agencyId,i={id:e.id,name:e.name,logo:e.subAccountLogo||void 0,type:"subaccount"};t.has(a)||t.set(a,[]),t.get(a).push(i)}for(let a of e.AgencyMemberships){let e=a.Agency,i=t.get(e.id)||[];r.push({id:e.id,name:e.name,logo:e.agencyLogo||void 0,type:"agency",subaccounts:i.length>0?i:void 0})}return r};e.s(["getAgencyPermissionKeys",0,g,"getAuthUserMemberships",0,c,"getEntitledPermissionKeys",0,b,"getEntitledPermissions",0,f,"getSubAccountPermissionKeys",0,d,"getUserAccessibleTeams",0,y,"getUserPermissionKeys",0,l,"getUserPermissions",0,o,"hasAgencyPermission",0,m,"hasPermission",0,u,"hasSubAccountPermission",0,p,"validatePermissionKeys",0,_],907117)},997953,(e,r,t)=>{"use strict";r.exports=e.r(442315).vendored["react-rsc"].ReactServerDOMTurbopackServer},745015,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"registerServerReference",{enumerable:!0,get:function(){return a.registerServerReference}});let a=e.r(997953)},195975,(e,r,t)=>{"use strict";function a(e){for(let r=0;r<e.length;r++){let t=e[r];if("function"!=typeof t)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof t}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ensureServerEntryExports",{enumerable:!0,get:function(){return a}})}];

//# sourceMappingURL=_8304135e._.js.map