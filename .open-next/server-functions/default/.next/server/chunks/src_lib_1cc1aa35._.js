module.exports=[883406,e=>{"use strict";e.s(["KEYS",0,{core:{organization:{profile:{view:"core.organization.profile.view",manage:"core.organization.profile.manage"},security:{view:"core.organization.security.view",manage:"core.organization.security.manage"},integrations:{view:"core.organization.integrations.view",manage:"core.organization.integrations.manage"},automation:{view:"core.organization.automation.view",manage:"core.organization.automation.manage"}},agency:{account:{read:"core.agency.account.read",update:"core.agency.account.update",delete:"core.agency.account.delete"},subaccounts:{read:"core.agency.subaccounts.read",create:"core.agency.subaccounts.create",update:"core.agency.subaccounts.update",delete:"core.agency.subaccounts.delete"},team_member:{invite:"core.agency.team_member.invite",remove:"core.agency.team_member.remove",manage:"core.agency.team_member.manage"},settings:{view:"core.agency.settings.view",manage:"core.agency.settings.manage"},storage:{view:"core.agency.storage.view",manage:"core.agency.storage.manage"}},billing:{account:{view:"core.billing.account.view",manage:"core.billing.account.manage"},payment_methods:{read:"core.billing.payment_methods.read",create:"core.billing.payment_methods.create",delete:"core.billing.payment_methods.delete"},subscription:{view:"core.billing.subscription.view",manage:"core.billing.subscription.manage"},features:{manage:"core.billing.features.manage"},usage:{view:"core.billing.usage.view",consume:"core.billing.usage.consume"},entitlements:{view:"core.billing.entitlements.view"},credits:{view:"core.billing.credits.view"},rebilling:{manage:"core.billing.rebilling.manage"},priority_support:{view:"core.billing.priority_support.view"}},subaccount:{account:{read:"core.subaccount.account.read",update:"core.subaccount.account.update",delete:"core.subaccount.account.delete"},team_member:{invite:"core.subaccount.team_member.invite",remove:"core.subaccount.team_member.remove"}},experimental:{flag:{toggle:"core.experimental.flag.toggle"}},apps:{app:{view:"core.apps.app.view",install:"core.apps.app.install",manage:"core.apps.app.manage",uninstall:"core.apps.app.uninstall"},webhooks:{manage:"core.apps.webhooks.manage",view:"core.apps.webhooks.view"},api_keys:{read:"core.apps.api_keys.read",create:"core.apps.api_keys.create",delete:"core.apps.api_keys.delete"}},support:{tickets:{view:"core.support.tickets.view",create:"core.support.tickets.create",update:"core.support.tickets.update",close:"core.support.tickets.close"},diagnostics:{run:"core.support.diagnostics.run"}}},iam:{authZ:{roles:{read:"iam.authZ.roles.read",create:"iam.authZ.roles.create",update:"iam.authZ.roles.update",delete:"iam.authZ.roles.delete"},permissions:{view:"iam.authZ.permissions.view"},members:{assign:"iam.authZ.members.assign",revoke:"iam.authZ.members.revoke"}}},fi:{configuration:{fiscal_years:{view:"fi.configuration.fiscal_years.view",manage:"fi.configuration.fiscal_years.manage"},currencies:{view:"fi.configuration.currencies.view",manage:"fi.configuration.currencies.manage"},tax_settings:{view:"fi.configuration.tax_settings.view",manage:"fi.configuration.tax_settings.manage"},tolerances:{view:"fi.configuration.tolerances.view",manage:"fi.configuration.tolerances.manage"},number_ranges:{view:"fi.configuration.number_ranges.view",manage:"fi.configuration.number_ranges.manage"},posting_rules:{view:"fi.configuration.posting_rules.view",manage:"fi.configuration.posting_rules.manage",simulate:"fi.configuration.posting_rules.simulate"}},master_data:{accounts:{view:"fi.master_data.accounts.view",manage:"fi.master_data.accounts.manage"},customers:{view:"fi.master_data.customers.view",manage:"fi.master_data.customers.manage"},vendors:{view:"fi.master_data.vendors.view",manage:"fi.master_data.vendors.manage"},banks:{view:"fi.master_data.banks.view",manage:"fi.master_data.banks.manage"}},general_ledger:{accounts:{view:"fi.general_ledger.accounts.view",manage:"fi.general_ledger.accounts.manage"},subledgers:{view:"fi.general_ledger.subledgers.view",allocate:"fi.general_ledger.subledgers.allocate",manage:"fi.general_ledger.subledgers.manage"},balances:{view:"fi.general_ledger.balances.view",recalculate:"fi.general_ledger.balances.recalculate",rollforward:"fi.general_ledger.balances.rollforward"},settings:{view:"fi.general_ledger.settings.view",manage:"fi.general_ledger.settings.manage",setup:"fi.general_ledger.settings.setup"},journal_entries:{read:"fi.general_ledger.journal_entries.read",create:"fi.general_ledger.journal_entries.create",update:"fi.general_ledger.journal_entries.update",submit:"fi.general_ledger.journal_entries.submit",delete:"fi.general_ledger.journal_entries.delete",reverse:"fi.general_ledger.journal_entries.reverse",reject:"fi.general_ledger.journal_entries.reject",approve:"fi.general_ledger.journal_entries.approve"},reports:{view:"fi.general_ledger.reports.view",generate:"fi.general_ledger.reports.generate",approve:"fi.general_ledger.reports.approve",export:"fi.general_ledger.reports.export"},consolidation:{view:"fi.general_ledger.consolidation.view",manage:"fi.general_ledger.consolidation.manage"},year_end:{view:"fi.general_ledger.year_end.view",manage:"fi.general_ledger.year_end.manage",close:"fi.general_ledger.year_end.close"},reconciliation:{view:"fi.general_ledger.reconciliation.view",manage:"fi.general_ledger.reconciliation.manage",clear:"fi.general_ledger.reconciliation.clear",reset:"fi.general_ledger.reconciliation.reset"}},accounts_receivable:{subledgers:{view:"fi.accounts_receivable.subledgers.view",allocate:"fi.accounts_receivable.subledgers.allocate",manage:"fi.accounts_receivable.subledgers.manage"}},accounts_payable:{subledgers:{view:"fi.accounts_payable.subledgers.view",allocate:"fi.accounts_payable.subledgers.allocate",manage:"fi.accounts_payable.subledgers.manage"}},bank_ledger:{bank_accounts:{view:"fi.bank_ledger.bank_accounts.view",manage:"fi.bank_ledger.bank_accounts.manage"},subledgers:{view:"fi.bank_ledger.subledgers.view",allocate:"fi.bank_ledger.subledgers.allocate",manage:"fi.bank_ledger.subledgers.manage"}},controlling:{cost_centers:{view:"fi.controlling.cost_centers.view",manage:"fi.controlling.cost_centers.manage"}},advanced_reporting:{financial_statements:{view:"fi.advanced_reporting.financial_statements.view",generate:"fi.advanced_reporting.financial_statements.generate"},custom_reports:{view:"fi.advanced_reporting.custom_reports.view",create:"fi.advanced_reporting.custom_reports.create",update:"fi.advanced_reporting.custom_reports.update",delete:"fi.advanced_reporting.custom_reports.delete"}}},crm:{customers:{contact:{read:"crm.customers.contact.read",create:"crm.customers.contact.create",update:"crm.customers.contact.update",delete:"crm.customers.contact.delete"},billing:{read:"crm.customers.billing.read",create:"crm.customers.billing.create",update:"crm.customers.billing.update",delete:"crm.customers.billing.delete"}},media:{file:{read:"crm.media.file.read",create:"crm.media.file.create",delete:"crm.media.file.delete"}},funnels:{content:{read:"crm.funnels.content.read",create:"crm.funnels.content.create",update:"crm.funnels.content.update",delete:"crm.funnels.content.delete",publish:"crm.funnels.content.publish"}},pipelines:{lane:{read:"crm.pipelines.lane.read",create:"crm.pipelines.lane.create",update:"crm.pipelines.lane.update",delete:"crm.pipelines.lane.delete"},ticket:{read:"crm.pipelines.ticket.read",create:"crm.pipelines.ticket.create",update:"crm.pipelines.ticket.update",delete:"crm.pipelines.ticket.delete"},tag:{read:"crm.pipelines.tag.read",create:"crm.pipelines.tag.create",update:"crm.pipelines.tag.update",delete:"crm.pipelines.tag.delete"}}},co:{cost_centers:{master_data:{read:"co.cost_centers.master_data.read",create:"co.cost_centers.master_data.create",update:"co.cost_centers.master_data.update",delete:"co.cost_centers.master_data.delete"},hierarchy:{view:"co.cost_centers.hierarchy.view",manage:"co.cost_centers.hierarchy.manage"},allocations:{view:"co.cost_centers.allocations.view",execute:"co.cost_centers.allocations.execute"},reports:{view:"co.cost_centers.reports.view",generate:"co.cost_centers.reports.generate"}},profit_centers:{master_data:{read:"co.profit_centers.master_data.read",create:"co.profit_centers.master_data.create",update:"co.profit_centers.master_data.update",delete:"co.profit_centers.master_data.delete"},hierarchy:{view:"co.profit_centers.hierarchy.view",manage:"co.profit_centers.hierarchy.manage"},reports:{view:"co.profit_centers.reports.view",generate:"co.profit_centers.reports.generate"}},internal_orders:{master_data:{read:"co.internal_orders.master_data.read",create:"co.internal_orders.master_data.create",update:"co.internal_orders.master_data.update",close:"co.internal_orders.master_data.close"},settlement:{view:"co.internal_orders.settlement.view",execute:"co.internal_orders.settlement.execute"}},profitability:{segments:{view:"co.profitability.segments.view",manage:"co.profitability.segments.manage"},reports:{view:"co.profitability.reports.view",generate:"co.profitability.reports.generate"}},budgets:{planning:{view:"co.budgets.planning.view",create:"co.budgets.planning.create",update:"co.budgets.planning.update",approve:"co.budgets.planning.approve"},monitoring:{view:"co.budgets.monitoring.view",alerts:"co.budgets.monitoring.alerts"}}}}])},907117,e=>{"use strict";e.i(423502);var r=e.i(698902),a=e.i(843793),t=e.i(307144),i=e.i(883406);let n=[{prefix:"core.agency.",requireAny:["core.agency.account"]},{prefix:"core.billing.",requireAll:["core.agency.account"]},{prefix:"iam.authZ.",requireAnyAll:[["core.agency.account"],["core.subaccount.account"]]},{prefix:"core.subaccount.",requireAny:["core.agency.subaccounts","core.subaccount.account"]},{prefix:"core.apps.",requireAny:["core.apps.api_keys","core.apps.app","core.apps.webhooks"]},{prefix:"core.billing.priority_support.",requireAny:["core.billing.priority_support"]},{prefix:"core.billing.rebilling.",requireAny:["crm.customers.billing"]},{prefix:"crm.customers.contact.",requireAny:["crm.customers.contact"]},{prefix:"crm.customers.billing.",requireAny:["crm.customers.billing"]},{prefix:"crm.funnels.content.",requireAny:["crm.funnels.content"]},{prefix:"crm.pipelines.lane.",requireAny:["crm.pipelines.lane"]},{prefix:"crm.pipelines.ticket.",requireAny:["crm.pipelines.lane"]},{prefix:"crm.pipelines.tag.",requireAny:["crm.pipelines.lane"]},{prefix:"crm.media.file.",requireAny:["crm.media.file"]},{prefix:"fi.configuration.",requireAny:["fi.general_ledger.settings","fi.accounts_receivable.subledgers","fi.accounts_payable.subledgers","fi.bank_ledger.bank_accounts","fi.controlling.cost_centers","fi.advanced_reporting.financial_statements"]},{prefix:"fi.general_ledger.",requireAny:["fi.general_ledger.settings"]},{prefix:"fi.accounts_receivable.",requireAny:["fi.accounts_receivable.subledgers"]},{prefix:"fi.accounts_payable.",requireAny:["fi.accounts_payable.subledgers"]},{prefix:"fi.bank_ledger.",requireAny:["fi.bank_ledger.bank_accounts"]},{prefix:"fi.controlling.",requireAny:["fi.controlling.cost_centers"]},{prefix:"fi.advanced_reporting.",requireAny:["fi.advanced_reporting.financial_statements"]},{prefix:"co.cost_centers.",requireAny:["co.cost_centers.master_data"]},{prefix:"co.profit_centers.",requireAny:["co.profit_centers.master_data"]},{prefix:"co.internal_orders.",requireAny:["co.internal_orders.master_data"]},{prefix:"co.profitability.",requireAny:["co.profitability.segments"]},{prefix:"co.budgets.",requireAny:["co.budgets.planning"]}];function c(e){if(!e)return!1;if("BOOLEAN"===e.valueType)return e.isEnabled;if(!e.isEnabled)return!1;if(e.isUnlimited||(e.maxInt??e.includedInt??0)>0)return!0;let r=parseFloat(e.maxDec??e.includedDec??"0");return Number.isFinite(r)&&r>0}let s=async()=>{let e=await (0,r.auth)(),t=e?.user?.id;return t?a.db.user.findUnique({where:{id:t},include:{AgencyMemberships:{where:{isActive:!0},include:{Agency:!0,Role:{include:{Permissions:{where:{granted:!0},include:{Permission:!0}}}}}},SubAccountMemberships:{where:{isActive:!0},include:{SubAccount:!0,Role:{include:{Permissions:{where:{granted:!0},include:{Permission:!0}}}}}}}}):null},o=async()=>{let e=await s();if(!e)return[];let r=e.AgencyMemberships.flatMap(e=>e.Role.Permissions.map(e=>e.Permission)),a=e.SubAccountMemberships.flatMap(e=>e.Role.Permissions.map(e=>e.Permission)),t={};for(let e of[...r,...a])t[e.key]=e;return Object.keys(t).map(e=>t[e])},l=async()=>(await o()).map(e=>e.key),g=async e=>{let r=e.trim();return(await l()).includes(r)},u=async e=>{let r=await s();if(!r)return[];let a=r.AgencyMemberships.find(r=>r.agencyId===e);return a?a.Role.Permissions.map(e=>e.Permission.key):[]},m=async e=>{let r=await s();if(!r)return[];let a=r.SubAccountMemberships.find(r=>r.subAccountId===e);return a?a.Role.Permissions.map(e=>e.Permission.key):[]},p=async(e,r)=>{let a=r.trim();return(await u(e)).includes(a)},d=async(e,r)=>{let a=r.trim();return(await m(e)).includes(a)},f=async(e,r)=>{let s,o=await (0,t.resolveEffectiveEntitlements)({scope:"SUBACCOUNT"===r?"SUBACCOUNT":"AGENCY",agencyId:e,subAccountId:null}),l="AGENCY"===r?["core.agency.","core.billing.","core.apps.","core.experimental.","crm.","fi."]:["core.subaccount.","crm.","fi."],g=(s=[],!function e(r,a){if(r&&"object"==typeof r)for(let t of Object.values(r))"string"==typeof t?a.push(t):t&&"object"==typeof t&&e(t,a)}(i.KEYS,s),Array.from(new Set(s)).sort((e,r)=>e.localeCompare(r)).map(e=>{var r;let a,t,i;return{key:e,name:(t=(a=(r=e).split("."))[a.length-1]??r,i=a[a.length-2]??"",`${i} ${t}`.trim().replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())),description:null,category:e.split(".").slice(0,2).join("."),isSystem:!0}})).filter(e=>l.some(r=>e.key.startsWith(r))).filter(e=>(function(e,r){let a=function(e){let r=null;for(let a of n)e.startsWith(a.prefix)&&(!r||a.prefix.length>r.prefix.length)&&(r=a);return r}(e);if(!a)return!(e.startsWith("fi.")||e.startsWith("co."));if(a.requireAll?.length){for(let e of a.requireAll)if(!c(r[e]))return!1}return(!a.requireAnyAll?.length||!!a.requireAnyAll.some(e=>e.every(e=>c(r[e]))))&&(!a.requireAny?.length||a.requireAny.some(e=>c(r[e])))})(e.key,o));await a.db.permission.createMany({data:g.map(e=>({key:e.key,name:e.name,description:e.description,category:e.category,isSystem:e.isSystem})),skipDuplicates:!0});let u=await a.db.permission.findMany({where:{key:{in:g.map(e=>e.key)}},orderBy:[{category:"asc"},{key:"asc"}]}),m={};for(let e of u)m[e.category]||(m[e.category]=[]),m[e.category].push(e);return m},_=async(e,r)=>Object.values(await f(e,r)).flat().map(e=>e.key),b=async(e,r,a)=>{let t=new Set(await _(e,r)),i=a.filter(e=>!t.has(e));return{valid:0===i.length,invalidKeys:i}},y=async()=>{let e=await s();if(!e)return[];let r=[],a=new Map;for(let r of e.SubAccountMemberships){let e=r.SubAccount,t=e.agencyId,i={id:e.id,name:e.name,logo:e.subAccountLogo||void 0,type:"subaccount"};a.has(t)||a.set(t,[]),a.get(t).push(i)}for(let t of e.AgencyMemberships){let e=t.Agency,i=a.get(e.id)||[];r.push({id:e.id,name:e.name,logo:e.agencyLogo||void 0,type:"agency",subaccounts:i.length>0?i:void 0})}return r};e.s(["getAgencyPermissionKeys",0,u,"getAuthUserMemberships",0,s,"getEntitledPermissionKeys",0,_,"getEntitledPermissions",0,f,"getSubAccountPermissionKeys",0,m,"getUserAccessibleTeams",0,y,"getUserPermissionKeys",0,l,"getUserPermissions",0,o,"hasAgencyPermission",0,p,"hasPermission",0,g,"hasSubAccountPermission",0,d,"validatePermissionKeys",0,b],907117)}];

//# sourceMappingURL=src_lib_1cc1aa35._.js.map