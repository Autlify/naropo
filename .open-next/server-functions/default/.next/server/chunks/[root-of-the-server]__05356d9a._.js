module.exports=[974389,e=>{"use strict";var t=e.i(67982);e.s(["Prisma",0,t])},307144,e=>{"use strict";e.i(423502);var t=e.i(843793);function n(e){return null==e?null:"string"==typeof e?e:e.toString()}let r=new Set(["ACTIVE","TRIALING"]),a="false"!==process.env.ENTITLEMENTS_SUBACCOUNT_INHERIT_AGENCY;async function i(e){if("SUBACCOUNT"!==e.scope)return!1;if(null!=e.inheritAgencyEntitlements)return!!e.inheritAgencyEntitlements;if(e.subAccountId){let n=await t.db.subAccountSettings.findUnique({where:{subAccountId:e.subAccountId},select:{entitlementsInheritFromAgency:!0}});if(n?.entitlementsInheritFromAgency!=null)return!!n.entitlementsInheritFromAgency}let n=await t.db.agencySettings.findUnique({where:{agencyId:e.agencyId},select:{entitlementsInheritToSubaccounts:!0}});return n?.entitlementsInheritToSubaccounts??a}async function o(e,n=new Date){let a=await t.db.subscription.findFirst({where:{agencyId:e,status:{in:Array.from(r)},currentPeriodEndDate:{gt:n}},select:{priceId:!0}});return a?.priceId??null}async function u(e,n=new Date){return Array.from(new Set([await o(e,n),...(await t.db.addOns.findMany({where:{agencyId:e,active:!0},select:{priceId:!0}})).map(e=>e.priceId)].filter(Boolean)))}function s(e,t){let n=e??null,r=t??null;return null==n&&null==r?null:(n??0)+(r??0)}function c(e,t){return null==e&&null==t?null:null==e?t:null==t?e:e.plus?.(t)??e}async function l(e){let r=e.now??new Date,a=e.planId,o=a?[a]:await u(e.agencyId,r);if(!o.length)return{};let l=await t.db.planFeature.findMany({where:{planId:{in:o}},include:{EntitlementFeature:!0}}),d=new Map;for(let e of l){let t=d.get(e.featureKey)??[];t.push(e),d.set(e.featureKey,t)}let p=[];for(let[,e]of d)p.push(1===e.length?e[0]:function(e){let t=e[0];if(!t)throw Error("mergePlanFeatures called with empty list");return{...t,isEnabled:e.some(e=>e.isEnabled),isUnlimited:e.some(e=>e.isUnlimited),includedInt:e.reduce((e,t)=>s(e,t.includedInt),null),maxInt:e.reduce((e,t)=>s(e,t.maxInt),null),includedDec:e.reduce((e,t)=>c(e,t.includedDec),null),maxDec:e.reduce((e,t)=>c(e,t.maxDec),null),recurringCreditGrantInt:e.reduce((e,t)=>s(e,t.recurringCreditGrantInt),null),recurringCreditGrantDec:e.reduce((e,t)=>c(e,t.recurringCreditGrantDec),null),rolloverCredits:e.some(e=>e.rolloverCredits),topUpEnabled:e.some(e=>e.topUpEnabled),topUpPriceId:e.find(e=>e.topUpPriceId)?.topUpPriceId??t.topUpPriceId,enforcement:e.some(e=>"HARD"===e.enforcement)?"HARD":t.enforcement,overageMode:t.overageMode,overageFee:t.overageFee,stripeOveragePriceId:t.stripeOveragePriceId}}(e));let g=await i(e)?await t.db.entitlementOverride.findMany({where:{scope:"AGENCY",agencyId:e.agencyId,subAccountId:null,startsAt:{lte:r},OR:[{endsAt:null},{endsAt:{gte:r}}]}}):[],f=await t.db.entitlementOverride.findMany({where:{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId||null,startsAt:{lte:r},OR:[{endsAt:null},{endsAt:{gte:r}}]}}),y=[...g,...f],m=new Map;for(let e of g)m.set(e.featureKey,e);for(let e of f)m.set(e.featureKey,e);let I={};for(let e of p)I[e.featureKey]=function(e,t){let r=e.EntitlementFeature,a=(t?.isEnabled??!0)&&e.isEnabled,i=t?.isUnlimited??e.isUnlimited,o=e.maxInt??null,u=t?.maxOverrideInt!=null?t.maxOverrideInt:null!=o?o+(t?.maxDeltaInt??0):null,s=null!=e.maxDec?n(e.maxDec):null,c=t?.maxOverrideDec!=null?n(t.maxOverrideDec):null!=s?n(e.maxDec.plus?.(t?.maxDeltaDec??0)??e.maxDec):null;return{featureKey:e.featureKey,name:r.name,category:r.category,description:r.description,valueType:r.valueType,unit:r.unit,metering:r.metering,aggregation:r.aggregation,scope:r.scope,period:r.period,isEnabled:a,isUnlimited:i,includedInt:e.includedInt??null,maxInt:u,includedDec:null!=e.includedDec?n(e.includedDec):null,maxDec:c,enforcement:e.enforcement,overageMode:e.overageMode,creditEnabled:r.creditEnabled,creditUnit:r.creditUnit??null,creditExpires:r.creditExpires,creditPriority:r.creditPriority,recurringCreditGrantInt:e.recurringCreditGrantInt??null,recurringCreditGrantDec:null!=e.recurringCreditGrantDec?n(e.recurringCreditGrantDec):null,rolloverCredits:e.rolloverCredits,topUpEnabled:e.topUpEnabled,topUpPriceId:e.topUpPriceId??null}}(e,m.get(e.featureKey)||null);for(let e of y){if(I[e.featureKey])continue;let n=await t.db.entitlementFeature.findUnique({where:{key:e.featureKey}});n&&(I[e.featureKey]={featureKey:n.key,name:n.name,category:n.category,description:n.description,valueType:n.valueType,unit:n.unit,metering:n.metering,aggregation:n.aggregation,scope:n.scope,period:n.period,isEnabled:e.isEnabled??!1,isUnlimited:e.isUnlimited??!1,includedInt:0,maxInt:e.maxOverrideInt??e.maxDeltaInt??null,includedDec:"0",maxDec:e.maxOverrideDec?e.maxOverrideDec.toString():e.maxDeltaDec?e.maxDeltaDec.toString():null,enforcement:"HARD",overageMode:"NONE",creditEnabled:n.creditEnabled,creditUnit:n.creditUnit??null,creditExpires:n.creditExpires,creditPriority:n.creditPriority,recurringCreditGrantInt:null,recurringCreditGrantDec:null,rolloverCredits:!1,topUpEnabled:!1,topUpPriceId:null})}return I}function d(e){return e?"SUBACCOUNT":"AGENCY"}e.s(["inferScopeFromIds",()=>d,"resolveEffectiveEntitlements",()=>l],307144)},50377,e=>{"use strict";let t=process.env.LOG_LEVEL||"info",n=new class{level;prefix;levels={debug:0,info:1,warn:2,error:3};constructor(e){this.level=e.level,this.prefix=e.prefix||""}shouldLog(e){return this.levels[e]>=this.levels[this.level]}formatMessage(e){return this.prefix?`[${this.prefix}] ${e}`:e}formatData(e){if(e)return e instanceof Error?{...e,message:e.message,name:e.name,stack:e.stack}:e}debug(e,t){this.shouldLog("debug")&&console.debug(this.formatMessage(e),this.formatData(t))}info(e,t,n,r){this.shouldLog("info")&&console.info(this.formatMessage(e),this.formatData(t))}warn(e,t){this.shouldLog("warn")&&console.warn(this.formatMessage(e),this.formatData(t))}error(e,t){this.shouldLog("error")&&console.error(this.formatMessage(e),this.formatData(t))}}({level:t,prefix:"Autlify"});e.s(["logger",0,n])},312757,e=>{"use strict";async function t(e,t){return e.featureCreditBalance.findUnique({where:{scope_agencyId_subAccountId_featureKey:{scope:t.scope,agencyId:t.agencyId,subAccountId:t.subAccountId??"",featureKey:t.featureKey}}})}async function n(e,n){let r=await t(e,n);return r?r:e.featureCreditBalance.create({data:{scope:n.scope,agencyId:n.agencyId,subAccountId:n.subAccountId??"",featureKey:n.featureKey,balance:"0"}})}e.s(["getCreditBalance",()=>t,"getOrCreateCreditBalance",()=>n])},95927,e=>{"use strict";function t(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))}function n(e,t){let n=new Date(e);return n.setUTCDate(n.getUTCDate()+t),n}function r(e,a=new Date){let i=new Date(a);switch(e){case"DAILY":{let e=t(i),r=n(e,1);return{periodStart:e,periodEnd:r}}case"WEEKLY":{let e=i.getUTCDay(),r=n(t(i),-((e+6)%7)),a=n(r,7);return{periodStart:r,periodEnd:a}}case"YEARLY":return{periodStart:new Date(Date.UTC(i.getUTCFullYear(),0,1)),periodEnd:new Date(Date.UTC(i.getUTCFullYear()+1,0,1))};default:return{periodStart:new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),1)),periodEnd:new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth()+1,1))}}}function a(e,t,i=new Date){let o=Math.max(0,Math.floor(Number(t)||0));if(0===o)return r(e,i);let u=r(e,i);switch(e){case"DAILY":return{periodStart:n(u.periodStart,-o),periodEnd:n(u.periodEnd,-o)};case"WEEKLY":{let e=7*o;return{periodStart:n(u.periodStart,-e),periodEnd:n(u.periodEnd,-e)}}case"YEARLY":return{periodStart:new Date(Date.UTC(u.periodStart.getUTCFullYear()-o,0,1)),periodEnd:new Date(Date.UTC(u.periodEnd.getUTCFullYear()-o,0,1))};default:{let e=u.periodStart.getUTCFullYear(),t=u.periodStart.getUTCMonth();return{periodStart:new Date(Date.UTC(e,t-o,1)),periodEnd:new Date(Date.UTC(e,t-o+1,1))}}}}e.s(["getUsageWindow",()=>r,"getUsageWindowWithOffset",()=>a])},408401,e=>{"use strict";async function t(e,t){return e.featureCreditLedger.findUnique({where:{idempotencyKey:t}})}async function n(e,n){let r=await t(e,n.idempotencyKey);return r||e.featureCreditLedger.create({data:{scope:n.scope,agencyId:n.agencyId,subAccountId:n.subAccountId,featureKey:n.featureKey,type:n.type,delta:n.delta,reason:n.reason??null,periodStart:n.periodStart??null,periodEnd:n.periodEnd??null,stripePaymentIntentId:n.stripePaymentIntentId??null,stripeInvoiceId:n.stripeInvoiceId??null,idempotencyKey:n.idempotencyKey}})}e.s(["createCreditLedger",()=>n])},66569,e=>{"use strict";e.i(423502),e.i(828189);var t=e.i(974389),n=e.i(843793),r=e.i(307144),a=e.i(95927);async function i(e,t,n,r){let a=t.subAccountId??"",i=await e.usageTracking.findUnique({where:{scope_agencyId_subAccountId_featureKey_periodStart:{scope:t.scope,agencyId:t.agencyId,subAccountId:a,featureKey:t.featureKey,periodStart:t.periodStart}}});return i||e.usageTracking.create({data:{scope:t.scope,agencyId:t.agencyId,subAccountId:a,featureKey:t.featureKey,currentUsage:"0",period:r,periodStart:n.periodStart,periodEnd:n.periodEnd}})}async function o(e,t){return e.usageEvent.findUnique({where:{idempotencyKey:t}})}async function u(e,t){return e.usageEvent.create({data:t})}var s=e.i(312757),c=e.i(408401);async function l(e,n){let r=Math.max(0,Number(n.amount)||0);if(0===r||await e.featureCreditLedger.findUnique({where:{idempotencyKey:n.idempotencyKey}}))return{consumed:0,remaining:Number((await (0,s.getOrCreateCreditBalance)(e,{scope:n.scope,agencyId:n.agencyId,subAccountId:n.subAccountId,featureKey:n.featureKey})).balance.toString())};let a=await (0,s.getOrCreateCreditBalance)(e,{scope:n.scope,agencyId:n.agencyId,subAccountId:n.subAccountId,featureKey:n.featureKey}),i=Number(a.balance.toString()),o=i-r;return o<0?{consumed:0,remaining:i}:(await (0,c.createCreditLedger)(e,{scope:n.scope,agencyId:n.agencyId,subAccountId:n.subAccountId,featureKey:n.featureKey,type:"CONSUME",delta:new t.Prisma.Decimal(-r),reason:n.reason??"Usage consume",idempotencyKey:n.idempotencyKey}),{consumed:r,remaining:Number((await e.featureCreditBalance.update({where:{id:a.id},data:{balance:new t.Prisma.Decimal(o)}})).balance.toString())})}function d(e){if(null==e)return 0;let t=Number(e.toString?.()??e);return Number.isFinite(t)?t:0}async function p(e){let t=e.now??new Date,i=await (0,r.resolveEffectiveEntitlements)({scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId||null});if(!i.planId)return{allowed:!1,reason:"NO_SUBSCRIPTION",currentUsage:0,quantity:e.quantity,nextUsage:e.quantity};let o=i[e.featureKey];if(!o||!o.isEnabled)return{allowed:!1,reason:"FEATURE_DISABLED",currentUsage:0,quantity:e.quantity,nextUsage:e.quantity};let u=o.period??"MONTHLY",{periodStart:s}=(0,a.getUsageWindow)(u,t),c=await n.db.usageTracking.findUnique({where:{scope_agencyId_subAccountId_featureKey_periodStart:{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId||"",featureKey:e.featureKey,periodStart:s}}}),l=d(c?.currentUsage),p=Math.max(0,Number(e.quantity)||0),g=l+p,f=o.isUnlimited?null:null!=o.maxInt?Number(o.maxInt):null!=o.maxDec?Number(o.maxDec):null;if(null==f||g<=f)return{allowed:!0,overageMode:o.overageMode,currentUsage:l,quantity:p,nextUsage:g,maxAllowed:f};let y=g-f;if("INTERNAL_CREDITS"!==o.overageMode)return{allowed:!1,reason:"LIMIT_EXCEEDED",overageMode:o.overageMode,currentUsage:l,quantity:p,nextUsage:g,maxAllowed:f};let m=await n.db.featureCreditBalance.findUnique({where:{scope_agencyId_subAccountId_featureKey:{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId||"",featureKey:e.featureKey}}}),I=d(m?.balance);return I<y?{allowed:!1,reason:"INSUFFICIENT_CREDITS",overageMode:o.overageMode,currentUsage:l,quantity:p,nextUsage:g,maxAllowed:f,creditsAvailable:I,creditsRequired:y}:{allowed:!0,overageMode:o.overageMode,currentUsage:l,quantity:p,nextUsage:g,maxAllowed:f,creditsAvailable:I,creditsRequired:y}}async function g(e){let c=e.now??new Date;return n.db.$transaction(async n=>{let p=await o(n,e.idempotencyKey);if(p){let e=d(p.quantity);return{allowed:!0,currentUsage:0,quantity:e,nextUsage:e,creditsConsumed:0}}let g=await (0,r.resolveEffectiveEntitlements)({scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId??null});if(!g.planId)return{allowed:!1,reason:"NO_SUBSCRIPTION",currentUsage:0,quantity:e.quantity,nextUsage:e.quantity};let f=g[e.featureKey];if(!f||!f.isEnabled)return{allowed:!1,reason:"FEATURE_DISABLED",currentUsage:0,quantity:e.quantity,nextUsage:e.quantity};let y=f.period??"MONTHLY",{periodStart:m,periodEnd:I}=(0,a.getUsageWindow)(y,c),h=await i(n,{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId||"",featureKey:e.featureKey,periodStart:m},{periodStart:m,periodEnd:I},y),E=d(h.currentUsage),w=Math.max(0,Number(e.quantity)||0),b=E+w,v=f.isUnlimited?null:null!=f.maxInt?Number(f.maxInt):null!=f.maxDec?Number(f.maxDec):null,C=0;if(null!=v&&b>v){let t=b-v;if("INTERNAL_CREDITS"!==f.overageMode)return{allowed:!1,reason:"LIMIT_EXCEEDED",overageMode:f.overageMode,currentUsage:E,quantity:w,nextUsage:b,maxAllowed:v};let r=await (0,s.getCreditBalance)(n,{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId??null,featureKey:e.featureKey}),a=d(r?.balance);if(a<t)return{allowed:!1,reason:"INSUFFICIENT_CREDITS",overageMode:f.overageMode,currentUsage:E,quantity:w,nextUsage:b,maxAllowed:v,creditsAvailable:a,creditsRequired:t};C=t,await l(n,{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId??null,featureKey:e.featureKey,amount:t,idempotencyKey:`consume:${e.idempotencyKey}`,reason:`Usage overage for ${e.featureKey}`})}return await u(n,{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId??null,featureKey:e.featureKey,quantity:new t.Prisma.Decimal(w),actionKey:e.actionKey??null,idempotencyKey:e.idempotencyKey}),await n.usageTracking.update({where:{id:h.id},data:{currentUsage:new t.Prisma.Decimal(b),lastEventAt:c}}),{allowed:!0,overageMode:f.overageMode,currentUsage:E,quantity:w,nextUsage:b,maxAllowed:v,creditsConsumed:C}})}e.s(["checkUsage",()=>p,"consumeUsage",()=>g],66569)},115977,e=>{"use strict";var t=e.i(747909),n=e.i(174017),r=e.i(996250),a=e.i(759756),i=e.i(561916),o=e.i(174677),u=e.i(869741),s=e.i(316795),c=e.i(487718),l=e.i(995169),d=e.i(47587),p=e.i(666012),g=e.i(570101),f=e.i(626937),y=e.i(10372),m=e.i(193695);e.i(52474);var I=e.i(600220),h=e.i(89171),E=e.i(661418),w=e.i(50377),b=e.i(66569);async function v(e){try{let{scope:t}=await (0,E.requireRequestAccess)({req:e,requiredKeys:["core.billing.usage.consume"],requireActiveSubscription:!0}),n=(t.kind,t.agencyId),r="subaccount"===t.kind?t.subAccountId:null,a="subaccount"===t.kind?"SUBACCOUNT":"AGENCY",i=await e.json().catch(()=>null);if(!i?.featureKey)return h.NextResponse.json({ok:!1,reason:"BAD_REQUEST"},{status:400});let o=i.featureKey,u=i.quantity??1,s=Number(u),c=i.idempotencyKey,l=i.actionKey??null;if(!c)return h.NextResponse.json({ok:!1,reason:"MISSING_IDEMPOTENCY_KEY"},{status:400});if(!Number.isFinite(s)||s<=0)return h.NextResponse.json({ok:!1,reason:"INVALID_QUANTITY"},{status:400});let d=await (0,b.consumeUsage)({scope:a,agencyId:n,subAccountId:r,featureKey:o,quantity:s,actionKey:l,idempotencyKey:c});return h.NextResponse.json({ok:!0,result:d})}catch(e){if(e instanceof E.ApiAuthzError)return h.NextResponse.json({ok:!1,reason:e.code,message:e.message},{status:e.status});return w.logger.error("Error consuming usage",{error:e}),h.NextResponse.json({ok:!1,reason:"INTERNAL_ERROR"},{status:500})}}e.s(["POST",()=>v],35784);var C=e.i(35784);let A=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/features/core/billing/usage/consume/route",pathname:"/api/features/core/billing/usage/consume",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/features/core/billing/usage/consume/route.ts",nextConfigOutput:"standalone",userland:C}),{workAsyncStorage:U,workUnitAsyncStorage:D,serverHooks:R}=A;function T(){return(0,r.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:D})}async function x(e,t,r){A.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let h="/api/features/core/billing/usage/consume/route";h=h.replace(/\/index$/,"")||"/";let E=await A.prepare(e,t,{srcPage:h,multiZoneDraftMode:!1});if(!E)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:b,nextConfig:v,parsedUrl:C,isDraftMode:U,prerenderManifest:D,routerServerContext:R,isOnDemandRevalidate:T,revalidateOnlyGenerated:x,resolvedPathname:_,clientReferenceManifest:N,serverActionsManifest:K}=E,S=(0,u.normalizeAppPath)(h),M=!!(D.dynamicRoutes[S]||D.routes[_]),O=async()=>((null==R?void 0:R.render404)?await R.render404(e,t,C,!1):t.end("This page could not be found"),null);if(M&&!U){let e=!!D.routes[_],t=D.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await O();throw new m.NoFallbackError}}let P=null;!M||A.isDev||U||(P="/index"===(P=_)?"/":P);let q=!0===A.isDev||!M,k=M&&!q;K&&N&&(0,o.setManifestsSingleton)({page:h,clientReferenceManifest:N,serverActionsManifest:K});let F=e.method||"GET",L=(0,i.getTracer)(),Y=L.getActiveScopeSpan(),B={params:b,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,a)=>A.onRequestError(e,t,r,a,R)},sharedContext:{buildId:w}},H=new s.NodeNextRequest(e),j=new s.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(H,(0,c.signalFromNodeResponse)(t));try{let o=async e=>A.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=L.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${F} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${h}`)}),u=!!(0,a.getRequestMeta)(e,"minimalMode"),s=async a=>{var i,s;let c=async({previousCacheEntry:n})=>{try{if(!u&&T&&x&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let c=B.renderOpts.collectedTags;if(!M)return await (0,p.sendResponse)(H,j,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:I.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:T})},!1,R),t}},l=await A.handleResponse({req:e,nextConfig:v,cacheKey:P,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:x,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:u});if(!M)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==I.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(s=l.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});u||t.setHeader("x-nextjs-cache",T?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),U&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,g.fromNodeOutgoingHttpHeaders)(l.value.headers);return u&&M||m.delete(y.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,f.getCacheControlHeader)(l.cacheControl)),await (0,p.sendResponse)(H,j,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};Y?await s(Y):await L.withPropagatedContext(e.headers,()=>L.trace(l.BaseServerSpan.handleRequest,{spanName:`${F} ${h}`,kind:i.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},s))}catch(t){if(t instanceof m.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:T})},!1,R),M)throw t;return await (0,p.sendResponse)(H,j,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>T,"routeModule",()=>A,"serverHooks",()=>R,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>D],115977)},916005,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_node:buffer_00e2e67a._.js"].map(t=>e.l(t))).then(()=>t(951615)))},918707,e=>{e.v(t=>Promise.all(["server/chunks/2e4a4_@prisma_client_runtime_query_compiler_fast_bg_postgresql_mjs_35c4194d._.js"].map(t=>e.l(t))).then(()=>t(407142)))},480599,e=>{e.v(t=>Promise.all(["server/chunks/9c9c5_client_runtime_query_compiler_fast_bg_postgresql_wasm-base64_mjs_9e69af0b._.js"].map(t=>e.l(t))).then(()=>t(417734)))},642072,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__5460a96f._.js","server/chunks/_b96aa026._.js","server/chunks/src_lib_1cc1aa35._.js"].map(t=>e.l(t))).then(()=>t(485849)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__05356d9a._.js.map