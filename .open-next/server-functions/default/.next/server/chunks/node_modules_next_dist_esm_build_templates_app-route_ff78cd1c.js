module.exports=[444375,e=>{"use strict";var t=e.i(747909),r=e.i(174017),i=e.i(996250),a=e.i(759756),s=e.i(561916),n=e.i(174677),o=e.i(869741),c=e.i(316795),l=e.i(487718),p=e.i(995169),u=e.i(47587),d=e.i(666012),m=e.i(570101),h=e.i(626937),f=e.i(10372),b=e.i(193695);e.i(52474);var _=e.i(600220),y=e.i(445147),g=e.i(89171),v=e.i(822880);async function E(e){try{let t=new URL(e.url),r=t.searchParams.get("closed"),i=t.searchParams.get("configuration"),a={limit:100};null!==r&&(a.closed="true"===r),i&&(a.applied_configurations=[i]);let s=await y.stripe.v2.core.accounts.list(a);return g.NextResponse.json({accounts:s.data,hasMore:s.has_more})}catch(e){return console.error("Error fetching Stripe accounts:",e),g.NextResponse.json({error:"Failed to fetch Stripe accounts"},{status:500})}}function x(e){if(!e)return;let t=e.split("-");if(3===t.length)return{year:parseInt(t[0]),month:parseInt(t[1]),day:parseInt(t[2])}}function R(e){if(e)return{line1:e.line1,line2:e.line2,city:e.city,state:e.state,postal_code:e.postalCode,country:e.country}}async function N(e){try{let t=await e.json();console.log("ðŸ” Creating V2 account:",JSON.stringify(t,null,2));let{accountType:r,email:i,displayName:a,dashboard:s="none",identity:n,configuration:o,defaults:c,persons:l,include:p=["identity","configuration","defaults"],agencyId:u,subAccountId:d,metadata:m={},country:h,entityType:f,individual:b,merchant:_}=t;if(!r)return g.NextResponse.json({error:"accountType is required (merchant, recipient, or customer)"},{status:400});"customer"===r&&console.log("â„¹ï¸ Note: V2 customer config is for KYC/compliance, not billing");let v=n?.country||h||"MY",E=n?.entityType||f||"company",N={...m,...u&&{agencyId:u},...d&&{subAccountId:d},accountType:r,entityType:E,dashboard:s,createdAt:new Date().toISOString()},w=()=>{if(c?.responsibilities)return{responsibilities:{...c.responsibilities.feesCollector&&{fees_collector:c.responsibilities.feesCollector},...c.responsibilities.lossesCollector&&{losses_collector:c.responsibilities.lossesCollector}}}},q={contact_email:i,metadata:N,...a&&{display_name:a},dashboard:s,identity:(()=>{let e={country:v,entity_type:E};if("individual"===E){let t=n?.individualDetails||b;if(t){let r={};if("name"in t&&t.name){let e=t.name;r.name={given_name:e.givenName,surname:e.surname,...e.givenNameKana&&{given_name_kana:e.givenNameKana},...e.surnameKana&&{surname_kana:e.surnameKana},...e.givenNameKanji&&{given_name_kanji:e.givenNameKanji},...e.surnameKanji&&{surname_kanji:e.surnameKanji}}}else"firstName"in t&&"lastName"in t&&(r.name={given_name:t.firstName,surname:t.lastName});let i="dateOfBirth"in t?t.dateOfBirth:void 0;i&&(r.date_of_birth=x(i)),"phone"in t&&t.phone&&(r.phone=t.phone),"email"in t&&t.email&&(r.email=t.email);let a="address"in t?t.address:void 0;a&&(r.address=R(a)),"idNumber"in t&&t.idNumber&&(r.id_number=t.idNumber),"nationality"in t&&t.nationality&&(r.nationality=t.nationality),"politicalExposure"in t&&t.politicalExposure&&(r.political_exposure=t.politicalExposure),e.individual_details=r}}else{let t=n?.businessDetails||(_?{registeredName:_.businessName}:void 0);if(t){let r={};t.registeredName&&(r.registered_name=t.registeredName),t.doingBusinessAs&&(r.doing_business_as=t.doingBusinessAs),t.address&&(r.address=R(t.address)),t.phone&&(r.phone=t.phone),t.taxId&&(r.tax_id=t.taxId),t.vatId&&(r.vat_id=t.vatId),t.structure&&(r.structure=t.structure),t.mcc&&(r.mcc=t.mcc),t.productDescription&&(r.product_description=t.productDescription),t.url&&(r.url=t.url),t.supportEmail&&(r.support_email=t.supportEmail),t.supportPhone&&(r.support_phone=t.supportPhone),t.supportUrl&&(r.support_url=t.supportUrl),t.supportAddress&&(r.support_address=R(t.supportAddress)),e.business_details=r}}return e})(),configuration:(()=>{if(o){let e={};if(o.merchant){let t={};o.merchant.capabilities&&(t.capabilities={...o.merchant.capabilities.cardPayments&&{card_payments:{requested:o.merchant.capabilities.cardPayments.requested}},...o.merchant.capabilities.transfers&&{transfers:{requested:o.merchant.capabilities.transfers.requested}},...o.merchant.capabilities.bankPayments?.ach&&{bank_payments:{ach:{requested:o.merchant.capabilities.bankPayments.ach.requested}}}}),o.merchant.statementDescriptor&&(t.statement_descriptor=o.merchant.statementDescriptor),o.merchant.statementDescriptorPrefix&&(t.statement_descriptor_prefix=o.merchant.statementDescriptorPrefix),o.merchant.mcc&&(t.mcc=o.merchant.mcc),o.merchant.supportEmail&&(t.support_email=o.merchant.supportEmail),o.merchant.supportPhone&&(t.support_phone=o.merchant.supportPhone),o.merchant.supportUrl&&(t.support_url=o.merchant.supportUrl),e.merchant=t}if(o.recipient){let t={};o.recipient.capabilities&&(t.capabilities={...o.recipient.capabilities.stripeBalance?.stripeTransfers&&{stripe_balance:{stripe_transfers:{requested:o.recipient.capabilities.stripeBalance.stripeTransfers.requested}}},...o.recipient.capabilities.cards&&{cards:{requested:o.recipient.capabilities.cards.requested}},...o.recipient.capabilities.banksLocal&&{banks_local:{requested:o.recipient.capabilities.banksLocal.requested}},...o.recipient.capabilities.banksWire&&{banks_wire:{requested:o.recipient.capabilities.banksWire.requested}}}),e.recipient=t}if(o.customer){let t={};o.customer.capabilities?.automaticIndirectTax&&(t.capabilities={automatic_indirect_tax:{requested:o.customer.capabilities.automaticIndirectTax.requested}}),e.customer=t}return e}return"merchant"===r?{merchant:{capabilities:{card_payments:{requested:!0},transfers:{requested:!0}},..._?.statementDescriptor&&{statement_descriptor:_.statementDescriptor},..._?.mcc&&{mcc:_.mcc},..._?.supportEmail&&{support_email:_.supportEmail},..._?.supportPhone&&{support_phone:_.supportPhone},..._?.supportUrl&&{support_url:_.supportUrl}}}:"recipient"===r?{recipient:{capabilities:{stripe_balance:{stripe_transfers:{requested:!0}}}}}:"customer"===r?{customer:{capabilities:{automatic_indirect_tax:{requested:!0}}}}:void 0})(),...w()&&{defaults:w()},include:p.map(e=>"configuration"===e?`configuration.${r}`:e)};console.log("ðŸ“¤ Stripe V2 create params:",JSON.stringify(q,null,2));let C=await y.stripe.v2.core.accounts.create(q);console.log("âœ… Created V2 account:",C.id,"type:",r,"entity:",E);let P=[];if(l&&l.length>0&&"company"===E)for(let e of l)try{let t={...e.firstName&&e.lastName&&{given_name:e.firstName,family_name:e.lastName},...e.email&&{email:e.email},...e.phone&&{phone:e.phone},...e.dateOfBirth&&{date_of_birth:x(e.dateOfBirth)},...e.address&&{address:R(e.address)},...e.idNumber&&{id_number:e.idNumber},...e.nationality&&{nationality:e.nationality},...e.politicalExposure&&{political_exposure:e.politicalExposure},relationship:{...e.relationship?.representative&&{representative:!0},...e.relationship?.executive&&{executive:!0},...e.relationship?.director&&{director:!0},...e.relationship?.owner&&{owner:!0},...e.relationship?.percentOwnership&&{percent_ownership:e.relationship.percentOwnership},...e.relationship?.title&&{title:e.relationship.title}}},r=await y.stripe.v2.core.accounts.createPerson(C.id,t);P.push({id:r.id,relationship:e.relationship||{}}),console.log("âœ… Created person:",r.id,"for account:",C.id)}catch(e){console.error("âš ï¸ Error creating person:",e)}return g.NextResponse.json({ok:!0,account:{id:C.id,type:r,entityType:E,dashboard:s,email:C.contact_email,displayName:C.display_name,metadata:C.metadata,...P.length>0&&{persons:P}}})}catch(t){console.error("ðŸ”´ Error creating V2 account:",t);let e=t instanceof v.default.errors.StripeError?t.message:"Failed to create account";return g.NextResponse.json({error:e},{status:500})}}async function w(e){try{let t=await e.json();console.log("ðŸ”„ Updating V2 account:",t.accountId);let{accountId:r,email:i,displayName:a,dashboard:s,identity:n,configuration:o,defaults:c,include:l=["identity","configuration","defaults"],metadata:p,merchant:u}=t;if(!r)return g.NextResponse.json({error:"accountId is required"},{status:400});let d={...i&&{contact_email:i},...a&&{display_name:a},...s&&{dashboard:s},...p&&{metadata:p}};if(n){let e={};if(n.country&&(e.country=n.country),n.entityType&&(e.entity_type=n.entityType),n.individualDetails){let t=n.individualDetails,r={};t.name&&(r.name={...t.name.givenName&&{given_name:t.name.givenName},...t.name.surname&&{surname:t.name.surname}}),t.dateOfBirth&&(r.date_of_birth=x(t.dateOfBirth)),t.phone&&(r.phone=t.phone),t.email&&(r.email=t.email),t.address&&(r.address=R(t.address)),t.idNumber&&(r.id_number=t.idNumber),t.nationality&&(r.nationality=t.nationality),t.politicalExposure&&(r.political_exposure=t.politicalExposure),Object.keys(r).length>0&&(e.individual_details=r)}if(n.businessDetails){let t=n.businessDetails,r={};t.registeredName&&(r.registered_name=t.registeredName),t.doingBusinessAs&&(r.doing_business_as=t.doingBusinessAs),t.address&&(r.address=R(t.address)),t.phone&&(r.phone=t.phone),t.taxId&&(r.tax_id=t.taxId),t.vatId&&(r.vat_id=t.vatId),t.structure&&(r.structure=t.structure),t.mcc&&(r.mcc=t.mcc),t.productDescription&&(r.product_description=t.productDescription),t.url&&(r.url=t.url),t.supportEmail&&(r.support_email=t.supportEmail),t.supportPhone&&(r.support_phone=t.supportPhone),t.supportUrl&&(r.support_url=t.supportUrl),t.supportAddress&&(r.support_address=R(t.supportAddress)),Object.keys(r).length>0&&(e.business_details=r)}Object.keys(e).length>0&&(d.identity=e)}if(o||u){let e={};if(o?.merchant||u){let t=o?.merchant,r={};t?.capabilities&&(r.capabilities={...t.capabilities.cardPayments&&{card_payments:{requested:t.capabilities.cardPayments.requested}},...t.capabilities.transfers&&{transfers:{requested:t.capabilities.transfers.requested}}}),(t?.statementDescriptor||u?.statementDescriptor)&&(r.statement_descriptor=t?.statementDescriptor||u?.statementDescriptor),(t?.mcc||u?.mcc)&&(r.mcc=t?.mcc||u?.mcc),(t?.supportEmail||u?.supportEmail)&&(r.support_email=t?.supportEmail||u?.supportEmail),(t?.supportPhone||u?.supportPhone)&&(r.support_phone=t?.supportPhone||u?.supportPhone),(t?.supportUrl||u?.supportUrl)&&(r.support_url=t?.supportUrl||u?.supportUrl),Object.keys(r).length>0&&(e.merchant=r)}if(o?.recipient){let t=o.recipient,r={};t.capabilities&&(r.capabilities={...t.capabilities.stripeBalance?.stripeTransfers&&{stripe_balance:{stripe_transfers:{requested:t.capabilities.stripeBalance.stripeTransfers.requested}}},...t.capabilities.cards&&{cards:{requested:t.capabilities.cards.requested}},...t.capabilities.banksLocal&&{banks_local:{requested:t.capabilities.banksLocal.requested}},...t.capabilities.banksWire&&{banks_wire:{requested:t.capabilities.banksWire.requested}}}),Object.keys(r).length>0&&(e.recipient=r)}if(o?.customer){let t=o.customer;t.capabilities?.automaticIndirectTax&&(e.customer={capabilities:{automatic_indirect_tax:{requested:t.capabilities.automaticIndirectTax.requested}}})}Object.keys(e).length>0&&(d.configuration=e)}c?.responsibilities&&(d.defaults={responsibilities:{...c.responsibilities.feesCollector&&{fees_collector:c.responsibilities.feesCollector},...c.responsibilities.lossesCollector&&{losses_collector:c.responsibilities.lossesCollector}}}),d.include=l,console.log("ðŸ“¤ Stripe V2 update params:",JSON.stringify(d,null,2));let m=await y.stripe.v2.core.accounts.update(r,d);return console.log("âœ… Updated V2 account:",m.id),g.NextResponse.json({ok:!0,account:{id:m.id,email:m.contact_email,displayName:m.display_name,dashboard:m.dashboard,metadata:m.metadata}})}catch(t){console.error("ðŸ”´ Error updating V2 account:",t);let e=t instanceof v.default.errors.StripeError?t.message:"Failed to update account";return g.NextResponse.json({error:e},{status:500})}}e.s(["GET",()=>E,"PATCH",()=>w,"POST",()=>N],516560);var q=e.i(516560);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/stripe/v2/core/accounts/route",pathname:"/api/stripe/v2/core/accounts",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/stripe/v2/core/accounts/route.ts",nextConfigOutput:"standalone",userland:q}),{workAsyncStorage:P,workUnitAsyncStorage:T,serverHooks:k}=C;function O(){return(0,i.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:T})}async function A(e,t,i){C.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/stripe/v2/core/accounts/route";y=y.replace(/\/index$/,"")||"/";let g=await C.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:v,params:E,nextConfig:x,parsedUrl:R,isDraftMode:N,prerenderManifest:w,routerServerContext:q,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,resolvedPathname:k,clientReferenceManifest:O,serverActionsManifest:A}=g,D=(0,o.normalizeAppPath)(y),I=!!(w.dynamicRoutes[D]||w.routes[k]),S=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,R,!1):t.end("This page could not be found"),null);if(I&&!N){let e=!!w.routes[k],t=w.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await S();throw new b.NoFallbackError}}let U=null;!I||C.isDev||N||(U="/index"===(U=k)?"/":U);let j=!0===C.isDev||!I,B=I&&!j;A&&O&&(0,n.setManifestsSingleton)({page:y,clientReferenceManifest:O,serverActionsManifest:A});let H=e.method||"GET",K=(0,s.getTracer)(),M=K.getActiveScopeSpan(),V={params:E,prerenderManifest:w,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,a)=>C.onRequestError(e,t,i,a,q)},sharedContext:{buildId:v}},F=new c.NodeNextRequest(e),L=new c.NodeNextResponse(t),$=l.NextRequestAdapter.fromNodeNextRequest(F,(0,l.signalFromNodeResponse)(t));try{let n=async e=>C.handle($,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=K.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${H} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${y}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),c=async a=>{var s,c;let l=async({previousCacheEntry:r})=>{try{if(!o&&P&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await n(a);e.fetchMetrics=V.renderOpts.fetchMetrics;let c=V.renderOpts.pendingWaitUntil;c&&i.waitUntil&&(i.waitUntil(c),c=void 0);let l=V.renderOpts.collectedTags;if(!I)return await (0,d.sendResponse)(F,L,s,V.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,i=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:_.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:P})},!1,q),t}},p=await C.handleResponse({req:e,nextConfig:x,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:w,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:o});if(!I)return null;if((null==p||null==(s=p.value)?void 0:s.kind)!==_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(c=p.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let b=(0,m.fromNodeOutgoingHttpHeaders)(p.value.headers);return o&&I||b.delete(f.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||b.get("Cache-Control")||b.set("Cache-Control",(0,h.getCacheControlHeader)(p.cacheControl)),await (0,d.sendResponse)(F,L,new Response(p.value.body,{headers:b,status:p.value.status||200})),null};M?await c(M):await K.withPropagatedContext(e.headers,()=>K.trace(p.BaseServerSpan.handleRequest,{spanName:`${H} ${y}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},c))}catch(t){if(t instanceof b.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:P})},!1,q),I)throw t;return await (0,d.sendResponse)(F,L,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>O,"routeModule",()=>C,"serverHooks",()=>k,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>T],444375)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ff78cd1c.js.map