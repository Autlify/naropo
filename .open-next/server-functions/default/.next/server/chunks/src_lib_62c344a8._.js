module.exports=[883406,e=>{"use strict";e.s(["KEYS",0,{core:{organization:{profile:{view:"core.organization.profile.view",manage:"core.organization.profile.manage"},security:{view:"core.organization.security.view",manage:"core.organization.security.manage"},integrations:{view:"core.organization.integrations.view",manage:"core.organization.integrations.manage"},automation:{view:"core.organization.automation.view",manage:"core.organization.automation.manage"}},agency:{account:{read:"core.agency.account.read",update:"core.agency.account.update",delete:"core.agency.account.delete"},subaccounts:{read:"core.agency.subaccounts.read",create:"core.agency.subaccounts.create",update:"core.agency.subaccounts.update",delete:"core.agency.subaccounts.delete"},team_member:{invite:"core.agency.team_member.invite",remove:"core.agency.team_member.remove",manage:"core.agency.team_member.manage"},settings:{view:"core.agency.settings.view",manage:"core.agency.settings.manage"},storage:{view:"core.agency.storage.view",manage:"core.agency.storage.manage"}},billing:{account:{view:"core.billing.account.view",manage:"core.billing.account.manage"},payment_methods:{read:"core.billing.payment_methods.read",create:"core.billing.payment_methods.create",delete:"core.billing.payment_methods.delete"},subscription:{view:"core.billing.subscription.view",manage:"core.billing.subscription.manage"},features:{manage:"core.billing.features.manage"},usage:{view:"core.billing.usage.view",consume:"core.billing.usage.consume"},entitlements:{view:"core.billing.entitlements.view"},credits:{view:"core.billing.credits.view"},rebilling:{manage:"core.billing.rebilling.manage"},priority_support:{view:"core.billing.priority_support.view"}},subaccount:{account:{read:"core.subaccount.account.read",update:"core.subaccount.account.update",delete:"core.subaccount.account.delete"},team_member:{invite:"core.subaccount.team_member.invite",remove:"core.subaccount.team_member.remove"}},experimental:{flag:{toggle:"core.experimental.flag.toggle"}},apps:{app:{view:"core.apps.app.view",install:"core.apps.app.install",manage:"core.apps.app.manage",uninstall:"core.apps.app.uninstall"},webhooks:{manage:"core.apps.webhooks.manage",view:"core.apps.webhooks.view"},api_keys:{read:"core.apps.api_keys.read",create:"core.apps.api_keys.create",delete:"core.apps.api_keys.delete"}},support:{tickets:{view:"core.support.tickets.view",create:"core.support.tickets.create",update:"core.support.tickets.update",close:"core.support.tickets.close"},diagnostics:{run:"core.support.diagnostics.run"}}},iam:{authZ:{roles:{read:"iam.authZ.roles.read",create:"iam.authZ.roles.create",update:"iam.authZ.roles.update",delete:"iam.authZ.roles.delete"},permissions:{view:"iam.authZ.permissions.view"},members:{assign:"iam.authZ.members.assign",revoke:"iam.authZ.members.revoke"}}},fi:{configuration:{fiscal_years:{view:"fi.configuration.fiscal_years.view",manage:"fi.configuration.fiscal_years.manage"},currencies:{view:"fi.configuration.currencies.view",manage:"fi.configuration.currencies.manage"},tax_settings:{view:"fi.configuration.tax_settings.view",manage:"fi.configuration.tax_settings.manage"},tolerances:{view:"fi.configuration.tolerances.view",manage:"fi.configuration.tolerances.manage"},number_ranges:{view:"fi.configuration.number_ranges.view",manage:"fi.configuration.number_ranges.manage"},posting_rules:{view:"fi.configuration.posting_rules.view",manage:"fi.configuration.posting_rules.manage",simulate:"fi.configuration.posting_rules.simulate"}},master_data:{accounts:{view:"fi.master_data.accounts.view",manage:"fi.master_data.accounts.manage"},customers:{view:"fi.master_data.customers.view",manage:"fi.master_data.customers.manage"},vendors:{view:"fi.master_data.vendors.view",manage:"fi.master_data.vendors.manage"},banks:{view:"fi.master_data.banks.view",manage:"fi.master_data.banks.manage"}},general_ledger:{accounts:{view:"fi.general_ledger.accounts.view",manage:"fi.general_ledger.accounts.manage"},subledgers:{view:"fi.general_ledger.subledgers.view",allocate:"fi.general_ledger.subledgers.allocate",manage:"fi.general_ledger.subledgers.manage"},balances:{view:"fi.general_ledger.balances.view",recalculate:"fi.general_ledger.balances.recalculate",rollforward:"fi.general_ledger.balances.rollforward"},settings:{view:"fi.general_ledger.settings.view",manage:"fi.general_ledger.settings.manage",setup:"fi.general_ledger.settings.setup"},journal_entries:{read:"fi.general_ledger.journal_entries.read",create:"fi.general_ledger.journal_entries.create",update:"fi.general_ledger.journal_entries.update",submit:"fi.general_ledger.journal_entries.submit",delete:"fi.general_ledger.journal_entries.delete",reverse:"fi.general_ledger.journal_entries.reverse",reject:"fi.general_ledger.journal_entries.reject",approve:"fi.general_ledger.journal_entries.approve"},reports:{view:"fi.general_ledger.reports.view",generate:"fi.general_ledger.reports.generate",approve:"fi.general_ledger.reports.approve",export:"fi.general_ledger.reports.export"},consolidation:{view:"fi.general_ledger.consolidation.view",manage:"fi.general_ledger.consolidation.manage"},year_end:{view:"fi.general_ledger.year_end.view",manage:"fi.general_ledger.year_end.manage",close:"fi.general_ledger.year_end.close"},reconciliation:{view:"fi.general_ledger.reconciliation.view",manage:"fi.general_ledger.reconciliation.manage",clear:"fi.general_ledger.reconciliation.clear",reset:"fi.general_ledger.reconciliation.reset"}},accounts_receivable:{subledgers:{view:"fi.accounts_receivable.subledgers.view",allocate:"fi.accounts_receivable.subledgers.allocate",manage:"fi.accounts_receivable.subledgers.manage"}},accounts_payable:{subledgers:{view:"fi.accounts_payable.subledgers.view",allocate:"fi.accounts_payable.subledgers.allocate",manage:"fi.accounts_payable.subledgers.manage"}},bank_ledger:{bank_accounts:{view:"fi.bank_ledger.bank_accounts.view",manage:"fi.bank_ledger.bank_accounts.manage"},subledgers:{view:"fi.bank_ledger.subledgers.view",allocate:"fi.bank_ledger.subledgers.allocate",manage:"fi.bank_ledger.subledgers.manage"}},controlling:{cost_centers:{view:"fi.controlling.cost_centers.view",manage:"fi.controlling.cost_centers.manage"}},advanced_reporting:{financial_statements:{view:"fi.advanced_reporting.financial_statements.view",generate:"fi.advanced_reporting.financial_statements.generate"},custom_reports:{view:"fi.advanced_reporting.custom_reports.view",create:"fi.advanced_reporting.custom_reports.create",update:"fi.advanced_reporting.custom_reports.update",delete:"fi.advanced_reporting.custom_reports.delete"}}},crm:{customers:{contact:{read:"crm.customers.contact.read",create:"crm.customers.contact.create",update:"crm.customers.contact.update",delete:"crm.customers.contact.delete"},billing:{read:"crm.customers.billing.read",create:"crm.customers.billing.create",update:"crm.customers.billing.update",delete:"crm.customers.billing.delete"}},media:{file:{read:"crm.media.file.read",create:"crm.media.file.create",delete:"crm.media.file.delete"}},funnels:{content:{read:"crm.funnels.content.read",create:"crm.funnels.content.create",update:"crm.funnels.content.update",delete:"crm.funnels.content.delete",publish:"crm.funnels.content.publish"}},pipelines:{lane:{read:"crm.pipelines.lane.read",create:"crm.pipelines.lane.create",update:"crm.pipelines.lane.update",delete:"crm.pipelines.lane.delete"},ticket:{read:"crm.pipelines.ticket.read",create:"crm.pipelines.ticket.create",update:"crm.pipelines.ticket.update",delete:"crm.pipelines.ticket.delete"},tag:{read:"crm.pipelines.tag.read",create:"crm.pipelines.tag.create",update:"crm.pipelines.tag.update",delete:"crm.pipelines.tag.delete"}}},co:{cost_centers:{master_data:{read:"co.cost_centers.master_data.read",create:"co.cost_centers.master_data.create",update:"co.cost_centers.master_data.update",delete:"co.cost_centers.master_data.delete"},hierarchy:{view:"co.cost_centers.hierarchy.view",manage:"co.cost_centers.hierarchy.manage"},allocations:{view:"co.cost_centers.allocations.view",execute:"co.cost_centers.allocations.execute"},reports:{view:"co.cost_centers.reports.view",generate:"co.cost_centers.reports.generate"}},profit_centers:{master_data:{read:"co.profit_centers.master_data.read",create:"co.profit_centers.master_data.create",update:"co.profit_centers.master_data.update",delete:"co.profit_centers.master_data.delete"},hierarchy:{view:"co.profit_centers.hierarchy.view",manage:"co.profit_centers.hierarchy.manage"},reports:{view:"co.profit_centers.reports.view",generate:"co.profit_centers.reports.generate"}},internal_orders:{master_data:{read:"co.internal_orders.master_data.read",create:"co.internal_orders.master_data.create",update:"co.internal_orders.master_data.update",close:"co.internal_orders.master_data.close"},settlement:{view:"co.internal_orders.settlement.view",execute:"co.internal_orders.settlement.execute"}},profitability:{segments:{view:"co.profitability.segments.view",manage:"co.profitability.segments.manage"},reports:{view:"co.profitability.reports.view",generate:"co.profitability.reports.generate"}},budgets:{planning:{view:"co.budgets.planning.view",create:"co.budgets.planning.create",update:"co.budgets.planning.update",approve:"co.budgets.planning.approve"},monitoring:{view:"co.budgets.monitoring.view",alerts:"co.budgets.monitoring.alerts"}}}}])},307144,e=>{"use strict";e.i(423502);var t=e.i(843793);function a(e){return null==e?null:"string"==typeof e?e:e.toString()}let r=new Set(["ACTIVE","TRIALING"]),n="false"!==process.env.ENTITLEMENTS_SUBACCOUNT_INHERIT_AGENCY;async function i(e){if("SUBACCOUNT"!==e.scope)return!1;if(null!=e.inheritAgencyEntitlements)return!!e.inheritAgencyEntitlements;if(e.subAccountId){let a=await t.db.subAccountSettings.findUnique({where:{subAccountId:e.subAccountId},select:{entitlementsInheritFromAgency:!0}});if(a?.entitlementsInheritFromAgency!=null)return!!a.entitlementsInheritFromAgency}let a=await t.db.agencySettings.findUnique({where:{agencyId:e.agencyId},select:{entitlementsInheritToSubaccounts:!0}});return a?.entitlementsInheritToSubaccounts??n}async function c(e,a=new Date){let n=await t.db.subscription.findFirst({where:{agencyId:e,status:{in:Array.from(r)},currentPeriodEndDate:{gt:a}},select:{priceId:!0}});return n?.priceId??null}async function l(e,a=new Date){return Array.from(new Set([await c(e,a),...(await t.db.addOns.findMany({where:{agencyId:e,active:!0},select:{priceId:!0}})).map(e=>e.priceId)].filter(Boolean)))}function o(e,t){let a=e??null,r=t??null;return null==a&&null==r?null:(a??0)+(r??0)}function s(e,t){return null==e&&null==t?null:null==e?t:null==t?e:e.plus?.(t)??e}async function d(e){let r=e.now??new Date,n=e.planId,c=n?[n]:await l(e.agencyId,r);if(!c.length)return{};let d=await t.db.planFeature.findMany({where:{planId:{in:c}},include:{EntitlementFeature:!0}}),u=new Map;for(let e of d){let t=u.get(e.featureKey)??[];t.push(e),u.set(e.featureKey,t)}let g=[];for(let[,e]of u)g.push(1===e.length?e[0]:function(e){let t=e[0];if(!t)throw Error("mergePlanFeatures called with empty list");return{...t,isEnabled:e.some(e=>e.isEnabled),isUnlimited:e.some(e=>e.isUnlimited),includedInt:e.reduce((e,t)=>o(e,t.includedInt),null),maxInt:e.reduce((e,t)=>o(e,t.maxInt),null),includedDec:e.reduce((e,t)=>s(e,t.includedDec),null),maxDec:e.reduce((e,t)=>s(e,t.maxDec),null),recurringCreditGrantInt:e.reduce((e,t)=>o(e,t.recurringCreditGrantInt),null),recurringCreditGrantDec:e.reduce((e,t)=>s(e,t.recurringCreditGrantDec),null),rolloverCredits:e.some(e=>e.rolloverCredits),topUpEnabled:e.some(e=>e.topUpEnabled),topUpPriceId:e.find(e=>e.topUpPriceId)?.topUpPriceId??t.topUpPriceId,enforcement:e.some(e=>"HARD"===e.enforcement)?"HARD":t.enforcement,overageMode:t.overageMode,overageFee:t.overageFee,stripeOveragePriceId:t.stripeOveragePriceId}}(e));let m=await i(e)?await t.db.entitlementOverride.findMany({where:{scope:"AGENCY",agencyId:e.agencyId,subAccountId:null,startsAt:{lte:r},OR:[{endsAt:null},{endsAt:{gte:r}}]}}):[],p=await t.db.entitlementOverride.findMany({where:{scope:e.scope,agencyId:e.agencyId,subAccountId:e.subAccountId||null,startsAt:{lte:r},OR:[{endsAt:null},{endsAt:{gte:r}}]}}),f=[...m,...p],v=new Map;for(let e of m)v.set(e.featureKey,e);for(let e of p)v.set(e.featureKey,e);let _={};for(let e of g)_[e.featureKey]=function(e,t){let r=e.EntitlementFeature,n=(t?.isEnabled??!0)&&e.isEnabled,i=t?.isUnlimited??e.isUnlimited,c=e.maxInt??null,l=t?.maxOverrideInt!=null?t.maxOverrideInt:null!=c?c+(t?.maxDeltaInt??0):null,o=null!=e.maxDec?a(e.maxDec):null,s=t?.maxOverrideDec!=null?a(t.maxOverrideDec):null!=o?a(e.maxDec.plus?.(t?.maxDeltaDec??0)??e.maxDec):null;return{featureKey:e.featureKey,name:r.name,category:r.category,description:r.description,valueType:r.valueType,unit:r.unit,metering:r.metering,aggregation:r.aggregation,scope:r.scope,period:r.period,isEnabled:n,isUnlimited:i,includedInt:e.includedInt??null,maxInt:l,includedDec:null!=e.includedDec?a(e.includedDec):null,maxDec:s,enforcement:e.enforcement,overageMode:e.overageMode,creditEnabled:r.creditEnabled,creditUnit:r.creditUnit??null,creditExpires:r.creditExpires,creditPriority:r.creditPriority,recurringCreditGrantInt:e.recurringCreditGrantInt??null,recurringCreditGrantDec:null!=e.recurringCreditGrantDec?a(e.recurringCreditGrantDec):null,rolloverCredits:e.rolloverCredits,topUpEnabled:e.topUpEnabled,topUpPriceId:e.topUpPriceId??null}}(e,v.get(e.featureKey)||null);for(let e of f){if(_[e.featureKey])continue;let a=await t.db.entitlementFeature.findUnique({where:{key:e.featureKey}});a&&(_[e.featureKey]={featureKey:a.key,name:a.name,category:a.category,description:a.description,valueType:a.valueType,unit:a.unit,metering:a.metering,aggregation:a.aggregation,scope:a.scope,period:a.period,isEnabled:e.isEnabled??!1,isUnlimited:e.isUnlimited??!1,includedInt:0,maxInt:e.maxOverrideInt??e.maxDeltaInt??null,includedDec:"0",maxDec:e.maxOverrideDec?e.maxOverrideDec.toString():e.maxDeltaDec?e.maxDeltaDec.toString():null,enforcement:"HARD",overageMode:"NONE",creditEnabled:a.creditEnabled,creditUnit:a.creditUnit??null,creditExpires:a.creditExpires,creditPriority:a.creditPriority,recurringCreditGrantInt:null,recurringCreditGrantDec:null,rolloverCredits:!1,topUpEnabled:!1,topUpPriceId:null})}return _}function u(e){return e?"SUBACCOUNT":"AGENCY"}e.s(["inferScopeFromIds",()=>u,"resolveEffectiveEntitlements",()=>d],307144)}];

//# sourceMappingURL=src_lib_62c344a8._.js.map